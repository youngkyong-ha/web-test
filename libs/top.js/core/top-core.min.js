Top=function(){function Top(){}Top.version="";Top.getVersion=function(){return this.version};Top.setVersion=function(version){this.version=version};Top.doNotUseThisFuncEver=function(b){Top.__private=b};Top.__isPrivate=function(){return Top.__private};Top.client="";Top.clientEnum={SONE:1};Top.setClient=function(client){if(this.clientEnum.hasOwnProperty(client)){this.client=this.clientEnum[client]}};Top.getClient=function(){return this.client};Top.libsPath="";Top.configs={};Top.events={onCreate:[],onBeforeLoad:[],onLoad:[],onRouteActivate:function(){return true},onRouteDeactivate:function(){return true},onWidgetAttach:{},onWidgetDetach:{},onLibsLoad:{}};Top.routes={};Top.modules={};Top.pages={};Top.pageSrcMap={};Top.curPage=null;Top.curRoute={};Top.dialogList={};Top.dialogArray=[];Top.autoComleteContainers=[];Top.setCookie=function(name,value){var cookie=[name,"=",JSON.stringify(value),";"].join("");document.cookie=cookie};Top.getCookie=function(name){var result=document.cookie.match(new RegExp(name+"=([^;]+)"));result&&(result=JSON.parse(result[1]));return result};return Top}();Top.App=function(){App.prototype=Object.create(Top.prototype);App.prototype.constructor=App;App.checkLocationHash=false;App.calledPopstate=false;function App(){}App.create=function(options){Top.Loader.start("large");var _this=this;options=options||{};options.config=options.config||undefined;this.__initLibsPath();this.__initVersion();this.__initConfigs(options.config,function(){_this.__initAppController(options.controller);_this.__initRoute(options.route,function(){_this.__initEvent(options.event);_this.__initModule(options.module);_this.__initI18n(options.i18n);_this.__createPagesImpl();_this.__load()})});top$(document).on("click",function(e){Top.App.__closeSelectbox();var openedDropdownMenu=this.querySelectorAll(".Menu_type_dropdown .top-menu_btn.top-menu_open");var i=0;var openedDropdownMenuLength=openedDropdownMenu.length;while(i<openedDropdownMenuLength){openedDropdownMenu[i].click();i++}var contextMenu=this.querySelectorAll("top-contextmenu .top-contextmenu-container.open");if(contextMenu){var i=0;var contextMenuLength=contextMenu.length;while(i<contextMenuLength){var menuId=contextMenu[i].parentNode.parentNode.id;Top.Dom.selectById(menuId).close();i++}}e.stopPropagation()});var initTooltipTimer;window.addEventListener("resize",function(e){Top.App.__closeSelectbox();var dropdownMenu=document.querySelectorAll(".Menu_type_dropdown .top-menu_btn.top-menu_open");if(dropdownMenu){var i=0;var dropdownMenuLength=dropdownMenu.length;while(i<dropdownMenuLength){if(dropdownMenu[i].parentNode.parentNode.parentNode.setDropdownPosition){dropdownMenu[i].parentNode.parentNode.parentNode.setDropdownPosition()}i++}}if(initTooltipTimer){clearTimeout(initTooltipTimer)}initTooltipTimer=setTimeout(function(){var textviews=Top.Dom.select("top-textview");for(var i=0;i<textviews.length;i++){if(typeof textviews[i].template.__initTooltip==="function")textviews[i].template.__initTooltip()}},200);var imagesliders=Top.Dom.select("top-imageslider");for(var i=0,len=imagesliders.length;i<len;i++){if(typeof imagesliders[i].reload==="function"){imagesliders[i].reload()}}if(Top.curPage)Top.curPage.template.__adjustLineHeight();e.stopPropagation()});document.addEventListener("scroll",function(e){if(e.target.classList&&e.target.classList.contains("top-tableview-scrollBody"))return;Top.App.__closeSelectbox();var dropdownMenu=document.querySelectorAll('top-menu[type="dropdown"] .top-menu_btn.top-menu_open');if(dropdownMenu){i=0;var dropdownMenuLength=dropdownMenu.length;while(i<dropdownMenuLength){dropdownMenu[i].parentNode.parentNode.parentNode.setDropdownPosition();i++}}Top.App.closeAutoCompleteContainers()});Top.App.__preventTabOutsideDialog()};App.__closeSelectbox=function(){var openedSelectBox=document.querySelectorAll("top-selectbox .top-selectbox-container.active");var i=0;var openedSelectBoxLength=openedSelectBox.length;while(i<openedSelectBoxLength){openedSelectBox[i].click();i++}};App.__closePopover=function(){var popovers=Top.Dom.select("top-popover");for(var i=0,len=popovers.length;i<len;i++){popovers[i].close()}};App.__preventTabOutsideDialog=function(){document.addEventListener("keyup",function(){if(document.getElementsByClassName("top-dialog-overlay").length>0){var ids=Object.keys(Top.App.getDialogs());var zIndex=0;var curDialog;for(var i=0;i<ids.length;i++){var dialog=document.getElementById("top-dialog-root_"+ids[i]);if(zIndex<dialog.style.zIndex){zIndex=dialog.style.zIndex;curDialog=dialog}}if(curDialog&&event.target.id!==""&&curDialog.querySelector("#"+event.target.id)==null){if(Top.Dom.selectById(event.target.id)!==null)Top.Dom.selectById(event.target.id).blur()}}})};App.__load=function(){if(location.hash===""){this.__callEvent(Top.events["onCreate"])}this.loaded=true;this.__callEvent(Top.events["onBeforeLoad"]);this.__callEvent(Top.events["onLoad"]);var pageNames=Object.keys(Top.pages);for(var i=0,len=pageNames.length;i<len;i++){var page=Top.pages[pageNames[i]];page.setProperties({visible:"none"})}if(!Top.curPage){console.error(Top.configs["indexPageId"]+" cannot be found.");return}if(App.__compatibleWithTOP()&&location.hash){this.__routeReplace(location.hash.replace("#!",""))}else if(!Top.curPage.loaded){this.__pageLoad(Top.curPage)}if(Top.curPage.loaded){this.__pageBeforeActivate(Top.curPage);this.__showPage(Top.curPage.id);this.__pageActivate(Top.curPage)}Top.Loader.stop()};App.__loadLibs=function(next){var _this=this;this.__loadExternalHtml(Top.libsPath+"widget/top-widgets.html",function(){next()})};App.__loadStyle=function(next){if(Top.configs.loadStyleSeparately===true||Top.configs.loadStyleSeparately==="true"){var link=document.createElement("link");link.href=Top.libsPath+"css/top-common.css";link.rel="stylesheet";document.head.appendChild(link);link=document.createElement("link");if(Top.Util.Browser.isIE()){link.href=Top.libsPath+"css/top-common_ie.css"}else{link.href=Top.libsPath+"css/top-common_chrome.css"}link.rel="stylesheet";document.head.appendChild(link);var dir=Top.libsPath+"css/widget";var fileextension=".css";var i=0;top$.ajax({url:dir,success:function(data){top$(data).find("a:contains("+fileextension+")").each(function(){var filename=Top.libsPath+"css/widget/"+this.text.trim();if(this.text.endsWith("_ie.css")&&!Top.Util.Browser.isIE()||this.text.endsWith("_chrome.css")&&Top.Util.Browser.isIE()){return}link=document.createElement("link");link.href=filename;link.rel="stylesheet";i++;if(i===60)link.onload=next;document.head.appendChild(link)})}})}else{var link=document.createElement("link");if(Top.Util.Browser.isIE()){link.href=Top.libsPath+"css/top_ie.css"}else{link.href=Top.libsPath+"css/top.css"}link.rel="stylesheet";link.onload=next;document.head.appendChild(link)}if(Top.configs.deploy===undefined||Top.configs.deploy.useDefaultFont!=="false"&&Top.configs.deploy.useDefaultFont!==false){this.__loadFont()}};App.__loadFont=function(){var link=document.createElement("link");link.href=Top.libsPath+"css/font.css";link.rel="stylesheet";document.head.appendChild(link)};App.__loadUserStyle=function(next){if(typeof Top.configs.css==="object"){var styleList=Top.configs.css.filter(function(value){return typeof value==="string"&&!value.includes("_ie.css")});if(Top.Util.Browser.isIE()){styleList=styleList.concat(Top.configs.css.filter(function(value){return typeof value==="string"&&value.includes("_ie.css")}));if(typeof Top.configs.cssIE==="object"&&Top.configs.cssIE.length>0){styleList=styleList.concat(Top.configs.cssIE)}}}if(typeof styleList==="object"){var len=styleList.length;if(len===0){next()}else{var cnt=0;for(var i=0;i<len;i++){this.__loadExternalStyle(styleList[i],function(){cnt++;if(cnt===len)next()})}}}else if(styleList===undefined){next()}else{console.error("Config error: css or cssIE must be an array.");next()}};App.__loadUserLogic=function(next){if(typeof Top.configs.js==="object"){var logicList=Top.configs.js;var len=logicList.length;var cnt=0;for(var i=0,len=logicList.length;i<len;i++){Top.App.__loadExternalScript(logicList[i],function(){cnt++;if(cnt===len){Top.__isLoadedUserLogic=true;if(typeof next==="function")next();Top.App.__callEvent(Top.onLoadUserLogic);Top.onLoadUserLogic=[]}})}}else if(Top.configs.js===undefined){Top.__isLoadedUserLogic=true;if(typeof next==="function")next();Top.App.__callEvent(Top.onLoadUserLogic);Top.onLoadUserLogic=[]}else{console.error("Config error: js must be an array.");Top.__isLoadedUserLogic=true;if(typeof next==="function")next();Top.App.__callEvent(Top.onLoadUserLogic);Top.onLoadUserLogic=[]}};App.__loadControllerFile=function(controllerPaths,onLoad,param){var cnt=0;for(var i=0,len=controllerPaths.length;i<len;i++){Top.App.__loadExternalScript(controllerPaths[i],function(){cnt++;if(cnt===len){onLoad(param)}},function(){cnt++;if(cnt===len){onLoad(param)}})}};App.__loadExternalScript=function(url,onload,onerror){if(Top.App.__useCommonLogic()&&url.startsWith("src/common")){onload();return}if(Top.App.__externalScriptList&&Top.App.__externalScriptList.indexOf(url)!=-1){onload();return}var script=document.createElement("script");script.src=url;script.onload=onload;script.onerror=onerror;script.async=false;script.charset="utf-8";document.head.appendChild(script);if(Top.App.__externalScriptList===undefined){Top.App.__externalScriptList=[]}Top.App.__externalScriptList.push(url)};App.__loadExternalHtml=function(url,onload){var link=document.createElement("link");link.rel="import";link.href=url;link.onload=onload;document.head.appendChild(link)};App.__loadExternalStyle=function(url,onload){var link=document.createElement("link");link.rel="stylesheet";link.href=url;link.onload=onload;document.head.appendChild(link)};App.onLoadUserLogic=function(callback){if(Top.__isLoadedUserLogic===true){callback()}else{if(Top.onLoadUserLogic===undefined)Top.onLoadUserLogic=[];Top.onLoadUserLogic.push(callback)}};App.__pageLoad=function(page){if(page.template.src){page.template.__srcLoad(function(){page.setProperties({loaded:true});Top.App.__execPageEvent(page,"onLoad");if(!page.getProperties("activated")){Top.App.__pageBeforeActivate(page);Top.App.__showPage(page.id);Top.App.__pageActivate(page)}Top.App.__makeTooltip(page);Top.App.__makeContextMenu(page)})}else{page.setProperties({loaded:true});page.loaded=true;this.__execPageEvent(page,"onLoad");this.__makeTooltip(page);Top.App.__makeContextMenu(page)}};App.__makeTooltip=function(page){var span=document.createElement("span");span.className="top-tooltip-text";page.template.appendChild(span);var div=document.createElement("div");div.className="top-tooltip-arrow";page.template.appendChild(div)};App.__makeContextMenu=function(page){var contextmenu=Top.Widget.create("top-contextmenu");page.template.appendChild(contextmenu.template);TopRuntime._callCallback(contextmenu.template,"attached");Top.ContextMenu.setWidget(contextmenu)};App.__pageBeforeActivate=function(page){this.__execPageEvent(page,"onBeforeActivate")};App.__pageActivate=function(page){page.onActivate(function(){});Top.curPage=page;page.setProperties({activated:true});this.__execPageEvent(page,"onActivate")};App.__pageDeactivate=function(page){page.onDeactivate(function(){});page.setProperties({activated:false});this.__execPageEvent(page,"onDeactivate")};App.__initLibsPath=function(){var path=document.getElementById("top.js").src;var fileName=Top.Util.getFileName(path);Top.libsPath=path.split(fileName)[0]};App.__initVersion=function(){Top.Ajax.execute(Top.libsPath+"core/version",{success:function(data){Top.setVersion(data)}})};App.__initConfigs=function(configs,next){if(typeof configs==="string"){var _this=this;Top.Ajax.execute(configs,{success:function(data){Top.configs=JSON.parse(data);_this.__postInitConfigs(next)}})}else if(typeof configs==="object"){var keys=Object.keys(configs);for(var i=0,len=keys.length;i<len;i++){var key=keys[i];var value=configs[key];Top.configs[key]=value}this.__postInitConfigs(next)}else{console.error("Config is not defined.")}};App.__postInitConfigs=function(next){this.__initDebug(Top.configs.debug);if(Top.configs.indexPageId===undefined){console.error("Config error: indexPageId must be defined.");return}if(Top.configs.name===undefined){Top.configs.name="TOP Application"}this.setTitle(Top.configs.name);var _this=this;this.__loadStyle(function(){_this.__loadUserStyle(function(){if(Top.App.__compatibleWithTOP()){Top.ValuesManager.__initTheme();Top.App.onBeforeLoad(_this.__loadUserLogic);next()}else{Top.ValuesManager.__initTheme();_this.__loadUserLogic(function(){next()})}})})};App.getConfig=function(key){return Top.configs[key]};App.getConfigs=function(){return Top.configs};App.setTitle=function(title){document.title=title};App.onBeforeLoad=function(func){Top.events.onBeforeLoad.push(func)};App.onLoad=function(func){if(this.isLoaded()){func()}else{Top.events.onLoad.push(func)}};App.isLoaded=function(){return this.loaded};App.__initAppController=function(controllerName){if(typeof controllerName!=="string")return;var controller=Top.Controller.get(controllerName);if(typeof controller==="object"){Top.Controller.setAppController(controller);controller.__setBoundWidget()}};App.__initModule=function(module){if(typeof module!=="object")return;Top.modules=module};App.__initEvent=function(events){if(typeof events!=="object")return;var len=Object.keys(events).length;for(var i=0;i<len;i++){var key=Object.keys(events)[i];var value=events[key];if(Top.events[key]){Top.events[key].push(value)}}};App.__initI18n=function(settings){if(typeof settings!=="object")return;Top.i18n.load(settings)};App.__initDebug=function(settings){if(typeof settings!=="object")return;if(typeof settings.livereload==="object"&&Top.Util.Browser.isChrome()){this.__initLiveReload(settings.livereload)}};App.__initLiveReload=function(userOptions){var options={host:"localhost",port:"52790"};Object.assign(options,userOptions);var liveReload=Top.LiveReload.create({options:options});if(liveReload.WebSocket!=null){liveReload.connect()}};App.addEvent=function(event){this.__initEvent(event)};App.__callEvent=function(events,params){if(typeof events==="object"){for(var i=0,len=events.length;i<len;i++){this.__callEventImpl(events[i],params)}}else if(typeof events==="function"){this.__callEventImpl(events,params)}else if(typeof events==="string"){var fn=Top.Util.namespace(events);if(typeof fn==="function")fn()}};App.__callEventImpl=function(eventFunc,params){if(typeof eventFunc==="string"){if(location.hash==""){Top.Util.namespace(eventFunc)(params)}}else{eventFunc(params)}};App.__execPageEvent=function(page,event){var func=page.template[event];if(typeof func==="function")func(page)};App.__initRoute=function(routings,next){if(typeof routings==="string"){var _this=this;Top.Ajax.execute(routings,{success:function(data){var dataObj=JSON.parse(data);_this.__initObjectDepth(dataObj,0);Top.routes=_this.__createRoutes(dataObj);_this.__postInitRoute();next()}})}else if(typeof routings==="object"){this.__initObjectDepth(routings,0);Top.routes=this.__createRoutes(routings);this.__postInitRoute();next()}else{this.__postInitRoute();next()}};App.addRoute=function(routings){if(typeof routings==="string"){var _this=this;Top.Ajax.execute(routings,{success:function(data){var dataObj=JSON.parse(data);_this.__initObjectDepth(dataObj,0);Object.assign(Top.routes,_this.__createRoutes(dataObj))}})}else if(typeof routings==="object"){this.__initObjectDepth(routings,0);Object.assign(Top.routes,this.__createRoutes(routings))}};App.removeRoute=function(path){delete Top.routes[path]};App.__initObjectDepth=function(object,level){object.__depth=level;level++;for(var key in object){if(typeof object[key].route==="object"){this.__initObjectDepth(object[key].route,level)}}};App.__createRoutes=function(routeInfo){var routes={};var keys=Object.keys(routeInfo);for(var i=0,len=keys.length;i<len;i++){var from=keys[i];var to=routeInfo[from];if(from!=="__depth"&&typeof to!=="object"){temp=to;to={};to.activate=temp}if(typeof to.activate==="function"){to.__dest=this.__makeDestFunction(to,from,routeInfo.__depth)}else if(typeof Top.Util.namespace(to.activate)==="function"){to.activate=Top.Util.namespace(to.activate);to.__dest=this.__makeDestFunction(to,from,routeInfo.__depth)}else if(typeof to.activate==="string"&&Top.Dom.selectById(to.activate)){to.__dest=this.__makeDestPage(to)}else if(to.activate===undefined){to.activate=function(params,data,next){next()};to.__dest=this.__makeDestFunction(to,from,routeInfo.__depth)}else{console.error("Routing error: '"+to.activate+"' is not defined.")}routes[from]={};routes[from].dest=to.__dest;if(typeof to.route==="object"){routes[from].route=this.__createRoutes(to.route)}}return routes};App.__postInitRoute=function(){Top.routes["/"]={};Top.routes["/"].dest=function(){window.location=document.location.origin+document.location.pathname}};App.__routeToBack=function(beforePath){var route=this.__searchRoute(Top.routes,beforePath);if(beforePath!=="/"&&route!==undefined&&typeof route.dest==="function"){if(!Top.Dom.selectById(Top.curRoute.beforeRootLayout)){Top.curPage.src(Top.curRoute.beforeRootLayout+".html",function(){Top.App.routeTo(beforePath)})}}else if(beforePath==="/"){Top.App.routeTo(beforePath)}else{Top.App.back()}};App.__popstate=function(){Top.App.closeDialogs();if(event.state&&event.state.path){Top.App.__routeReplace(event.state.path)}else if(location.hash){Top.App.checkLocationHash=true;Top.App.__routeReplace(location.hash.replace("#!",""))}else if(location.hash===""){Top.App.__routeReplace()}};App.routeTo=function(path,data,__popstate){if(Top.configs.appRouting!==false){var route=this.__searchRoute(Top.routes,path);if(route!==undefined&&typeof route.dest==="function"){route.dest(path,data,__popstate)}else if(Array.isArray(route)){var i=0;var makeNext=function(){i++;if(i<route.length-1){return route[i].dest(path,data,__popstate,makeNext)}else if(i===route.length-1){return route[i].dest(path,data,__popstate)}};route[0].dest(path,data,__popstate,makeNext)}else if(path.indexOf("#")!==-1){var routePath="";routePath+=Top.curRoute.path;routePath+=path;if(routePath.substring(0,2)==="//"){routePath=routePath.substring(1,routePath.length)}if(this.checkLocationHash){window.history.pushState({path:routePath},"","#!"+routePath)}else{var originRoute=routePath.split("#")[0];window.history.pushState({path:originRoute},"","#!"+originRoute);Top.App.reload()}}else{Top.App.__notFoundPage(path)}this.checkLocationHash=false}};App.__notFoundPage=function(path){var _this=this;var pageSource404=_this.page404||"page/contents_404.html";var imageSource404=_this.image404||"page/res/error_img_404.png";console.error("Routing error: "+path+" is not defined.");Top.curRoute.before=Top.curRoute.path;Top.curRoute.path=path;Top.curRoute.act=null;Top.curRoute.deact=null;Top.curRoute.data=null;Top.curRoute.params=null;var rootLayout=Top.curPage.template.children;if(rootLayout.length>0){if(rootLayout[0].id.indexOf("Top_404_error_layout")===-1){Top.curRoute.beforeRootLayout=rootLayout[0].id}else{Top.curRoute.beforeRootLayout=Top.curRoute.beforeRootLayout}}else{Top.curRoute.beforeRootLayout=Top.curPage.template.src.split("?")[0].split(".")[0]}if(!this.checkLocationHash)window.history.pushState({path:path},"","#!"+path);if(Top.curPage.getVisible()!=="visible"||Top.curPage.getVisible()!==true||Top.curPage.getVisible()!=="true"){Top.curPage.setVisible("visible")}Top.curPage.src(Top.libsPath+pageSource404,function(){var layout=Top.curPage.selectById("Top_404_error_layout");if(Top.curPage.selectById("imageError404"))Top.curPage.selectById("imageError404").setSrc(Top.libsPath+imageSource404);if(!_this.fn404_back){_this.fn404_back=function(layout){layout.selectById("backButton_404").setProperties({"on-click":"Top.App.__routeToBack(Top.curRoute.before)"})}}if(!_this.fn404){_this.fn404=function(layout){layout.selectById("mainButton_404").setProperties({"on-click":"Top.App.routeTo('/')"})}}_this.fn404_back(layout);_this.fn404(layout)})};App.onLoad404=function(fn){this.fn404=fn};App.reset404=function(pageSrc,imageSrc){this.page404=pageSrc;this.image404=imageSrc};App.load404Page=function(){Top.App.__notFoundPage("/404")};App.__notAccessPage=function(path){var _this=this;var pageSource403=_this.page403||"page/contents_403.html";var imageSource403=_this.image403||"page/res/error_img_403.png";console.error("Access error: You are not authorized to view this page");Top.curRoute.before=Top.curRoute.path;Top.curRoute.path=path;Top.curRoute.act=null;Top.curRoute.deact=null;Top.curRoute.data=null;Top.curRoute.params=null;var rootLayout=Top.curPage.template.children;if(rootLayout.length>0){if(rootLayout[0].id.indexOf("Top_403_error_layout")===-1){Top.curRoute.beforeRootLayout=rootLayout[0].id}else{Top.curRoute.beforeRootLayout=Top.curRoute.beforeRootLayout}}else{Top.curRoute.beforeRootLayout=Top.curPage.template.src.split("?")[0].split(".")[0]}if(!this.checkLocationHash)window.history.pushState({path:path},"","#!"+path);if(Top.curPage.getVisible()!=="visible"||Top.curPage.getVisible()!==true||Top.curPage.getVisible()!=="true"){Top.curPage.setVisible("visible")}Top.curPage.src(Top.libsPath+pageSource403,function(){var layout=Top.curPage.selectById("Top_403_error_layout");if(Top.curPage.selectById("imageError403"))Top.curPage.selectById("imageError403").setSrc(Top.libsPath+imageSource403);if(!_this.fn403_back){_this.fn403_back=function(layout){layout.selectById("backButton_403").setProperties({"on-click":"Top.App.__routeToBack(Top.curRoute.before)"})}}if(!_this.fn403){_this.fn403=function(layout){layout.selectById("mainButton_403").setProperties({"on-click":"Top.App.routeTo('/')"})}}_this.fn403_back(layout);_this.fn403(layout)})};App.reset403=function(pageSrc,imageSrc){this.page403=pageSrc;this.image403=imageSrc};App.load403Page=function(fn){this.fn403=fn;Top.App.__notAccessPage()};App.__routeReplace=function(path){if(path!=null){this.routeTo(path,undefined,true)}else{var dest=Top.routes["/"].dest;dest();Top.App.checkLocationHash=false}};App.back=function(){window.history.back()};App.forward=function(){window.history.forward()};App.reload=function(forcedReload){window.location.reload(forcedReload)};App.openWindow=function(path,name,features){if(path.includes("http")){window.open(path,name,features)}else{var location=window.location.origin+window.location.pathname+"#!";window.open(location+path,name,features)}};App.__makeDestFunction=function(to,from,depth){return function(path,data,popstate,next){if(typeof Top.curRoute.deact==="function")Top.curRoute.deact();if(typeof to.deactivate==="string"){to.deactivate=Top.Util.namespace(to.deactivate)}if(typeof to.deactivate==="function"){Top.curRoute.deact=to.deactivate}else{Top.curRoute.deact=function(){}}var params={};var paramKeys=from.split("/");paramKeys.splice(0,1);var values=path.split("/");values.splice(0,1);if(to.type==="POST"||to.type==="post"){var query={};var lastIndex=values.length-1;if(values[lastIndex].includes("?")){var queryString=values[values.length-1].split("?")[1];var queryList=queryString.split("&");for(var i=0,len=queryList.length;i<len;i++){var queryValue=queryList[i].split("=");if(queryValue[0]!=="")query[queryValue[0]]=queryValue[1]}values[lastIndex]=values[lastIndex].replace("?"+queryString,"")}}if(paramKeys.length===1){for(var i=0,len=values.length;i<len;i++){if(paramKeys[0]===values[i]){params["_default"+i]=values[i]}}if(Object.keys(params).length===0){params[paramKeys[0].replace(":","")]=values[depth]}var pathLen=depth+1}else if(paramKeys.length>1){for(var i=0,len=values.length;i<len;i++){if(paramKeys[i].indexOf(":")!==-1){params[paramKeys[i].replace(":","")]=values[i]}else{params["_default"+i]=values[i]}}var pathLen=values.length}var routePath="";for(var i=0;i<pathLen;i++){routePath+="/"+values[i]}if(popstate!==true&&next===undefined){window.history.pushState({path:routePath},"","#!"+routePath)}Top.curRoute.before=Top.curRoute.path;Top.curRoute.path=routePath;Top.curRoute.act=to.activate;Top.curRoute.data=data;if(depth===0)Top.curRoute.params={};Object.assign(Top.curRoute.params,params);if(query)Top.curRoute.query=query;if(Top.curPage.getVisible()==="visible"||Top.curPage.getVisible()===true||Top.curPage.getVisible()==="true"){if(path!==Top.curRoute.before){to.activate.call(Top.Controller.getAppController(),params,data,next)}}else{Top.curPage.setVisible("visible");to.activate.call(Top.Controller.getAppController(),params,data,next)}}};App.__makeDestPage=function(to){return function(path,data,popstate){Top.curRoute.before=Top.curRoute.path;Top.curRoute.path=path;Top.curRoute.act=to.activate;Top.curRoute.data=data;if(to.deactivate){Top.curRoute.deact=to.deactivate}else{Top.curRoute.deact=function(){}}if(popstate!==true)window.history.pushState({path:path},"","#!"+path);Top.App.__goToImpl(to.activate);Top.i18n.__clearBoundWidget()}};App.__searchRoute=function(routeObj,path,__fromInner){if(path.includes("?"))path=path.split("?")[0];if(routeObj===undefined)return undefined;if(routeObj[path]!==undefined){return routeObj[path]}var parts=path.split("/");parts.splice(0,1);var pattern="";for(var i=0,len=parts.length;i<len;i++){pattern+="/:([a-zA-Z0-9]+)"}var keys=Object.keys(routeObj);for(var i=0,len=keys.length;i<len;i++){var match=keys[i].match(pattern);if(match){return routeObj[match[0]]}}if(!__fromInner)return this.__searchInnerRoute(parts)};App.__searchInnerRoute=function(parts){var routes=[];var route=this.__searchRoute(Top.routes,"/"+parts[0],true);if(parts.length>1&&parts[0].length===0)return undefined;if(route!==undefined){routes.push(route)}else{return undefined}for(var i=1,len=parts.length;i<len;i++){if(routes[i-1]!==undefined)routes.push(this.__searchRoute(routes[i-1].route,"/"+parts[i],true))}return routes};App.__goToImpl=function(pageId){if(Top.curPage.getProperties("activated"))this.__pageDeactivate(Top.curPage);var page=Top.pages[pageId];if(page===undefined)return;if(!page.loaded){this.__pageLoad(page)}if(page.loaded){this.__pageBeforeActivate(page);this.__showPage(pageId);this.__pageActivate(page)}};App.__showPage=function(pageId){Top.curPage.setProperties({visible:"none"});var page=Top.pages[pageId];page.setProperties({visible:"visible"})};App.__createPagesImpl=function(){var elements=document.getElementsByTagName("top-page");var cnt=elements.length;for(var i=0;i<cnt;i++){var element=elements[i];if(!Top.pages.hasOwnProperty(element.id)){var widget=Top.Widget.create("top-page",undefined,element);Top.pages[widget.id]=widget;if(widget.getSrc()!==undefined)Top.pageSrcMap[widget.getSrc()]=widget.id}}Top.curPage=Top.pages[Top.configs["indexPageId"]];Top.curRoute.path="/";var params={};params.from=Top.curRoute.path;params.to=Top.curRoute.path;Top.events.onRouteActivate(params)};App.goToPage=function(pageId){Top.App.__goToImpl(pageId)};App.getPages=function(){return Top.pages};App.getCurrentPage=function(){return Top.curPage};App.getPage=function(pageId){return Top.pages[pageId]};App.getPageIdBySrc=function(src){return Top.pageSrcMap[src]};App.onWidgetAttach=function(widgetId,func){if(this.isWidgetAttached(widgetId)){func(Top.Dom.selectById(widgetId))}else{if(Top.events.onWidgetAttach[widgetId]===undefined){Top.events.onWidgetAttach[widgetId]=[]}Top.events.onWidgetAttach[widgetId].push(func)}};App.onWidgetDetach=function(widgetId,func){if(Top.events.onWidgetDetach[widgetId]===undefined){Top.events.onWidgetDetach[widgetId]=[]}Top.events.onWidgetDetach[widgetId].push(func)};App.isWidgetAttached=function(widgetId){return document.getElementById(widgetId)!=null};App.onRouteActivate=function(func){Top.events.onRouteActivate=func};App.onRouteDeactivate=function(func){Top.events.onRouteDeactivate=func};App.current=function(){var __current={};__current.before=Top.curRoute.before;__current.path=Top.curRoute.path;__current.params=Top.curRoute.params;__current.data=Top.curRoute.data;if(Top.curRoute.query)__current.query=Top.curRoute.query;return __current};App.__compatibleWithTOP=function(){return Top.configs.compatibleWithTOP==="true"||Top.configs.compatibleWithTOP===true};App.__useCommonLogic=function(){return Top.configs.deploy&&(Top.configs.deploy.common==="true"||Top.configs.deploy.common===true)};App.addDialog=function(id,dialog){Top.dialogList[id]=dialog;if(Top.configs.closeDialogToBrowserBack){Top.dialogArray.push(dialog)}};App.removeDialog=function(id){delete Top.dialogList[id];if(Top.configs.closeDialogToBrowserBack){Top.dialogArray.pop()}};App.getDialogs=function(){return Top.dialogList};App.closeDialogs=function(){var ids=Object.keys(Top.dialogList);for(var i=0,len=ids.length;i<len;i++){Top.dialogList[ids[i]].close()}};App.openDialog=function(params){return Top.Action.dialogCreate(params)};App.addAutoCompleteContainer=function(autoCompleteContainer){Top.autoComleteContainers.push(autoCompleteContainer)};App.closeAutoCompleteContainers=function(){for(var i=0,len=Top.autoComleteContainers.length;i<len;i++){Top.autoComleteContainers[i].blur()}};App.closeOpenedSelectBox=function(){var openedSelectBox=document.querySelectorAll("top-selectbox .top-selectbox-container.active");var i=0;var openedSelectBoxLength=openedSelectBox.length;while(i<openedSelectBoxLength){openedSelectBox[i].click();i++}};App.createBlur=function(focusedWidgets){if(this.__blurLayout===undefined){this.__blurLayout=document.createElement("div");this.__blurLayout.setAttribute("style","position:fixed;top:0;left:0;width:100%;height:100%;background-color:#7d7d7d;opacity:0.5;z-index:100");this.getCurrentPage().template.appendChild(this.__blurLayout)}if(typeof focusedWidgets==="string"){this.__adjustFocusWidgets(focusedWidgets)}else if(typeof focusedWidgets==="object"){for(var i=0,len=focusedWidgets.length;i<len;i++){this.__adjustFocusWidgets(focusedWidgets[i])}}if(this.__userLayout===undefined){this.__userLayout=Top.Widget.create("top-layout");this.__userLayout.getElement(".top-layout-root")[0].setAttribute("style","position:fixed;top:0;left:0;width:100%;height:100%;background-color:transparent;z-index:101");this.getCurrentPage().template.appendChild(this.__userLayout.template)}return this.__userLayout};App.removeBlur=function(){if(this.__blurLayout!==undefined){this.__blurLayout.remove();delete this.__blurLayout}if(this.__userLayout!==undefined){this.__userLayout.template.remove();delete this.__userLayout}if(typeof this.__focusedWidgets==="object"){var widgetIds=Object.keys(this.__focusedWidgets);for(var i=0,len=widgetIds.length;i<len;i++){var widget=Top.Dom.selectById(widgetIds[i]);var zIndex=this.__focusedWidgets[widgetIds[i]];widget.setProperties({"z-index":zIndex})}}};App.__adjustFocusWidgets=function(widgetId){if(this.__focusedWidgets===undefined)this.__focusedWidgets={};var widget=Top.Dom.selectById(widgetId);if(widget!==null){var originZIndex=widget.getProperties("z-index");widget.setProperties({"z-index":101});this.__focusedWidgets[widget.id]=originZIndex}};return App}();Top.Action=function(){Action.prototype=Object.create(Top.prototype);Action.prototype.constructor=Action;function Action(){}Action.windowCreate=function(params){};Action.windowDestroy=function(params){};Action.pageNavigate=function(params){if(params.type==="forward"){Top.App.forward()}else if(params.type==="back"){Top.App.back()}else{Top.App.routeTo("/"+params.targetPage)}};Action.widgetCreate=function(params){for(var i=0,len=params.widgets.length;i<len;i++){var parent=Top.Dom.selectById(params.parentId);if(parent!==null){var widget=Top.Widget.create(params.widgets[i].type);this.__setWidgetProperties(widget,params.widgets[i]);this.__addWidget(parent,widget,params.targetIndex)}}};Action.widgetDestroy=function(params){for(var i=0,len=params.widgets.length;i<len;i++){var parent=Top.Dom.selectById(params.parentId);var widget=Top.Dom.selectById(params.widgets[i].id);if(parent!==null&&widget!==null){parent.removeWidget(widget);parent.complete()}}};Action.widgetChange=function(params){for(var i=0,len=params.widgets.length;i<len;i++){var keys=Object.keys(params.widgets[i]);var widget=Top.Dom.selectById(params.widgets[i].id);if(widget!==null){this.__setWidgetProperties(widget,params.widgets[i]);
}}};Action.widgetMove=function(params){var parent=Top.Dom.selectById(params.parentId);var widget=Top.Dom.selectById(params.targetId);if(parent!==null&&widget!==null){this.__addWidget(parent,widget,params.targetIndex)}};Action.FragmentShow=function(params){};Action.FragmentRemove=function(params){};Action.dialogCreate=function(params){if(typeof params!=="object")return;var id=params.id||Top.Util.guid();var newDialog=Top.Widget.create("top-dialog");params.id=id;params.removeOnClose=true;newDialog.setProperties(params);var page=Top.App.getCurrentPage();page.template.appendChild(newDialog.template);TopRuntime._callCallback(newDialog.template,"attached");newDialog.open();return newDialog};Action.__setWidgetProperties=function(widget,props){var keys=Object.keys(props);var obj={};var resourcePattern=/^@(string|color|dimen|raw|drawable|style|theme)(\/[a-zA-Z0-9]+)+$/;var isIncludedHeader=false;for(var i=0,len=keys.length;i<len;i++){if(keys[i]=="id"||keys[i]=="collectionHeaders"){if(keys[i]=="collectionHeaders")isIncludedHeader=true;continue}var value=props[keys[i]];if(resourcePattern.test(value)){var modifiedValue;var resourceType=value.split("/")[0];var resourceId=value.substr(value.indexOf("/")+1);switch(resourceType){case"@drawable":{modifiedValue=Top.DrawableManager.get(resourceId);break}case"@raw":{modifiedValue=Top.RawManager.get(resourceId);break}default:{resourceId=resourceId.substr(0,resourceId.lastIndexOf("/"));var resourceName=originValue.split("/");resourceName=resourceName[resourceName.length-1];switch(resourceType){case"@string":{modifiedValue=Top.ValuesManager.get("strings",resourceId)[resourceName];break}case"@color":{modifiedValue=Top.ValuesManager.get("colors",resourceId)[resourceName];break}case"@dimen":{modifiedValue=Top.ValuesManager.get("dimen",resourceId)[resourceName];break}}}}value=modifiedValue}if(keys[i]==="layoutWidth"||keys[i]==="layoutHeight"||keys[i]==="margin"||keys[i]==="padding"||keys[i]==="textSize"||keys[i]==="minSidth"||keys[i]==="minHeight"||keys[i]==="maxWidth"||keys[i]==="maxHeight"||keys[i]==="layoutTop"||keys[i]==="layoutLeft"||keys[i]==="tabMaxWidth"||keys[i]==="borderWidth"||keys[i]==="borderRadius"){if(!isNaN(parseFloat(value)))value=value.concat("px")}obj[keys[i]]=value}widget.setProperties(obj);if(isIncludedHeader)this.__setWidgetCollectionHeaderProperties(widget,props["collectionHeaders"])};Action.__setWidgetCollectionHeaderProperties=function(parentWidget,props){var keys=Object.keys(props);var obj={};var resourcePattern=/^@(string|color|dimen|raw|drawable|style|theme)(\/[a-zA-Z0-9]+)+$/;if(parentWidget.template.tagName==="TOP-TABLEVIEW"){for(var i=0,len=keys.length;i<len;i++){var value=props[keys[i]];if(resourcePattern.test(value)){var modifiedValue;var resourceType=value.split("/")[0];var resourceId=value.substr(value.indexOf("/")+1);switch(resourceType){case"@drawable":{modifiedValue=Top.DrawableManager.get(resourceId);break}case"@raw":{modifiedValue=Top.RawManager.get(resourceId);break}default:{resourceId=resourceId.substr(0,resourceId.lastIndexOf("/"));var resourceName=originValue.split("/");resourceName=resourceName[resourceName.length-1];switch(resourceType){case"@string":{modifiedValue=Top.ValuesManager.get("strings",resourceId)[resourceName];break}case"@color":{modifiedValue=Top.ValuesManager.get("colors",resourceId)[resourceName];break}case"@dimen":{modifiedValue=Top.ValuesManager.get("dimen",resourceId)[resourceName];break}}}}value=modifiedValue}if(keys[i]=="headerColumn"){this.__setWidgetCollectionItemProperties(parentWidget,value);continue}else if(keys[i]!=="parent"){obj[keys[i]]=value}}parentWidget.__setTableHeaderStyle(obj)}};Action.__setWidgetCollectionItemProperties=function(parentWidget,props){var resourcePattern=/^@(string|color|dimen|raw|drawable|style|theme)(\/[a-zA-Z0-9]+)+$/;for(var i=0,len=props.length;i<len;i++){var keys=Object.keys(props[i]);var obj={};if(parentWidget.template.tagName==="TOP-TABLEVIEW"){for(var j=0;j<keys.length;j++){var value=props[i][keys[j]];if(resourcePattern.test(value)){var modifiedValue;var resourceType=value.split("/")[0];var resourceId=value.substr(value.indexOf("/")+1);switch(resourceType){case"@drawable":{modifiedValue=Top.DrawableManager.get(resourceId);break}case"@raw":{modifiedValue=Top.RawManager.get(resourceId);break}default:{resourceId=value.split("/")[1];var resourceName=value.split("/")[2];switch(resourceType){case"@string":{modifiedValue=Top.ValuesManager.get("strings",resourceId)[resourceName];break}case"@color":{modifiedValue=Top.ValuesManager.get("colors",resourceId)[resourceName];break}case"@dimen":{modifiedValue=Top.ValuesManager.get("dimen",resourceId)[resourceName];break}}}}value=modifiedValue}if(keys[j]!=="parent"){obj[keys[j]]=value}}}parentWidget.__setHaderColumnStyle(obj)}};Action.__addWidget=function(parent,widget,targetIndex){if(typeof parent.addWidgetByIndex==="function"){parent.addWidgetByIndex(widget,targetIndex)}else{parent.addWidget(widget)}parent.complete();parent.adjustWidgets()};return Action}();Top.Data=function(){Data.prototype=Object.create(Top.prototype);Data.prototype.constructor=Data;Data.map={};Data.prototype.__allValues={};Data.prototype.__boundWidgets={};Data.prototype.__boundDevices={};Data.prototype.__initialValues={};Data.prototype.__isBackward=false;Data.prototype.__modelInfo={};function Data(obj,name){Object.assign(this,obj);this.id=Top.Util.guid();this.__boundWidgets={};this.__boundDevices={};this.__name=name;this.__getAllValues(this);var keys=Object.keys(this.__allValues);for(var i=0,len=keys.length;i<len;i++){if(typeof this.__allValues[keys[i]]==="string"&&this.__allValues[keys[i]].startsWith("{#")){this.__initBoundDevices(keys[i],this.__allValues[keys[i]].replace("{#","").replace("}",""))}}this.__initialValues=this.getValues()}Data.create=function(name,data){if(typeof name==="object"&&data===undefined){return new Data(name,"")}else if(typeof name==="string"&&typeof data==="object"){if(Top.Controller.current===undefined){window[name]=new Data(data,name)}else{if(Top.Controller.map[Top.Controller.current][name]===undefined){var dataImpl=new Data(data,name);this.map[name]=dataImpl;Top.Controller.map[Top.Controller.current][name]=dataImpl}}}else{console.error("Type error: Top.Data.create(string, object)")}};Data.prototype.__getAllValues=function(object,parentName){var keys=Object.keys(object);if(typeof parentName==="undefined"){parentName=""}else{parentName=parentName+"."}for(var i=0,len=keys.length;i<len;i++){if(typeof object[keys[i]]==="object"&&object[keys[i]]!=null){this.__getAllValues(object[keys[i]],parentName+keys[i])}else{this.__allValues[parentName+keys[i]]=object[keys[i]]}}};Data.prototype.__initBoundDevices=function(dataField,value){var parts=value.split(".");for(var i=0;i<parts.length;i++){if(Top.Util.namespace(parts[i])instanceof Top.Device){var device=Top.Util.namespace(parts[i]);var valuePath=value.split(parts[i]+".")[1];break}}device.__addBoundData(valuePath,this,dataField);this.__addBoundDevice(dataField,device,valuePath);this.setValue(dataField,device.getValue(valuePath))};Data.prototype.__addBoundWidget=function(valuePath,widgetId,prop){valuePath=valuePath.split("+")[0];var bindingInfo={};bindingInfo.widgetId=widgetId;bindingInfo.property=prop;bindingInfo.valuePath=valuePath;var parts=valuePath.split(".");var bindingPath=parts[0];if(this.__boundWidgets[bindingPath]===undefined)this.__boundWidgets[bindingPath]=[];if(this.__hasBindingInfo(bindingPath,bindingInfo)===false){this.__boundWidgets[bindingPath].push(bindingInfo)}for(var i=1,len=parts.length;i<len;i++){bindingPath+="."+parts[i];if(this.__boundWidgets[bindingPath]===undefined)this.__boundWidgets[bindingPath]=[];if(this.__hasBindingInfo(bindingPath,bindingInfo)===false){this.__boundWidgets[bindingPath].push(bindingInfo)}}};Data.prototype.__hasBindingInfo=function(path,info){var widgets=this.__boundWidgets[path];for(var i=0,len=widgets.length;i<len;i++){if(widgets[i].widgetId===info.widgetId&&widgets[i].property===info.property&&widgets[i].valuePath===info.valuePath){return true}}return false};Data.prototype.__updateBoundWidgets=function(key,__fromWidgetId,__fromControllerWidgetId){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundWidgetsImpl(key[i],__fromWidgetId,__fromControllerWidgetId)}}else{this.__updateBoundWidgetsImpl(key,__fromWidgetId,__fromControllerWidgetId)}};Data.prototype.__updateBoundWidgetsImpl=function(key,__fromWidgetId,__fromControllerWidgetId){var key=this.__searchBoundKey(key);if(this.__boundWidgets&&this.__boundWidgets[key]){var bindingInfoList=this.__boundWidgets[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];if(__fromWidgetId&&bindingInfo["widgetId"]==__fromWidgetId)continue;else if(__fromControllerWidgetId&&bindingInfo["widgetId"]!=__fromControllerWidgetId)continue;var widget=Top.Dom.selectById(bindingInfo["widgetId"]);if(__fromControllerWidgetId&&bindingInfo["__isInitCalled"]&&widget&&widget.template.tagName==="TOP-TABLEVIEW")continue;if(bindingInfo["__isInitCalled"]===undefined)bindingInfo["__isInitCalled"]=true;var prop=bindingInfo["property"];var value=prop==="items"?this.getValue(bindingInfo["valuePath"].split("+")[0]):this.getValue(bindingInfo["valuePath"]);var obj={};obj[prop]=value;if(widget)widget.setProperties(obj,true)}}};Data.prototype.__searchBoundKey=function(key){var parts=key.split(".");var path=key;var boundKey="";if(this.__boundWidgets[path]){boundKey=path}else{for(var i=1,len=parts.length;i<len;i++){var pos=path.lastIndexOf(parts[len-i]);path=path.substring(0,pos-1);if(this.__boundWidgets[path]&&this.__hasValuePath(this.__boundWidgets[path],path)){boundKey=path;break}}}return boundKey};Data.prototype.__hasValuePath=function(list,valuePath){for(var i=0,len=list.length;i<len;i++){if(list[i].valuePath==valuePath){return true}}return false};Data.prototype.__addBoundDevice=function(dataField,device,valuePath){var pathRoot=dataField.split(".")[0];var bindingInfo={};bindingInfo.device=device;bindingInfo.dataField=dataField;bindingInfo.valuePath=valuePath;if(this.__boundDevices[pathRoot]===undefined)this.__boundDevices[pathRoot]=[];this.__boundDevices[pathRoot].push(bindingInfo)};Data.prototype.__updateBoundDevices=function(key){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundDevicesImpl(key[i])}}else{this.__updateBoundDevicesImpl(key)}};Data.prototype.__updateBoundDevicesImpl=function(key){if(this.__boundDevices&&this.__boundDevices[key]){var bindingInfoList=this.__boundDevices[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];var device=bindingInfo["device"];var value=this.getValue(bindingInfo["dataField"]);var valuePath=bindingInfo["valuePath"];device.setValue(valuePath,value)}}};Data.prototype.getValues=function(){var values={};var keys=Object.keys(this);for(var i=0,len=keys.length;i<len;i++){if(keys[i]!="id"&&keys[i]!="__boundDevices"&&keys[i]!="__boundWidgets"&&keys[i]!="__initialValues"&&keys[i]!="__isBackward"&&typeof this[keys[i]]!=="function"){values[keys[i]]=JSON.parse(JSON.stringify(this[keys[i]]))}}return values};Data.prototype.getValue=function(path){if(this.__isBackward){if(!path.startsWith("data."))path="data."+path}var value=this;var arrPath=path.split(".");for(var i=0,len=arrPath.length;i<len;i++){if(value[arrPath[i]]!==undefined){value=value[arrPath[i]]}else{return}}return value};Data.prototype.__getValueWithConverter=function(path){var fields=path.split("+")[0];var converter=Top.Util.namespace(path.split("+")[1]);var value=this.getValue(fields);if(typeof converter.convert==="function"){return converter.convert(value)}else{return value}};Data.prototype.getData=function(keys){return this[keys]};Data.prototype.setData=function(values){if(this.__isBackward){var keys=Object.keys(values);for(var i=0,len=keys.length;i<len;i++){this["data"][keys[i]]=values[keys[i]]}this.__updateBoundWidgets("data."+keys);this.__updateBoundDevices("data."+keys)}else if(arguments.length===2&&typeof arguments[0]==="string"&&typeof arguments[1]==="object"){this.setValue(arguments[0],arguments[1])}else{this.setValues(values)}this.__updateRelationsBinding()};Data.prototype.setValues=function(values){var keys=Object.keys(values);for(var i=0,len=keys.length;i<len;i++){if(keys[i]!="id"&&keys[i]!="__boundDevices"&&keys[i]!="__boundWidgets"&&keys[i]!="__initialValues"){this[keys[i]]=values[keys[i]]}}this.__updateBoundWidgets(keys);this.__updateBoundDevices(keys);this.__updateRelationsBinding()};Data.prototype.setValue=function(path,value,__fromWidgetId,__isFromDevice){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}base[arrPath[len]]=value;this.__updateBoundWidgets(path,__fromWidgetId);if(!__isFromDevice)this.__updateBoundDevices(path);this.__updateRelationsBinding()};Data.prototype.addValue=function(path,value){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}if(Array.isArray(base[arrPath[len]])){if(value instanceof Top.Data){base[arrPath[len]].push(value.getValues())}else{base[arrPath[len]].push(value)}}this.__updateBoundWidgets(path);this.__updateBoundDevices(path);this.__updateRelationsBinding()};Data.prototype.removeValue=function(path,index){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}if(this.__isBackward&&index>=0){base[arrPath[len]].splice(index,1)}else{if(Array.isArray(base)){base.splice(arrPath[len],1)}else{delete base[arrPath[len]]}}this.__updateBoundWidgets(path);this.__updateBoundDevices(path);this.__updateRelationsBinding()};Data.prototype.reset=function(path){if(typeof path==="string"){if(this.__isBackward&&!path.startsWith("data.")){path="data."+path}var arrPath=path.split(".");var base=this;var initialBase=Top.Util.__deepCopy(this.__initialValues);for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{};initialBase=initialBase[arrPath[i]]=initialBase[arrPath[i]]||{}}base[arrPath[len]]=initialBase[arrPath[len]];this.__updateBoundWidgets(path);this.__updateBoundDevices(path)}else{var keys=Object.keys(this.__initialValues);var initialBase=Top.Util.__deepCopy(this.__initialValues);for(var i=0,len=keys.length;i<len;i++){this[keys[i]]=initialBase[keys[i]]}this.__updateBoundWidgets(keys);this.__updateBoundDevices(keys)}this.__updateRelationsBinding()};Data.prototype.update=function(path){if(typeof path==="string"){this.__updateBoundWidgets(path);this.__updateBoundDevices(path)}this.__updateRelationsBinding()};Data.prototype.setModel=function(field,modelId){var arrPath=field.split(".");var obj;if(arrPath.length==1){this.__modelInfo[arrPath[0]]={};this.__modelInfo[arrPath[0]]["modelId"]=modelId}else{if(this.__modelInfo[arrPath[0]])obj=this.__modelInfo[arrPath[0]];else{this.__modelInfo[arrPath[0]]={};obj=this.__modelInfo[arrPath[0]]}for(var i=1,len=arrPath.length-1;i<len;i++){if(obj[arrPath[i]]===undefined){obj[arrPath[i]]={}}obj=obj[arrPath[i]]}obj[arrPath[len]]={};obj[arrPath[len]]["modelId"]=modelId}};Data.prototype.getModel=function(){return this.__modelInfo};Data.prototype.setRelations=function(relations){this.relations=relations};Data.prototype.getRelations=function(){return this.relations};Data.prototype.getDataByRelations=function(relationsId){var relations=this.getRelationsById(relationsId);if(this[this.__toInstanceId(relationsId)]===undefined){this[this.__toInstanceId(relationsId)]=this.__makeDataByRelations(relations)}return this.__toInstanceId(relationsId)};Data.prototype.getRelationsById=function(relationsId){for(var i=0,len=this.relations.length;i<len;i++){if(this.relations[i].id===relationsId){return this.relations[i]}}};Data.prototype.__makeDataByRelations=function(relations){var relation=relations.Relation;var rootId=relation[0].parentId;var path=rootId;for(var i=0,len=relation.length;i<len;i++){if(rootId===relation[i].childId){rootId=relation[i].parentId;path=rootId.concat(".").concat(path)}else{path=path.concat(".").concat(relation[i].childId)}var _this=this;var parents=JSON.parse(JSON.stringify(this.getValue(rootId)));parents.forEach(function(parent){var children=_this.getValue(relation[i].childId);children.forEach(function(child){if(parent[relation[i].parentField]===child[relation[i].childField]){if(typeof parent[relation[i].childId]!=="object")parent[relation[i].childId]=[];parent[relation[i].childId].push(JSON.parse(JSON.stringify(child)))}})})}relations.rootId=rootId;this.__setRelationModel(path);this.__modelInfo[this.__toInstanceId(relations.id)]=this.getModel()[rootId];return parents};Data.prototype.__setRelationModel=function(path){var keys=path.split(".");var key=keys[0];this.setModel(key,this.getModel()[keys[0]].modelId);for(var i=1,len=keys.length;i<len;i++){key=key.concat(".").concat(keys[i]);this.setModel(key,this.getModel()[keys[i]].modelId)}};Data.prototype.getRootId=function(relationsId){for(var i=0,len=this.relations.length;i<len;i++){if(this.relations[i].id===relationsId){return this.relations[i].rootId}}};Data.prototype.__toInstanceId=function(relationsId){return"__relations__".concat(relationsId)};Data.prototype.__updateRelationsBinding=function(){var relations=this.getRelations();if(relations!==undefined){for(var i=0,len=relations.length;i<len;i++){var instanceId=this.__toInstanceId(relations[i].id);this[instanceId]=this.__makeDataByRelations(relations[i]);this.__updateBoundWidgets(instanceId)}}};Data.prototype.__clearBindingInfo=function(valuePath,widgetId){valuePath=valuePath.split("+")[0];var parts=valuePath.split(".");var bindingPath=parts[0];var bindingInfoList=this.__boundWidgets[bindingPath];if(bindingInfoList===undefined)return;for(var i=bindingInfoList.length-1;i>=0;i--){if(bindingInfoList[i].widgetId===widgetId){bindingInfoList.splice(i,1)}}for(var j=1,len2=parts.length;j<len2;j++){bindingPath+="."+parts[j];bindingInfoList=this.__boundWidgets[bindingPath];for(var i=bindingInfoList.length-1;i>=0;i--){if(bindingInfoList[i].widgetId===widgetId){bindingInfoList.splice(i,1)}}}};Data.__modelList={};Data.createModel=function(packageName,id,dataFields){this.__modelList[id]=dataFields};Data.getDataModel=function(id){return this.__modelList[id]};Data.toTreeNodes=function(origin,keyMap){if(!keyMap.hasOwnProperty("id")||!keyMap.hasOwnProperty("level"))return;var nodesByLevel={};var rootLevel=1;for(var i=0,len=origin.length;i<len;i++){if(origin[i][keyMap.level]===0||origin[i][keyMap.level]==="0"){rootLevel=0;break}}var toBeChanged=[];for(var k in keyMap){if(k!==keyMap[k])toBeChanged.push(k)}origin.forEach(function(node){toBeChanged.forEach(function(k){node[k]=node[keyMap[k]]})});for(i=0,len=origin.length;i<len;i++){var level=Number.isInteger(origin[i]["level"])===true?origin[i]["level"]:parseInt(origin[i]["level"]);if(nodesByLevel[level]===undefined)nodesByLevel[level]=[];nodesByLevel[level].push(origin[i])}var parentIdList=[];var parentChildMap={};var levels=Object.keys(nodesByLevel);for(i=0,len=levels.length;i<len-1;i++){var upperNodes=nodesByLevel[levels[i]];var lowerNodes=nodesByLevel[levels[i+1]];lowerNodes.forEach(function(lower){upperNodes.forEach(function(upper){if(upper["id"]===lower["parentId"]){if(!parentChildMap[upper["id"]]){parentChildMap[upper["id"]]=[upper];parentIdList.push(upper["id"])}parentChildMap[upper["id"]].push(lower);return}})})}parentIdList.forEach(function(parentId){var childList=parentChildMap[parentId];var parent=childList[0];for(var i=1;i<childList.length;i++){var child=childList[i];if(parent.children===undefined){parent.children=[]}if(child["seq"]){var index=parseInt(child["seq"])-1;parent.children.splice(index,0,child)}else{parent.children.push(child)}}});return nodesByLevel[rootLevel]};Data.syncTreeNodes=function(nodes){for(var i=0;i<nodes.length;i++){syncChildren(nodes[i].children,nodes[i])}function syncChildren(childrenArr,upperNode){var childrenLength=childrenArr.length;var currentPath="";if(upperNode.path==""){currentPath=upperNode.id}else{currentPath=upperNode.path+"."+upperNode.id}var currentLevel=parseInt(upperNode.level)+1;for(var i=0;i<childrenLength;i++){var currentNode=childrenArr[i];currentNode.path=currentPath;currentNode.level=currentLevel;currentNode.parentId=upperNode.id;var childrenOfcurrentNode=currentNode.children;if(childrenOfcurrentNode!=null&&typeof childrenOfcurrentNode=="object"&&childrenOfcurrentNode.length>=1){syncChildren(childrenOfcurrentNode,currentNode)}}}};return Data}();Top.Model=function(){Model.prototype=Object.create(Top.prototype);Model.prototype.constructor=Model;function Model(){}return Model}();Top.Model.Controller=function(){Controller.prototype=Object.create(Top.Model.prototype);Controller.prototype.constructor=Controller;function Controller(obj){Object.assign(this,obj)}Controller.create=function(obj){return new Controller(obj)};return Controller}();Top.DataController=function(){DataController.prototype=Object.create(Top.prototype);DataController.prototype.constructor=DataController;function DataController(obj){Object.assign(this,obj);var _this=this;var keys=Object.keys(this);for(var i=0,len=keys.length;i<len;i++){var name=keys[i];if(typeof this[name]=="object"){var data=this[name].data;this[name]=Top.Data.create({data:data,__isBackward:true})}}}DataController.create=function(obj){return new DataController(obj)};return DataController}();Top.Dom=function(){Dom.prototype=Object.create(Top.prototype);Dom.prototype.constructor=Dom;function Dom(){}Dom.selectById=function(id){if(id==="")return null;if(typeof Top.ContextMenu.get(id)==="string"){return this.__selectImpl(Top.ContextMenu.getWidgetById(id).template)}var controller=Top.Controller.getCurrent();if(controller&&typeof controller.getBoundWidget==="function"){var parent=controller.getBoundWidget();if(parent&&typeof parent.selectById==="function"){var widget=parent.selectById(id)}}if(widget)return widget;return this.__selectImpl(document.getElementById(id))};Dom.selectByTagName=function(tagName){var elements=document.getElementsByTagName(tagName);var widgets=[];if(elements.length>0){var l=elements.length;while(l--){widgets.unshift(Dom.__selectImpl(elements[l]))}}return widgets};Dom.select=function(selector){var elements=document.querySelectorAll(selector);var widgets=[];if(elements.length>0){var l=elements.length;while(l--){var widget=Dom.__selectImpl(elements[l]);if(widget)widgets.unshift(widget)}}return widgets};Dom.__selectImpl=function(element){if(!element||!Top.Util.__isTopWidget(element.tagName)){return null}if(element.tagName=="TOP-AJAX"){return element}var widget=Top.Widget.create(element.localName,undefined,element);return widget};Dom.appendToBody=function(widget){if(typeof widget==="string"){widget=this.selectById(widget)}var body=document.getElementsByTagName("body");body[0].appendChild(widget.template)};Dom.appendChild=function(parentId,widget){if(typeof widget==="string"){widget=this.selectById(widget)}var parentNode=document.getElementById(parentId);parentNode.appendChild(widget.template)};Dom.insertBefore=function(referId,widget){if(typeof widget==="string"){widget=this.selectById(widget)}var referNode=document.getElementById(referId);referNode.insertBefore(widget.template,referNode.childNodes[0])};Dom.remove=function(widgetId){document.getElementById(widgetId).remove()};return Dom}();Top.Ajax=function(){Ajax.prototype=Object.create(Top.prototype);Ajax.prototype.constructor=Ajax;function Ajax(){}Ajax.execute=function(url,settings){if(typeof url==="object"&&typeof settings==="undefined"){var settings=url;url=settings.url}var type=settings.type?settings.type:"get";var async=settings.async!==undefined?settings.async:true;var responseType=settings.dataType!==undefined?settings.dataType:"";var _headers=settings.headers;var _beforeSend=settings.beforeSend;var _xhrFields=settings.xhrFields;var _success=settings.success;var _error=settings.error;var _complete=settings.complete;if(type.toLowerCase()==="get"&&settings.data){url+=Top.Ajax.toQueryString(url,settings.data)}var xhr=new XMLHttpRequest;xhr.open(type,url,async);if(async)xhr.responseType=responseType;if(_headers!==undefined&&_headers!==null&&typeof _headers==="object"){for(var i in _headers){xhr.setRequestHeader(i,_headers[i])}}if(_beforeSend!==undefined&&typeof _beforeSend==="function"){var result=_beforeSend(xhr);if(result!==undefined&&!result){return false}}if(_xhrFields!==undefined&&_xhrFields!==null&&typeof _xhrFields==="object"){for(var key in _xhrFields){if(_xhrFields[key]==="withCredentials"){xhr.withCredentials=true}}}if(type.toLowerCase()!=="get"){var contentType=typeof settings.contentType==="string"?settings.contentType:"application/json";xhr.setRequestHeader("Content-Type",contentType)}xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===0){if(typeof _error==="function")_error(xhr,xhr.status);if(typeof _complete==="function")_complete(xhr,xhr.status)}};xhr.onload=function(){if(xhr.status===200){if(typeof xhr.response==="string"&&!xhr.response.startsWith("<")&&typeof settings.response==="string"){var dataName=Top.Util.getDataName(settings.response);if(dataName){var dataObj=Top.Util.namespace(dataName);if(dataObj instanceof Top.Data){var path=settings.response.split(dataName+".")[1];dataObj.setValue(path,xhr.response)}}}if(typeof _success==="function"){if(Top.Util.Browser.isIE()&&settings.dataType==="json"){var response=JSON.parse(xhr.response);_success(response,xhr.status,xhr)}else{_success(xhr.response,xhr.status,xhr)}}}else{if(typeof _error==="function")_error(xhr,xhr.status)}if(typeof _complete==="function")_complete(xhr,xhr.status)};if((type.toLowerCase()==="post"||type.toLowerCase()==="put"||type.toLowerCase()==="delete")&&settings.data){var data;if(settings.data&&typeof settings.data==="string"){data=settings.data}else if(settings.data&&typeof settings.data!=="string"&&contentType==="application/x-www-form-urlencoded; charset=UTF-8"){data=Ajax.__param(settings.data)}else{data=JSON.stringify(settings.data)}xhr.send(data)}else{xhr.send()}};Ajax.executeById=function(id){Top.Dom.selectById(id).execute()};Ajax.get=function(url,request,response,onSuccess,onFail){var settings={};settings.type="get";settings.data=request;settings.response=response;settings.success=onSuccess;settings.error=onFail;this.execute(url,settings)};Ajax.post=function(url,request,response,onSuccess,onFail){var settings={};settings.type="post";settings.data=request;settings.response=response;settings.success=onSuccess;settings.error=onFail;this.execute(url,settings)};Ajax.put=function(url,request,response,onSuccess,onFail){var settings={};settings.type="put";settings.data=request;settings.response=response;settings.success=onSuccess;settings.error=onFail;this.execute(url,settings)};Ajax.delete=function(url,request,response,onSuccess,onFail){var settings={};settings.type="delete";settings.data=request;settings.response=response;settings.success=onSuccess;settings.error=onFail;this.execute(url,settings)};Ajax.toQueryString=function(requestUrl,data){var query=requestUrl.indexOf("?")!==-1?"&":"?";if(typeof data==="string"){return query+data}else if(typeof data==="object"){return query+top$.param(data)}};Ajax.__param=function(data){var prefix;var result=[];var r20=/%20/g;var add=function(key,value){value=typeof value==="function"?value():value==null?"":value;result[result.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};for(prefix in data){Ajax.__buildParams(prefix,data[prefix],add)}return result.join("&").replace(r20,"+")};Ajax.__buildParams=function(prefix,obj,add){var name;if(typeof obj==="object"){for(name in obj){Ajax.__buildParams(prefix+"["+name+"]",obj[name],add)}}else{add(prefix,obj)}};return Ajax}();Top.Device=function(){Device.prototype=Object.create(Top.prototype);Device.prototype.constructor=Device;Device.prototype.id="";Device.prototype.__boundWidgets={};Device.prototype.__boundData={};function Device(obj){Object.assign(this,obj);this.__init();Top.Util.createGetterSetter(this);this.id=Top.Util.guid();this.__boundWidgets={};this.__boundData={}}Device.create=function(obj){return new Device(obj)};Device.prototype.__addBoundWidget=function(valuePath,widgetId,prop){var pathRoot=valuePath.split(".")[0];var bindingInfo={};bindingInfo.widgetId=widgetId;bindingInfo.property=prop;bindingInfo.valuePath=valuePath;if(this.__boundWidgets[pathRoot]===undefined)this.__boundWidgets[pathRoot]=[];this.__boundWidgets[pathRoot].push(bindingInfo)};Device.prototype.__addBoundData=function(valuePath,data,dataField){var pathRoot=valuePath.split(".")[0];var bindingInfo={};bindingInfo.data=data;bindingInfo.dataField=dataField;bindingInfo.valuePath=valuePath;if(this.__boundData[pathRoot]===undefined)this.__boundData[pathRoot]=[];this.__boundData[pathRoot].push(bindingInfo)};Device.prototype.__updateBoundWidgets=function(key){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundWidgetsImpl(key[i])}}else{this.__updateBoundWidgetsImpl(key)}};Device.prototype.__updateBoundWidgetsImpl=function(key){if(this.__boundWidgets&&this.__boundWidgets[key]){var bindingInfoList=this.__boundWidgets[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];var widget=Top.Dom.selectById(bindingInfo["widgetId"]);var prop=bindingInfo["property"];var value=this.getValue(bindingInfo["valuePath"]);var obj={};obj[prop]=value;widget.setProperties(obj,false,true)}}};Device.prototype.__updateBoundData=function(key){if(typeof key==="object"){for(var i=0,len=key.length;i<len;i++){this.__updateBoundDataImpl(key[i])}}else{this.__updateBoundDataImpl(key)}};Device.prototype.__updateBoundDataImpl=function(key){if(this.__boundData&&this.__boundData[key]){var bindingInfoList=this.__boundData[key];for(var i=0,len=bindingInfoList.length;i<len;i++){var bindingInfo=bindingInfoList[i];var data=bindingInfo["data"];var dataField=bindingInfo["dataField"];var value=this.getValue(bindingInfo["valuePath"]);data.setValue(dataField,value,true)}}};Device.prototype.getValue=function(path){var arrPath=path.split(".");var value=this;for(var i=0,len=arrPath.length;i<len;i++){if(value[arrPath[i]]){value=value[arrPath[i]]}else{return}}return value};Device.prototype.setValue=function(path,value){var arrPath=path.split(".");var base=this;for(var i=0,len=arrPath.length-1;i<len;i++){base=base[arrPath[i]]=base[arrPath[i]]||{}}base[arrPath[len]]=value;this.__updateBoundWidgets(arrPath[0]);this.__updateBoundData(arrPath[0])};return Device}();Top.Device.RestAPI=function(){RestAPI.prototype=Object.create(Top.Device.prototype);RestAPI.prototype.constructor=RestAPI;RestAPI.prototype.host="";RestAPI.prototype.url="";RestAPI.prototype.dataType="JSON";RestAPI.prototype.sync=true;RestAPI.prototype.requestHeaderData="";RestAPI.prototype.requestBodyData="";RestAPI.prototype.status="";RestAPI.prototype.statusCode="";RestAPI.prototype.headerData="";RestAPI.prototype.responseBodyData="";RestAPI.prototype.onComplete=function(){};RestAPI.prototype.onSuccess=function(){};RestAPI.prototype.onFailure=function(){};function RestAPI(obj){Object.assign(this,obj)}RestAPI.create=function(obj){return new RestAPI(obj)};RestAPI.prototype.__init=function(){if(!this.host)this.host="";if(!this.url)this.url="";if(!this.dataType)this.dataType="JSON";if(!this.sync)this.sync=true;if(!this.requestHeaderData)this.requestHeaderData="";if(!this.requestBodyData)this.requestBodyData=""};RestAPI.prototype.get=function(){this.__ajax("GET")};RestAPI.prototype.post=function(){this.__ajax("POST")};RestAPI.prototype.put=function(){this.__ajax("PUT")};RestAPI.prototype.delete=function(){this.__ajax("DELETE")};RestAPI.prototype.__ajax=function(type){var __this=this;var settings={};settings.type=type;settings.dataType=this.dataType;settings.async=this.sync;settings.data=this.requestBodyData;
settings.complete=function(jqXHR,textStatus){__this.onComplete(__this)};settings.success=function(data,textStatus,jqXHR){__this.setValue("responseBodyData",data);__this.setValue("statusCode",jqXHR.status);__this.onSuccess(__this)};settings.error=function(jqXHR,textStatus,errorThrown){__this.setValue("headerData","");__this.setValue("responseBodyData","");__this.setValue("statusCode",jqXHR.status);__this.onFailure(__this)};Top.Ajax(this.host+this.url,settings)};RestAPI.prototype.getDataType=function(){return this.dataType};RestAPI.prototype.getDeviceType=function(){return"RestAPI"};RestAPI.prototype.getHeaderData=function(){return this.headerData};RestAPI.prototype.getHost=function(){return this.host};RestAPI.prototype.getRequestBodyData=function(){return this.requestBodyData};RestAPI.prototype.getResponse=function(){return this.responseBodyData};RestAPI.prototype.getResponseBodyData=function(){return this.responseBodyData};RestAPI.prototype.getStatus=function(){return this.status};RestAPI.prototype.getStatusCode=function(){return this.statusCode};RestAPI.prototype.getUrl=function(){return this.url};RestAPI.prototype.isSync=function(){return this.sync};RestAPI.prototype.setDataType=function(dataType){this.dataType=dataType};RestAPI.prototype.setHeaderData=function(headerData){this.headerData=headerData};RestAPI.prototype.setHost=function(host){this.host=host};RestAPI.prototype.setRequestBodyData=function(requestBodyData){this.requestBodyData=requestBodyData};RestAPI.prototype.setStatus=function(status){this.status=status};RestAPI.prototype.setSync=function(sync){this.sync=sync};RestAPI.prototype.setUrl=function(url){this.url=url};return RestAPI}();Top.Device.FileChooser=function(){FileChooser.prototype=Object.create(Top.Device.prototype);FileChooser.prototype.constructor=FileChooser;FileChooser.prototype.id="";FileChooser.prototype.title="";FileChooser.prototype.windowId="";FileChooser.prototype.saveAs="";FileChooser.prototype.extFilter="";FileChooser.prototype.defaultExt="";FileChooser.prototype.defaultPath="";FileChooser.prototype.path="";FileChooser.prototype.responseString="";FileChooser.prototype.File=null;FileChooser.prototype.charset="";FileChooser.prototype.onFileChoose=function(){};FileChooser.prototype.onBeforeLoad=function(){};function FileChooser(obj){Object.assign(this,obj)}FileChooser.create=function(obj){return new FileChooser(obj)};FileChooser.download=function(data,strFileName,strMimeType){var self=window,defaultMime="application/octet-stream",mimeType=strMimeType||defaultMime,payload=data,url=!strFileName&&!strMimeType&&payload,anchor=document.createElement("a"),toString=function(a){return String(a)},myBlob=self.Blob||self.MozBlob||self.WebKitBlob||toString,fileName=strFileName||"download",blob,reader;myBlob=myBlob.call?myBlob.bind(self):Blob;if(String(this)==="true"){payload=[payload,mimeType];mimeType=payload[0];payload=payload[1]}if(url&&url.length<2048){fileName=url.split("/").pop().split("?")[0];anchor.href=url;if(anchor.href.indexOf(url)!==-1){var ajax=new XMLHttpRequest;ajax.open("GET",url,true);ajax.responseType="blob";ajax.onload=function(e){download(e.target.response,fileName,defaultMime)};setTimeout(function(){ajax.send()},0);return ajax}}if(/^data\:[\w+\-]+\/[\w+\-]+[,;]/.test(payload)){if(payload.length>1024*1024*1.999&&myBlob!==toString){payload=dataUrlToBlob(payload);mimeType=payload.type||defaultMime}else{return navigator.msSaveBlob?navigator.msSaveBlob(dataUrlToBlob(payload),fileName):saver(payload)}}blob=payload instanceof myBlob?payload:new myBlob([payload],{type:mimeType});function dataUrlToBlob(strUrl){var parts=strUrl.split(/[:;,]/),type=parts[1],decoder=parts[2]=="base64"?atob:decodeURIComponent,binData=decoder(parts.pop()),mx=binData.length,i=0,uiArr=new Uint8Array(mx);for(i;i<mx;++i)uiArr[i]=binData.charCodeAt(i);return new myBlob([uiArr],{type:type})}function saver(url,winMode){if("download"in anchor){anchor.href=url;anchor.setAttribute("download",fileName);anchor.className="download-js-link";anchor.innerHTML="downloading...";anchor.style.display="none";document.body.appendChild(anchor);setTimeout(function(){anchor.click();document.body.removeChild(anchor);if(winMode===true){setTimeout(function(){self.URL.revokeObjectURL(anchor.href)},250)}},66);return true}if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent)){url=url.replace(/^data:([\w\/\-\+]+)/,defaultMime);if(!window.open(url)){if(confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")){location.href=url}}return true}var f=document.createElement("iframe");document.body.appendChild(f);if(!winMode){url="data:"+url.replace(/^data:([\w\/\-\+]+)/,defaultMime)}f.src=url;setTimeout(function(){document.body.removeChild(f)},333)}if(navigator.msSaveBlob){return navigator.msSaveBlob(blob,fileName)}if(self.URL){saver(self.URL.createObjectURL(blob),true)}else{if(typeof blob==="string"||blob.constructor===toString){try{return saver("data:"+mimeType+";base64,"+self.btoa(blob))}catch(y){return saver("data:"+mimeType+","+encodeURIComponent(blob))}}reader=new FileReader;reader.onload=function(e){saver(this.result)};reader.readAsDataURL(blob)}return true};FileChooser.prototype.getDeviceType=function(){return"FileChooser"};FileChooser.prototype.getTitle=function(){return this.title};FileChooser.prototype.setTitle=function(title){this.title=title};FileChooser.prototype.getWindowId=function(){return this.windowId};FileChooser.prototype.setWindowId=function(windowId){this.windowId=windowId};FileChooser.prototype.getSaveAs=function(){return this.saveAs};FileChooser.prototype.setSaveAs=function(saveAs){this.saveAs=saveAs};FileChooser.prototype.getDefaultExt=function(){return this.defaultExt};FileChooser.prototype.setDefaultExt=function(defaultExt){this.defaultExt=defaultExt};FileChooser.prototype.getExtFilter=function(){return this.extFilter};FileChooser.prototype.setExtFilter=function(extFilter){this.extFilter=extFilter};FileChooser.prototype.getDefaultPath=function(){return this.defaultPath};FileChooser.prototype.setDefaultPath=function(defaultPath){this.defaultPath=defaultPath};FileChooser.prototype.getMultiple=function(){return this.multiple};FileChooser.prototype.setMultiple=function(multiple){this.multiple=multiple};FileChooser.prototype.getFolder=function(){return this.webkitdirectory};FileChooser.prototype.setFolder=function(folder){this.webkitdirectory=folder};FileChooser.prototype.getPath=function(){return this.path};FileChooser.prototype.setPath=function(path){this.path=path};FileChooser.prototype.getFile=function(){return this.file};FileChooser.prototype.setFile=function(file){this.file=file};FileChooser.prototype.getSrc=function(){return this.src};FileChooser.prototype.read=function(){var _this=this;if(_this.webkitdirectory===true){_this.folderName=_this.file[0].webkitRelativePath.split("/")[0]}for(var i=0;i<_this.file.length;i++){var file=_this.file[i];var reader=new FileReader;reader.onload=function(event){_this.src=event.target.result;_this.onFileRead(_this)};if(file!==undefined){if(file.name.substring(file.name.length,file.name.length-3)==="xls"||file.name.substring(file.name.length,file.name.length-4)==="xlsx"){reader.readAsArrayBuffer(file)}else if(file.name.substring(file.name.length,file.name.length-3)==="csv"){var charset=!_this.charset?"euc-kr":_this.charset;_this.charset=charset;reader.readAsText(file,charset)}else if(file.name.substring(file.name.length,file.name.length-3)==="txt"){var charset=!_this.charset?"utf-8":_this.charset;_this.charset=charset;reader.readAsText(file,charset)}else{if(Top.Util.Browser.isIE()){if(file.size<5e7)reader.readAsDataURL(file);else reader.readAsArrayBuffer(file)}else{if(file.size<524288e3)reader.readAsDataURL(file);else reader.readAsArrayBuffer(file)}}}}};FileChooser.prototype.show=function(){var pageId=Top.App.getCurrentPage().id;var inputId=pageId.concat("_fileChooser");var rABS=typeof FileReader!=="undefined"&&typeof FileReader.prototype!=="undefined"&&typeof FileReader.prototype.readAsArrayBuffer!=="undefined";var input=document.getElementById(inputId);if(input===null){input=document.createElement("input")}input.id=inputId;input.style.display="none";input.type="file";input.accept=this.extFilter;input.multiple=this.multiple;if(!Top.Util.Browser.isIE()){input.webkitdirectory=this.folder}input.multiple=this.multiple;if(input.multiple!==true)input.multiple=input.folder;var _this=this;input.onchange=function(event){_this.path=this.value;_this.file=this.files;if(typeof _this.onBeforeLoad==="function"){if(input.multiple===true&&_this.file.length>1){var files=_this.file}else{var files=_this.file[0]}var result=_this.onBeforeLoad(files);if(result!==undefined&&!result){return false}}if(input.multiple===true){_this.path=_this.path.replace(_this.file[0].name,"")}if(input.webkitdirectory===true){_this.folderName=_this.file[0].webkitRelativePath.split("/")[0]}var fileArray=new Array;for(var i=0;i<_this.file.length;i++){(function(file){var reader=new FileReader;reader.onload=function(event){_this.src=event.target.result;var fileFormat=_this.path.split(".")[_this.path.split(".").length-1];if(Top.Util.Browser.isIE()){fileFormat=file.name.split(".")[file.name.split(".").length-1]}if(fileFormat=="xlsx"||fileFormat=="xls"){if(!rABS){var binary="";var bytes=new Uint8Array(reader.result);var length=bytes.byteLength;for(var i=0;i<length;i++){binary+=String.fromCharCode(bytes[i])}_this.src=binary}}if(input.multiple===true){var tmp=Object.assign({},_this);if(Top.Util.Browser.isIE()){tmp.path=_this.path.split(",")[0]+file.name}else{tmp.path=_this.path+file.name}var fileFormat=tmp.path.split(".")[tmp.path.split(".").length-1];if(fileFormat=="xlsx"||fileFormat=="xls"){if(!rABS){var binary="";var bytes=new Uint8Array(reader.result);var length=bytes.byteLength;for(var i=0;i<length;i++){binary+=String.fromCharCode(bytes[i])}tmp.src=binary}}fileArray.push(tmp);if(fileArray.length===_this.file.length){_this.onFileChoose(fileArray)}}else{_this.onFileChoose(_this)}};if(file!==undefined){var fileFormat=file.name.split(".")[file.name.split(".").length-1];if(fileFormat=="xlsx"||fileFormat=="xls"){reader.readAsArrayBuffer(file)}else if(fileFormat==="txt"){var charset=!_this.charset?"utf-8":_this.charset;_this.charset=charset;reader.readAsText(file,charset)}else if(fileFormat==="csv"){var charset=!_this.charset?"euc-kr":_this.charset;_this.charset=charset;reader.readAsText(file,charset)}else{if(Top.Util.Browser.isIE()){if(file.size<5e7)reader.readAsDataURL(file);else reader.readAsArrayBuffer(file)}else{if(file.size<524288e3)reader.readAsDataURL(file);else reader.readAsArrayBuffer(file)}}}})(_this.file[i])}document.getElementById(inputId).remove()};document.getElementById(pageId).appendChild(input);input.click()};return FileChooser}();Top.Controller=function(){Controller.prototype=Object.create(Top.prototype);Controller.prototype.constructor=Controller;function Controller(obj){Object.assign(this,obj)}Controller.map={};Controller.create=function(name,controller){if(typeof name==="object"&&controller===undefined){return Top.DataController.create(name)}else if(typeof name==="string"&&typeof controller==="object"){if(typeof this.get(name)==="object"){this.set(name,Object.assign(this.get(name),controller))}else{if(typeof controller.init==="function"){controller.__init=controller.init;delete controller.init}var controllerImpl=new Controller(controller);controllerImpl.__name=name;this.set(name,controllerImpl)}}else{console.error("Type error: Top.Controller.create(string, object)")}};Controller.onLoad=function(controller,callback){if(!controller.hasOwnProperty("__loadEvents")){controller.__loadEvents=[]}controller.__loadEvents.push(callback)};Controller.set=function(name,controller){this.map[name]=controller};Controller.get=function(name){return this.map[name]};Controller.setAppController=function(controller){Controller.appController=controller};Controller.getAppController=function(){return Controller.appController||window};Controller.setCurrent=function(controller){this.__curController=controller};Controller.getCurrent=function(){return this.__curController};Controller.prototype.__boundWidget=null;Controller.prototype.__loadEvents=[];Controller.prototype.__initEvents=[];Controller.prototype.__loaded=false;Controller.prototype.__setBoundWidget=function(widgetId){Top.Controller.current=this.getName();if(widgetId===undefined){if(typeof this.__init==="function"){Top.Controller.setCurrent(this);this.__init()}this.__callLoadEvents();this.__loaded=true;this.__callInitEvents()}else{var widget=Top.Dom.selectById(widgetId);var _this=this;var initOnWidgetAttach=function(){_this.__boundWidget=widget;if(typeof _this.__init==="function"){Top.Controller.setCurrent(_this);_this.__init(widget)}_this.__callLoadEvents();_this.__loaded=true;_this.__callInitEvents()};if(widget&&widget.template&&widget.template.__isAttached===true){this.__boundWidget=widget;initOnWidgetAttach()}else{if(Top.events.onWidgetAttach[widgetId]===undefined){Top.events.onWidgetAttach[widgetId]=[]}Top.events.onWidgetAttach[widgetId].push(initOnWidgetAttach)}}};Controller.prototype.__callLoadEvents=function(){if(!this.hasOwnProperty("__loadEvents"))return;for(var i=0,len=this.__loadEvents.length;i<len;i++){this.__loadEvents[i]()}};Controller.prototype.__callInitEvents=function(){for(var i=0,len=this.__initEvents.length;i<len;i++){this.__initEvents[i]()}this.__initEvents=[]};Controller.prototype.onInit=function(callback){if(typeof callback==="function"){this.__initEvents.push(callback)}};Controller.prototype.isLoaded=function(){return this.__loaded};Controller.prototype.getName=function(){return this.__name};Controller.prototype.getBoundWidget=function(){return this.__boundWidget};return Controller}();Top.Module=function(){Module.prototype=Object.create(Top.prototype);Module.prototype.constructor=Module;function Module(){}Module.__moduleList={};Module.__curName="";Module.create=function(module){this.__moduleList[this.__curName]=module};Module.load=function(name,callback){if(Top.modules[name]===undefined){console.error(name+" is not defined.")}else{if(this.__moduleList[name]===undefined){var _this=this;this.__curName=name;Top.Ajax.execute(Top.modules[name],{dataType:"script",cache:true,success:function(script){script;if(typeof callback==="function")callback(_this.__moduleList[name])}})}else{if(typeof callback==="function")callback(this.__moduleList[name])}}};return Module}();Top.Util=function(){Util.prototype=Object.create(Top.prototype);Util.prototype.constructor=Util;function Util(){}Util.guid=function(){return"zxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})};Util.isTopData=function(strValue){if(strValue&&typeof strValue==="string"){var dataRoot=Top.Util.namespace(strValue.split(".")[0]);return typeof dataRoot.init==="function"}};Util.getFileExtension=function(fileName){return fileName.split(".").pop()};Util.getFileName=function(path){return path.split(/(\\|\/)/g).pop()};Util.namespace=function(string,widget){if(typeof string!=="string"){return null}else if(this.__isUrl(string)){return function(){Top.App.routeTo(string)}}else if(this.__isAction(string)){return this.__stringToAction(string)}else if(this.__isDeviceWithEvent(string)){return this.__stringToDeviceWithEvent(string)}else if(this.__isLogicWithParams(string)){return this.__stringToLogicWithParams(string)}else if(string.includes("(")&&string.includes(")")){return function(){eval(string)}}else{return this.__stringToObject(string,widget)}};Util.getDataName=function(path,widget){var parts=path.split(".");var dataName="";for(var i=0,len=parts.length;i<len;i++){if(dataName===""){dataName=dataName.concat(parts[i])}else{dataName=dataName.concat("."+parts[i])}if(Top.Util.namespace(dataName,widget)instanceof Top.Data){return dataName}}return""};Util.__isUrl=function(str){var IS_HTTP=/^(f|ht)tps?:\/\//i;return str.startsWith("/")||IS_HTTP.test(str)};Util.__isAction=function(str){var IS_ACTION=new RegExp("^\\(([a-zA-Z0-9_-]+)(%([\\x20-\\x7E]+))*\\)$");return IS_ACTION.test(str)};Util.__isDeviceWithEvent=function(str){var IS_DEVICE_WITH_EVENT=new RegExp("^\\{#([a-zA-Z0-9_-]+):*([a-zA-Z0-9_-]+)\\(\\)\\}$");return IS_DEVICE_WITH_EVENT.test(str)};Util.__isLogicWithParams=function(str){return str.includes("%")};Util.__stringToLogicWithParams=function(str){var parts=str.split("%");var obj={};obj.fn=this.__searchObject(window,parts[0]);obj.params=[];for(var i=1,len=parts.length;i<len;i++){obj.params.push(parts[i])}return obj};Util.__stringToAction=function(str){var parts=str.replace("(","").replace(")","").split("%");var len=parts.length;var action=window[parts[0]];if(len>1){var arg=[];for(var i=1;i<len;i++){arg.push(parts[i])}function fn(){action(arg)}return fn}else{return action}};Util.__stringToDeviceWithEvent=function(str){var parts=str.replace("{#","").replace("}","").replace("()","").split(":");var obj={};obj.type="device";obj.device=window[parts[0]];obj.fn=parts[1];return obj};Util.__stringToObject=function(str,widget,__originWidet){if(widget!==undefined&&typeof widget.getController==="function"){var controller=widget.getController();if(controller){Top.Controller.setCurrent(controller);var object=this.__searchObject(controller,str);if(object!==undefined){if(__originWidet)__originWidet.setController(controller);return object}else{if(__originWidet===undefined)__originWidet=widget;return this.__stringToObject(str,widget.getParent(),__originWidet)}}else{var object=this.__searchObject(Top.Controller.getAppController(),str);if(object!==undefined){if(__originWidet)__originWidet.setController(Top.Controller.getAppController());return object}else{return this.__searchObject(window,str)}}}else{var object=this.__searchObject(Top.Controller.getAppController(),str);if(object!==undefined){if(__originWidet)__originWidet.setController(Top.Controller.getAppController());return object}else{return this.__searchObject(window,str)}}};Util.__searchController=function(widget){var controller=widget.getController();while(controller===undefined){if(typeof widget.getController!=="function")return undefined;widget=widget.getParent();if(widget===undefined||typeof widget!=="object"){return Top.Controller.getAppController()}if(Top.Util.Browser.isIE()){controller=Top.Controller.get(widget.getAttribute("controller"))}else{controller=Top.Controller.get(widget.controller)}}return controller};Util.__searchObject=function(base,str){var object=base;var parts=str.split(".");for(var i=0;i<parts.length;i++){if(typeof object[parts[i]]==="undefined"){return undefined}object=object[parts[i]]}return object};Util.createGetterSetter=function(object){if(object.__createdGetterSetter===true)return object;var keys=Object.keys(object);for(var i=0,len=keys.length;i<len;i++){object["get"+this.capitalizeFirstLetter(keys[i])]=function(key){return function(){return this[key]}}(keys[i]);object["set"+this.capitalizeFirstLetter(keys[i])]=function(key){return function(value){object[key]=value;var repo=Top.Util.namespace(this.__repoId);repo.update(this.__insId+"."+key)}}(keys[i]);if(typeof object[keys[i]]==="object"){this.createGetterSetter(object[keys[i]])}}object.__createdGetterSetter=true;return object};Util.capitalizeFirstLetter=function(string){return string.charAt(0).toUpperCase()+string.slice(1)};Util.decapitalizeFirstLetter=function(string){return string.charAt(0).toLowerCase()+string.slice(1)};Util.toCamelCase=function(string){return string.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})};Util.toUnderscore=function(string){return string.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase()})};Util.toDash=function(string){return string.replace(/([A-Z])/g,function($1){return"-"+$1.toLowerCase()})};Util.__isStyleProperty=function(property){var styleRegexp=/^(opacity|background|backgroundColor|backgroundImage|tileMode|maxWidth|minWidth|maxHeight|minHeight|lineHeight|padding|margin|visible|display|zIndex|float|position|horizontalAlignment|verticalAlignment|layoutHorizontalAlignment|layoutVerticalAlignment|layoutHeight|layoutWidth|layoutTop|layoutLeft|layoutRight|layoutBottom|borderWidth|borderBottomWidth|borderLeftWidth|borderRightWidth|borderTopWidth|borderStyle|borderColor|borderRadius|verticalScroll|horizontalScroll)$/;return styleRegexp.test(property)};Util.__measureTextSize=function(pText,pFontSize,pStyle){var lDiv=document.createElement("div");document.body.appendChild(lDiv);if(pStyle!=null){lDiv.style=pStyle}lDiv.style.fontSize=""+pFontSize+"px";lDiv.style.position="absolute";lDiv.style.left=-1e3;lDiv.style.top=-1e3;lDiv.innerHTML=pText;var lResult={width:lDiv.clientWidth,height:lDiv.clientHeight};document.body.removeChild(lDiv);lDiv=null;return lResult};Util.__isTopWidget=function(tagName){if(tagName){var name=tagName.toLowerCase()}return/^TOP-[a-zA-Z]*/.test(tagName)&&tagName!=="TOP-WIDGETITEM"&&tagName!=="TOP-LISTHEADER"&&tagName!=="TOP-ROWITEM"&&tagName!=="TOP-COLUMNITEM"&&tagName!=="TOP-TABLEHEADER"&&tagName!=="TOP-HEADERCOLUMN"||TopRuntime.topWidgets[name]!==undefined&&TopRuntime.topWidgets[name].isCustomType===true};Util.__getControllerPaths=function(strLayout){var matched=strLayout.match(/ controller-path="([^"]*)"/);if(matched){return matched[1].split(",")}else{return undefined}};Util.__getRawValue=function(str){if(str.startsWith("@raw")){str=str.split("?")[0];var id=str.substr(str.indexOf("/")+1);return Top.RawManager.get(id.split(".")[0])}else{return str}};Util.__isBooleanTrue=function(value){if(typeof value==="boolean"){return value}else if(typeof value==="string"){if(value==="true")return true;else if(value==="false")return false}return Boolean(value)};Util.__deepCopy=function(data){if(Array.isArray(data)){var newArr=[];for(var i=data.length;i-- >0;){newArr[i]=this.__deepCopy(data[i])}return newArr}if(data&&typeof data==="object"){var obj={};for(var k in data){obj[k]=this.__deepCopy(data[k])}return obj}return data};return Util}();Top.Util.Browser=function(){Browser.prototype=Object.create(Top.Util.prototype);Browser.prototype.constructor=Browser;function Browser(){}Browser.detectBrowser=function(){var agent=navigator.userAgent.toLowerCase(),name=navigator.appName,browser;if(agent.indexOf("togate")>-1){browser="togate"}else if(name==="Microsoft Internet Explorer"||agent.indexOf("trident")>-1||agent.indexOf("edge/")>-1){browser="ie";if(name==="Microsoft Internet Explorer"){agent=/msie ([0-9]{1,}[\.0-9]{0,})/.exec(agent);browser+=parseInt(agent[1])}else{if(agent.indexOf("trident")>-1){browser+=11}else if(agent.indexOf("edge/")>-1){browser="edge"}}}else if(agent.indexOf("safari")>-1){if(agent.indexOf("opr")>-1){browser="opera"}else if(agent.indexOf("chrome")>-1){browser="chrome"}else{browser="safari"}}else if(agent.indexOf("firefox")>-1){browser="firefox"}else if(agent.indexOf("ipad")>-1||agent.indexOf("iphone")>-1){browser="ios"}else if(agent.indexOf("mobile")>-1){browser="mobile"}else if(agent.indexOf("applewebkit")>-1){browser="webkit"}else{browser="unknown"}return browser};Browser.isOpera=function(){return Top.Util.Browser.detectBrowser().indexOf("opera")>-1};Browser.isFirefox=function(){return Top.Util.Browser.detectBrowser().indexOf("firefox")>-1};Browser.isSafari=function(){return Top.Util.Browser.detectBrowser().indexOf("safari")>-1};Browser.isWebkit=function(){return Top.Util.Browser.detectBrowser().indexOf("webkit")>-1};Browser.isIE=function(){return Top.Util.Browser.detectBrowser().indexOf("ie")>-1};Browser.isEdge=function(){return Top.Util.Browser.detectBrowser().indexOf("edge")>-1};Browser.isChrome=function(){return Top.Util.Browser.detectBrowser().indexOf("chrome")>-1};Browser.isBlink=function(){return(this.isChrome()||this.isOpera())&&!!window.CSS};Browser.isTogate=function(){return Top.Util.Browser.detectBrowser().indexOf("togate")>-1};Browser.isIOS=function(){return Top.Util.Browser.detectBrowser().indexOf("ios")>-1};Browser.isMobile=function(){return Top.Util.Browser.detectBrowser().indexOf("mobile")>-1};Browser.getIEVersion=function(){var word;var agent=navigator.userAgent.toLowerCase();if(navigator.appName=="Microsoft Internet Explorer")word="msie ";else if(agent.search("trident")>-1)word="trident/.*rv:";else if(agent.search("edge/")>-1)word="edge/";else return 100;var reg=new RegExp(word+"([0-9]{1,})(\\.{0,}[0-9]{0,1})");if(reg.exec(agent)!=null)return parseFloat(RegExp.$1+RegExp.$2);return 100};return Browser}();Top.i18n=function(){i18n.prototype=Object.create(Top.prototype);i18n.prototype.constructor=i18n;function i18n(){}i18n.map={};i18n.__settings={};i18n.__loadEvents=[];i18n.__loaded=false;i18n.__boundWidgets=[];i18n.load=function(settings){this.__cntLoad=0;if(Array.isArray(settings)){for(var i=0,len=settings.length;i<len;i++){this.__loadImpl(settings[i],len)}}else{this.__loadImpl(settings,1)}};i18n.__loadImpl=function(settings,length){if(typeof settings==="object"){if(typeof this.__settings.name!=="string"&&typeof settings.name!=="string"){console.error("Top.i18n.load: name(string) is not defined.");return}if(typeof this.__settings.path!=="string"&&typeof settings.path!=="string"){settings.path=""}if(settings.language===undefined){settings.language="default"}Object.assign(this.__settings,settings);if(typeof this.__settings.language!=="string"&&typeof settings.language!=="string"){var url=this.__settings.path+this.__settings.name+".json"}else if(typeof settings.language==="string"&&settings.language.length===0||settings.language.equals("default")){var url=this.__settings.path+this.__settings.name+".json"}if(this.__settings.checkDefaultLanguage===true||this.__settings.checkDefaultLanguage==="true"){this.__loadFile(this.__settings.path+this.__settings.name+".json",{name:this.__settings.name,language:"__default"});this.__settings.languageShort=this.__settings.language.split("_")[0];if(this.__settings.language!==this.__settings.languageShort){this.__loadFile(this.__settings.path+this.__settings.name+"_"+this.__settings.languageShort+".json",{name:this.__settings.name,language:this.__settings.languageShort})}}var _this=this;if(!url)var url=this.__settings.path+this.__settings.name+"_"+this.__settings.language+".json";this.__loadFile(url,{name:this.__settings.name,language:this.__settings.language,callback:function(){if(typeof _this.__settings.callback==="function")_this.__settings.callback();if(length===1){_this.__cntLoad=0}_this.__cntLoad++;if(_this.__cntLoad===length){_this.__loaded=true;_this.__callLoadEvents();_this.__updateWidgets()}}})}else{console.error("Type error: Top.i18n.load(object)")}};i18n.t=function(key,defaultValue){var value=this.__getValueByString(key);if(value===undefined){if(defaultValue){return defaultValue}console.error('Top.i18n: "'+key+'" is not defined.');return""}if(arguments.length>1){for(var i=0,len=arguments.length;i<len;i++){value=value.replace("{"+i+"}",arguments[i+1])}}return value};i18n.onLoad=function(callback){if(typeof callback==="function"){if(this.isLoaded()){callback()}else{this.__loadEvents.push(callback)}}else{console.error("Type error: Top.i18n.onLoad(function)")}};i18n.isLoaded=function(){return this.__loaded};i18n.__addBoundWidget=function(widget){if(!this.__boundWidgets.includes(widget)){this.__boundWidgets.push(widget)}};i18n.__callLoadEvents=function(){for(var i=0,len=this.__loadEvents.length;i<len;i++){this.__loadEvents[i]()}};i18n.__updateWidgets=function(){for(var i=0,len=this.__boundWidgets.length;i<len;i++){if(typeof this.__boundWidgets[i].__updateI18n==="function")this.__boundWidgets[i].__updateI18n()}this.__callOnUpdate()};i18n.__onUpdate=function(widgetId,fnName){if(this.__updateListeners===undefined)this.__updateListeners={};this.__updateListeners[widgetId]=fnName};i18n.__callOnUpdate=function(){if(this.__updateListeners===undefined)return;var ids=Object.keys(this.__updateListeners);for(var i=0,len=ids.length;i<len;i++){var widget=Top.Dom.selectById(ids[i]);if(widget){var fn=widget.template[this.__updateListeners[ids[i]]];if(typeof fn==="function")fn.call(widget.template)}}};i18n.__removeOnUpdate=function(id){if(this.__updateListeners&&this.__updateListeners[id]){delete this.__updateListeners[id]}};i18n.__loadFile=function(url,settings){var _this=this;Top.Ajax.execute(url,{async:true,success:function(data){Object.assign(_this.map,JSON.parse(data))},complete:function(){if(typeof settings.callback==="function")settings.callback()}})};i18n.__getValueByString=function(str){str=str.replace(/\[(\w+)\]/g,".$1");str=str.replace(/^\./,"");var a=str.split(".");var o=this.map;for(var i=0,n=a.length;i<n;++i){var k=a[i];if(k in o){o=o[k]}else{return undefined}}return o};i18n.set=function(obj){this.map=obj;this.__updateWidgets()};i18n.get=function(){return this.map};i18n.__clearBoundWidget=function(){i18n.__boundWidgets=[]};return i18n}();Top.LiveReload=function(){LiveReload.prototype=Object.create(Top.prototype);LiveReload.prototype.constructor=LiveReload;function LiveReload(obj){Object.assign(this,obj);if(!(this.WebSocket=window.WebSocket||window.MozWebSocket)){console.error("LiveReload disabled because the browser does not seem to support web sockets");return}this.uri="ws"+(this.options.https?"s":"")+"://"+this.options.host+":"+this.options.port+"/livereload"}LiveReload.create=function(obj){return new LiveReload(obj)};LiveReload.prototype.connect=function(){this.socket=new this.WebSocket(this.uri);var _this=this;this.socket.onopen=function(){_this.sendCommand({command:"hello",protocols:["http://livereload.com/protocols/official-6","http://livereload.com/protocols/official-7"]});_this.sendCommand({command:"info",url:window.location.href})};this.socket.onclose=function(){};this.socket.onmessage=function(e){_this.parseMessage(e.data)}};LiveReload.prototype.sendCommand=function(command){this.socket.send(JSON.stringify(command))};LiveReload.prototype.parseMessage=function(data){try{var message=JSON.parse(data)}catch(e){console.error("unparsable JSON",data)}switch(message.command){case"reload":this.reload(message);break;case"alert":this.alert(message);break}};LiveReload.prototype.reload=function(message){if(message.path.match(/\.html$/i)){var fileName=Top.Util.getFileName(message.path);if(fileName==="index.html"||this.__isCurrentPageFile(fileName)){this.reloadPage()}}else{this.reloadPage()}};LiveReload.prototype.reloadPage=function(){window.document.location.reload()};LiveReload.prototype.alert=function(message){alert(message.message)};LiveReload.prototype.__isCurrentPageFile=function(fileName){return Top.App.getPageIdBySrc(fileName)===Top.App.getCurrentPage().id};return LiveReload}();Top.DrawableManager=function(){DrawableManager.prototype=Object.create(Top.prototype);DrawableManager.prototype.constructor=DrawableManager;function DrawableManager(){}DrawableManager.__map={};DrawableManager.create=function(obj){Object.assign(DrawableManager.__map,obj)};DrawableManager.get=function(id){return DrawableManager.__map[id]};return DrawableManager}();Top.RawManager=function(){RawManager.prototype=Object.create(Top.prototype);RawManager.prototype.constructor=RawManager;function RawManager(){}RawManager.__map={};RawManager.create=function(obj){var keys=Object.keys(obj);var newObj={};for(var i=0,len=keys.length;i<len;i++){newObj[keys[i].split(".")[0]]=obj[keys[i]]}Object.assign(RawManager.__map,newObj)};RawManager.get=function(id){return RawManager.__map[id]};RawManager.download=function(fileName){var id=fileName.split(".")[0];if(RawManager.__map[id]){var link=document.createElement("a");link.href=RawManager.__map[id];link.download=RawManager.__map[id];document.body.appendChild(link);link.click();document.body.removeChild(link)}};return RawManager}();Top.ValuesManager=function(){ValuesManager.prototype=Object.create(Top.prototype);ValuesManager.prototype.constructor=ValuesManager;function ValuesManager(){}ValuesManager.__map={strings:{},colors:{},dimens:{},themes:{}};ValuesManager.create=function(type,obj){Object.assign(ValuesManager.__map[type],obj)};ValuesManager.get=function(type,id){return ValuesManager.__map[type][id];
};ValuesManager.loadTheme=function(themeId){if(this.__currentThemeId!==undefined||themeId===undefined){this.__setThemeDisabled(this.__currentThemeId,true)}this.__setThemeDisabled(themeId,false);this.__currentThemeId=themeId};ValuesManager.__initTheme=function(){var ids=Object.keys(this.__map.themes);for(var i=0,len=ids.length;i<len;i++){this.__setThemeDisabled(ids[i],true)}};ValuesManager.__setThemeDisabled=function(themeId,disabled){var cssList=this.__map.themes[themeId];if(cssList!==undefined){for(var i=0,len=cssList.length;i<len;i++){var link=document.head.querySelector('link[href*="'+cssList[i]+'"]');if(link)link.disabled=disabled}}};return ValuesManager}();Top.ContextMenu=function(){ContextMenu.prototype=Object.create(Top.prototype);ContextMenu.prototype.constructor=ContextMenu;function ContextMenu(){}ContextMenu.__widget={};ContextMenu.__map={};ContextMenu.create=function(obj){Object.assign(ContextMenu.__map,obj)};ContextMenu.get=function(id){return ContextMenu.__map[id]};ContextMenu.setWidget=function(widget){this.__widget=widget};ContextMenu.getDom=function(){return this.__widget};ContextMenu.getWidgetById=function(id){this.__widget.setProperties({id:id,items:this.get(id)});return this.__widget};return ContextMenu}();Top.Dialog=function(){Dialog.prototype=Object.create(Top.prototype);Dialog.prototype.constructor=Dialog;function Dialog(){}Dialog.__map={};Dialog.create=function(id,props){this.__map[id]=props};Dialog.init=function(){var ids=Object.keys(this.__map);for(var i=0,len=ids.length;i<len;i++){var props=this.__map[ids[i]];props.id=ids[i];var dialog=Top.Widget.create("top-dialog",props);Top.App.getCurrentPage().template.appendChild(dialog.template);TopRuntime._callCallback(dialog.template,"attached")}};return Dialog}();Top.Notification=function(){Notification.prototype=Object.create(Top.prototype);Notification.prototype.constructor=Notification;function Notification(){}Notification.__map={};Notification.create=function(id,props){this.__map[id]=props};Notification.init=function(){var ids=Object.keys(this.__map);for(var i=0,len=ids.length;i<len;i++){var notification=Top.Widget.create("top-notification");var props=this.__map[ids[i]];props.id=ids[i];notification.setProperties(props);Top.App.getCurrentPage().template.appendChild(notification.template);TopRuntime._callCallback(notification.template,"attached")}};return Notification}();window.addEventListener("popstate",function(event){if(Top.configs.closeDialogToBrowserBack&&Top.dialogArray.length>0){Top.dialogArray[Top.dialogArray.length-1].close()}else{Top.App.calledPopstate=true;Top.App.__popstate(event)}});window.addEventListener("hashchange",function(event){if(Top.App.calledPopstate!==true){Top.App.__popstate(event)}Top.App.calledPopstate=false});if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){position=position||0;return this.substr(position,searchString.length)===searchString}}if(!String.prototype.endsWith){String.prototype.endsWith=function(searchString,position){var subjectString=this.toString();if(typeof position!=="number"||!isFinite(position)||Math.floor(position)!==position||position>subjectString.length){position=subjectString.length}position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position}}if(!String.prototype.includes){String.prototype.includes=function(search,start){"use strict";if(typeof start!=="number"){start=0}if(start+search.length>this.length){return false}else{return this.indexOf(search,start)!==-1}}}if(!String.prototype.equals){String.prototype.equals=function(str){return this.toString()===str}}String.prototype.replaceAt=function(index,character){return this.substr(0,index)+character+this.substr(index+character.length)};if(typeof Object.assign!="function"){(function(){Object.assign=function(target){"use strict";if(target===undefined||target===null){throw new TypeError("Cannot convert undefined or null to object")}var output=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!==undefined&&source!==null){for(var nextKey in source){if(source.hasOwnProperty(nextKey)){output[nextKey]=source[nextKey]}}}}return output}})()}if(!Array.prototype.includes){Array.prototype.includes=function(searchElement){"use strict";if(this==null){throw new TypeError("Array.prototype.includes called on null or undefined")}var O=Object(this);var len=parseInt(O.length,10)||0;if(len===0){return false}var n=parseInt(arguments[1],10)||0;var k;if(n>=0){k=n}else{k=len+n;if(k<0){k=0}}var currentElement;while(k<len){currentElement=O[k];if(searchElement===currentElement||searchElement!==searchElement&&currentElement!==currentElement){return true}k++}return false}}if(!Array.prototype.fill){Object.defineProperty(Array.prototype,"fill",{value:function(value){if(this==null){throw new TypeError("this is null or not defined")}var O=Object(this);var len=O.length>>>0;var start=arguments[1];var relativeStart=start>>0;var k=relativeStart<0?Math.max(len+relativeStart,0):Math.min(relativeStart,len);var end=arguments[2];var relativeEnd=end===undefined?len:end>>0;var final=relativeEnd<0?Math.max(len+relativeEnd,0):Math.min(relativeEnd,len);while(k<final){O[k]=value;k++}return O}})}if(!Array.from){Array.from=function(){var toStr=Object.prototype.toString;var isCallable=function(fn){return typeof fn==="function"||toStr.call(fn)==="[object Function]"};var toInteger=function(value){var number=Number(value);if(isNaN(number)){return 0}if(number===0||!isFinite(number)){return number}return(number>0?1:-1)*Math.floor(Math.abs(number))};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=="undefined"){if(!isCallable(mapFn)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){T=arguments[2]}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==="undefined"?mapFn(kValue,k):mapFn.call(T,kValue,k)}else{A[k]=kValue}k+=1}A.length=len;return A}}()}(function(arr){arr.forEach(function(item){if(item.hasOwnProperty("remove")){return}Object.defineProperty(item,"remove",{configurable:true,enumerable:true,writable:true,value:function remove(){if(this.parentNode!==null)this.parentNode.removeChild(this)}})})})([Element.prototype,CharacterData.prototype,DocumentType.prototype]);if(window.NodeList&&!NodeList.prototype.forEach){NodeList.prototype.forEach=function(callback,argument){argument=argument||window;for(var i=0;i<this.length;i++){callback.call(argument,this[i],i,this)}}}if(!("remove"in Element.prototype)){Element.prototype.remove=function(){if(this.parentNode){this.parentNode.removeChild(this)}}}Number.isInteger=Number.isInteger||function(value){return typeof value==="number"&&isFinite(value)&&Math.floor(value)===value};(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();if(Array.prototype.equals)console.warn("Overriding existing Array.prototype.equals. Possible causes: New API defines the method, there's a framework conflict or you've got double inclusions in your code.");Array.prototype.equals=function(array){if(!array)return false;if(this.length!=array.length)return false;for(var i=0,l=this.length;i<l;i++){if(this[i]instanceof Array&&array[i]instanceof Array){if(!this[i].equals(array[i]))return false}else if(this[i]!=array[i]){return false}}return true};Object.defineProperty(Array.prototype,"equals",{enumerable:false});function isEquivalent(a,b){var aProps=Object.getOwnPropertyNames(a);var bProps=Object.getOwnPropertyNames(b);if(aProps.length!=bProps.length){return false}for(var i=0;i<aProps.length;i++){var propName=aProps[i];if(a[propName]!==b[propName]){return false}}return true}(function(arr){arr.forEach(function(item){if(item.hasOwnProperty("append")){return}Object.defineProperty(item,"append",{configurable:true,enumerable:true,writable:true,value:function append(){var argArr=Array.prototype.slice.call(arguments),docFrag=document.createDocumentFragment();argArr.forEach(function(argItem){var isNode=argItem instanceof Node;docFrag.appendChild(isNode?argItem:document.createTextNode(String(argItem)))});this.appendChild(docFrag)}})})})([Element.prototype,Document.prototype,DocumentFragment.prototype]);(function(arr){arr.forEach(function(item){if(item.hasOwnProperty("prepend")){return}Object.defineProperty(item,"prepend",{configurable:true,enumerable:true,writable:true,value:function prepend(){var argArr=Array.prototype.slice.call(arguments),docFrag=document.createDocumentFragment();argArr.forEach(function(argItem){var isNode=argItem instanceof Node;docFrag.appendChild(isNode?argItem:document.createTextNode(String(argItem)))});this.insertBefore(docFrag,this.firstChild)}})})})([Element.prototype,Document.prototype,DocumentFragment.prototype]);topjQuery.fn.hasOverflown=function(){var res;var vwidth;var text=this.attr("value")||this.text();if(text==undefined||text==""){return}if(text)text=text.replace(/\s/g,"&nbsp");var cont=top$("<div></div>").css("display",this.css("none")).css("z-index","-50").css("position","absolute").css("font-family",this.css("font-family")).css("font-size",this.css("font-size")).css("font-weight",this.css("font-weight")).text(text).appendTo("body");vwidth=cont.width();cont.remove();res=vwidth>this.width();return res};Top.Loader=function(){Loader.prototype=Object.create(Top.prototype);Loader.prototype.constructor=Loader;function Loader(){}Loader.start=function(settings){if(this.__loadingCount===undefined)this.__loadingCount=0;if(this.__id===undefined)this.__id=Top.Util.guid();if(typeof settings==="object"){var size=settings.size;var timeout=parseInt(settings.timeout);if(!isNaN(timeout)&&typeof timeout==="number"){setTimeout(function(){if(typeof settings.parentId==="string"){Top.Loader.__stopWithSettings(settings)}else{Top.Loader.stop()}},timeout)}this.__onStop=settings.stop;if(typeof settings.parentId==="string"){var parent=Top.Dom.selectById(settings.parentId).getElement();if(this.__isLoadingWithLayout===undefined)this.__isLoadingWithLayout={};if(this.__isLoadingWithLayout[settings.parentId]===true)return;this.__isLoadingWithLayout[settings.parentId]=true}else{var parent=document.body;this.__isLoading=true}}else{var size=settings}if(parent){parent.insertAdjacentHTML("beforeend","<div id='"+this.__id+"' class='top-loader-overlay' style='font-size:0;height:100%;'><ul class='top-loader "+size+"' style='position:absolute;'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>");if(typeof settings.layout==="function"){settings.layout(parent.querySelector(".top-loader-overlay"))}}else{var layout=document.getElementById(this.__id);if(document.body&&layout===null){var page=Top.App.getCurrentPage();var overlayHeight=page!=null?page.template.__height+"px":"100%";var loaderTop=size==="large"?"calc(50% - 24px)":"calc(50% - 6px)";document.body.insertAdjacentHTML("beforeend","<div id='"+this.__id+"' class='top-loader-overlay-default' style='font-size:0;height:"+overlayHeight+";position:fixed;'><ul class='top-loader "+size+"' style='position:fixed;top:"+loaderTop+";'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div>")}}this.__loadingCount++};Loader.stop=function(force){if(typeof force==="object"){this.__stopWithSettings(force)}else{if(force===true){this.__loadingCount=0}else{this.__loadingCount--}if(this.__loadingCount===0){this.__isLoading=false;var layout=document.getElementById(this.__id);if(Top.Util.Browser.isIE()){if(layout)layout.removeNode(true)}else{if(layout)layout.remove()}if(typeof this.__onStop==="function")this.__onStop()}else if(this.__loadingCount<0){this.__loadingCount=0}}};Loader.__stopWithSettings=function(settings){if(typeof settings.parentId==="string"&&this.__isLoadingWithLayout&&this.__isLoadingWithLayout[settings.parentId]===true){this.__isLoadingWithLayout[settings.parentId]=false;var parent=Top.Dom.selectById(settings.parentId).getElement();if(parent.querySelector(".top-loader-overlay")){parent.querySelector(".top-loader-overlay").remove();this.__loadingCount--}if(typeof this.__onStop==="function")this.__onStop()}};Loader.isLoading=function(){return this.__isLoading};return Loader}();Top.EventManager=function(){EventManager.prototype=Object.create(Top.prototype);EventManager.prototype.constructor=EventManager;EventManager.prototype.events={};EventManager.prototype.shortCut=false;function EventManager(){}EventManager.on=function(event,topDom,selector,callback){var id=topDom.id;if(typeof topDom==="string")id=topDom;if(!this.prototype.events[event]){this.__addEvent(event,callback);this.prototype.events[event]={}}if(this.prototype.events[event]!==undefined){if(this.prototype.events[event][id]===undefined){this.prototype.events[event][id]={}}if(typeof selector==="function"){callback=selector;selector=id}this.prototype.events[event][id][selector]=callback}};EventManager.__findEvent=function(e,flag){var events=Top.EventManager.prototype.events;var event=top$.extend({},e);e=undefined;event.top_stop_propagation=false;event.stopPropagation=function(){this.top_stop_propagation=true};if(flag===true){Top.EventManager.__setLastEvent(event.target);flag=false}if(!events[event.type]){return}var dom=Top.EventManager.__findTopDom(event.target);if(dom===false)return false;if(events[event.type][dom.id]!==undefined){for(var tag in events[event.type][dom.id]){var widgets=Top.Dom.selectById(dom.id).template.querySelectorAll(tag);for(var i=0;i<widgets.length;i++){var widget=widgets[i];if(widget.isEqualNode(event.target)){var callback=events[event.type][dom.id][tag];callback(event)}}}}if(event.top_stop_propagation===false){if(Top.Util.Browser.isChrome()&&event.path.length>1){event.target=event.path[1];event.path.shift()}else{if(event.target.parentNode!==undefined){event.target=event.target.parentNode}}if(event.target.tagName.startsWith("TOP")&&flag===undefined)Top.EventManager.__findEvent(event,true);else Top.EventManager.__findEvent(event,flag)}};EventManager.__findKeyEvent=function(e,lastEvent){var event=top$.extend({},e);e=undefined;if(event.top_target===undefined&&document.activeElement!==undefined&&document.activeElement.tagName!=="BODY"){lastEvent=EventManager.__findTopDom(document.activeElement);event.top_target=lastEvent}if(lastEvent===undefined)var lastEvent=Top.EventManager.lastEvent;if(event.target.tagName==="BODY")event.target=lastEvent;event.top_stop_propagation=false;event.stopPropagation=function(){this.top_stop_propagation=true};var events=Top.EventManager.prototype.events;if(lastEvent&&events[event.type][lastEvent.id]!==undefined){var callback=events[event.type][lastEvent.id][lastEvent.id];callback(event)}if(lastEvent&&event.top_stop_propagation===false){var dom=EventManager.__findTopDom(lastEvent.parentNode);if(dom===false)return;EventManager.__findKeyEvent(event,dom)}};EventManager.off=function(event,topDom,selector){var id=topDom.id;if(typeof topDom==="string")id=topDom;var events=Top.EventManager.prototype.events;if(!events[event])return;if(!events[event][id])return;if(!events[event][id][selector])return;delete events[event][id][selector];var flag=false;for(var tmp in events[event][id]){flag=true;break}if(flag===false)delete events[event][id];var flag=false;for(var tmp in events[event]){flag=true;break}if(flag===false){delete events[event];document.removeEventListener(event)}};EventManager.addShortcut=function(key,callback){if(EventManager.prototype.shortCut===false){EventManager.__addEvent("keydown",null,true);EventManager.prototype.shortCut=true}var events=EventManager.prototype.events;var keys=key.split("+");var new_key=new Array;for(var i=0;i<keys.length;i++){switch(keys[i].toLowerCase()){case"ctrl":new_key[0]="ctrl";break;case"alt":new_key[1]="alt";break;case"shift":new_key[2]="shift";break;default:if(parseInt(keys[i].toLowerCase())>300)new_key[3]=parseInt(keys[i].toLowerCase());else new_key[3]=keys[i].toLowerCase()}}new_key=new_key.filter(Boolean).toString();events[new_key]=callback};EventManager.__findShorcut=function(e){var key_string="";if(e.ctrlKey===true){key_string+="ctrl,"}if(e.altKey===true){key_string+="alt,"}if(e.shiftKey===true){key_string+="shift,"}if(e.keyCode>47&&e.keyCode<91){key_string+=String.fromCharCode(e.keyCode)}else{key_string+=e.keyCode.toString()}key_string=key_string.toLowerCase();var events=EventManager.prototype.events;if(events[key_string]!==undefined){var callback=events[key_string];callback(e)}};EventManager.__findTopDom=function(dom){if(dom===null||dom.tagName===undefined)return false;if(dom.tagName.startsWith("TOP")){return dom}return this.__findTopDom(dom.parentNode)};EventManager.__addEvent=function(type,callback,shortCut){if(type.startsWith("key")){if(shortCut===true){document.addEventListener(type,this.__findShorcut)}else{document.addEventListener(type,this.__findKeyEvent)}}else document.addEventListener(type,this.__findEvent)};EventManager.__setLastEvent=function(target){Top.EventManager.lastEvent=target};return EventManager}();Top.Excel=function(){Excel.prototype=Object.create(Top.prototype);Excel.prototype.constructor=Excel;function Excel(){}Excel.import=function(device,header,callback,option){var _this=this;var data=device.src;var workbook=XLSX.read(data,{type:"buffer"});var sheetName;var workSheet;var result;if(!option){sheetName=workbook.SheetNames[0];workSheet=workbook.Sheets[sheetName];result=XLSX.utils.sheet_to_row_object_array(workSheet);if(header!==null&&header!==undefined&&header.length>0){result=_this.convertKey(result,header)}}else if(option===true||option==="true"){result=new Object;sheetName=workbook.SheetNames;for(var i=0,length=sheetName.length;i<length;i++){workSheet=workbook.Sheets[sheetName[i]];result[sheetName[i]]=XLSX.utils.sheet_to_row_object_array(workSheet);if(header!==null&&header!==undefined&&typeof header==="object"&&Object.keys(header).length>0){if(header[sheetName[i]]&&Array.isArray(header[sheetName[i]])){result[sheetName[i]]=_this.convertKey(result[sheetName[i]],header[sheetName[i]])}}}}else if(option&&Array.isArray(option)){result=new Object;sheetName=workbook.SheetNames;var filterSheet=sheetName.filter(function(item){return option.filter(function(sheet){return sheet===item}).length!==0});for(var i=0,length=filterSheet.length;i<length;i++){workSheet=workbook.Sheets[filterSheet[i]];result[filterSheet[i]]=XLSX.utils.sheet_to_row_object_array(workSheet);if(header!==null&&header!==undefined&&typeof header==="object"&&Object.keys(header).length>0){if(header[filterSheet[i]]&&Array.isArray(header[filterSheet[i]])){result[filterSheet[i]]=_this.convertKey(result[filterSheet[i]],header[filterSheet[i]])}}}}else{throw new TypeError("import option type is not the specified type")}callback(result)};Excel.convertKey=function(XL_row_object,header){var keys=Object.keys(XL_row_object[0]);var filterKeys=keys.filter(function(item){return header.filter(function(id){return id===item}).length!==0});var tmpArray=new Array;for(var i=0;i<XL_row_object.length;i++){var tmpInfo=new Object;for(var j=0;j<filterKeys.length;j++){tmpInfo[filterKeys[j]]=XL_row_object[i][filterKeys[j]]}tmpArray.push(tmpInfo)}return tmpArray};Excel.export=function(tableId,booktype,pageId,tableData,option){if(pageId===undefined||pageId===null)pageId=Top.App.getCurrentPage().id;if(option===undefined){option={};option.type="single";option.includeHiddenData=false;option.includeHeaderList={};option.filename="top-tableview_to_excel"}if(!option||option!==undefined&&typeof option!=="object"){throw new TypeError("export option is not an object")}else if(option.type!==undefined&&option.type!=="single"&&option.type!=="list"){throw new TypeError("export option type is not the specified type(single or list)")}else if(option.includeHiddenData!==undefined&&typeof option.includeHiddenData!=="boolean"){throw new TypeError("export option includeHiddenData is not boolean")}else if(option.includeHeaderList!==undefined&&option.includeHeaderList!==null&&typeof option.includeHeaderList!=="object"){throw new TypeError("export option includeHeaderList is not an array")}else if(option.filename!==undefined&&(option.filename===null||option.filename===""||option.filename!==null&&typeof option.filename!=="string")){throw new TypeError("export option filename is not string or not entered")}if(option.type===undefined){option.type="single"}if(option.includeHiddenData===undefined){option.includeHiddenData=false}if(option.includeHeaderList===undefined||option.includeHeaderList===null){option.includeHeaderList={}}if(option.filename===undefined){option.filename="top-tableview_to_excel"}var workbook=XLSX.utils.book_new();if(option.type==="list"&&Array.isArray(tableId)&&(Array.isArray(tableData)||tableData===null)){if(Array.isArray(tableData)){if(tableId.length===tableData.length){for(var i=0,len=tableId.length;i<len;i++){var table=Top.Dom.selectById(pageId).getElement("#"+tableId[i])[0];var headerList=Object.keys(option.includeHeaderList).length>0?option.includeHeaderList[tableId[i]]:null;if(tableData[i]){var data=this.__tableDataToJson(table,tableData[i],headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}else if(table.paginate){var data=this.__tableDataToJson(table,table.data,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}else{var data=this.__tableDataToJson(table,table.backupdata,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}var index=i+1;XLSX.utils.book_append_sheet(workbook,ws,"Sheet"+index)}}else{throw new TypeError("the length of table Id does not match the length of tableData")}}else{for(var i=0,len=tableId.length;i<len;i++){var table=Top.Dom.selectById(pageId).getElement("#"+tableId[i])[0];var headerList=Object.keys(option.includeHeaderList).length>0?option.includeHeaderList[tableId[i]]:null;if(table.paginate){var data=this.__tableDataToJson(table,table.data,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}else{var data=this.__tableDataToJson(table,table.backupdata,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}var index=i+1;XLSX.utils.book_append_sheet(workbook,ws,"Sheet"+index)}}}else if(option.type==="single"&&typeof tableId==="string"&&(Array.isArray(tableData)||tableData===null||tableData===undefined)){if(Array.isArray(tableData)){var table=Top.Dom.selectById(pageId).getElement("#"+tableId)[0];var headerList=Object.keys(option.includeHeaderList).length>0?option.includeHeaderList[tableId]:null;if(tableData){var data=this.__tableDataToJson(table,tableData,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}else if(table.paginate){var data=this.__tableDataToJson(table,table.data,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}else{var data=this.__tableDataToJson(table,table.backupdata,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}XLSX.utils.book_append_sheet(workbook,ws,"Sheet1")}else{var table=Top.Dom.selectById(pageId).getElement("#"+tableId)[0];var headerList=Object.keys(option.includeHeaderList).length>0?option.includeHeaderList[tableId]:null;if(table.paginate){var data=this.__tableDataToJson(table,table.data,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}else{var data=this.__tableDataToJson(table,table.backupdata,headerList,option.includeHiddenData);var ws=XLSX.utils.aoa_to_sheet(data)}XLSX.utils.book_append_sheet(workbook,ws,"Sheet1")}}else{throw new TypeError("check export option type, tableId type, tableData type")}if(booktype===undefined||booktype==="xlsx"){booktype="xlsx"}else if(booktype==="xls"){booktype="biff8"}else if(booktype==="csv"){this.__exportCsv(data,option.filename);return}else if(booktype==="txt"){booktype="txt"}else if(booktype==="json"){this.__exportJson(table.backupdata,option.filename);return}else if(booktype==="xml"){this.__exportXml(table.backupdata,option.filename);return}else{throw new TypeError(booktype+" is unexpected type(xlsx, xls, csv, txt, json, xml)")}var wopts={bookType:booktype,bookSST:false,type:"binary",cellStyles:"true"};if(booktype=="biff8"){booktype="xls"}var wbout=XLSX.write(workbook,wopts);saveAs(new Blob([this.__s2ab(wbout)],{type:"application/octet-stream"}),option.filename+"."+booktype)};Excel.__exportCsv=function(data,inputFileName){var csvString="";for(var i=0;i<data.length;i++){for(var j=0;j<Object.keys(data[i]).length;j++){csvString+='"'+data[i][j]+'"';if(j<Object.keys(data[i]).length-1)csvString+=","}csvString+="\r\n"}var saveFileName;if(inputFileName!==undefined){saveFileName=inputFileName}else{saveFileName="top-tableview_to_excel"}var blob=new Blob(["\ufeff"+csvString],{type:"data:text/csv;charset=utf-8,\ufeff"});var encodedUri=encodeURI(csvString);if(Top.Util.Browser.isIE()){window.navigator.msSaveOrOpenBlob(blob,saveFileName+".csv")}else{var link=document.createElement("a");link.setAttribute("href","data:text/csv;charset=utf-8,\ufeff"+encodedUri);link.setAttribute("download",saveFileName+".csv");link.click()}};Excel.__exportJson=function(data,inputFileName){var dataStr=JSON.stringify(data);var exportFileName;if(inputFileName!==undefined&&inputFileName!=="top-tableview_to_excel"){exportFileName=inputFileName}else{exportFileName="top-tableview_to_json"}if(Top.Util.Browser.isIE()){var blob=new Blob([dataStr],{type:"data:application/json;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(blob,exportFileName+".json")}else{var dataUri="data:application/json;charset=utf-8,"+encodeURIComponent(dataStr);var linkElement=document.createElement("a");linkElement.setAttribute("href",dataUri);linkElement.setAttribute("download",exportFileName+".json");linkElement.click();linkElement=null}};Excel.__exportXml=function(data,inputFileName){var result=this.__objectToXml(data);var exportFileName;if(inputFileName!==undefined&&inputFileName!=="top-tableview_to_excel"){exportFileName=inputFileName}else{exportFileName="top-tableview_to_xml"}if(Top.Util.Browser.isIE()){var blob=new Blob([result],{type:"data:text/xml;charset=utf-8;"});window.navigator.msSaveOrOpenBlob(blob,exportFileName+".xml")}else{var dataUri="data:text/xml;charset=utf-8,"+encodeURIComponent(result);var linkElement=document.createElement("a");linkElement.setAttribute("href",dataUri);linkElement.setAttribute("download",exportFileName+".xml");linkElement.click()}};Excel.__objectToXml=function(obj){var xml="";for(var prop in obj){if(!obj.hasOwnProperty(prop)){continue}if(obj[prop]==undefined){continue}xml+="<"+prop+">";if(typeof obj[prop]=="object"){xml+=this.__objectToXml(new Object(obj[prop]))}else{xml+=obj[prop]}xml+="</"+prop+">"}return xml};Excel.__tableDataToJson=function(table,tableData,headerData,includeHidden){var rowSpanDummyString="";var colSpanDummyString="";var array=[];var lastHeaderIndexList=[];var result=[];var numOfHeader=1;var headerRows=table.querySelectorAll(".top-tableview-scrollHead .head-row");var headerArr=table.headerInfoArray;if(!includeHidden){headerArr=headerArr.filter(function(col){return col.visible==="visible"})}if(headerData!==null&&headerData!==undefined&&headerData.length>0){var headerList=headerArr.filter(function(col){return headerData.filter(function(selectCol){return selectCol===col.lastHeadNum}).length!==0});result=Excel.__trackParentRecursive(headerArr,headerList,result);result=result.concat(headerList);result=Excel.__getUniqueObjectArray(result,"id");result.map(function(data){data.currentColspan=0});result=Excel.__calculateCurrentColspan(result)}for(var i=0,len=headerRows.length;i<len;i++){array[i]=[];var colOffset=0;var selectedList;for(var col=0,leng=headerArr.length;col<leng;col++){if(headerArr[col].lastHeadNum==="index"||headerArr[col].lastHeadNum==="index_r"||headerArr[col].lastHeadNum==="check"||headerArr[col]["header-control"]==="js::index"||headerArr[col]["header-control"]==="js::status"||headerArr[col]["header-control"]==="js::check"||headerArr[col]["header-control"]===null)continue;if(headerArr[col].xmlRow!==i){continue}var value=table.__i18n(headerArr[col].text);var id=headerArr[col].id;if(value!==null){if(result.length>0){selectedList=result.indexOf(result.filter(function(item){return item.id===id})[0]);if(selectedList===-1){continue}}if(value===""){value=document.getElementById(headerArr[col].id).innerText}if(headerArr[col].isLastHead){lastHeaderIndexList.push(headerArr[col].lastHeadNum)}array[i].push(value)}var colspan;if(result.length>0){colspan=headerArr[col].currentColspan}else{colspan=headerArr[col].colspan}if(colspan>1){for(var k=1,len3=colspan;k<len3;k++){array[i].splice(col+k+colOffset,0,colSpanDummyString)}colOffset+=parseInt(colspan)}if(parseInt(headerArr[col].rowspan)>numOfHeader){numOfHeader=parseInt(headerArr[col].rowspan)}}}numOfHeader=array.length;if(numOfHeader===2){var rowOffset=0;if(result.length>0){for(var i=0;i<result.length;i++){if(result[i].rowspan>1){array[1].splice(i+rowOffset,0,rowSpanDummyString)}}}else{for(var num=0,leng=headerArr.length;num<leng;num++){if(headerArr[num].lastHeadNum==="index"||headerArr[num].lastHeadNum==="index_r"||headerArr[num].lastHeadNum==="check"||headerArr[num]["header-control"]==="js::index"||headerArr[num]["header-control"]==="js::status"||headerArr[num]["header-control"]==="js::check"||headerArr[num]["header-control"]===null)continue;if(headerArr[num].rowspan>1){array[1].splice(num+rowOffset,0,rowSpanDummyString)}}}}else if(numOfHeader===3){var rowOffset1=0;var rowOffset2=0;if(result.length>0){for(var i=0;i<result.length;i++){if(result[i].rowspan===2){array[1].splice(i+rowOffset,0,rowSpanDummyString)}else if(result[i].rowspan===3){array[1].splice(i+rowOffset1,0,rowSpanDummyString);array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(result[i].currentColspan>1){rowOffset1+=result[i].currentColspan-1;rowOffset2+=result[i].currentColspan-1}}}else{for(var num=0,leng=headerArr.length;num<leng;num++){if(headerArr[num].lastHeadNum==="index"||headerArr[num].lastHeadNum==="index_r"||headerArr[num].lastHeadNum==="check"||headerArr[num]["header-control"]==="js::index"||headerArr[num]["header-control"]==="js::status"||headerArr[num]["header-control"]==="js::check"||headerArr[num]["header-control"]===null)continue;if(headerArr[num].rowspan===2){array[1].splice(i+rowOffset,0,rowSpanDummyString)}else if(headerArr[num].rowspan===3){array[1].splice(num+rowOffset1,0,rowSpanDummyString);array[2].splice(num+rowOffset2,0,rowSpanDummyString)}if(headerArr[num].colspan>1){rowOffset1+=headerArr[num].colspan-1;rowOffset2+=headerArr[num].colspan-1}}}rowOffset2=0;for(var i=0,len=array[2].length;i<len;i++){if(array[2][i]!==rowSpanDummyString){rowOffset2=i;break}}}for(var i=0,len=tableData.length;i<len;i++){var rowData=[];var columnLen=lastHeaderIndexList.length;if(columnLen>0){lastHeaderIndexList.sort(function(a,b){return a-b})}var offset=0;for(var j=0;j<columnLen;j++){var dataFieldRegExp=new RegExp("([-\\w]+)=[\"|']({[\\w.]+})[\"|']","g");var keys=new Array;var bindingKey;var selectedText;var isSelectBoxInTableviewData=false;var value=table.rowItemArray[lastHeaderIndexList[j]].outerHTML.match(dataFieldRegExp);if(value!==null){value.sort();for(var prop=0;prop<value.length;prop++){var parseValue=value[prop].split("=");bindingKey=parseValue[0];var fieldName=parseValue[1];if(bindingKey==="items"&&fieldName.indexOf(".")===-1){isSelectBoxInTableviewData=true;continue}fieldName=fieldName.substring(2,fieldName.indexOf("}"));
if(keys.indexOf(fieldName)===-1){keys.push(fieldName)}if(isSelectBoxInTableviewData&&bindingKey==="selected-text"){selectedText=fieldName}}var tagName=table.rowItemArray[lastHeaderIndexList[j]].children.length>0?table.rowItemArray[lastHeaderIndexList[j]].children[0].tagName:null;if(tagName==="TOP-SELECTBOX"){var entity;if(Top.Util.Browser.isIE()){entity='":"'}else{entity="&quot;:&quot;"}var widgetItemRegExp=new RegExp("(text=)[\"|']([-A-Za-z0-9]+)[\"|']","g");var nodesBindingRegExp=new RegExp("(nodes"+entity+")([A-Za-z0-9_-]+.[A-Za-z0-9_-]+)","g");var itemsBindingRegExp=new RegExp("(items"+entity+")([A-Za-z0-9_-]+.[A-Za-z0-9_-]+)","g");var nodesRegExp=new RegExp("(nodes=)([\"|'][A-Za-z0-9_-]+.[A-Za-z0-9_-]+[\"|'])","g");var resultWidgetItem=table.rowItemArray[lastHeaderIndexList[j]].children[0].outerHTML.match(widgetItemRegExp);var resultNodesBindingData=table.rowItemArray[lastHeaderIndexList[j]].children[0].outerHTML.match(nodesBindingRegExp);var resultItemsBindingData=table.rowItemArray[lastHeaderIndexList[j]].children[0].outerHTML.match(itemsBindingRegExp);var resultNodesData=table.rowItemArray[lastHeaderIndexList[j]].children[0].outerHTML.match(nodesRegExp);var nodeList=new Array;if(resultWidgetItem!==null){for(var z=0;z<resultWidgetItem.length;z++){var text=resultWidgetItem[z].split("=");var parseText=text[1].replace(/\"/gi,"");nodeList.push(parseText)}var nodeData=tableData[i][keys[0]];var data=bindingKey==="selected-index"?nodeList[nodeData]:nodeData}else if(resultNodesBindingData!==null){var text=resultNodesBindingData[0].split("nodes"+entity);var parseText=eval(text[1].replace(/\"/gi,""));var nodeData=tableData[i][keys[0]];var data=bindingKey==="selected-index"?parseText[nodeData].text:nodeData}else if(resultItemsBindingData!==null){var text=resultItemsBindingData[0].split("items"+entity);var parseText=eval(text[1].replace(/\"/gi,""));var nodeData=tableData[i][keys[0]];var data=bindingKey==="selected-index"?parseText[nodeData].text:nodeData}else if(resultNodesData!==null){var text=resultNodesBindingData[0].split("=");var parseText=eval(text[1].replace(/\"/gi,""));var nodeData=tableData[i][keys[0]];var data=bindingKey==="selected-index"?parseText[nodeData].text:nodeData}else if(selectedText){var data=tableData[i][selectedText]}else{throw new TypeError("top-selectbox nodes exists an error")}}else{var data=tableData[i][keys[0]];if(data===undefined)data=""}rowData[j-offset]=data}else{var currentCell=table.rowItemArray[lastHeaderIndexList[j]];if(currentCell.tagName!==undefined&&currentCell.tagName=="TOP-COLUMNITEM"){var data=currentCell.getAttribute("text");if(data!==undefined||data!==null){if(data===undefined)data="";rowData[j-offset]=data}else{throw new TypeError("currentCell text attribute is undefined or null")}}else{throw new TypeError("currentCell tageName is not TOP-COLUMNITEM")}}}array[i+numOfHeader]=rowData}return array};Excel.__tableToJson=function(_table){var rowSpanDummyString="";var colSpanDummyString="";var table=_table.scrollTable?_table.querySelector(".top-tableview-scrollBody table"):_table.querySelector("table");var array=[];var numOfHeader=1;for(var i=0,len=table.rows.length;i<len;i++){array[i]=[];var row=table.rows[i];var colOffset=0;var temp=[];for(var j=0,len2=row.cells.length;j<len2;j++){var cell=row.cells[j];if(cell.children[0]!==undefined&&cell.children[0].tagName==="TOP-SELECTBOX"){array[i].push(cell.children[0].querySelector(".top-selectbox-container").innerText);continue}if(cell.tagName==="TH"){if(cell.getAttribute("value")!=null){array[i].push(cell.getAttribute("value"))}else if(cell.innerText!=null){array[i].push(cell.innerText)}}else if(cell.tagName==="TD"){if(cell.getAttribute("value")!=null)array[i].push(cell.getAttribute("value"));else if(cell.innerText!=null){array[i].push(cell.innerText);if(array[i][j].includes("No data available in table")){array[i][j]=""}}else{var dump="";array[i].push(dump)}}if(cell.getAttribute("colspan")>1){for(var k=1,len3=cell.getAttribute("colspan");k<len3;k++){array[i].splice(j+k+colOffset,0,colSpanDummyString)}colOffset+=parseInt(cell.getAttribute("colspan"))}if(parseInt(cell.getAttribute("rowspan"))>numOfHeader){numOfHeader=parseInt(cell.getAttribute("rowspan"))}}}if(numOfHeader===2){var rowOffset=0;var row0=table.rows[0];for(var i=0,len=row0.cells.length;i<len;i++){if(row0.cells[i].getAttribute("rowspan")>1){array[1].splice(i+rowOffset,0,rowSpanDummyString)}if(row0.cells[i].getAttribute("colspan")>1){rowOffset+=row0.cells[i].getAttribute("colspan")-1}}}else if(numOfHeader===3){var rowOffset1=0;var rowOffset2=0;var row0=table.rows[0];for(var i=0,len=row0.cells.length;i<len;i++){if(parseInt(row0.cells[i].getAttribute("rowspan"))===2){array[1].splice(i+rowOffset1,0,rowSpanDummyString)}else if(parseInt(row0.cells[i].getAttribute("rowspan"))===3){array[1].splice(i+rowOffset1,0,rowSpanDummyString);array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(parseInt(row0.cells[i].getAttribute("colspan"))>1){rowOffset1+=parseInt(row0.cells[i].getAttribute("colspan"))-1;rowOffset2+=parseInt(row0.cells[i].getAttribute("colspan"))-1}}rowOffset2=0;for(var i=0,len=array[2].length;i<len;i++){if(array[2][i]!==rowSpanDummyString){rowOffset2=i;break}}var row1=table.rows[1];for(var i=0,len=row1.cells.length;i<len;i++){if(parseInt(row1.cells[i].getAttribute("rowspan"))===2){array[2].splice(i+rowOffset2,0,rowSpanDummyString)}if(parseInt(row1.cells[i].getAttribute("colspan"))>1){rowOffset2+=parseInt(row1.cells[i].getAttribute("colspan"))-1}}}if(_table.checkable===true||_table.checkable==="true"){for(var i=0;i<array.length;i++){array[i].shift()}}return array};Excel.__trackParentRecursive=function(sourceArr,selectedList,resultArr){var parentList=sourceArr.filter(function(col){return selectedList.filter(function(selectCol){return selectCol.parent===col.index}).length!==0});resultArr=resultArr.concat(parentList);if(parentList.length>0){for(var i=0,length=parentList.length;i<length;i++){if(parentList[i].parent!==undefined&&parentList[i].parent!==null){resultArr=Excel.__trackParentRecursive(sourceArr,parentList,resultArr)}else{continue}}}return resultArr};Excel.__getUniqueObjectArray=function(array,key){var tempArr=[];var resultArr=[];for(var i=0;i<array.length;i++){var item=array[i];if(tempArr.includes(item[key])){continue}else{resultArr.push(item);tempArr.push(item[key])}}return resultArr=resultArr.sort(function(a,b){return a.xmlRow-b.xmlRow||a.xmlCol-b.xmlCol})};Excel.__calculateCurrentColspan=function(array){array.map(function(currentHeader){if(currentHeader.parent){var currentParent=array.filter(function(header){return currentHeader.parent===header.index});for(var i=0;i<currentParent.length;i++){currentParent[i].currentColspan++}}else if(currentHeader.children.length>0){currentHeader.currentColspan=0}else{currentHeader.currentColspan=1}});return array};Excel.__rgbToHex=function(rgb){var rgbRegex=/^rgb\(\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*,\s*(-?\d+)(%?)\s*\)$/;var result,r,g,b,hex="";if(result=rgbRegex.exec(rgb)){r=this.__componentFromStr(result[1],result[2]);g=this.__componentFromStr(result[3],result[4]);b=this.__componentFromStr(result[5],result[6]);hex="#"+(16777216+(r<<16)+(g<<8)+b).toString(16).slice(1)}return hex};Excel.__componentFromStr=function(numStr,percent){var num=Math.max(0,parseInt(numStr,10));return percent?Math.floor(255*Math.min(100,num)/100):Math.min(255,num)};Excel.__s2ab=function(s){var buf=new ArrayBuffer(s.length);var view=new Uint8Array(buf);for(var i=0;i!=s.length;++i)view[i]=s.charCodeAt(i)&255;return buf};Excel.__datenum=function(v,date1904){if(date1904)v+=1462;var epoch=Date.parse(v);return(epoch-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3)};return Excel}();Top.Mobile=function(){Mobile.prototype=Object.create(Top.prototype);Mobile.prototype.constructor=Mobile;adjudgeMobile();function Mobile(){}function adjudgeMobile(){if(navigator.userAgent.match(/Android/i)){Mobile.isMobile=true;Mobile.device="Android"}else if(navigator.userAgent.match(/BlackBerry/i)){Mobile.isMobile=true;Mobile.device="BlackBerry"}else if(navigator.userAgent.match(/iPhone|iPad|iPod/i)){Mobile.isMobile=true;Mobile.device="Apple"}else if(navigator.userAgent.match(/Opera/i)){Mobile.isMobile=true;Mobile.device="Opera"}else if(navigator.userAgent.match(/IEMobile/i)){Mobile.isMobile=true;Mobile.device="Window"}else{Mobile.isMobile=false}}Mobile.openKeyboard=function(positionX,positionY,type){if(!this.isMobile){return}positionX=positionX||0;positionY=positionY||0;type=type||"text";top$(".top-dummy-input").remove();var dummyInput=top$('<input class="top-dummy-input" type="'+type+'">').css("top",positionY).css("left",positionX).appendTo("body");top$(".top-dummy-input").focus()};Mobile.closeKeyboard=function(){if(!this.isMobile){return}top$(".top-dummy-input").focusout().remove()};Mobile.getKeyboardValue=function(){var input=top$(".top-dummy-input");if(!input){return}return input.val()};Mobile.keyDownCallback=function(fn){top$(".top-dummy-input").on("keydown",function(e){fn(e)})};return Mobile}();