(function(window){"use strict";var TOP={version:"0.0.1",jQuery:window.topjQuery,chart_list:[]};var top_chart_fn,top_chart_internal_fn;function API(owner){this.owner=owner}function inherit(base,derived){if(Object.create){derived.prototype=Object.create(base.prototype)}else{var f=function f(){};f.prototype=base.prototype;derived.prototype=new f}derived.prototype.constructor=derived;return derived}function Chart(config){var $$=this.internal=new ChartInternal(this);$$.loadConfig(config);$$.init();(function bindThis(fn,target,argThis){Object.keys(fn).forEach(function(key){target[key]=fn[key].bind(argThis);if(Object.keys(fn[key]).length>0){bindThis(fn[key],target[key],argThis)}})})(top_chart_fn,this,this);(function setChartAttribute(element){var chartNumber=0;if(TOP.chart_list&&TOP.chart_list.length){chartNumber=TOP.chart_list.length}element.setAttribute("top-chart",chartNumber)})(this.element)}function ChartInternal(api){var $$=this;$$.d3=window.d3?window.d3:typeof require!=="undefined"?require("d3"):undefined;$$.api=api;$$.config=$$.getDefaultConfig();$$.data={};$$.cache={};$$.axes={}}TOP.generate=function(config){var chart=new Chart(config);TOP.chart_list.push(chart);return chart};topjQuery.fn.topcharts=function(){var constr="generate",options,ret,chart,args=arguments;if(this[0]){if(typeof args[0]==="string"){constr=args[0];args=Array.prototype.slice.call(args,1)}options=args[0];if(options!==undefined){options.chart=options.chart||{};options.chart.renderTo=this[0];chart=new TOP[constr](options,args[1]);ret=chart}else if(options===undefined){ret=TOP.chart_list[this[0].getAttribute("top-chart")]}return ret}else{console.log("Error : No element found to render TOP chart!")}};TOP.chart={fn:Chart.prototype,internal:{fn:ChartInternal.prototype}};top_chart_fn=TOP.chart.fn;top_chart_internal_fn=TOP.chart.internal.fn;TOP.chart.Browser=function(){Browser.prototype=Object.create(Chart.prototype);Browser.prototype.constructor=Browser;function Browser(){}Browser.isOpera=function(){return!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0};Browser.isFirefox=function(){return typeof InstallTrigger!=="undefined"};Browser.isSafari=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0};Browser.isIE=function(){return false||!!document.documentMode};Browser.isEdge=function(){return!this.isIE()&&!!window.StyleMedia};Browser.isChrome=function(){return!!window.chrome&&!!window.chrome.webstore};Browser.isBlink=function(){return(this.isChrome()||this.isOpera())&&!!window.CSS};return Browser}();top_chart_internal_fn.loadJson=function(fileName){var request=new XMLHttpRequest;var json;request.onload=function(e){json=JSON.parse(this.responseText)};request.open("get",fileName,false);request.send();return json};top_chart_internal_fn.findCurrentPath=function(){var scripts=Array.prototype.slice.call(document.getElementsByTagName("script"));var currentPath="";var themepath="";scripts.forEach(function(item){var testChartname=/(\/topchart.js)$|(\/top.chart.js)$|(\/lib.min.js)$|(\/top.chart.min.js)$/g;if(testChartname.test(item.src))currentPath=item.src});themepath=currentPath.toString();if(themepath===""){themepath=document.getElementById("top.js").href;themepath=themepath+"/../chart"}else{var temp=themepath.split("/");var tempPath=temp[temp.length-1];if(tempPath==="top-chart.js"||tempPath==="lib.min.js")themepath=themepath+"/../../chart";else themepath=themepath+"/.."}return themepath};top_chart_internal_fn.init=function(){var $$=this,config=$$.config;$$.initParams();if(config.series){config.series=$$.convertHighchartsSeriesOptionsToTopChartsSeriesOptions(config.series);$$.buildStacks(config.series);$$.buildSeries(config.series);$$.initWithData($$.convertSeriesToData(config.series))}else{throw Error("Series may have some serious problems to initiate.")}};top_chart_internal_fn.convertHighchartsSeriesOptionsToTopChartsSeriesOptions=function(seriesOptions){var hasArcType=false,hasArcTypeSeries,$$=this,config=$$.config,length,i,j,k,arcTypeIndex,chartType=config.chart_type,newSeries=[];length=Array.isArray(seriesOptions)?seriesOptions.length:0;var isArcType=function(type){if(type){if(type==="pie"||type==="donut"||type==="angulargauge"||type==="bargauge"||type==="columngauge")return true;else return false}return false};var seriesOptions=$$.clone(seriesOptions);if(length<=0)return seriesOptions;if(isArcType(chartType)){for(i=0;i<seriesOptions.length;i++){if(isArcType(seriesOptions[i].type)||seriesOptions[i].type===undefined){hasArcTypeSeries=true;if(seriesOptions[i].data&&seriesOptions[i].data[0]&&seriesOptions[i].data[0]instanceof Object){for(j=0;j<seriesOptions[i].data.length;j++){newSeries[j]={};for(k in seriesOptions[i].data[j]){if(k!="y"){newSeries[j][k]=seriesOptions[i].data[j][k]}else{newSeries[j]["data"]=[seriesOptions[i].data[j][k]]}}}break}}}}return newSeries.length>0?newSeries:seriesOptions};top_chart_internal_fn.initSeriesMap=function(seriesOptions){$$.buildStacks(seriesOptions);$$.buildSeries(seriesOptions)};top_chart_internal_fn.buildStacks=function(seriesOptions){var $$=this,config=$$.config,i,stackName;config.data_groups={};for(i=0;i<seriesOptions.length;i++){if(seriesOptions[i].stacking==="normal"||"percent"){stackName=seriesOptions[i].stack;if(Object.keys(config.data_groups).length===0||Object.keys(config.data_groups).indexOf(stackName)<0)config.data_groups[stackName]=[];config.data_groups[stackName].push(seriesOptions[i].name)}}};top_chart_internal_fn.buildSeries=function(seriesOptions){var $$=this,config=$$.config,i,series;$$.api.series=[];for(i=0;i<seriesOptions.length;i++){series=new Series($$);series.init(seriesOptions[i]);series.index=i;$$.api.series[i]=series}};top_chart_internal_fn.initParams=function(){var $$=this,d3=$$.d3,config=$$.config;$$.clipId="TOP-"+ +new Date+"-clip",$$.clipIdForXAxis=$$.clipId+"-xaxis",$$.clipIdForYAxis=$$.clipId+"-yaxis",$$.clipIdForY2Axis=$$.clipId+"-y2axis",$$.clipIdForGrid=$$.clipId+"-grid",$$.clipPath=$$.getClipPath($$.clipId),$$.clipPathForXAxis=$$.getClipPath($$.clipIdForXAxis),$$.clipPathForYAxis=$$.getClipPath($$.clipIdForYAxis),$$.clipPathForY2Axis=$$.getClipPath($$.clipIdForY2Axis),$$.clipPathForGrid=$$.getClipPath($$.clipIdForGrid),$$.flowX=null;$$.dragStart=null;$$.dragging=false;$$.flowing=false;$$.cancelClick=false;$$.mouseover=undefined;$$.transiting=false;$$.tickValues=[];var currThemePath=$$.findCurrentPath()+"/theme.json";$$.theme=$$.loadJson(currThemePath);$$.color=$$.generateColor();$$.levelColor=$$.generateLevelColor();$$.dataTimeFormat=config.data_xLocaltime?d3.time.format:d3.time.format.utc;$$.axisTimeFormat=config.axis_x_localtime?d3.time.format:d3.time.format.utc;$$.defaultAxisTimeFormat=$$.axisTimeFormat.multi([["%H:%M:%S",function(d){return d.getMilliseconds()}],[":%S",function(d){return d.getSeconds()}],["%H:%M",function(d){return d.getMinutes()}],["%H:%M",function(d){return d.getHours()}],["%-m/%-d",function(d){return d.getDay()&&d.getDate()!==1}],["%-m/%-d",function(d){return d.getDate()!==1}],["%-m/%-d",function(d){return d.getMonth()}],["%Y/%-m/%-d",function(){return true}]]);$$.focusedPoint={};$$.focusedSeries=[];$$.clickDataPoint={};$$.selectedDataPoints=[];$$.hiddenTargetIds=[];$$.hiddenLegendIds=[];$$.focusedTargetIds=[];$$.defocusedTargetIds=[];$$.afterFlowTickValues=[];$$.positionMap={};if(config.chart_type==="bar"){config.chart_inverted=true}else if(config.chart_type==="column"){config.chart_type="bar"}if(config.chart_type==="bargauge"){config.chart_inverted=true}if(config.legend_verticalAlign==="top"&&!config.legend_align&&!config.legend_pagination){config.legend_align="right"}else if(config.legend_verticalAlign==="bottom"&&!config.legend_align){config.legend_align="center"}if(config.slider_enabled)config.zoom_enabled=true;if(($$.hasType("pie")||$$.hasType("donut"))&&!config.legend_pagination){if(!config.legend_align)config.legend_align="right";if(!config.legend_verticalAlign)config.legend_verticalAlign="middle";if(!config.legend_layout)config.legend_layout="vertical"}else{if(!config.legend_align)config.legend_align="center";if(!config.legend_verticalAlign)config.legend_verticalAlign="bottom";if(!config.legend_layout)config.legend_layout="horizontal"}$$.xOrient=config.chart_inverted?"left":"bottom";$$.yOrient=config.chart_inverted?config.axis_y_inner?"top":"bottom":config.axis_y_inner?"right":"left";$$.y2Orient=config.chart_inverted?config.axis_y2_inner?"bottom":"top":config.axis_y2_inner?"left":"right";$$.isLegendRight=config.legend_align==="right";$$.isLegendBottom=config.legend_align!=="right"&&config.legend_verticalAlign==="bottom";$$.isLegendTop=config.legend_floating===true&&config.legend_verticalAlign==="top";$$.isLegendLeft=config.legend_floating===true&&config.legend_align==="left";$$.legendStep=0;$$.legendItemWidth=0;$$.legendItemHeight=0;$$.isY2Show=false;$$.currentMaxTickWidths={x:0,y:0,y2:0};$$.rotated_padding_left=30;$$.rotated_padding_right=config.chart_inverted&&!config.xAxis_show?0:30;$$.rotated_padding_top=5;$$.withoutFadeIn={};$$.intervalForObserveInserted=undefined;$$.data.xs={};$$.frameList=[];$$.frameQueue=[];$$.frameUpdateList=[];$$.animationRaf=undefined;$$.lastFrameAt=undefined;$$.timeToNext=undefined;$$.runningTransitions=undefined;$$.currentFrame=undefined;$$.closest=undefined;$$.selectedData=undefined;$$.isMouseOverTooltip=false;$$.isFocusLock=false;$$.orgClosest=undefined;$$.tooltipClick=false;$$.is3d=undefined;$$.currentLegendIndex=0;$$.prevLegendList=[];$$.currentLegendList=[];$$.nextLegendList=[]};top_chart_internal_fn.initChartElements=function(){this.initBar();this.initLine();this.initEqualizer();this.initScatter();this.initLinearGauge();this.initArc();this.initAngularGauge();this.initCircularGauge();this.initText();this.initThreshold();this.initBubble();this.initBoxplot()};top_chart_internal_fn.initWithData=function(data){var $$=this,d3=$$.d3,config=$$.config,i;var defs,main,binding=true;$$.axis=new Axis($$);if($$.initPie){$$.initPie()}if($$.initBrush){$$.initBrush()}if($$.initZoom){$$.initZoom()}if(!config.chart_renderTo){$$.selectChart=d3.selectAll([])}else if(typeof config.chart_renderTo.node==="function"){$$.selectChart=config.chart_renderTo}else{$$.selectChart=d3.select(config.chart_renderTo)}if($$.selectChart.empty()){$$.selectChart=d3.select(document.createElement("div")).style("opacity",0);$$.observeInserted($$.selectChart);binding=false}$$.selectChart.html("").classed("TOP",true);if($$.stacking)config.tooltip_grouped=true;if($$.stacking==="percent"){$$.data.targets=$$.convertDataToTargets($$.convertDataToPercentData(data));$$.data.targetsForTooltip=$$.convertDataToTargets(data)}else{$$.data.targets=$$.convertDataToTargets(data);$$.data.targetsForTooltip=$$.convertDataToTargets(data)}if(config.data_filter){$$.data.targets=$$.data.targets.filter(config.data_filter)}for(i=0;i<config.series.length;i++){if(config.series[i].visible===false){$$.hiddenTargetIds.push(config.series[i].name)}}if(config.legend_hide){$$.addHiddenLegendIds(config.legend_hide===true?$$.mapToIds($$.data.targets):config.legend_hide)}if($$.hasType("angulargauge")||$$.hasType("bargauge")||$$.hasType("columngauge")||$$.hasType("circulargauge")){config.legend_enabled=false;config.tooltip_show=false;config.grid_x_show=false;config.grid_y_show=false;config.xAxis_tick_show=false;config.yAxis_tick_show=false;config.yAxis_threshold_value=false}$$.updateSizes();$$.updateScales();if(!config.chart_reflow){$$.api.setSize($$.currentWidth,$$.currentHeight)}$$.firstestTick=undefined;$$.x.domain(d3.extent($$.getXDomain($$.data.targets)));$$.y.domain($$.getYDomain($$.data.targets,"y"));$$.y2.domain($$.getYDomain($$.data.targets,"y2"));$$.orgXDomain=$$.x.domain();if($$.brush){$$.brush.scale($$.subX)}if(config.zoom_enabled){$$.zoom.scale($$.x)}$$.svg=$$.selectChart.append("svg").style("overflow","hidden").on("mouseenter",function(){return config.onmouseover.call($$)}).on("mouseleave",function(){return config.onmouseout.call($$)});defs=$$.svg.append("defs");$$.clipChart=$$.appendClip(defs,$$.clipId);$$.clipXAxis=$$.appendClip(defs,$$.clipIdForXAxis);$$.clipYAxis=$$.appendClip(defs,$$.clipIdForYAxis);$$.clipGrid=$$.appendClip(defs,$$.clipIdForGrid);$$.updateSvgSize();main=$$.main=$$.svg.append("g").attr("transform",$$.getTranslate("main"));if(config.slider_enabled){$$.initSlider()}if($$.initSubchart){$$.initSubchart()}if($$.initTooltip){$$.initTooltip()}$$.initRegion();if(!$$.hasType("equalizer")){$$.initGrid()}main.append("text").attr("class",CLASS.text+" "+CLASS.empty).attr("x",$$.width/2).attr("y",$$.height/2).text(function(d){if(!data||!data[0]){return config.noData_text}else{return""}}).style("font-weight",config.noData_style_fontWeight).style("font-size",config.noData_style_fontSize+"px").style("fill",config.noData_style_color).attr("text-anchor","middle").attr("dominant-baseline","middle");$$.initPlotBorder();if(!$$.hasType("bargauge")&&!$$.hasType("columngauge")&&!$$.hasType("angulargauge")){$$.initTitle();$$.updateTitle();if(!$$.hasType("circulargauge")){$$.initSubtitle();$$.updateSubtitle();if(config.credits_enabled)$$.initCredits()}}if($$.initLegend){$$.initLegend()}main.append("g").attr("clip-path",$$.clipPath).attr("class",CLASS.chart);$$.initEventRect();$$.initChartElements();$$.initLabels();$$.updateLabels();main.insert("rect",config.zoom_privileged?null:"g."+CLASS.regions).attr("class",CLASS.zoomRect).attr("width",$$.width).attr("height",$$.height).style("opacity",0).on("dblclick.zoom",null);if(config.axis_x_extent){$$.brush.extent($$.getDefaultExtent())}$$.axis.init();$$.updateTargets($$.data.targets);if(config.slider_enabled)$$.generateSlider();if(binding){$$.updateDimension();$$.redraw({withTransition:false,withTransform:true,withUpdateXDomain:true,withUpdateOrgXDomain:true,withTransitionForAxis:false});if(config.chart_type==="bargauge"||config.chart_type==="columngauge")$$.updateAndRedraw()}if(window.onresize==null){window.onresize=$$.generateResize()}if(window.onresize.add){window.onresize.add(function(){$$.api.flush()})}$$.api.element=$$.selectChart.node()};top_chart_internal_fn.updateParams=function(){var $$=this,config=$$.config;$$.color=$$.generateColor();$$.levelColor=$$.generateLevelColor();if(!config.legend_align&&config.legend_verticalAlign==="top"){config.legend_align="right"}else if(!config.legend_align&&config.legend_verticalAlign==="bottom"){config.legend_align="center"}$$.xOrient=config.chart_inverted?"left":"bottom";$$.yOrient=config.chart_inverted?config.axis_y_inner?"top":"bottom":config.axis_y_inner?"right":"left";$$.y2Orient=config.chart_inverted?config.axis_y2_inner?"bottom":"top":config.axis_y2_inner?"left":"right";$$.isLegendRight=config.legend_align==="right";$$.isLegendBottom=config.legend_align!=="right"&&config.legend_verticalAlign==="bottom";$$.isLegendTop=config.legend_floating===true&&config.legend_verticalAlign==="top";$$.isLegendLeft=config.legend_floating===true&&config.legend_align==="left";$$.rotated_padding_right=config.chart_inverted&&!config.xAxis_show?0:30;$$.buildStacks(config.series);$$.buildSeries(config.series);$$.updateWithData($$.convertSeriesToData(config.series),true);$$.loadFromArgs({series:config.series});$$.tooltipTable.attr("class",config.tooltip_grouped?CLASS.tooltip:CLASS.tooltipSingle);if(config.chart_type!=="pie"&&config.chart_type!=="donut"&&config.chart_type!=="angulargauge"&&config.chart_type!=="circulargauge"){$$.tooltipArrow.attr("class",config.tooltip_grouped?CLASS.tooltipGroupArrow:CLASS.tooltipArrow)}};top_chart_internal_fn.updateWithData=function(data,isUpdate){var $$=this,config=$$.config,i;if($$.stacking==="percent"){$$.data.targets=$$.convertDataToTargets($$.convertDataToPercentData(data));$$.data.targetsForTooltip=$$.convertDataToTargets(data)}else{var targets=$$.convertDataToTargets(data);if(targets.length===0){$$.data.targets=[]}else{var i=0;if(isUpdate){$$.data.targets.forEach(function(d){for(var i=0;i<targets.length;i++){if(d.id===targets[i].id){d.values=targets[i].values;targets.splice(i,1);break}}});$$.data.targets=$$.data.targets.concat(targets)}else if(targets.length<$$.data.targets.length){var count=$$.data.targets.length-targets.length;while(count){if(targets[i]){if($$.data.targets[i].id!==targets[i].id){$$.data.targets.splice(i,count);count=0}}else if(!targets[i]&&count){$$.data.targets.splice(i,count);count=0}i++}}else{for(i=0;i<targets.length;i++){if($$.data.targets[i]){$$.data.targets[i].targetsForTooltip=targets[i].targetsForTooltip;if($$.data.targets[i].values.length<targets[i].values.length){var plusLength=targets[i].values.length-$$.data.targets[i].values.length;var plusIndex=$$.data.targets[i].values.length;for(var k=0;k<plusLength;k++)$$.data.targets[i].values.push(targets[i].values[plusIndex+k])}else{for(var j=0;j<$$.data.targets[i].values.length;j++){if(targets[i].values){$$.data.targets[i].values[j].value=targets[i].values[j].value;if(targets[i].values[j].x)$$.data.targets[i].values[j].x=targets[i].values[j].x}}}}else{$$.data.targets[i]=targets[i]}}}}}if(config.data_filter){$$.data.targets=$$.data.targets.filter(config.data_filter)}for(i=0;i<config.series.length;i++){if(config.series[i].visible===false){$$.hiddenTargetIds.push(config.series[i].name)}}if(config.legend_hide){$$.addHiddenLegendIds(config.legend_hide===true?$$.mapToIds($$.data.targets):config.legend_hide)}if(!config.slider_enabled||config.slider_enabled&&config.slider_mode==="reset"){$$.x.domain(d3.extent($$.getXDomain($$.data.targets)))}$$.y.domain($$.getYDomain($$.data.targets,"y"));$$.y2.domain($$.getYDomain($$.data.targets,"y2"));$$.updateTargets($$.data.targets);if(config.slider_enabled)$$.updateSlider()};top_chart_internal_fn.smoothLines=function(el,type){var $$=this;if(type==="grid"){el.each(function(){var g=$$.d3.select(this),x1=g.attr("x1"),x2=g.attr("x2"),y1=g.attr("y1"),y2=g.attr("y2");g.attr({x1:Math.ceil(x1),x2:Math.ceil(x2),y1:Math.ceil(y1),y2:Math.ceil(y2)})})}};top_chart_internal_fn.updateSizes=function(){var $$=this,config=$$.config;var legendHeight=$$.legend?$$.getLegendHeight():0,legendWidth=$$.legend?$$.getLegendWidth():0,legendHeightForBottom=$$.isLegendRight||config.legend_floating===true?0:legendHeight,hasArc=$$.hasArcType(),xAxisHeight=config.chart_inverted||hasArc?0:$$.getHorizontalAxisHeight("x"),subchartHeight=config.subchart_show&&!hasArc?config.subchart_size_height+xAxisHeight:0;$$.updateSpacing();var titleMargin=$$.titleMargin||0,titleHeight=$$.titleHeight-5||0;$$.titleSpace=titleHeight?titleHeight+21:0;if(config.title_floating){$$.titleSpace=0}var subtitleHeight=$$.subtitleHeight||0;$$.subtitleSpace=subtitleHeight||0;if(config.subtitle_floating){$$.subtitleSpace=0}var horizontalAxisY2=$$.isY2Show?$$.getHorizontalAxisHeight("y2"):0;$$.currentWidth=$$.getCurrentWidth();$$.currentHeight=$$.getCurrentHeight();if(config.slider_enabled)$$.currentHeight=$$.currentHeight-30;$$.margin=config.chart_inverted?{top:horizontalAxisY2+$$.getCurrentPaddingTop()+$$.titleSpace+$$.subtitleSpace,right:hasArc?0:$$.getCurrentPaddingRight(),bottom:$$.hasType("bargauge")?$$.getCurrentPaddingBottom():$$.getHorizontalAxisHeight("y")+$$.getCurrentPaddingBottom(),left:subchartHeight+(hasArc?0:$$.getCurrentPaddingLeft())}:{top:$$.hasArcType()?0:(titleMargin?titleMargin.bottom:0)+$$.getCurrentPaddingTop()+$$.titleSpace+$$.subtitleSpace,right:hasArc?0:$$.getCurrentPaddingRight(),bottom:$$.hasType("columngauge")||$$.hasArcType()?$$.getCurrentPaddingBottom():xAxisHeight+subchartHeight+$$.getCurrentPaddingBottom(),left:hasArc?0:$$.getCurrentPaddingLeft()};if(config.chart_margin[0]){$$.margin.top=config.chart_margin[0]}if(config.chart_margin[1]){$$.margin.right=config.chart_margin[1]}if(config.chart_margin[2]){$$.margin.bottom=config.chart_margin[2]}if(config.chart_margin[3]){$$.margin.left=config.chart_margin[3]}$$.margin2=config.chart_inverted?{top:$$.margin.top,right:NaN,bottom:20+legendHeightForBottom,left:$$.rotated_padding_left}:{top:$$.currentHeight-subchartHeight-legendHeightForBottom,right:NaN,bottom:xAxisHeight+legendHeightForBottom,left:$$.margin.left};$$.margin3={top:$$.margin.top,right:NaN,bottom:0,left:0};if($$.updateSizeForLegend){$$.updateSizeForLegend(legendHeight,legendWidth)}$$.width=$$.currentWidth-$$.margin.left-$$.margin.right;$$.height=$$.currentHeight-$$.margin.top-$$.margin.bottom;if($$.width<0){$$.width=0}if($$.height<0){$$.height=0}$$.width2=config.chart_inverted?$$.margin.left-$$.rotated_padding_left-$$.rotated_padding_right:$$.width;$$.height2=config.chart_inverted?$$.height:$$.currentHeight-$$.margin2.top-$$.margin2.bottom;if($$.width2<0){$$.width2=0}if($$.height2<0){$$.height2=0}if($$.hasType("pie")||$$.hasType("donut")&&!config.donut_semiCircle){$$.arcWidth=$$.currentWidth-10;$$.arcHeight=$$.currentHeight-10-($$.isLegendBottom?legendHeight:0)}else{$$.arcWidth=$$.width-($$.isLegendRight?legendWidth+10:0);$$.arcHeight=$$.height}if($$.hasType("angulargauge")||$$.hasType("donut")&&config.donut_semiCircle){$$.arcHeight+=$$.height-2*$$.getAngularGaugeLabelHeight()}if($$.updateRadius){$$.updateRadius()}if($$.isLegendRight&&hasArc){$$.margin3.left=$$.arcWidth/2+$$.radiusExpanded*1.1+config.legend_x}};top_chart_internal_fn.updateTargets=function(targets){var $$=this;$$.updateTargetsForText(targets);if($$.hasType("bar"))$$.updateTargetsForBar(targets);if($$.hasLineType())$$.updateTargetsForLine(targets);if($$.hasType("equalizer"))$$.updateTargetsForEqualizer(targets);if($$.hasType("scatter"))$$.updateTargetsForScatter(targets);if($$.hasType("bubble"))$$.updateTargetsForBubble(targets);if($$.hasType("boxplot"))$$.updateTargetsForBoxplot(targets);if($$.hasArcType()&&$$.updateTargetsForArc){$$.updateTargetsForArc(targets)}if($$.hasType("columngauge",targets)){$$.updateTargetsForColumnGauge(targets)}if($$.hasType("bargauge",targets)){$$.updateTargetsForBarGauge(targets)}if($$.updateTargetsForSubchart){$$.updateTargetsForSubchart(targets)}$$.showTargets()};top_chart_internal_fn.showTargets=function(){var $$=this;$$.svg.selectAll("."+CLASS.target).filter(function(d){return $$.isTargetToShow(d.id)}).transition().duration($$.config.transition_duration).style("opacity",1)};top_chart_internal_fn.redraw=function(options,transitions){var $$=this,main=$$.main,d3=$$.d3,config=$$.config;var areaIndices=$$.getShapeIndices($$.isAreaType),barIndices=$$.getShapeIndices($$.isBarType),boxplotIndices=$$.getShapeIndices($$.isBoxplotType),lineIndices=$$.getShapeIndices($$.isLineType);var withY,withSubchart,withTransition,withTransitionForExit,withTransitionForAxis,withTransform,withUpdateXDomain,withUpdateOrgXDomain,withTrimXDomain,withLegend,withEventRect,withDimension,withUpdateXAxis;var shouldRedrawLine,shouldRedrawBar,shouldRedrawArea,shouldRedrawCircle,shouldRedrawRegion,shouldRedrawText,shouldRedrawScatter,shouldRedrawGrid,shouldRedrawThreshold,shouldRedrawEqualizer,shouldRedrawBubble,shouldRedrawMarker,shouldRedrawBoxplot;var hideAxis=$$.hasArcType()||$$.hasType("bargauge")||$$.hasType("columngauge");var drawArea,drawBar,drawLine,drawBoxplot,xForText,yForText;var duration,durationForExit,durationForAxis;var waitForDraw,flow;var targetsToShow=$$.filterTargetsToShow($$.data.targets),tickValues,i,intervalForCulling,xDomainForZoom,yAxisTickValues,y2AxisTickValues;var xv=$$.xv.bind($$),cx,cy;options=options||{};withY=getOption(options,"withY",true);withSubchart=getOption(options,"withSubchart",true);withTransition=getOption(options,"withTransition",true);withTransform=getOption(options,"withTransform",false);withUpdateXDomain=getOption(options,"withUpdateXDomain",false);withUpdateOrgXDomain=getOption(options,"withUpdateOrgXDomain",false);withTrimXDomain=getOption(options,"withTrimXDomain",true);withUpdateXAxis=getOption(options,"withUpdateXAxis",withUpdateXDomain);withLegend=getOption(options,"withLegend",false);withEventRect=getOption(options,"withEventRect",true);withDimension=getOption(options,"withDimension",true);withTransitionForExit=getOption(options,"withTransitionForExit",withTransition);withTransitionForAxis=getOption(options,"withTransitionForAxis",withTransition);shouldRedrawLine=shouldRedrawBar=shouldRedrawCircle=shouldRedrawArea=false;shouldRedrawRegion=shouldRedrawScatter=shouldRedrawText=shouldRedrawGrid=false;duration=withTransition?config.transition_duration:0;durationForExit=withTransitionForExit?duration:0;durationForAxis=0;transitions=transitions||$$.axis.generateTransitions(durationForAxis);if(!$$.currentWidth||!$$.currentHeight)return;if($$.hasType("area")||$$.hasType("area-spline")){shouldRedrawArea=true;shouldRedrawLine=true;shouldRedrawCircle=true}else if($$.hasLineType()){shouldRedrawCircle=true;shouldRedrawLine=true}if(typeof config.yAxis_threshold_value==="number"){shouldRedrawThreshold=true}if($$.hasType("bar")){shouldRedrawBar=true}if($$.hasType("boxplot")){shouldRedrawBoxplot=true}if($$.hasType("scatter")){shouldRedrawScatter=true}if($$.hasType("bubble")){shouldRedrawBubble=true}if($$.hasType("equalizer")){shouldRedrawEqualizer=true}if($$.hasDataLabel()){shouldRedrawText=true}if(!isEmpty(config.regions)){shouldRedrawRegion=true}if((config.grid_x_show||config.grid_y_show)&&$$.grid){shouldRedrawGrid=true}if($$.hasMarker()){shouldRedrawMarker=true}if(!$$.hasType("bargauge")&&!$$.hasType("columngauge")&&!$$.hasType("angulargauge")){$$.updateTitle();if(!$$.hasType("circulargauge"))$$.updateSubtitle()}$$.updateSizes();if(withLegend&&config.legend_enabled){if(config.legend_pagination&&$$.currentLegendList)$$.updateLegend($$.currentLegendList,options,transitions);else $$.updateLegend($$.mapToIds($$.data.targets),options,transitions)}else if(withDimension){$$.updateDimension(true)}if($$.isCategorized()&&targetsToShow.length===0){$$.x.domain([0,$$.axes.x.selectAll(".tick").size()])}if(targetsToShow.length){if(!options.flow&&(!config.xAxis_tick_count&&!config.xAxis_type==="datetime")){if(targetsToShow.length){if(!config.slider_enabled||config.slider_enabled&&config.slider_mode==="reset")$$.updateXDomain(targetsToShow,withUpdateXDomain,withUpdateOrgXDomain,withTrimXDomain);if(!config.axis_x_tick_values){tickValues=$$.axis.updateXAxisTickValues(targetsToShow);if(!$$.hasType("bar")&&!$$.hasType("column")&&!$$.hasType("equalizer")&&!$$.isCategorized()&&!options.withForZoom){if(tickValues&&tickValues.length>1){var first=tickValues[0],last=tickValues[tickValues.length-1];$$.x.domain([first,last])}}}}}else{tickValues=$$.axis.updateXAxisTickValues(targetsToShow);$$.updateXDomain(targetsToShow,withUpdateXDomain,withUpdateOrgXDomain,withTrimXDomain)}}else{$$.xAxis.tickValues([])}if(config.zoom_rescale&&!options.flow){xDomainForZoom=$$.x.orgDomain()}$$.y.domain($$.getYDomain(targetsToShow,"y",xDomainForZoom));$$.y2.domain($$.getYDomain(targetsToShow,"y2",xDomainForZoom));if(!config.yAxis_tick_values&&config.yAxis_tick_count){$$.yAxis.ticks(config.yAxis_tick_count)}if(!config.axis_y2_tick_values&&config.axis_y2_tick_count){$$.y2Axis.ticks(config.axis_y2_tick_count)}else if(config.axis_y2_tick_values){$$.y2Axis.tickValues(config.axis_y2_tick_values)}if(config.yAxis_tick_interval&&config.yAxis_min!==undefined&&config.yAxis_max){$$.yAxis.tickValues($$.axis.generateTickValues($$.y.domain(),config.yAxis_tick_count,undefined));yAxisTickValues=$$.yAxis.tickValues()}if(yAxisTickValues){$$.y.domain([Math.min(yAxisTickValues[0],yAxisTickValues[yAxisTickValues.length-1]),Math.max(yAxisTickValues[0],yAxisTickValues[yAxisTickValues.length-1])])}$$.axis.redraw(transitions,hideAxis);$$.axis.updateLabels(withTransition);if((withUpdateXDomain||withUpdateXAxis)&&targetsToShow.length){if(config.axis_x_tick_culling&&tickValues){for(i=1;i<tickValues.length;i++){if(tickValues.length/i<config.axis_x_tick_culling_max){intervalForCulling=i;break}}$$.svg.selectAll("."+CLASS.axisX+" .tick text").each(function(e){var index=tickValues.indexOf(e);if(index>=0){d3.select(this).style("display",index%intervalForCulling||config.xAxis_tick_show===false?"none":"block")}});$$.svg.selectAll("."+CLASS.axisX+" .tick line").style("display",config.xAxis_tick_show===false?"none":"block")}else{$$.svg.selectAll("."+CLASS.axisX+" .tick text").style("display",config.xAxis_tick_show===false?"none":"block");$$.svg.selectAll("."+CLASS.axisX+" .tick line").style("display",config.xAxis_tick_show===false?"none":"block")}}if(config.xAxis_tick_show===false){$$.svg.selectAll("."+CLASS.axisX).style("display","none")}if(config.yAxis_tick_show===false)$$.svg.selectAll("."+CLASS.axisY).style("display","none");if(shouldRedrawArea)drawArea=$$.generateDrawArea?$$.generateDrawArea(areaIndices,false):undefined;if(shouldRedrawBar)drawBar=$$.generateDrawBar?$$.generateDrawBar(barIndices):undefined;if(shouldRedrawLine)drawLine=$$.generateDrawLine?$$.generateDrawLine(lineIndices,false):undefined;if(shouldRedrawText){xForText=$$.generateXYForText(areaIndices,barIndices,lineIndices,true);yForText=$$.generateXYForText(areaIndices,barIndices,lineIndices,false)}$$.updateXgridFocus();main.select("."+CLASS.empty).attr("x",$$.width/2).attr("y",$$.height/2).text(function(d){if($$.data.targets.length<1){return config.noData_text}else{return""}}).style("font-weight",config.noData_style_fontWeight).style("font-size",config.noData_style_fontSize+"px").style("fill",config.noData_style_color).transition().style("opacity",targetsToShow.length?0:1);if(shouldRedrawGrid){$$.updateGrid(duration)}if(shouldRedrawRegion){$$.updateRegion(duration)}if(shouldRedrawBar)$$.updateBar(durationForExit);if(shouldRedrawLine)$$.updateLine(durationForExit);if(shouldRedrawArea)$$.updateArea(durationForExit);if(shouldRedrawCircle)$$.updateCircle(durationForExit);if(shouldRedrawMarker)$$.updateMarker(durationForExit);if(shouldRedrawBubble)$$.updateBubble(durationForExit);if(shouldRedrawBoxplot)$$.updateBoxplot(durationForExit);if(shouldRedrawScatter)$$.updateScatter(durationForExit);if(shouldRedrawEqualizer)$$.updateEqualizer(durationForExit);$$.updatePlotBorder();if(!$$.hasType("bargauge")&&!$$.hasType("columngauge")&&!$$.hasType("angulargauge")&&!$$.hasType("circulargauge")){if(config.credits_enabled)$$.updateCredits()}if(shouldRedrawText){$$.updateText(durationForExit)}if($$.redrawLinearGauge&&($$.hasType("bargauge")||$$.hasType("columngauge"))){$$.redrawLinearGauge(duration,durationForExit,withTransform)}if($$.redrawArc){$$.redrawArc(duration,durationForExit,withTransform)}if(!isEmpty(config.labels)){$$.updateLabels()}if(shouldRedrawThreshold){$$.updateThreshold()}main.selectAll("."+CLASS.selectedCircles).filter($$.isBarType.bind($$)).selectAll("circle").remove();if(config.interaction_enabled&&!options.flow&&withEventRect){$$.redrawEventRect();if($$.updateZoom){$$.updateZoom()}}$$.updateCircleY();cx=($$.config.chart_inverted?$$.circleY:$$.circleX).bind($$);cy=($$.config.chart_inverted?$$.circleX:$$.circleY).bind($$);$$.unexpandCircles();if(options.flow){flow=$$.generateFlow({targets:targetsToShow,flow:options.flow,duration:options.flow.duration,drawBar:drawBar,drawLine:drawLine,drawArea:drawArea,cx:cx,cy:cy,xv:xv,xForText:xForText,yForText:yForText})}if(shouldRedrawMarker){$$.redrawMarker(cx,cy)}if(shouldRedrawCircle)$$.redrawCircle(cx,cy);if(duration||flow){d3.transition().duration(duration).each(function(){var transitionsToWait=[];var redrawList=[];if(shouldRedrawBar){redrawList[redrawList.length]=$$.redrawBar(drawBar,true)}if(shouldRedrawBoxplot){redrawList[redrawList.length]=$$.redrawBoxplot(true)}if(shouldRedrawLine){redrawList[redrawList.length]=$$.redrawLine(drawLine,true)}if(shouldRedrawArea){redrawList[redrawList.length]=$$.redrawArea(drawArea,true)}if(shouldRedrawBubble){redrawList[redrawList.length]=$$.redrawBubble(cx,cy,true)}if(shouldRedrawEqualizer){redrawList[redrawList.length]=$$.redrawEqualizer(true)}if(shouldRedrawScatter&&!flow){redrawList[redrawList.length]=$$.redrawScatter(cx,cy,true)}else if(shouldRedrawScatter&&flow){$$.redrawScatter(cx,cy,false)}if(shouldRedrawText){redrawList[redrawList.length]=$$.redrawText(xForText,yForText,options.flow,true)}if(shouldRedrawRegion){redrawList[redrawList.length]=$$.redrawRegion(true)}if(shouldRedrawGrid){}redrawList.forEach(function(transitions){
transitions.forEach(function(transition){transitionsToWait.push(transition)})});waitForDraw=$$.generateWait();transitionsToWait.forEach(function(t){waitForDraw.add(t)})}).call(waitForDraw,function(){if(flow){flow()}if(config.onrendered){config.onrendered.call($$)}});if(!config.xAxis_tick_reset&&flow)$$.afterFlowTickValues=$$.tickValues}else{if(shouldRedrawBar)$$.redrawBar(drawBar);if(shouldRedrawLine)$$.redrawLine(drawLine);if(shouldRedrawArea)$$.redrawArea(drawArea);if(shouldRedrawEqualizer)$$.redrawEqualizer(true);if(shouldRedrawCircle)$$.redrawCircle(cx,cy);if(shouldRedrawBubble)$$.redrawBubble(cx,cy);if(shouldRedrawBoxplot)$$.redrawBoxplot();if(shouldRedrawScatter)$$.redrawScatter(cx,cy,false);if(shouldRedrawText)$$.redrawText(xForText,yForText,options.flow);if(shouldRedrawRegion)$$.redrawRegion();if(config.onrendered){config.onrendered.call($$)}}$$.mapToIds($$.data.targets).forEach(function(id){$$.withoutFadeIn[id]=true})};top_chart_internal_fn.updateChartElement=function(chartType){var $$=this,config=$$.config,classNames,className;if(config.chart_type==="bar"){config.chart_inverted=true}else if(config.chart_type==="column"){config.chart_type="bar";config.chart_inverted=false}else if(config.chart_type==="bargauge"){config.chart_inverted=true}else config.chart_inverted=false;$$.xOrient=config.chart_inverted?"left":"bottom";$$.yOrient=config.chart_inverted?config.axis_y_inner?"top":"bottom":config.axis_y_inner?"right":"left";$$.y2Orient=config.chart_inverted?config.axis_y2_inner?"bottom":"top":config.axis_y2_inner?"left":"right";$$.rotated_padding_right=config.chart_inverted&&!config.xAxis_show?0:30;$$.setSeriesTypes(config.series);$$.updateTargets($$.data.targets);if(chartType==="area"||chartType==="line"){classNames="TOP-chart-lines";className="TOP-chart-line"}else if(chartType==="pie"||chartType==="donut"||chartType==="angulargauge"||chartType==="circulargauge"){classNames="TOP-chart-arcs";className="TOP-chart-arc";$$.main.selectAll("."+classNames).selectAll("."+classNames+"-background").attr("d",null)}else if(chartType==="bar"||chartType==="column"){classNames="TOP-chart-bars";className="TOP-chart-bar"}else{classNames="TOP-chart-"+chartType+"s";className="TOP-chart-"+chartType}var removeChartElement=$$.main.selectAll("."+classNames).selectAll("."+className).selectAll(".TOP-shapes").selectAll(".TOP-shape").remove()};top_chart_internal_fn.updateAndRedraw=function(options){var $$=this,config=$$.config,transitions;options=options||{};options.withTransition=getOption(options,"withTransition",true);options.withTransform=getOption(options,"withTransform",false);options.withLegend=getOption(options,"withLegend",false);options.withUpdateXDomain=true;options.withUpdateOrgXDomain=true;options.withTransitionForExit=false;options.withTransitionForTransform=getOption(options,"withTransitionForTransform",options.withTransition);$$.updateSizes();if(!(options.withLegend&&config.legend_enabled)){transitions=$$.axis.generateTransitions(options.withTransitionForAxis?config.transition_duration:0);$$.updateScales();$$.updateSvgSize();$$.transformAll(options.withTransitionForTransform,transitions)}if(!$$.currentWidth||!$$.currentHeight)return;if(config.chart_reflow){$$.redraw(options,transitions)}};top_chart_internal_fn.redrawWithoutRescale=function(){this.redraw({withY:false,withSubchart:false,withEventRect:false,withTransitionForAxis:false})};top_chart_internal_fn.isTimeSeries=function(){return this.config.xAxis_type==="datetime"};top_chart_internal_fn.isCategorized=function(){return this.config.xAxis_categories.length>0};top_chart_internal_fn.isCustomX=function(id){var $$=this,config=$$.config;return!$$.isTimeSeries()&&(config.data_x||notEmpty(config.data_xs))};top_chart_internal_fn.isTimeSeriesY=function(){return this.config.yAxis_type==="datetime"};top_chart_internal_fn.isLogY=function(){return this.config.yAxis_type==="logarithmic"};top_chart_internal_fn.getTranslate=function(target){var $$=this,config=$$.config,x,y;if(target==="main"){x=asHalfPixel($$.margin.left);y=asHalfPixel($$.margin.top)}else if(target==="context"){x=asHalfPixel($$.margin2.left);y=asHalfPixel($$.margin2.top)}else if(target==="legend"){x=$$.margin3.left;y=$$.margin3&&$$.margin3.top?$$.margin3.top:0}else if(target==="x"){x=0;y=config.chart_inverted?0:$$.height}else if(target==="y"){x=0;y=config.chart_inverted?$$.height:0}else if(target==="y2"){x=config.chart_inverted?0:$$.width;y=config.chart_inverted?1:0}else if(target==="arc"){if(typeof config.chart_spacing.left==="number")x=config.chart_spacing.left+$$.radius;else x=$$.arcWidth/2;if(typeof config.chart_spacing.top==="number")y=config.chart_spacing.top+$$.radius;else y=$$.arcHeight/2}else if(target==="title"){x=$$.titleHorizontalPosition;y=$$.titleVerticalPosition}else if(target==="subtitle"){x=$$.subtitleHorizontalPosition;y=$$.subtitleVerticalPosition}else if(target==="credits"){x=$$.creditsHorizontalPosition;y=$$.creditsVerticalPosition}return"translate("+x+","+y+")"};top_chart_internal_fn.initialOpacity=function(d){return d.value!==null&&this.withoutFadeIn[d.id]?1:0};top_chart_internal_fn.initialOpacityForCircle=function(d){return d.value!==null&&this.withoutFadeIn[d.id]?this.opacityForCircle(d):1};top_chart_internal_fn.opacityForCircle=function(d){var opacity=this.config.point_show?1:0;return isValue(d.value)?this.isScatterType(d)?.6:opacity:0};top_chart_internal_fn.opacityForText=function(d){if(this.mainText.length)return 1;else return 0};top_chart_internal_fn.xx=function(d){return d?this.x(d.x):null};top_chart_internal_fn.xv=function(d){var $$=this,value=d.value;if($$.isTimeSeries()){value=$$.parseDate(d.value)}else if($$.isCategorized()&&typeof d.value==="string"){value=$$.config.xAxis_categories.indexOf(d.value)}return Math.ceil($$.x(value))};top_chart_internal_fn.yv=function(d){var $$=this,yScale=d.axis&&d.axis==="y2"?$$.y2:$$.y;return Math.ceil(yScale(d.value))};top_chart_internal_fn.transformMain=function(withTransition,transitions){var $$=this,xAxis,yAxis,y2Axis;if(transitions&&transitions.axisX){xAxis=transitions.axisX}else{xAxis=$$.main.select("."+CLASS.axisX);if(withTransition){xAxis=xAxis.transition()}}if(transitions&&transitions.axisY){yAxis=transitions.axisY}else{yAxis=$$.main.select("."+CLASS.axisY);if(withTransition){yAxis=yAxis.transition()}}if(transitions&&transitions.axisY2){y2Axis=transitions.axisY2}else{y2Axis=$$.main.select("."+CLASS.axisY2);if(withTransition){y2Axis=y2Axis.transition()}}(withTransition?$$.main.transition():$$.main).attr("transform",$$.getTranslate("main"));xAxis.attr("transform",$$.getTranslate("x"));yAxis.attr("transform",$$.getTranslate("y"));y2Axis.attr("transform",$$.getTranslate("y2"));$$.main.select("."+CLASS.chartArcs).attr("transform",$$.getTranslate("arc"))};top_chart_internal_fn.transformAll=function(withTransition,transitions){var $$=this;$$.transformMain(withTransition,transitions);if($$.config.subchart_show){$$.transformContext(withTransition,transitions)}if($$.legend){$$.transformLegend(withTransition)}};top_chart_internal_fn.updateSvgSize=function(){var $$=this,brush=$$.svg.select(".TOP-brush .background");if($$.currentHeight<0)return;$$.svg.attr("width",$$.currentWidth).attr("height",$$.currentHeight);$$.svg.selectAll(["#"+$$.clipId,"#"+$$.clipIdForGrid]).select("rect").attr("width",$$.width).attr("height",$$.height);$$.svg.select("#"+$$.clipIdForXAxis).select("rect").attr("x",$$.getXAxisClipX.bind($$)).attr("y",$$.getXAxisClipY.bind($$)).attr("width",$$.getXAxisClipWidth.bind($$)).attr("height",$$.getXAxisClipHeight.bind($$));$$.svg.select("#"+$$.clipIdForYAxis).select("rect").attr("x",$$.getYAxisClipX.bind($$)).attr("y",$$.getYAxisClipY.bind($$)).attr("width",$$.getYAxisClipWidth.bind($$)).attr("height",$$.getYAxisClipHeight.bind($$));$$.svg.select("."+CLASS.zoomRect).attr("width",$$.width).attr("height",$$.height)};top_chart_internal_fn.updateDimension=function(withoutAxis){var $$=this;if(!withoutAxis){if($$.config.chart_inverted){$$.axes.x.call($$.xAxis)}else{$$.axes.y.call($$.yAxis);$$.axes.y2.call($$.y2Axis)}}$$.updateSizes();$$.updateScales();$$.updateSvgSize();$$.transformAll(false)};top_chart_internal_fn.observeInserted=function(selection){var $$=this,observer;if(typeof MutationObserver==="undefined"){window.console.error("MutationObserver not defined.");return}observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(mutation.type==="childList"&&mutation.previousSibling){observer.disconnect();$$.intervalForObserveInserted=window.setInterval(function(){if(selection.node().parentNode){window.clearInterval($$.intervalForObserveInserted);$$.updateDimension();$$.redraw({withTransform:true,withUpdateXDomain:true,withUpdateOrgXDomain:true,withTransition:false,withTransitionForTransform:false,withLegend:true});selection.transition().style("opacity",1)}},10)}})});boserver.observe(selection.node(),{attributes:true,childList:true,characterData:true})};top_chart_internal_fn.generateResize=function(){var resizeFunctions=[];function callResizeFunctions(){resizeFunctions.forEach(function(f){f()})}callResizeFunctions.add=function(f){resizeFunctions.push(f)};return callResizeFunctions};top_chart_internal_fn.endall=function(transition,callback){var n=0;transition.each(function(){++n}).each("end",function(){if(!--n){callback.apply(this,arguments)}})};top_chart_internal_fn.generateWait=function(){var transitionsToWait=[],f=function(transition,callback){function toDo(){var timer=window.requestAnimationFrame(toDo);var done=0;transitionsToWait.forEach(function(t){if(t.empty()){done+=1;return}try{t.transition()}catch(e){done+=1}});if(done===transitionsToWait.length){window.cancelAnimationFrame(timer);if(callback){callback()}}}toDo()};f.add=function(transition){transitionsToWait.push(transition)};return f};top_chart_internal_fn.pushFuncToQueue=function(frameQueue,funcName,parameters){var $$=this,config=$$.config;var funcJson={};funcJson.toDo=funcName;funcJson.params=parameters;frameQueue.push(funcJson)};top_chart_internal_fn.executeFrameQueue=function(){var $$=this,config=$$.config;if($$.frameQueue.length===0)return;if(!$$.animationRaf){$$.beginAnimationLoop()}};top_chart_internal_fn.stopAnimationLoop=function(){var $$=this;window.cancelAnimationFrame($$.animationRaf);$$.animationRaf=null};top_chart_internal_fn.beginAnimationLoop=function(){var $$=this,config=$$.config;$$.lastFrameAt=-Infinity;$$.timeToNext=0;$$.runningTransitions=0;$$.currentFrame=null;var doFrame=function(){$$.animationRaf=window.requestAnimationFrame(doFrame);if(Date.now()-$$.lastFrameAt>$$.timeToNext){$$.nextFrame()}};doFrame()};top_chart_internal_fn.convertJsonToFunction=function(json){var $$=this,config=$$.config;var funcName=json.toDo,parameters=json.params,returnData=[],fn;if(top_chart_internal_fn[funcName])fn=top_chart_internal_fn[funcName];else if(Series.prototype[funcName])fn=Series.prototype[funcName];returnData.push(fn);returnData.push(parameters);return returnData};top_chart_internal_fn.nextFrame=function(){var $$=this,config=$$.config;var newFrame=$$.currentFrame=$$.frameQueue.shift();if(newFrame){var functionAndParams,fn,params;var funcName=newFrame.toDo;var correctionValue=100;var transitionDuration=config.transition_duration;var shift,redraw;$$.lastFrameAt=Date.now();switch(funcName){case"executeFrameList":{if(transitionDuration<50)transitionDuration=50;var isRedraw=newFrame.params[2];$$.timeToNext=transitionDuration+correctionValue;break}case"setSeriesData":{var isRedraw=newFrame.params[2];if(isRedraw)$$.timeToNext=transitionDuration;else $$.timeToNext=10;break}case"addSeries":{if(transitionDuration<50)transitionDuration=50;$$.timeToNext=transitionDuration+correctionValue;break}case"removeSeries":{$$.timeToNext=transitionDuration+correctionValue;break}case"updateSeries":{var isRedraw=newFrame.params[2];if(isRedraw)$$.timeToNext=transitionDuration+correctionValue;else $$.timeToNext=10;break}case"getSeries":{$$.timeToNext=10;break}case"setOption":{$$.timeToNext=transitionDuration;break}case"addPoint":{var shift=newFrame.params[2];var redraw=newFrame.params[4];if(!redraw||!shift)$$.timeToNext=30;else if(shift.duration)$$.timeToNext=shift.duration+transitionDuration+correctionValue;else if(shift)$$.timeToNext=config.shift_duration+transitionDuration+correctionValue;break}}functionAndParams=$$.convertJsonToFunction(newFrame);fn=functionAndParams[0];params=functionAndParams[1];fn.apply($$,params)}else{$$.stopAnimationLoop()}};top_chart_internal_fn.parseDate=function(date){var $$=this,parsedDate;if(date instanceof Date){parsedDate=date}else if(typeof date==="string"){parsedDate=$$.dataTimeFormat($$.config.xAxis_timeFormat).parse(date)}else if(typeof date==="number"||!isNaN(date)){parsedDate=new Date(+date)}if(!parsedDate||isNaN(+parsedDate)){window.console.error("Failed to parse x '"+date+"' to Date object")}return parsedDate};top_chart_internal_fn.isTabVisible=function(){var hidden;if(typeof document.hidden!=="undefined"){hidden="hidden"}else if(typeof document.mozHidden!=="undefined"){hidden="mozHidden"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden"}return document[hidden]?false:true};top_chart_internal_fn.getDefaultConfig=function(){var config={chart_renderTo:"#chart",chart_width:undefined,chart_height:undefined,chart_bar_width:undefined,zoom_enabled:false,zoom_extent:undefined,zoom_privileged:false,zoom_rescale:false,zoom_onzoom:function(){},zoom_onzoomstart:function(){},zoom_onzoomend:function(){},interaction_enabled:true,onmouseover:function(){},onmouseout:function(){},oninit:function(){},onrendered:function(){},transition_duration:350,chart_backgroundColor:"#FFFFFF",chart_borderColor:"#4572A7",chart_borderRadius:0,chart_borderWidth:0,chart_plotBackgroundColor:"#FFFFFF",chart_plotBackgroundImage:undefined,chart_plotBorderColor:"#C0C0C0",chart_plotBorderWidth:0,chart_plotShadow:false,chart_reflow:true,chart_ignoreHiddenSeries:true,chart_inverted:false,chart_shape_width:undefined,chart_spacing:{top:undefined,right:undefined,bottom:undefined,left:undefined},chart_margin:[],chart_marginTop:undefined,chart_marginRight:undefined,chart_marginBottom:undefined,chart_marginLeft:undefined,chart_type:"line",chart_unit:"",chart_focusable:true,chart_selectable:true,data_x:undefined,data_xs:{},data_xFormat:"%Y-%m-%d",data_xLocaltime:true,data_xSort:true,data_idConverter:function(id){return id},data_names:{},data_classes:{},data_groups:{},data_axes:{},data_type:undefined,data_types:{},data_labels:{},data_order:"desc",data_regions:{},data_color:undefined,data_colors:{},data_hide:false,data_filter:undefined,data_selection_enabled:true,data_selection_grouped:true,data_selection_isselectable:function(){return true},data_selection_multiple:true,data_selection_draggable:true,data_onclick:function(){},data_onmouseover:function(){},data_onmouseout:function(){},data_onselected:function(){},data_onunselected:function(){},data_url:undefined,data_json:undefined,data_rows:undefined,data_columns:undefined,data_mimeType:undefined,data_keys:undefined,dataLabels_enabled:false,dataLabels_floatPoint:true,dataLabels_fontSize:undefined,dataLabels_x:0,dataLabels_y:0,dataLabels_format:undefined,dataLabels_horizontalAlignment:"center",dataLabels_verticalAlignment:"center",color_threshold:{},legend_enabled:true,legend_hide:false,legend_inset_anchor:"top-left",legend_x:0,legend_y:0,legend_inset_step:undefined,legend_onclick:undefined,legend_item_onmouseover:undefined,legend_item_onmouseout:undefined,legend_equally:false,legend_borderColor:"#909090",legend_borderRadius:0,legend_borderWidth:0,legend_backgroundColor:undefined,legend_align:undefined,legend_verticalAlign:undefined,legend_itemWidth:undefined,legend_layout:undefined,legend_itemDistance:30,legend_symbolWidth:20,legend_symbolHeight:5,legend_itemMarginTop:0,legend_itemMarginBottom:0,legend_padding:0,legend_rtl:false,legend_itemStyle_color:"#333333",legend_itemStyle_cursor:"pointer",legend_itemStyle_fontSize:"12",legend_itemStyle_fontWeight:"bold",legend_itemStyle_x:5,legend_itemStyle_y:-4,legend_width:undefined,legend_margin:12,legend_floating:false,legend_itemHiddenStyle:{color:"#CCC"},legend_itemHoverStyle:{color:"#F00"},legend_reversed:false,legend_pagination:false,legend_buttonWidth:5,legend_buttonHeight:15,xAxis_show:true,xAxis_type:"indexed",axis_x_localtime:true,xAxis_categories:[],axis_x_tick_centered:false,axis_x_tick_format:undefined,axis_x_tick_culling:{},axis_x_tick_culling_max:100,xAxis_tick_rotate:undefined,xAxis_tick_count:undefined,xAxis_tick_fit:true,xAxis_tick_format:undefined,xAxis_tick_show:true,xAxis_tick_width:undefined,xAxis_tick_from:"start",xAxis_tick_reset:false,xAxis_tick_multiline:true,xAxis_tick_limit_type:"collapse",xAxis_tick_limit_enabled:false,xAxis_tick_limit_count:4,xAxis_tick_floor:true,xAxis_min:undefined,xAxis_max:undefined,axis_x_tick_values:null,axis_x_tick_rotate:0,axis_x_tick_outer:false,axis_x_tick_multiline:true,axis_x_tick_width:null,axis_x_max:undefined,axis_x_min:undefined,xAxis_padding:{},axis_x_height:undefined,axis_x_extent:undefined,axis_x_label:{},yAxis_show:true,yAxis_type:undefined,yAxis_max:undefined,yAxis_min:undefined,axis_y_inverted:false,axis_y_center:undefined,axis_y_inner:undefined,axis_y_label:{},yAxis_tick_format:undefined,axis_y_tick_outer:false,yAxis_tick_values:null,yAxis_tick_count:undefined,yAxis_tick_integer:true,yAxis_tick_interval:undefined,yAxis_tick_base:10,yAxis_tick_division:undefined,yAxis_threshold_value:undefined,yAxis_threshold_color:"#ff3355",axis_y_tick_time_value:undefined,axis_y_tick_time_interval:undefined,yAxis_padding:{},axis_y_default:undefined,axis_y2_show:false,axis_y2_max:undefined,axis_y2_min:undefined,axis_y2_inverted:false,axis_y2_center:undefined,axis_y2_inner:undefined,axis_y2_label:{},axis_y2_tick_format:undefined,axis_y2_tick_outer:true,axis_y2_tick_values:null,axis_y2_tick_count:undefined,axis_y2_padding:{},axis_y2_default:undefined,xAxis_tickPixelInterval:undefined,xAxis_tickTimeInterval:undefined,xAxis_tickAmount:undefined,xAxis_timeFormat:undefined,grid_x_show:true,grid_x_type:"tick",grid_x_lines:[],grid_y_show:true,grid_y_lines:[],grid_y_ticks:10,grid_focus_show:true,point_show:true,point_r:1,point_focus_expand_enabled:true,point_focus_expand_r:4.5,point_select_r:undefined,line_connectNull:false,line_step_type:"step",bar_width_ratio:.7,bar_width_max:undefined,bar_zerobased:true,bar_showZero:true,bar_zeroInterval:false,area_zerobased:true,pie_label_show:true,pie_label_format:undefined,pie_label_threshold:0,pie_expand:true,angular_gauge_label_show:true,angular_gauge_label_format:undefined,angular_gauge_expand:true,angular_gauge_min:0,angular_gauge_max:100,angular_gauge_units:undefined,angular_gauge_width:undefined,gauge_min:0,gauge_max:100,gauge_breaks:undefined,gauge_format_total:undefined,gauge_format_value:undefined,gauge_text:undefined,gauge_fontSize:undefined,donut_label_show:true,donut_label_format:undefined,donut_label_threshold:0,donut_width:undefined,donut_expand:true,donut_title:"",donut_semiCircle:false,regions:[],tooltip_distance:100,tooltip_show:true,tooltip_grouped:false,tooltip_onmouse_enabled:false,tooltip_onmouse_onclick:false,tooltip_format_title:undefined,tooltip_format_name:undefined,tooltip_format_value:undefined,tooltip_format_xValue:undefined,tooltip_format_yValue:undefined,tooltip_format_zValue:undefined,tooltip_format_xText:undefined,tooltip_format_yText:undefined,tooltip_format_zText:undefined,tooltip_format_single:"x",tooltip_position:undefined,tooltip_contents:function(d,defaultTitleFormat,defaultValueFormat,color){return this.getTooltipContent?this.getTooltipContent(d,defaultTitleFormat,defaultValueFormat,color):""},tooltip_init_show:false,tooltip_init_x:0,tooltip_init_position:{top:"0px",left:"0px"},tooltip_reversed:false,tooltip_inside:false,tooltip_positioningType:"default",tooltip_limit:{},title:true,title_text:"Chart title",title_align:"left",title_show:true,title_margin:{top:0,right:15,bottom:0,left:25},title_floating:false,title_x:0,title_y:5,title_verticalAlign:undefined,subtitle_text:undefined,subtitle_align:"center",subtitle_show:false,subtitle_floating:false,subtitle_x:0,subtitle_y:0,subtitle_verticalAlign:undefined,shift_duration:500,credits_enabled:false,credits_href:"http://kr.tmaxsoft.com/main.do",credits_position:undefined,credits_style:undefined,credits_text:" Topcharts",colors:[],theme:"colorSet1",series:[],plotOptions:{},labels:[],noData_text:"",noData_position_x:0,noData_position_y:0,noData_position_align:"center",noData_position_verticalAlign:"middle",noData_style_fontWeight:"bold",noData_style_fontSize:"12",noData_style_color:"#606060",selection_draggable:true,slider_enabled:false,slider_position:"bottom",slider_start:[0,100],slider_mode:"flow",slider_step:undefined,slider_connect:true,slider_direction:undefined,slider_snap:undefined,slider_animate:undefined,slider_animationDuration:undefined,slider_range_min:0,slider_range_max:100,slider_orientation:undefined,slider_margin:undefined,slider_limit:undefined,slider_padding:undefined,slider_behaviour:"drag",slider_format:undefined,slider_tooltips:undefined,slider_cssPrefix:undefined,slider_cssClasses:undefined,slider_useRequestAnimationFrame:undefined,slider_onupdate:function(){}};Object.keys(this.additionalConfig).forEach(function(key){config[key]=this.additionalConfig[key]},this);return config};top_chart_internal_fn.additionalConfig={};top_chart_internal_fn.loadConfig=function(config){var this_config=this.config,target,keys,read;function find(){var key=keys.shift();if(key&&target&&typeof target==="object"&&key in target){target=target[key];return find()}else if(!key){return target}else{return undefined}}Object.keys(this_config).forEach(function(key){target=config;keys=key.split("_");read=find();if(isDefined(read)){this_config[key]=read}})};top_chart_internal_fn.getScale=function(min,max,forTimeseries,forLog){return(forTimeseries?this.d3.time.scale():forLog?this.d3.scale.log():this.d3.scale.linear()).range([min,max])};top_chart_internal_fn.getX=function(min,max,domain,offset){var $$=this,scale=$$.getScale(min,max,$$.isTimeSeries()),_scale=domain?scale.domain(domain):scale,key;if($$.isCategorized()){offset=offset||function(){return 0};scale=function(d,raw){var v=_scale(d)+offset(d);return raw?v:Math.ceil(v)}}else{scale=function(d,raw){var v=_scale(d);return raw?v:Math.ceil(v)}}for(key in _scale){scale[key]=_scale[key]}scale.orgDomain=function(){return _scale.domain()};if($$.isCategorized()){scale.domain=function(domain){if(!arguments.length){domain=this.orgDomain();return[domain[0],domain[1]+1]}_scale.domain(domain);return scale}}return scale};top_chart_internal_fn.getY=function(min,max,domain){var scale=this.getScale(min,max,this.isTimeSeriesY(),this.isLogY());if(domain){scale.domain(domain)}return scale};top_chart_internal_fn.getYScale=function(id){return this.axis.getId(id)==="y2"?this.y2:this.y};top_chart_internal_fn.updateScales=function(){var $$=this,config=$$.config,forInit=!$$.x;$$.xMin=config.chart_inverted?1:0;$$.xMax=config.chart_inverted?$$.height:$$.width;$$.yMin=config.chart_inverted?0:$$.height;$$.yMax=config.chart_inverted?$$.width:1;$$.x=$$.getX($$.xMin,$$.xMax,forInit?undefined:$$.x.orgDomain(),function(){return $$.xAxis.tickOffset()});$$.y=$$.getY($$.yMin,$$.yMax,forInit?config.axis_y_default:$$.y.domain());$$.y2=$$.getY($$.yMin,$$.yMax,forInit?config.axis_y2_default:$$.y2.domain());$$.xAxisTickFormat=$$.axis.getXAxisTickFormat();$$.xAxisTickValues=$$.axis.getXAxisTickValues();$$.yAxisTickValues=$$.axis.getYAxisTickValues();$$.y2AxisTickValues=$$.axis.getY2AxisTickValues();$$.xAxis=$$.axis.getXAxis($$.x,$$.xOrient,$$.xAxisTickFormat,$$.xAxisTickValues,config.axis_x_tick_outer,false,false,config.xAxis_show);$$.yAxis=$$.axis.getYAxis($$.y,$$.yOrient,config.yAxis_tick_format,$$.yAxisTickValues,config.axis_y_tick_outer,false,config.yAxis_show);$$.y2Axis=$$.axis.getYAxis($$.y2,$$.y2Orient,config.axis_y2_tick_format,$$.y2AxisTickValues,config.axis_y2_tick_outer);if(!forInit){if($$.brush){$$.brush.scale($$.subX)}if(config.zoom_enabled){$$.zoom.scale($$.x)}}if($$.updateArc){$$.updateArc()}};top_chart_internal_fn.getYDomainMin=function(targets){var $$=this,config=$$.config,ids=$$.mapToIds(targets),ys=$$.getValuesAsIdKeyed(targets),j,k,baseId,idsInGroup,id,hasNegativeValue;if($$.stacking==="percent")return 0;if(Object.keys(config.data_groups).length>0){hasNegativeValue=$$.hasNegativeValueInTargets(targets);for(j in config.data_groups){idsInGroup=config.data_groups[j].filter(function(id){return ids.indexOf(id)>=0});if(idsInGroup.length===0){continue}baseId=idsInGroup[0];if(hasNegativeValue&&ys[baseId]){ys[baseId].forEach(function(v,i){ys[baseId][i]=v<0?v:0})}for(k=1;k<idsInGroup.length;k++){id=idsInGroup[k];if(!ys[id]){continue}ys[id].forEach(function(v,i){if($$.axis.getId(id)===$$.axis.getId(baseId)&&ys[baseId]&&!(hasNegativeValue&&+v>0)){ys[baseId][i]+=+v}})}}}return $$.d3.min(Object.keys(ys).map(function(key){return $$.d3.min(ys[key])}))};top_chart_internal_fn.getYDomainMax=function(targets){var $$=this,config=$$.config,ids=$$.mapToIds(targets),ys=$$.getValuesAsIdKeyed(targets),j,k,baseId,idsInGroup,id,hasPositiveValue;if($$.stacking==="percent")return 100;if(Object.keys(config.data_groups).length>0){hasPositiveValue=$$.hasPositiveValueInTargets(targets);for(j in config.data_groups){idsInGroup=config.data_groups[j].filter(function(id){return ids.indexOf(id)>=0});if(idsInGroup.length===0){continue}baseId=idsInGroup[0];if(hasPositiveValue&&ys[baseId]){ys[baseId].forEach(function(v,i){ys[baseId][i]=v>0?v:0})}for(k=1;k<idsInGroup.length;k++){id=idsInGroup[k];if(!ys[id]){continue}ys[id].forEach(function(v,i){if($$.axis.getId(id)===$$.axis.getId(baseId)&&ys[baseId]&&!(hasPositiveValue&&+v<0)){ys[baseId][i]+=+v}})}}}return $$.d3.max(Object.keys(ys).map(function(key){return $$.d3.max(ys[key])}))};top_chart_internal_fn.getYDomain=function(targets,axisId,xDomain){var $$=this,config=$$.config,targetsByAxisId=targets.filter(function(t){return $$.axis.getId(t.id)===axisId}),yTargets=xDomain?$$.filterByXDomain(targetsByAxisId,xDomain):targetsByAxisId,yMin=axisId==="y2"?config.axis_y2_min:config.yAxis_min,yMax=axisId==="y2"?config.axis_y2_max:config.yAxis_max,yDomainMin=$$.getYDomainMin(yTargets),yDomainMax=$$.getYDomainMax(yTargets),domain,domainLength,padding,padding_top,padding_bottom,center=axisId==="y2"?config.axis_y2_center:config.axis_y_center,yDomainAbs,lengths,diff,ratio,isAllPositive,isAllNegative,isZeroBased=$$.hasType("boxplot",yTargets)||$$.hasType("bar",yTargets)&&config.bar_zerobased||$$.hasType("area",yTargets)&&config.area_zerobased,isInverted=axisId==="y2"?config.axis_y2_inverted:config.axis_y_inverted,showHorizontalDataLabel=$$.hasDataLabel()&&config.chart_inverted,showVerticalDataLabel=$$.hasDataLabel()&&!config.chart_inverted;yDomainMin=isValue(yMin)?yMin:isValue(yMax)?yDomainMin<yMax?yDomainMin:yMax-10:yDomainMin;yDomainMax=isValue(yMax)?yMax:isValue(yMin)?yMin<yDomainMax?yDomainMax:yMin+10:yDomainMax;if(yTargets.length===0){return axisId==="y2"?$$.y2.domain():$$.y.domain()}if(isNaN(yDomainMin)){yDomainMin=0}if(isNaN(yDomainMax)){yDomainMax=yDomainMin}if(yDomainMin===yDomainMax){yDomainMin<0?yDomainMax=0:yDomainMin=0}isAllPositive=yDomainMin>=0&&yDomainMax>=0;isAllNegative=yDomainMin<=0&&yDomainMax<=0;if(isValue(yMin)&&isAllPositive||isValue(yMax)&&isAllNegative){isZeroBased=false}if(isZeroBased){if(isAllPositive&&!$$.isLogY()){yDomainMin=0}if(isAllNegative){yDomainMax=0}}domainLength=Math.abs(yDomainMax-yDomainMin);padding=padding_top=padding_bottom=domainLength/10;if(typeof center!=="undefined"){yDomainAbs=Math.max(Math.abs(yDomainMin),Math.abs(yDomainMax));yDomainMax=center+yDomainAbs;yDomainMin=center-yDomainAbs}if(showHorizontalDataLabel){lengths=$$.getDataLabelLength(yDomainMin,yDomainMax,"width");diff=diffDomain($$.y.range());ratio=[lengths[0]/diff,lengths[1]/diff];padding_top+=domainLength*(ratio[1]/(1-ratio[0]-ratio[1]));padding_bottom+=domainLength*(ratio[0]/(1-ratio[0]-ratio[1]))}else if(showVerticalDataLabel){lengths=$$.getDataLabelLength(yDomainMin,yDomainMax,"height");padding_top+=$$.axis.convertPixelsToAxisPadding(lengths[1],domainLength);padding_bottom+=$$.axis.convertPixelsToAxisPadding(lengths[0],domainLength)}if(axisId==="y"&&notEmpty(config.yAxis_padding)){padding_top=$$.axis.getPadding(config.yAxis_padding,"top",padding_top,domainLength);padding_bottom=$$.axis.getPadding(config.yAxis_padding,"bottom",padding_bottom,domainLength)}if(axisId==="y2"&&notEmpty(config.axis_y2_padding)){padding_top=$$.axis.getPadding(config.axis_y2_padding,"top",padding_top,domainLength);padding_bottom=$$.axis.getPadding(config.axis_y2_padding,"bottom",padding_bottom,domainLength)}if(isZeroBased){if(isAllPositive){padding_bottom=yDomainMin}if(isAllNegative){padding_top=-yDomainMax}}if($$.stacking==="percent")padding_bottom=padding_top=0;domain=[yDomainMin,yDomainMax];if(!$$.isLogY()){if(isValue(yMin))padding_bottom=0;if(isValue(yMax))padding_top=0;domain=[yDomainMin-padding_bottom,yDomainMax+padding_top]}return isInverted?domain.reverse():domain};top_chart_internal_fn.getXDomainMin=function(targets){var $$=this,config=$$.config;return isDefined(config.xAxis_min)?$$.isTimeSeries()?this.parseDate(config.axis_x_min):config.xAxis_min:$$.d3.min(targets,function(t){return $$.d3.min(t.values,function(v){return v.x})})};top_chart_internal_fn.getXDomainMax=function(targets){var $$=this,config=$$.config;return isDefined(config.xAxis_max)?$$.isTimeSeries()?this.parseDate(config.axis_x_max):config.xAxis_max:$$.d3.max(targets,function(t){return $$.d3.max(t.values,function(v){return v.x})})};top_chart_internal_fn.getXDomainPadding=function(domain){var $$=this,config=$$.config,diff=domain[1]-domain[0],maxDataCount,padding,paddingLeft,paddingRight;if($$.isCategorized()){padding=0}else if($$.hasType("bar")){maxDataCount=$$.getMaxDataCount();padding=maxDataCount>1?diff/(maxDataCount-1)/2:.5}else{padding=diff*.01}if(typeof config.xAxis_padding==="object"&&notEmpty(config.xAxis_padding)){paddingLeft=isValue(config.xAxis_padding.left)?config.xAxis_padding.left:padding;paddingRight=isValue(config.xAxis_padding.right)?config.xAxis_padding.right:padding}else if(typeof config.xAxis_padding==="number"){paddingLeft=paddingRight=config.xAxis_padding}else{paddingLeft=paddingRight=padding}return $$.isCategorized()||$$.hasType("bar")||$$.hasType("scatter")||$$.isTimeSeries()?{left:paddingLeft,right:paddingRight}:{left:0,right:0}};top_chart_internal_fn.getXDomain=function(targets){var $$=this,xDomain=[$$.getXDomainMin(targets),$$.getXDomainMax(targets)],firstX=xDomain[0],lastX=xDomain[1],padding=$$.getXDomainPadding(xDomain),min=0,max=0;if(firstX-lastX===0&&!$$.isCategorized()){if($$.isTimeSeries()){firstX=new Date(firstX*.5);lastX=new Date(lastX*1.5)}else{firstX=firstX===0?1:firstX*.5;lastX=lastX===0?-1:lastX*1.5}}if(firstX||firstX===0){min=$$.isTimeSeries()?new Date(firstX.getTime()-padding.left):firstX-padding.left}if(lastX||lastX===0){max=$$.isTimeSeries()?new Date(lastX.getTime()+padding.right):lastX+padding.right}return[min,max]};top_chart_internal_fn.updateXDomain=function(targets,withUpdateXDomain,withUpdateOrgXDomain,withTrim,domain){var $$=this,config=$$.config;if(withUpdateOrgXDomain){$$.x.domain(domain?domain:$$.d3.extent($$.getXDomain(targets)));$$.orgXDomain=$$.x.domain();if(config.zoom_enabled){$$.zoom.scale($$.x).updateScaleExtent()}}if(withUpdateXDomain){$$.x.domain(domain?domain:$$.orgXDomain);if(config.zoom_enabled){$$.zoom.scale($$.x).updateScaleExtent()}}if(withTrim){$$.x.domain($$.trimXDomain($$.x.orgDomain()))}return $$.x.domain()};top_chart_internal_fn.trimXDomain=function(domain){var $$=this;if(domain[0]<=$$.orgXDomain[0]){domain[1]=+domain[1]+($$.orgXDomain[0]-domain[0]);domain[0]=$$.orgXDomain[0]}if($$.orgXDomain[1]<=domain[1]){domain[0]=+domain[0]-(domain[1]-$$.orgXDomain[1]);domain[1]=$$.orgXDomain[1]}return domain};top_chart_internal_fn.isX=function(key){var $$=this,config=$$.config;return config.data_x&&key===config.data_x||notEmpty(config.data_xs)&&hasValue(config.data_xs,key);
};top_chart_internal_fn.isInnerData=function(key){var $$=this,config=$$.config;return key.indexOf("_inner")>=0};top_chart_internal_fn.isNotX=function(key){return!this.isX(key)&&!this.isInnerData(key)};top_chart_internal_fn.isZ=function(key){var $$=this,config=$$.config;return key.indexOf("_z")>=0};top_chart_internal_fn.getXKey=function(id){var $$=this,config=$$.config;return config.data_x?config.data_x:notEmpty(config.data_xs)?config.data_xs[id]:null};top_chart_internal_fn.getXValuesOfXKey=function(key,targets){var $$=this,xValues,ids=targets&&notEmpty(targets)?$$.mapToIds(targets):[];ids.forEach(function(id){if($$.getXKey(id)===key){xValues=$$.data.xs[id]}});return xValues};top_chart_internal_fn.getIndexByX=function(x){var $$=this,data=$$.filterByX($$.data.targets,x);return data.length?data[0].index:null};top_chart_internal_fn.getXValue=function(id,i){var $$=this;return id in $$.data.xs&&$$.data.xs[id]&&isValue($$.data.xs[id][i])?$$.data.xs[id][i]:i};top_chart_internal_fn.getOtherTargetXs=function(){var $$=this,idsForX=Object.keys($$.data.xs);return idsForX.length?$$.data.xs[idsForX[0]]:null};top_chart_internal_fn.getOtherTargetX=function(index){var xs=this.getOtherTargetXs();return xs&&index<xs.length?xs[index]:null};top_chart_internal_fn.addXs=function(xs){var $$=this;Object.keys(xs).forEach(function(id){$$.config.data_xs[id]=xs[id]})};top_chart_internal_fn.hasMultipleX=function(xs){return this.d3.set(Object.keys(xs).map(function(id){return xs[id]})).size()>1};top_chart_internal_fn.isMultipleX=function(){if(isEmpty(this.config.data_xs)&&this.hasType("bar"))return false;else return true};top_chart_internal_fn.addName=function(data){var $$=this,name;if(data){name=$$.config.data_names[data.id];data.name=name?name:data.id}return data};top_chart_internal_fn.getValueOnIndex=function(values,index){var valueOnIndex=values.filter(function(v){return v.index===index});return valueOnIndex.length?valueOnIndex[0]:null};top_chart_internal_fn.updateTargetX=function(targets,x){var $$=this;targets.forEach(function(t){t.values.forEach(function(v,i){v.x=$$.generateTargetX(x[i],t.id,i)});$$.data.xs[t.id]=x})};top_chart_internal_fn.updateTargetXs=function(targets,xs){var $$=this;targets.forEach(function(t){if(xs[t.id]){$$.updateTargetX([t],xs[t.id])}})};top_chart_internal_fn.generateTargetX=function(rawX,id,index){var $$=this,x;if($$.isTimeSeries()){x=rawX?$$.parseDate(rawX):$$.parseDate($$.getXValue(id,index))}else if($$.isCustomX()&&!$$.isCategorized()||$$.isScatterType(id)){x=isValue(rawX)?+rawX:$$.getXValue(id,index)}else{x=index}return x};top_chart_internal_fn.cloneTarget=function(target){return{id:target.id,id_org:target.id_org,values:target.values.map(function(d){return{x:d.x,value:d.value,id:d.id}})}};top_chart_internal_fn.updateXs=function(){var $$=this;if($$.data.targets.length){$$.xs=[];$$.data.targets[0].values.forEach(function(v){$$.xs[v.index]=v.x})}};top_chart_internal_fn.getPrevX=function(i){var x=this.xs[i-1];return typeof x!=="undefined"?x:null};top_chart_internal_fn.getNextX=function(i){var x=this.xs[i+1];return typeof x!=="undefined"?x:null};top_chart_internal_fn.getMaxDataCount=function(){var $$=this;return $$.d3.max($$.data.targets,function(t){return t.values.length})};top_chart_internal_fn.getMaxDataCountTarget=function(targets){var length=targets.length,max=0,maxTarget={};var xs=[];maxTarget.values=[];if(length>1){targets.forEach(function(t){t.values.forEach(function(data){if(!xs.includes(data.x)){maxTarget.values[data.x]=data;xs.push(data.x)}})})}else{maxTarget=length?targets[0]:null;return maxTarget}return maxTarget};top_chart_internal_fn.getEdgeX=function(targets){var $$=this;return!targets.length?[0,0]:[$$.d3.min(targets,function(t){return t.values[0].x}),$$.d3.max(targets,function(t){return t.values[t.values.length-1].x})]};top_chart_internal_fn.mapToIds=function(targets){return targets.map(function(d){return d.id})};top_chart_internal_fn.mapToTargetIds=function(ids){var $$=this;return ids?isString(ids)?[ids]:ids:$$.mapToIds($$.data.targets)};top_chart_internal_fn.hasTarget=function(targets,id){var ids=this.mapToIds(targets),i;for(i=0;i<ids.length;i++){if(ids[i]===id){return true}}return false};top_chart_internal_fn.isTargetToShow=function(targetId){return this.hiddenTargetIds.indexOf(targetId)<0};top_chart_internal_fn.isLegendToShow=function(targetId){return this.hiddenLegendIds.indexOf(targetId)<0};top_chart_internal_fn.filterTargetsToShow=function(targets){var $$=this;return targets.filter(function(t){return $$.isTargetToShow(t.id)})};top_chart_internal_fn.mapTargetsToUniqueXs=function(targets){var $$=this;var xs=$$.d3.set($$.d3.merge(targets.map(function(t){return t.values.map(function(v){return+v.x})}))).values();return $$.isTimeSeries()?xs.map(function(x){return new Date(+x)}):xs.map(function(x){return+x})};top_chart_internal_fn.addHiddenTargetIds=function(targetIds){this.hiddenTargetIds=this.hiddenTargetIds.concat(targetIds)};top_chart_internal_fn.removeHiddenTargetIds=function(targetIds){this.hiddenTargetIds=this.hiddenTargetIds.filter(function(id){return targetIds.indexOf(id)<0})};top_chart_internal_fn.addHiddenLegendIds=function(targetIds){this.hiddenLegendIds=this.hiddenLegendIds.concat(targetIds)};top_chart_internal_fn.removeHiddenLegendIds=function(targetIds){this.hiddenLegendIds=this.hiddenLegendIds.filter(function(id){return targetIds.indexOf(id)<0})};top_chart_internal_fn.getValuesAsIdKeyed=function(targets){var ys={};var $$=this;targets.forEach(function(t){ys[t.id]=[];t.values.forEach(function(v){if($$.is3d||$$.isBoxplotType(t.id))ys[t.id].push(v.y);else ys[t.id].push(v.value)})});return ys};top_chart_internal_fn.checkValueInTargets=function(targets,checker){var ids=Object.keys(targets),i,j,values;for(i=0;i<ids.length;i++){values=targets[ids[i]].values;for(j=0;j<values.length;j++){if(checker(values[j].value)){return true}}}return false};top_chart_internal_fn.hasNegativeValueInTargets=function(targets){return this.checkValueInTargets(targets,function(v){return v<0})};top_chart_internal_fn.hasPositiveValueInTargets=function(targets){return this.checkValueInTargets(targets,function(v){return v>0})};top_chart_internal_fn.isOrderDesc=function(){var config=this.config;return typeof config.data_order==="string"&&config.data_order.toLowerCase()==="desc"};top_chart_internal_fn.isOrderAsc=function(){var config=this.config;return typeof config.data_order==="string"&&config.data_order.toLowerCase()==="asc"};top_chart_internal_fn.orderTargets=function(targets){var $$=this,config=$$.config,orderAsc=$$.isOrderAsc(),orderDesc=$$.isOrderDesc();if($$.stacking){var stackedTargets=[],i;for(i=targets.length-1;i>-1;i--){stackedTargets.push(targets[i])}return stackedTargets}else if(orderAsc||orderDesc){targets.sort(function(t1,t2){var reducer=function(p,c){return p+Math.abs(c.value)};var t1Sum=t1.values.reduce(reducer,0),t2Sum=t2.values.reduce(reducer,0);return orderAsc?t2Sum-t1Sum:t1Sum-t2Sum})}else if(isFunction(config.data_order)){targets.sort(config.data_order)}return targets};top_chart_internal_fn.filterByX=function(targets,x){return this.d3.merge(targets.map(function(t){return t.values})).filter(function(v){return v.x-x===0})};top_chart_internal_fn.filterRemoveNull=function(data){return data.filter(function(d){return isValue(d.value)})};top_chart_internal_fn.filterByXDomain=function(targets,xDomain){return targets.map(function(t){return{id:t.id,id_org:t.id_org,values:t.values.filter(function(v){return xDomain[0]<=v.x&&v.x<=xDomain[1]})}})};top_chart_internal_fn.hasDataLabel=function(){var config=this.config,key,i;if(config.dataLabels_enabled)return true;else return false};top_chart_internal_fn.getDataLabelLength=function(min,max,key){var $$=this,lengths=[0,0],paddingCoef=1.3;$$.selectChart.select("svg").selectAll(".dummy").data([min,max]).enter().append("text").text(function(d){return $$.dataLabelFormat(d.id)(d)}).each(function(d,i){lengths[i]=this.getBoundingClientRect()[key]*paddingCoef}).remove();return lengths};top_chart_internal_fn.isNoneArc=function(d){return this.hasTarget(this.data.targets,d.id)},top_chart_internal_fn.isArc=function(d){return"data"in d&&this.hasTarget(this.data.targets,d.data.id)};top_chart_internal_fn.findSameXOfValues=function(values,index){var i,targetX=values[index].x,sames=[];for(i=index-1;i>=0;i--){if(targetX!==values[i].x){break}sames.push(values[i])}for(i=index;i<values.length;i++){if(targetX!==values[i].x){break}sames.push(values[i])}return sames};top_chart_internal_fn.findClosestFromTargets=function(targets,pos){var $$=this,candidates;candidates=targets.map(function(target){return $$.findClosest(target.values,pos)});return $$.findClosest(candidates,pos)};top_chart_internal_fn.findClosest=function(values,pos){var $$=this,config=$$.config,minDist=config.tooltip_distance,closest;values.filter(function(v){return v&&$$.isBarType(v.id)}).forEach(function(v){var shape=$$.main.select("."+CLASS.bars+$$.getTargetSelectorSuffix(v.id)+" ."+CLASS.bar+"-"+v.index).node();if(!closest&&$$.isWithinBar(shape)){closest=v}});values.filter(function(v){return v&&$$.isBoxplotType(v.id)}).forEach(function(v){var shape=$$.main.select("."+CLASS.boxplots+$$.getTargetSelectorSuffix(v.id)).select(".TOP-shape-"+v.index).node();if(!closest&&$$.isWithinBar(shape)){closest=v}});values.filter(function(v){return v&&!$$.isBarType(v.id)}).forEach(function(v){var d=$$.dist(v,pos);if(v.value!==null){if(d<minDist){minDist=d;closest=v}}});return closest};top_chart_internal_fn.dist=function(data,pos){var $$=this,config=$$.config,xIndex=config.chart_inverted?1:0,yIndex=config.chart_inverted?0:1,y=$$.circleY(data,data.index),x=$$.x(data.x);return Math.pow(x-pos[xIndex],2)+Math.pow(y-pos[yIndex],2)};top_chart_internal_fn.convertValuesToStep=function(values){var converted=[].concat(values),i;if(!this.isCategorized()){return values}for(i=values.length+1;0<i;i--){converted[i]=converted[i-1]}converted[0]={x:converted[0].x-1,value:converted[0].value,id:converted[0].id};converted[values.length+1]={x:converted[values.length].x+1,value:converted[values.length].value,id:converted[values.length].id};return converted};top_chart_internal_fn.updateDataAttributes=function(name,attrs){var $$=this,config=$$.config,current=config["data_"+name];if(typeof attrs==="undefined"){return current}Object.keys(attrs).forEach(function(id){current[id]=attrs[id]});$$.redraw({withLegend:true});return current};top_chart_internal_fn.convertUrlToData=function(url,mimeType,keys,done){var $$=this,type=mimeType?mimeType:"csv";$$.d3.xhr(url,function(error,data){var d;if(!data){throw new Error(error.responseURL+" "+error.status+" ("+error.statusText+")")}if(type==="json"){d=$$.convertJsonToData(JSON.parse(data.response),keys)}else if(type==="tsv"){d=$$.convertTsvToData(data.response)}else{d=$$.convertCsvToData(data.response)}done.call($$,d)})};top_chart_internal_fn.convertXsvToData=function(xsv,parser){var rows=parser.parseRows(xsv),d;if(rows.length===1){d=[{}];rows[0].forEach(function(id){d[0][id]=null})}else{d=parser.parse(xsv)}return d};top_chart_internal_fn.convertCsvToData=function(csv){return this.convertXsvToData(csv,this.d3.csv)};top_chart_internal_fn.convertTsvToData=function(tsv){return this.convertXsvToData(tsv,this.d3.tsv)};top_chart_internal_fn.convertJsonToData=function(json,keys){var $$=this,new_rows=[],targetKeys,data;if(keys){if(keys.x){targetKeys=keys.value.concat(keys.x);$$.config.data_x=keys.x}else{targetKeys=keys.value}new_rows.push(targetKeys);json.forEach(function(o){var new_row=[];targetKeys.forEach(function(key){var v=isUndefined(o[key])?null:o[key];new_row.push(v)});new_rows.push(new_row)});data=$$.convertRowsToData(new_rows)}else{Object.keys(json).forEach(function(key){new_rows.push([key].concat(json[key]))});data=$$.convertColumnsToData(new_rows)}return data};top_chart_internal_fn.convertRowsToData=function(rows){var keys=rows[0],new_row={},new_rows=[],i,j;for(i=1;i<rows.length;i++){new_row={};for(j=0;j<rows[i].length;j++){if(isUndefined(rows[i][j])){throw new Error("Source data is missing a component at ("+i+","+j+")!")}new_row[keys[j]]=rows[i][j]}new_rows.push(new_row)}return new_rows};top_chart_internal_fn.convertColumnsToData=function(columns){var new_rows=[],i,j,key;for(i=0;i<columns.length;i++){key=columns[i][0];for(j=1;j<columns[i].length;j++){if(isUndefined(new_rows[j-1])){new_rows[j-1]={}}if(isUndefined(columns[i][j])){throw new Error("Source data is missing a component at ("+i+","+j+")!")}new_rows[j-1][key]=columns[i][j]}}return new_rows};top_chart_fn.addPoint=function(seriesIndexOrName,pointOption,shift,duration,redraw){var $$=this.internal,config=$$.config;if(redraw===undefined)redraw=true;if($$.frameList.length>0){if($$.frameList[$$.frameList.length-1].toDo==="removeSeries"||$$.frameList[$$.frameList.length-1].toDo==="addSeries"){var frameList=$$.frameList.slice();$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);$$.frameList=[]}}$$.pushFuncToQueue($$.frameUpdateList,"addPoint",[seriesIndexOrName,pointOption,shift,duration,redraw]);if(redraw||!shift){for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}};top_chart_internal_fn.getSeries=function(seriesIndexOrName){var $$=this,config=$$.config;var series;if(typeof seriesIndexOrName==="number"){if(config.series[seriesIndexOrName]){series=config.series[seriesIndexOrName]}else{return}}else if(typeof seriesIndexOrName==="string"){for(var i=0;i<config.series.length;i++){if(config.series[i].name===seriesIndexOrName)series=config.series[i]}if(!series){return}}return series};function Series(owner){API.call(this,owner)}Series.prototype.init=function(seriesOption){this.setInternalData(seriesOption);this.setOptions(seriesOption)};Series.prototype.setOptions=function(seriesOption){var $$=this.owner,config=$$.config,plotOptions=config.plotOptions;var key=this.name=seriesOption.name||seriesOption.name===0?seriesOption.name:"Series "+(i+1);this.type=seriesOption.type||config.chart_type||"line";this.stacking=seriesOption.stacking||seriesOption.stacking===null?seriesOption.stacking:plotOptions[this.type]?plotOptions[this.type].stacking:plotOptions.series?plotOptions.series.stacking:seriesOption.stack?"normal":undefined;if(this.stacking){$$.stacking=$$.stacking?$$.stacking==="percent"?"percent":"normal":this.stacking}this.stack=seriesOption.stack||"stack1";this.color=seriesOption.color||$$.color(key);this.cursor=seriesOption.cursor||"default";this.zIndex=seriesOption.zIndex||0;this.dashStyle=seriesOption.dashStyle||"Solid";this.lineWidth=seriesOption.lineWidth||2;this.legendIndex=seriesOption.legendIndex&&seriesOption.legendIndex.constructor===Number?$$.d3.round(seriesOption.legendIndex):undefined;this.dataLabels=this.initDataLabels(seriesOption.dataLabels);this.visible=seriesOption.visible===false?false:true;this.pointStart=seriesOption.pointStart||0;this.pointInterval=seriesOption.pointInterval||1;this.index=seriesOption.index||seriesOption.index===0?seriesOption.index:undefined;this.marker={};this.marker.enabled=seriesOption.marker?seriesOption.marker.enabled:false;this.marker.shape=seriesOption.marker?seriesOption.marker.shape?seriesOption.marker.shape:undefined:undefined;this.marker.size=seriesOption.marker?seriesOption.marker.size?seriesOption.marker.size:100:100;this.marker.color=seriesOption.marker?seriesOption.marker.color:undefined;this.marker.fill=seriesOption.marker?seriesOption.marker.fill:undefined;this.opacity=seriesOption.opacity?seriesOption.opacity:undefined};Series.prototype.mergeOptions=function(seriesOption,plotOptions){var $$=this.owner,config=$$.config};Series.prototype.update=function(seriesOptions,redraw,callback){var $$=this.owner,config=$$.config;for(var key in seriesOptions){this[key]=seriesOptions[key]}if(seriesOptions.data){config.series[this.index].data=seriesOptions.data}$$.loadFromArgs({series:config.series,done:callback},redraw)};Series.prototype.remove=function(redraw){var $$=this.owner,config=$$.config;if(this.index>-1){config.series.splice(this.index,1)}$$.buildStacks(config.series);$$.buildSeries(config.series);$$.updateWithData($$.convertSeriesToData(config.series));$$.loadFromArgs({series:config.series,done:callback})};top_chart_fn.removeSeries=function(index,count,redraw){var $$=this.internal,config=$$.config;if(redraw===undefined)redraw=true;if($$.frameUpdateList.length>0){if($$.frameUpdateList[$$.frameUpdateList.length-1].toDo==="addPoint"){$$.frameUpdateList[frameUpdateList.length-1].params[4]=true}}if(redraw&&$$.frameList.length===0){$$.pushFuncToQueue($$.frameUpdateList,"removeSeries",[index,count]);for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}else if(redraw&&$$.frameList.length){$$.pushFuncToQueue($$.frameList,"removeSeries",[index,count]);var frameList=$$.frameList.slice();$$.frameList=[];$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}else{$$.pushFuncToQueue($$.frameList,"removeSeries",[index,count])}};top_chart_internal_fn.removeSeries=function(index,count){var $$=this,config=$$.config,i,id,ids=[];if(index===undefined){index=0;count=config.series.length}if(!count)count=1;if(config.series.length<index+count){return}if(index>-1){var removedSeries=config.series.splice(index,count);$$.buildStacks(config.series);$$.buildSeries(config.series);if(config.legend_pagination){if($$.prevLegendList&&$$.prevLegendList.length>index){$$.currentLegendIndex=$$.currentLegendIndex-count>0?$$.currentLegendIndex-count:0}}for(var i=0;i<count;i++){id=removedSeries[i].name;ids.push(removedSeries[i].name);delete config.data_types[id]}if($$.legend){ids.forEach(function(currentValue){$$.legend.selectAll("."+CLASS.legendItem+$$.getTargetSelectorSuffix(currentValue)).remove()})}if(config.transition_duration){$$.svg.selectAll($$.selectorTargets(ids)).transition().duration(config.transition_duration).style("opacity",0).remove().call($$.endall,function(){$$.updateWithData($$.convertSeriesToData(config.series));$$.loadFromArgs({series:config.series})})}else{$$.svg.selectAll($$.selectorTargets(ids)).remove();$$.updateWithData($$.convertSeriesToData(config.series));$$.loadFromArgs({series:config.series})}}};top_chart_internal_fn.addPoint=function(seriesIndexOrName,pointOption,shift,duration,redraw){var $$=this,config=$$.config,series=$$.getSeries(seriesIndexOrName),currentLength;if(!$$.isTabVisible()||!series)return;if($$.flowX===null){var seriesName=series.name;for(var i=0;i<$$.data.targets.length;i++){if(seriesName===$$.data.targets[i].id)$$.flowX=$$.data.targets[i].values[$$.data.targets[i].values.length-1].x+1}}if(typeof duration==="number"){$$.config.transition_duration=duration}if(!shift){if(pointOption.data){series.data.push(pointOption.data)}if($$.isTimeSeries()){if(typeof pointOption==="number"){var date=new Date;series.data.push([date,pointOption]);$$.flowX=date}else if(pointOption.constructor===Array&&pointOption.length===2){if($$.isTimeSeries()&&typeof pointOption[0]==="object")$$.flowX=pointOption[0];else if($$.isTimeSeries()&&typeof pointOption[0]==="number")$$.flowX=new Date(pointOption[0]);else $$.flowX=pointOption[0];var tempPointOption=[$$.flowX,pointOption[1]];series.data.push(tempPointOption)}else{series.data.push(pointOption);$$.flowX=pointOption[0]}}else{if(typeof pointOption==="number"){series.data.push(pointOption);$$.flowX++}else if(pointOption.constructor===Array&&pointOption.length===2){series.data.push(pointOption);$$.flowX=pointOption[0]}else{series.data.push(pointOption);$$.flowX=pointOption[0]}}$$.updateWithData($$.convertSeriesToData(config.series));$$.loadFromArgs({series:config.series},redraw)}else{config.selection_draggable=false;if(typeof pointOption==="number"||pointOption===null){if($$.isTimeSeries())$$.flowX=new Date;var tempOption=[[$$.flowX,pointOption]];pointOption=tempOption}else if(pointOption.constructor===Array&&pointOption.length===2){if($$.isTimeSeries()&&typeof pointOption[0]==="object")$$.flowX=pointOption[0];else if($$.isTimeSeries()&&typeof pointOption[0]==="number")$$.flowX=new Date(pointOption[0]);else $$.flowX=pointOption[0];var tempOption=[[$$.flowX,pointOption[1]]];pointOption=tempOption}else{var pointOpt=[];pointOpt.push(pointOption);pointOption=pointOpt;$$.flowX=pointOption.x}if(shift.duration){config.shift_duration=shift.duration}else if(shift===true||typeof shift==="number"){var shift={length:1};shift.duration=config.shift_duration}shift.duration=shift.duration||config.shift_duration;shift.length=shift.length||1;if(redraw===undefined)redraw=true;$$.buildStacks(config.series);$$.api.flow({series:[{name:series.name,type:series.type,data:pointOption}],duration:shift.duration,length:shift.length,to:shift.to,redraw:redraw});if(redraw&&!$$.isTimeSeries())$$.flowX=$$.flowX+shift.length}};Series.prototype.addPoint=function(pointOption,shift,duration,redraw){var $$=this.owner,config=$$.config;if(redraw===undefined)redraw=true;if($$.frameList.length>0){if($$.frameList[$$.frameList.length-1].toDo==="removeSeries"||$$.frameList[$$.frameList.length-1].toDo==="addSeries"){var frameList=$$.frameList.slice();$$.pushFuncToQueue($$.frameUpdateList,"updateSeries",[frameList]);$$.frameList=[]}}$$.pushFuncToQueue($$.frameUpdateList,"addPoint",[this,pointOption,shift,duration,redraw]);if(redraw){for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}};Series.prototype.addPoints=function(pointOptions,redraw,shift,animation){var $$=this.owner,config=$$.config,series=this;if(typeof pointOptions!=="undefined"&&pointOptions&&pointOptions.constructor===Array){pointOptions.forEach(function(pointOption){if(pointOption.data){this.data.push(pointOption.data)}if($$.isTimeSeries()){if(typeof pointOption==="number"){series.data.push([new Date,pointOption])}else if(pointOption.length===2){series.data.push(pointOption)}}else{series.data.push(pointOption)}})}$$.loadFromArgs(config,redraw)};Series.prototype.initDataLabels=function(dataLabels){var defaultDataLabels={align:"center",borderRadius:0,borderWidth:0,crop:true,defer:true,format:"{y}",overflow:"justify",padding:5,rotation:0,shape:"square",style:{color:"contrast",fontSize:"11px",fontWeight:"bold",textShadow:"0 0 6px contrast, 0 0 3px contrast"},x:0,y:-6,zIndex:6};if(!dataLabels){return defaultDataLabels}else{for(var key in dataLabels){if(key==="style"){for(var subKey in dataLabels[key]){defaultDataLabels[key][subKey]=dataLabels[key][subKey]}}else{defaultDataLabels[key]=dataLabels[key]}}return defaultDataLabels}};Series.prototype.setInternalData=function(seriesOption){var $$=this.owner;this.data=seriesOption.data};Series.prototype.setData=function(data,redraw){var $$=this.owner,config=$$.config;if(data){this.data=data;config.series[this.index].data=data}$$.loadFromArgs(config,redraw)};Series.prototype.getData=function(){return this.data};top_chart_internal_fn.convertSeriesToIndexedSeries=function(series){var tempSeries=[],i,j,key,$$=this;for(i=0;i<series.length;i++){if(series[i].index||series[i].index===0){if(series[i].index.constructor!=Number||series[i].index>=series.length||series[i].index<0){series[i].index=undefined}else{tempSeries[series[i].index?series[i].index:0]=series[i]}}}for(i=0;i<series.length;i++){if(!(series[i].index||series[i].index===0)){for(j=0;j<series.length;j++){if(!tempSeries[j]){tempSeries[j]=series[i];tempSeries[j].index=j;break}else{}}}}return tempSeries};top_chart_internal_fn.convertSeriesToData=function(seriesOption){var new_rows=[],i,j,key,$$=this;$$.setSeriesTypes(seriesOption);$$.setSeriesColors(seriesOption);$$.setSeriesEvents(seriesOption);$$.config.data_xs={};for(i=0;i<seriesOption.length;i++){if(i==0)$$.lastIndex=0;key=seriesOption[i].name||"Series "+(i+1);if(!seriesOption[i].data){return new_rows}for(j=0;j<seriesOption[i].data.length;j++){if(seriesOption[i].data[j]===null){if(isUndefined(new_rows[j])){new_rows[j]={}}new_rows[j][key]=seriesOption[i].data[j];if(seriesOption[i].pointStart){new_rows[j][key+"_x"]=seriesOption[i].pointStart+j*seriesOption[i].pointInterval;$$.config.data_xs[key]=key+"_x"}}else if(seriesOption[i].data[j].constructor===Number){if(isUndefined(new_rows[j])){new_rows[j]={}}new_rows[j][key]=seriesOption[i].data[j];if(seriesOption[i].pointStart){new_rows[j][key+"_x"]=seriesOption[i].pointStart+j*seriesOption[i].pointInterval;$$.config.data_xs[key]=key+"_x"}}else if(seriesOption[i].data[j]instanceof Array&&seriesOption[i].data[j].length===2){if(isUndefined(new_rows[j])){new_rows[j]={}}new_rows[j][key+"_x"]=seriesOption[i].data[j][0];new_rows[j][key]=seriesOption[i].data[j][1];$$.config.data_xs[key]=key+"_x"}else if(seriesOption[i].data[j]instanceof Array&&seriesOption[i].data[j].length===3){$$.is3d=true;if(isUndefined(new_rows[j])){new_rows[j]={}}new_rows[j][key+"_x"]=seriesOption[i].data[j][0];new_rows[j][key+"_y"]=seriesOption[i].data[j][1];new_rows[j][key+"_z"]=seriesOption[i].data[j][2];$$.config.data_xs[key]=key+"_x"}else if(seriesOption[i].data[j]instanceof Array&&seriesOption[i].data[j].length===5){if(isUndefined(new_rows[j])){new_rows[j]={}}new_rows[j][key+"_max"]=seriesOption[i].data[j][0];new_rows[j][key+"_upper"]=seriesOption[i].data[j][1];new_rows[j][key+"_median"]=seriesOption[i].data[j][2];new_rows[j][key+"_lower"]=seriesOption[i].data[j][3];new_rows[j][key+"_min"]=seriesOption[i].data[j][4];new_rows[j][key+"_x"]=j;$$.config.data_xs[key]=key+"_x"}else if(seriesOption[i].data[j]instanceof Array&&seriesOption[i].data[j].length===6){if(isUndefined(new_rows[j])){new_rows[j]={}}new_rows[j][key+"_x"]=seriesOption[i].data[j][0];new_rows[j][key+"_max"]=seriesOption[i].data[j][1];new_rows[j][key+"_upper"]=seriesOption[i].data[j][2];new_rows[j][key+"_median"]=seriesOption[i].data[j][3];new_rows[j][key+"_lower"]=seriesOption[i].data[j][4];new_rows[j][key+"_min"]=seriesOption[i].data[j][5];$$.config.data_xs[key]=key+"_x"}else if(seriesOption[i].data[j]instanceof Object){if(isUndefined(new_rows[j])){new_rows[j]={}}if(seriesOption[i].data[j].z){$$.is3d=true;new_rows[j][key+"_x"]=seriesOption[i].data[j].x;new_rows[j][key+"_z"]=seriesOption[i].data[j].z;new_rows[j][key+"_y"]=seriesOption[i].data[j].y}else{new_rows[j][key+"_x"]=seriesOption[i].data[j].x;new_rows[j][key]=seriesOption[i].data[j].y}new_rows[j][key+"_inner"]=seriesOption[i].data[j].innerData;$$.config.data_xs[key]=key+"_x"}}}return new_rows};top_chart_internal_fn.convertDataToPercentData=function(data){var new_rows=[],i,j,key,$$=this,subKey,tempSum;for(key in data){if(key.indexOf("_x")>=0)continue;tempSum=0;for(subKey in data[key]){if(subKey.indexOf("_x")>=0)continue;tempSum+=data[key][subKey]}for(subKey in data[key]){if(subKey.indexOf("_x")>=0)continue;data[key][subKey]=data[key][subKey]*100/tempSum}}return data};top_chart_internal_fn.setSeriesTypes=function(series){var i,$$=this,config=$$.config,key;for(i=0;i<series.length;i++){key=series[i].name||"Series "+(i+1);if(series[i].type){config.data_types[key]=series[i].type}else if(config.chart_type){config.data_types[key]=config.chart_type}else{config.data_types[key]="line"}}};top_chart_internal_fn.setSeriesColors=function(series){var i,$$=this,config=$$.config,key;for(i=0;i<series.length;i++){key=series[i].name||"Series "+(i+1);if(series[i].color){config.data_colors[key]=series[i].color}}};top_chart_internal_fn.setSeriesEvents=function(series){var i,$$=this,config=$$.config,key;for(i=0;i<series.length;i++){key=series[i].name||"Series "+(i+1);if(series[i].events){if(series[i].events.click){config.data_onclick=series[i].events.click}if(series[i].events.select){config.data_onselected=series[i].events.select}}}};top_chart_internal_fn.getDashArray=function(dashStyle,strokeWidth){var dashArray,i;if(typeof dashStyle==="string"){dashStyle=dashStyle&&dashStyle.toLowerCase()}if(dashStyle&&typeof dashStyle=="string"){dashArray=dashStyle.replace("shortdashdotdot","3,1,1,1,1,1,").replace("shortdashdot","3,1,1,1").replace("shortdot","1,1,").replace("shortdash","3,1,").replace("longdash","8,3,").replace(/dot/g,"1,3,").replace("dash","4,3,").replace(/,$/,"").split(",");i=dashArray.length;while(i--){if(strokeWidth&&strokeWidth.constructor===Number){dashArray[i]=parseInt(dashArray[i])*(strokeWidth||3)}}dashArray=dashArray.join(",").replace("NaN","none")}return dashArray};top_chart_fn.getSelectedSeries=function(){return this.internal.seriesSelected};top_chart_internal_fn.merge=function(){var i,args=arguments,len,ret={},doCopy=function(copy,original){var value,key;if(typeof copy!=="object"){copy={}}for(key in original){if(original.hasOwnProperty(key)){value=original[key];if(value&&typeof value==="object"&&Object.prototype.toString.call(value)!=="[object Array]"&&key!=="renderTo"&&typeof value.nodeType!=="number"){copy[key]=doCopy(copy[key]||{},value)}else{copy[key]=original[key]}}}return copy};if(args[0]===true){ret=args[1];args=Array.prototype.slice.call(args,2)}len=args.length;for(i=0;i<len;i++){ret=doCopy(ret,args[i])}return ret};top_chart_internal_fn.convertDataToTargets=function(data,appendXs){var $$=this,config=$$.config;var dataForIds;$$.isY2Show=false;for(var i=0;i<data.length;i++){dataForIds=$$.merge(dataForIds,data[i])}var ids=[],xs=$$.d3.keys(dataForIds).filter($$.isX,$$),inners=$$.d3.keys(dataForIds).filter($$.isInnerData,$$),targets;$$.data.xs={};for(var i=0;i<config.series.length;i++){ids.push(config.series[i].name)}var data_axes={};for(var i=0;i<config.series.length;i++){var seriesID=config.series[i].name;var seriesYaxis=config.series[i].yAxis;if(seriesYaxis==="y2"){$$.isY2Show=true}else seriesYaxis="y";data_axes[seriesID]=seriesYaxis}if($$.isY2Show)config.axis_y2_show=true;else config.axis_y2_show=false;config.data_axes=data_axes;ids.forEach(function(id){var xKey=$$.getXKey(id);if($$.isCustomX(id)||$$.isTimeSeries()){if(xs.indexOf(xKey)>=0){$$.data.xs[id]=(appendXs&&$$.data.xs[id]?$$.data.xs[id]:[]).concat(data.map(function(d){return d[xKey]}).filter(isValue).map(function(rawX,i){return $$.generateTargetX(rawX,id,i)}))}else if(config.data_x){$$.data.xs[id]=$$.getOtherTargetXs()}else if(notEmpty(config.data_xs)){$$.data.xs[id]=$$.getXValuesOfXKey(xKey,$$.data.targets)||data.map(function(d,i){return i})}}else{$$.data.xs[id]=data.map(function(d,i){return i})}});ids.forEach(function(id){if(!$$.data.xs[id]){throw new Error('x is not defined for id = "'+id+'".')}});targets=ids.map(function(id,index){var convertedId=config.data_idConverter(id);return{opacity:config.series[index].opacity,lineWidth:config.series[index].lineWidth,marker:{enabled:config.series[index].marker?config.series[index].marker.enabled:false,shape:config.series[index].marker?config.series[index].marker.shape?config.series[index].marker.shape:undefined:undefined,size:config.series[index].marker?config.series[index].marker.size?config.series[index].marker.size:0:0,color:config.series[index].marker?config.series[index].marker.color:undefined,fill:config.series[index].marker?config.series[index].marker.fill:undefined},stacking:config.series[index].stacking,id:convertedId,id_org:id,values:data.map(function(d,i){var xKey=$$.getXKey(id),rawX=d[xKey],x=$$.generateTargetX(rawX,id,i);if($$.isCustomX()&&$$.isCategorized()&&index===0&&rawX){if(i===0){config.xAxis_categories=[]}config.xAxis_categories.push(rawX)}if($$.is3d&&isUndefined(d[id]+"_z")||!$$.is3d&&isUndefined(d[id])||$$.data.xs[id].length<=i){x=undefined}if($$.is3d)return{x:x,y:d[id+"_y"],z:d[id+"_z"],id:convertedId,innerData:d[id+"_inner"]};if($$.isBoxplotType(id)){return{x:d[id+"_x"],y:d[id+"_max"],max:d[id+"_max"],upper:d[id+"_upper"],median:d[id+"_median"],lower:d[id+"_lower"],min:d[id+"_min"],id:convertedId,innerData:d[id+"_inner"]}}else{return{x:x,value:d[id]!==null&&!isNaN(d[id])?+d[id]:null,id:convertedId,innerData:d[id+"_inner"]}}}).filter(function(v){return isDefined(v.x)})}});targets.forEach(function(t){var i;if(config.data_xSort){t.values=t.values.sort(function(v1,v2){var x1=v1.x||v1.x===0?v1.x:Infinity,x2=v2.x||v2.x===0?v2.x:Infinity;
return x1-x2})}i=0;t.values.forEach(function(v){v.index=i++});$$.data.xs[t.id].sort(function(v1,v2){return v1-v2})});if(config.data_type){$$.setTargetType($$.mapToIds(targets).filter(function(id){return!(id in config.data_types)}),config.data_type)}return targets};top_chart_internal_fn.load=function(targets,args,redraw){var $$=this,config=$$.config;if(targets){if(args.filter){targets=targets.filter(args.filter)}if(args.type||args.types){targets.forEach(function(t){var type=args.types&&args.types[t.id]?args.types[t.id]:args.type;$$.setTargetType(t.id,type)})}}if(redraw!==false){$$.redraw({withUpdateOrgXDomain:true,withUpdateXDomain:true,withLegend:true})}if(args.done){args.done()}};top_chart_internal_fn.loadFromArgs=function(args,redraw){var $$=this;if(args.series&&$$.stacking==="percent"){$$.load($$.convertDataToTargets($$.convertDataToPercentData($$.convertSeriesToData(args.series))),args,redraw)}else if(args.series){$$.load($$.convertDataToTargets($$.convertSeriesToData(args.series)),args,redraw)}else{$$.load(null,args)}};top_chart_internal_fn.unload=function(targetIds,done){var $$=this;if(!done){done=function(){}}targetIds=targetIds.filter(function(id){return $$.hasTarget($$.data.targets,id)});if(!targetIds||targetIds.length===0){done();return}$$.svg.selectAll(targetIds.map(function(id){return $$.selectorTarget(id)})).transition().style("opacity",0).remove().call($$.endall,done);targetIds.forEach(function(id){$$.withoutFadeIn[id]=false;if($$.legend){$$.legend.selectAll("."+CLASS.legendItem+$$.getTargetSelectorSuffix(id)).remove()}$$.data.targets=$$.data.targets.filter(function(t){return t.id!==id})})};top_chart_internal_fn.categoryName=function(i){var config=this.config;return i<config.xAxis_categories.length?config.xAxis_categories[i]:i};top_chart_internal_fn.initEventRect=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.eventRects).style("fill-opacity",0)};top_chart_internal_fn.redrawEventRect=function(){var $$=this,config=$$.config,eventRectUpdate,maxDataCountTarget,isMultipleX=$$.isMultipleX();var eventRects=$$.main.select("."+CLASS.eventRects).classed(CLASS.eventRectsMultiple,isMultipleX).classed(CLASS.eventRectsSingle,!isMultipleX);eventRects.selectAll("."+CLASS.eventRect).remove();$$.eventRect=eventRects.selectAll("."+CLASS.eventRect);if(isMultipleX){eventRectUpdate=$$.eventRect.data([0]);$$.generateEventRectsForMultipleXs(eventRectUpdate.enter());$$.updateEventRect(eventRectUpdate)}else{maxDataCountTarget=$$.getMaxDataCountTarget($$.data.targets);eventRects.datum(maxDataCountTarget?maxDataCountTarget.values:[]);$$.eventRect=eventRects.selectAll("."+CLASS.eventRect);eventRectUpdate=$$.eventRect.data(function(d){return d});$$.generateEventRectsForSingleX(eventRectUpdate.enter());$$.updateEventRect(eventRectUpdate);eventRectUpdate.exit().remove()}};top_chart_internal_fn.updateEventRect=function(eventRectUpdate){var $$=this,config=$$.config,x,y,w,h,rectW,rectX;eventRectUpdate=eventRectUpdate||$$.eventRect.data(function(d){return d});if($$.isMultipleX()){x=0;y=0;w=$$.width;h=$$.height}else{if(($$.isCustomX()||$$.isTimeSeries())&&!$$.isCategorized()){$$.updateXs();rectW=function(d){var prevX=$$.getPrevX(d.index),nextX=$$.getNextX(d.index);if(prevX===null&&nextX===null){return config.chart_inverted?$$.height:$$.width}if(prevX===null){prevX=$$.x.domain()[0]}if(nextX===null){nextX=$$.x.domain()[1]}return Math.max(0,($$.x(nextX)-$$.x(prevX))/2)};rectX=function(d){var prevX=$$.getPrevX(d.index),nextX=$$.getNextX(d.index),thisX=$$.data.xs[d.id][d.index];if(prevX===null&&nextX===null){return 0}if(prevX===null){prevX=$$.x.domain()[0]}return($$.x(thisX)+$$.x(prevX))/2}}else{rectW=$$.getEventRectWidth();rectX=function(d){return $$.x(d.x)-rectW/2+1}}x=config.chart_inverted?0:rectX;y=config.chart_inverted?rectX:0;w=config.chart_inverted?$$.width:rectW;h=config.chart_inverted?rectW:$$.height}eventRectUpdate.attr("class",$$.classEvent.bind($$)).attr("x",x).attr("y",y).attr("width",w).attr("height",h)};top_chart_internal_fn.highlightEventRect=function(d){var $$=this,config=$$.config,grouped=config.tooltip_grouped,categorized=$$.isCategorized(),columned=$$.hasType("column")||$$.hasType("bar"),stacked=$$.stacking,eventRect=$$.main.select("."+CLASS.eventRect+"-"+d.index);if(grouped&&(categorized||columned)||stacked){eventRect.style("stroke","#ffba00").style("fill","#ffba00").style("fill-opacity",.15)}};top_chart_internal_fn.unhighlightEventRect=function(){var $$=this;$$.main.selectAll("."+CLASS.eventRect).style("stroke",null).style("fill",null).style("fill-opacity",0)};top_chart_internal_fn.generateEventRectsForSingleX=function(eventRectEnter){var $$=this,d3=$$.d3,config=$$.config;eventRectEnter.append("rect").attr("class",$$.classEvent.bind($$)).style("cursor",config.data_selection_enabled&&config.data_selection_grouped?"pointer":null).on("mouseover",function(d){var index=d.index;if($$.dragging||$$.flowing){return}if($$.hasArcType()){return}if(config.point_focus_expand_enabled){$$.expandCircles(index,null,true);$$.highlightEventRect(d)}$$.main.selectAll("."+CLASS.shape+"-"+index).each(function(d){config.data_onmouseover.call($$.api,d)})}).on("mouseout",function(d){var index=d.index;if(!$$.config){return}if($$.hasArcType()){return}$$.hideXGridFocus();if(!$$.flowing)$$.hideTooltip();$$.unexpandCircles();$$.unexpandBars();$$.unhighlightEventRect();$$.api.revert();$$.main.selectAll("."+CLASS.shape+"-"+index).each(function(d){config.data_onmouseout.call($$.api,d)})}).on("mousemove",function(d){var selectedData,index=d.index,closest,mouse,isNullStack=false,eventRect=$$.svg.select("."+CLASS.eventRect+"-"+index);var targetsToShow=$$.filterTargetsToShow($$.data.targets);mouse=d3.mouse(this);closest=$$.findClosestFromTargets(targetsToShow,mouse);if($$.dragging||$$.flowing){return}if($$.hasArcType()){return}closest=closest?closest:d;if(closest.value===null){var index=d.index;var findStack=false;for(var i=0;i<targetsToShow.length;i++){if(targetsToShow[i].values[index].value!==null){closest=targetsToShow[i].values[index];findStack=true;break}}if(findStack===false)isNullStack=true}$$.closest=closest;$$.focusedPoint=closest;if(!isNullStack&&!$$.isFocusLock&&config.chart_focusable)if(!$$.hasType("column")&&!$$.hasType("bar"))$$.api.focus(closest.id);if($$.isStepType(d)&&$$.config.line_step_type==="step-after"&&d3.mouse(this)[0]<$$.x($$.getXValue(d.id,index))){index-=1}selectedData=$$.filterTargetsToShow($$.data.targets).map(function(t){return $$.addName($$.getValueOnIndex(t.values,index))});if($$.stacking==="percent"){var oriData=$$.filterTargetsToShow($$.convertDataToTargets($$.convertSeriesToData(config.series))).map(function(t){return $$.addName($$.getValueOnIndex(t.values,index))});for(var i=0;i<selectedData.length;i++){selectedData[i].oriValue=oriData[i].value}}$$.selectedData=selectedData;if(config.tooltip_grouped&&closest.value!==null){$$.showTooltip(selectedData,this,closest);$$.showXGridFocus(selectedData)}if(config.tooltip_grouped&&(!config.data_selection_enabled||config.data_selection_grouped)){return}$$.main.selectAll("."+CLASS.shape+"-"+index).each(function(){d3.select(this).classed(CLASS.EXPANDED,true);if(!config.tooltip_grouped){$$.hideXGridFocus();$$.hideTooltip();if(!config.data_selection_grouped){$$.unexpandCircles(index);$$.unexpandBars(index);$$.api.revert()}}}).filter(function(d){return $$.isWithinShape(this,d)}).each(function(d){if(!config.tooltip_grouped){$$.showTooltip([d],this,closest);if(!$$.isCategorized()&&!$$.stacking)$$.showXGridFocus([d]);if(config.point_focus_expand_enabled){$$.expandCircles(index,d.id,true)}$$.expandBars(index,d.id,true);if(config.chart_focusable)$$.api.focus(d.id)}})}).on("click",function(d){var index=d.index;$$.clickDataPoint={};if($$.hasArcType()||!$$.toggleShape){return}if($$.cancelClick){$$.cancelClick=false;return}if($$.isStepType(d)&&config.line_step_type==="step-after"&&d3.mouse(this)[0]<$$.x($$.getXValue(d.id,index))){index-=1}var clickedData=[];$$.main.selectAll("."+CLASS.shape+"-"+index).each(function(d){if(config.data_selection_grouped||$$.isWithinShape(this,d)){if(d.value||d.y||d.value===0){$$.clickDataPoint=$$.generateClickDataPoint(d);clickedData.push($$.clickDataPoint)}}});$$.config.data_onclick.call($$.api,clickedData)}).call(config.selection_draggable&&$$.drag?d3.behavior.drag().origin(Object).on("drag",function(){$$.drag(d3.mouse(this))}).on("dragstart",function(){$$.dragstart(d3.mouse(this))}).on("dragend",function(){$$.dragend()}):function(){})};top_chart_internal_fn.generateEventRectsForMultipleXs=function(eventRectEnter){var $$=this,d3=$$.d3,config=$$.config;function mouseout(){$$.svg.select("."+CLASS.eventRect).style("cursor",null);$$.hideXGridFocus();if(!$$.flowing)$$.hideTooltip();$$.unexpandCircles();$$.unexpandBars();if(!$$.isFocusLock)$$.api.revert()}eventRectEnter.append("rect").attr("x",0).attr("y",0).attr("width",$$.width).attr("height",$$.height).attr("class",CLASS.eventRect).on("mouseout",function(){if(!$$.config){return}if($$.hasArcType()){return}setTimeout(function(){if(config.tooltip_onmouse_enabled&&!$$.isMouseOverTooltip)mouseout()},0);if(!config.tooltip_onmouse_enabled)mouseout()}).on("mousemove",function(){var targetsToShow=$$.filterTargetsToShow($$.data.targets);var mouse,closest,sameXData,selectedData;if($$.dragging){return}if($$.hasArcType(targetsToShow)){return}mouse=d3.mouse(this);if($$.stacking&&($$.hasType("line")||$$.hasType("area"))){closest=$$.findClosestInStackingType(mouse)}else{closest=$$.findClosestFromTargets(targetsToShow,mouse)}$$.closest=closest;if($$.mouseover&&(!closest||closest.id!==$$.mouseover.id)){config.data_onmouseout.call($$.api,$$.mouseover);$$.mouseover=undefined;$$.orgClosest=undefined}if(!closest){mouseout();$$.orgClosest=undefined;return}if(config.tooltip_grouped||$$.stacking){sameXData=$$.filterByX(targetsToShow,closest.x)}else{sameXData=[closest]}selectedData=sameXData.map(function(d){return $$.addName(d)});if($$.isBoxplotType(closest.id)||$$.isBubbleType(closest.id))closest.value=closest.y;if(closest.value!==null){$$.showTooltip(selectedData,this,closest);$$.showXGridFocus(selectedData)}$$.selectedData=selectedData;if(config.point_focus_expand_enabled&&!$$.isFocusLock){$$.expandCircles(closest.index,closest.id,true);if(closest.value!==null&&config.chart_focusable)$$.api.focus(closest.id)}$$.expandBars(closest.index,closest.id,true);if($$.isBarType(closest.id)||$$.dist(closest,mouse)<100||$$.isLineType&&$$.stacking&&closest!==null){if(closest.value!==null)$$.svg.select("."+CLASS.eventRect).style("cursor","pointer");if(!$$.mouseover){config.data_onmouseover.call($$.api,closest);$$.mouseover=closest}}if(!$$.orgClosest)$$.orgClosest=closest}).on("click",function(){var targetsToShow=$$.filterTargetsToShow($$.data.targets);var mouse,closest;$$.clickDataPoint={};if($$.hasArcType(targetsToShow)){return}mouse=d3.mouse(this);closest=$$.findClosestFromTargets(targetsToShow,mouse);if(!closest){return}if($$.isBarType(closest.id)||$$.dist(closest,mouse)<100){var clickedData=[];$$.main.selectAll("."+CLASS.shapes+$$.getTargetSelectorSuffix(closest.id)).selectAll("."+CLASS.shape+"-"+closest.index).each(function(){if(config.data_selection_grouped||$$.isWithinShape(this,closest)){if(closest.value||closest.y||closest.value===0){$$.clickDataPoint=$$.generateClickDataPoint(closest);clickedData.push($$.clickDataPoint)}}})}$$.config.data_onclick.call($$.api,clickedData)}).call(config.selection_draggable&&$$.drag?d3.behavior.drag().origin(Object).on("drag",function(){$$.drag(d3.mouse(this))}).on("dragstart",function(){$$.dragstart(d3.mouse(this))}).on("dragend",function(){$$.dragend()}):function(){})};top_chart_internal_fn.findClosestInStackingType=function(mouse){var $$=this,config=$$.config,minDist=100,xIndex=config.chart_inverted?1:0,yIndex=config.chart_inverted?0:1,closest,x,y;$$.selectedCircle.forEach(function(c){c.forEach(function(circle){x=$$.x(circle.__data__.x);y=circle.cy.animVal.value;var d=Math.pow(x-mouse[xIndex],2)+Math.pow(y-mouse[yIndex],2);if(d<minDist){minDist=d;closest=circle.__data__}})});return closest};top_chart_internal_fn.dispatchEvent=function(type,index,mouse){var $$=this,selector="."+CLASS.eventRect+(!$$.isMultipleX()?"-"+index:""),eventRect=$$.main.select(selector).node(),box=eventRect.getBoundingClientRect(),x=box.left+(mouse?mouse[0]:0),y=box.top+(mouse?mouse[1]:0),event=document.createEvent("MouseEvents");event.initMouseEvent(type,true,true,window,0,x,y,x,y,false,false,false,false,0,null);eventRect.dispatchEvent(event)};top_chart_internal_fn.getCurrentWidth=function(){var $$=this,config=$$.config,toReturn=$$.getParentWidth();if(toReturn){if(toReturn.toString().indexOf("%")>-1){toReturn=toReturn.replace("%","");toReturn=$$.getParentWidth()*Number(toReturn)/100}}return toReturn};top_chart_internal_fn.getCurrentHeight=function(){var $$=this,config=$$.config,h=$$.getParentHeight();if(h){if(h.toString().indexOf("%")>-1){h=h.replace("%","");h=$$.getParentHeight()*Number(h)/100}}return h};top_chart_internal_fn.getCurrentPaddingTop=function(){var config=this.config;return isValue(config.chart_spacing.top)?config.chart_spacing.top:0};top_chart_internal_fn.getCurrentPaddingBottom=function(){var config=this.config;return isValue(config.chart_spacing.bottom)?config.chart_spacing.bottom:0};top_chart_internal_fn.getCurrentPaddingLeft=function(withoutRecompute){var $$=this,config=$$.config;if(config.chart_inverted){if($$.hasType("bargauge")){return 0}var paddingLeft=35;if(config.chart_spacing.left){paddingLeft=config.chart_spacing.left}return!config.xAxis_show?1:paddingLeft}else if($$.hasType("columngauge")){return 0}else if(!isNaN(config.chart_spacing.left)){if(config.chart_spacing.left||config.chart_spacing.left===0)return config.chart_spacing.left;else if(ceil10($$.getAxisWidthByAxisId("y"))-15<=25)return 40;else return ceil10($$.getAxisWidthByAxisId("y"))-15}else if(!config.yAxis_show||config.axis_y_inner){return $$.axis.getYAxisLabelPosition().isOuter?30:1}else{return ceil10($$.getAxisWidthByAxisId("y",withoutRecompute))+1}};top_chart_internal_fn.getCurrentPaddingRight=function(){var $$=this,config=$$.config,defaultPadding=10,legendWidthOnRight=0;if(config.axis_y2_show){var returnPadding=ceil10($$.getAxisWidthByAxisId("y2"))-15+legendWidthOnRight;returnPadding=returnPadding<25?25:returnPadding;return returnPadding+(isValue(config.chart_spacing.right)?config.chart_spacing.right:0)}else if(isValue(config.chart_spacing.right)){return config.chart_spacing.right+1+legendWidthOnRight}else if(config.chart_inverted){return defaultPadding+legendWidthOnRight}else if(!config.axis_y2_show||config.axis_y2_inner){return 2+legendWidthOnRight+($$.axis.getY2AxisLabelPosition().isOuter?20:0)}};top_chart_internal_fn.getParentRectValue=function(key){var parent=this.selectChart.node(),v;while(parent&&parent.tagName!=="BODY"){try{v=parent.getBoundingClientRect()[key]}catch(e){if(key==="width"){v=parent.offsetWidth}}if(v){break}parent=parent.parentNode}return v?v:0};top_chart_internal_fn.getParentWidth=function(){return this.getParentRectValue("width")};top_chart_internal_fn.getParentHeight=function(){return this.getParentRectValue("height")};top_chart_internal_fn.getSvgLeft=function(withoutRecompute){var $$=this,config=$$.config,hasLeftAxisRect=config.chart_inverted||!config.chart_inverted&&!config.axis_y_inner,leftAxisClass=config.chart_inverted?CLASS.axisX:CLASS.axisY,leftAxis=$$.main.select("."+leftAxisClass).node(),svgRect=leftAxis&&hasLeftAxisRect?leftAxis.getBoundingClientRect():{right:0},chartRect=$$.selectChart.node().getBoundingClientRect(),hasArc=$$.hasArcType(),svgLeft=svgRect.right-chartRect.left-(hasArc?0:$$.getCurrentPaddingLeft(withoutRecompute));return svgLeft>0?svgLeft:0};top_chart_internal_fn.getAxisWidthByAxisId=function(id,withoutRecompute){var $$=this,position=$$.axis.getLabelPositionById(id);return $$.axis.getMaxTickWidth(id,withoutRecompute)+(position.isInner?0:40)};top_chart_internal_fn.getHorizontalAxisHeight=function(axisId){var $$=this,config=$$.config,h=17;if(axisId==="x"&&!config.xAxis_show){return 8}if(axisId==="x"&&config.axis_x_height){return config.axis_x_height}if(axisId==="y"&&!config.yAxis_show){return config.legend_enabled&&!$$.isLegendRight&&!config.legend_floating===true?10:1}if(axisId==="y2"&&!config.axis_y2_show){return $$.rotated_padding_top}if(axisId==="x"&&!config.chart_inverted&&config.axis_x_tick_rotate){h=30+$$.axis.getMaxTickWidth(axisId)*Math.cos(Math.PI*(90-config.axis_x_tick_rotate)/180)}return h+($$.axis.getLabelPositionById(axisId).isInner?0:10)+(axisId==="y2"?-10:0)};top_chart_internal_fn.getEventRectWidth=function(){var $$=this,length=$$.main.select(".TOP-axis-x").select("path.domain").node().getTotalLength(),tickInterval=$$.isCategorized()?$$.xAxis.tickInterval():$$.stacking?$$.xAxis.tickInterval():length/($$.tickValues.length?$$.tickValues.length:1);return Math.max(0,tickInterval)};top_chart_internal_fn.getShapeIndices=function(typeFilter){var $$=this,config=$$.config,indices={},i=0,j,k;$$.filterTargetsToShow($$.data.targets.filter(typeFilter,$$)).forEach(function(d){for(j in config.data_groups){if(config.data_groups[j].indexOf(d.id)<0){continue}for(k=0;k<config.data_groups[j].length;k++){if(config.data_groups[j][k]in indices){indices[d.id]=indices[config.data_groups[j][k]];break}}}if(isUndefined(indices[d.id])){indices[d.id]=i++}});indices.__max__=i-1;return indices};top_chart_internal_fn.getShapeX=function(offset,targetsNum,indices,isSub){var $$=this,scale=$$.x;return function(d){var index=d.id in indices?indices[d.id]:0;return d.x||d.x===0?scale(d.x)-offset*(targetsNum/2-index):0}};top_chart_internal_fn.getShapeY=function(isSub){var $$=this;return function(d){var scale=$$.getYScale(d.id);if($$.is3d)return scale(d.y);else if($$.isBoxplotType(d.id))return scale(d.upper);else return scale(d.value)}};top_chart_internal_fn.getShapeOffset=function(typeFilter,indices,isSub){var $$=this,targets=$$.orderTargets($$.filterTargetsToShow($$.data.targets.filter(typeFilter,$$))),targetIds=targets.map(function(t){return t.id});return function(d,i){var scale=$$.getYScale(d.id),y0=scale(0),offset=y0;if(i>d.x)i=d.x;targets.forEach(function(t){var index=-1,values=$$.isStepType(d)?$$.convertValuesToStep(t.values):t.values;values.forEach(function(v){if(v.x.constructor===Date){var dx=d.x.constructor===Date?d.x.getTime():d.x;if(v.x.getTime()===dx)index=values.indexOf(v)}else{if(v.x===d.x)index=values.indexOf(v)}});if(t.id===d.id||indices[t.id]!==indices[d.id]){return}if(targetIds.indexOf(t.id)<targetIds.indexOf(d.id)){if(values[index]&&values[index].value*d.value>=0){offset+=scale(values[index].value)-y0}}});return offset}};top_chart_internal_fn.isWithinShape=function(that,d){var $$=this,shape=$$.d3.select(that),isWithin;if(!$$.isTargetToShow(d.id)){isWithin=false}else if(that.nodeName==="circle"){isWithin=$$.isStepType(d)?$$.isWithinStep(that,$$.getYScale(d.id)(d.value)):$$.isWithinCircle(that,$$.pointSelectR(d)*1.5)}else if(that.nodeName==="path"){isWithin=shape.classed(CLASS.bar)?$$.isWithinBar(that):true}return isWithin};top_chart_internal_fn.getInterpolate=function(d){var $$=this;return $$.isSplineType(d)?"monotone":$$.isStepType(d)?$$.config.line_step_type:"linear"};top_chart_internal_fn.initThreshold=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.threshold)};top_chart_internal_fn.updateThreshold=function(){var $$=this,config=$$.config;var threshold,thresholdY;var scale=$$.getYScale("y");var color=config.yAxis_threshold_color;thresholdY=scale(config.yAxis_threshold_value);threshold=$$.main.select("."+CLASS.chart).selectAll("."+CLASS.threshold);threshold.select("."+CLASS.thresholdLine).remove();threshold.append("line").attr("class",CLASS.thresholdLine);threshold.select("."+CLASS.thresholdLine).attr("x1",config.chart_inverted?thresholdY:0).attr("x2",config.chart_inverted?thresholdY:$$.width).attr("y1",config.chart_inverted?0:thresholdY).attr("y2",config.chart_inverted?$$.height:thresholdY).style("stroke",color)};top_chart_internal_fn.initLine=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartLines)};top_chart_internal_fn.initBubble=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartBubbles)};top_chart_internal_fn.initBoxplot=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartBoxplots)};top_chart_internal_fn.initScatter=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartScatters)};top_chart_internal_fn.updateTargetsForScatter=function(targets){var $$=this,config=$$.config,mainScatterUpdate,mainScatterEnter,classScatters=$$.classScatters.bind($$),classChartScatter=$$.classChartScatter.bind($$);mainScatterUpdate=$$.main.select("."+CLASS.chartScatters).selectAll("."+CLASS.chartScatter).data(targets).attr("class",function(d){return classChartScatter(d)});mainScatterEnter=mainScatterUpdate.enter().append("g").attr("class",classChartScatter).style("opacity",0).style("pointer-events","none").style("position","relative").style("cursor","pointer");mainScatterEnter.append("g").attr("class",classScatters)};top_chart_internal_fn.updateTargetsForBubble=function(targets){var $$=this,config=$$.config,mainBubbleUpdate,mainBubbleEnter,classBubbles=$$.classBubbles.bind($$),classChartBubble=$$.classChartBubble.bind($$);mainBubbleUpdate=$$.main.select("."+CLASS.chartBubbles).selectAll("."+CLASS.chartBubble).data(targets).attr("class",function(d){return classChartBubble(d)});mainBubbleEnter=mainBubbleUpdate.enter().append("g").attr("class",classChartBubble).style("opacity",0).style("pointer-events","none").style("position","relative").style("cursor","pointer");mainBubbleEnter.append("g").attr("class",classBubbles)};top_chart_internal_fn.updateTargetsForLine=function(targets){var $$=this,config=$$.config,mainLineUpdate,mainLineEnter,classChartLine=$$.classChartLine.bind($$),classLines=$$.classLines.bind($$),classAreas=$$.classAreas.bind($$),classCircles=$$.classCircles.bind($$),classSelectedCircles=$$.classSelectedCircles.bind($$),classFocus=$$.classFocus.bind($$);mainLineUpdate=$$.main.select("."+CLASS.chartLines).selectAll("."+CLASS.chartLine).data(targets).attr("class",function(d){return classChartLine(d)+classFocus(d)});mainLineEnter=mainLineUpdate.enter().append("g").attr("class",classChartLine).style("opacity",0).style("pointer-events","none").style("position","relative");mainLineUpdate.exit().remove();mainLineEnter.append("g").attr("class",classLines);mainLineEnter.append("g").attr("class",classAreas);mainLineEnter.append("g").attr("class",classSelectedCircles);mainLineEnter.append("g").attr("class",classCircles).style("cursor",function(d){return config.data_selection_isselectable(d)?"pointer":null});if($$.hasMarker())mainLineEnter.append("g").attr("class","TOP-markers");$$.main.selectAll("."+CLASS.lines).data(targets);$$.main.selectAll("."+CLASS.areas).data(targets);$$.main.selectAll("."+CLASS.circles).data(targets);$$.main.selectAll("."+CLASS.selectedCircles).data(targets)};top_chart_internal_fn.updateLine=function(durationForExit){var $$=this;$$.mainLine=$$.main.selectAll("."+CLASS.lines).selectAll("."+CLASS.line).data($$.lineData.bind($$));$$.mainLine.enter().append("path").attr("class",$$.classLine.bind($$)).style("stroke-width",function(d){return d.lineWidth});$$.mainLine.style("opacity",$$.initialOpacity.bind($$)).style("shape-rendering",function(d){return $$.isStepType(d)?"crispEdges":""}).attr("transform",null);$$.mainLine.exit().transition().duration(durationForExit).style("opacity",0).remove()};top_chart_internal_fn.redrawLine=function(drawLine,withTransition){var $$=this,color=function(d){return $$.color(d.id)[0]};return[(withTransition?this.mainLine.transition():this.mainLine).attr("d",drawLine).style("stroke",color).style("opacity",1)]};top_chart_internal_fn.generateDrawLine=function(lineIndices,isSub){var $$=this,config=$$.config,line=$$.d3.svg.line(),getPoints=$$.generateGetLinePoints(lineIndices,isSub),yScaleGetter=$$.getYScale,xValue=function(d){return $$.xx.call($$,d)},yValue=function(d,i){return Object.keys(config.data_groups).length>0?getPoints(d,i)[0][1]:$$.is3d?yScaleGetter.call($$,d.id)(d.y):yScaleGetter.call($$,d.id)(d.value)};line=config.chart_inverted?line.x(yValue).y(xValue):line.x(xValue).y(yValue);if(!config.line_connectNull){line=line.defined(function(d){return d.value!=null})}return function(d){var values=config.line_connectNull?$$.filterRemoveNull(d.values):d.values,x=isSub?$$.x:$$.subX,y=yScaleGetter.call($$,d.id),x0=0,y0=0,path;if($$.isLineType(d)){if(config.data_regions[d.id]){path=$$.lineWithRegions(values,x,y,config.data_regions[d.id])}else{if($$.isStepType(d)){values=$$.convertValuesToStep(values)}path=line.interpolate($$.getInterpolate(d))(values)}}else{if(values[0]){x0=x(values[0].x);if($$.is3d)y0=y(values[0].y);else y0=y(values[0].value)}path=config.chart_inverted?"M "+y0+" "+x0:"M "+x0+" "+y0}return path?path:"M 0 0"}};top_chart_internal_fn.generateGetLinePoints=function(lineIndices,isSub){var $$=this,config=$$.config,lineTargetsNum=lineIndices.__max__+1,x=$$.getShapeX(0,lineTargetsNum,lineIndices,!!isSub),y=$$.getShapeY(!!isSub),lineOffset=$$.getShapeOffset($$.isLineType,lineIndices,!!isSub),yScale=$$.getYScale;return function(d,i){if(!$$.positionMap[d.id]){$$.positionMap[d.id]={}}var y0=yScale.call($$,d.id)(0),offset=lineOffset(d,i)||y0,posX=x(d),posY=y(d);var posInfoY=posY-(y0-offset);var positionInfo={x:posX,y:posInfoY};if($$.positionMap[d.id]){$$.positionMap[d.id][d.x]=positionInfo}if(config.chart_inverted){if(0<d.value&&posY<y0||d.value<0&&y0<posY){posY=y0}}return[[posX,posY-(y0-offset)],[posX,posY-(y0-offset)],[posX,posY-(y0-offset)],[posX,posY-(y0-offset)]]}};top_chart_internal_fn.lineWithRegions=function(d,x,y,_regions){var $$=this,config=$$.config,prev=-1,i,j,s="M",sWithRegion,xp,yp,dx,dy,dd,diff,diffx2,xOffset=$$.isCategorized()?.5:0,xValue,yValue,regions=[];function isWithinRegions(x,regions){var i;for(i=0;i<regions.length;i++){if(regions[i].start<x&&x<=regions[i].end){return true}}return false}if(isDefined(_regions)){for(i=0;i<_regions.length;i++){regions[i]={};if(isUndefined(_regions[i].start)){regions[i].start=d[0].x}else{regions[i].start=$$.isTimeSeries()?$$.parseDate(_regions[i].start):_regions[i].start}if(isUndefined(_regions[i].end)){regions[i].end=d[d.length-1].x}else{regions[i].end=$$.isTimeSeries()?$$.parseDate(_regions[i].end):_regions[i].end}}}xValue=config.chart_inverted?function(d){return y(d.value)}:function(d){return x(d.x)};yValue=config.chart_inverted?function(d){return x(d.x)}:function(d){return y(d.value)};function generateM(points){return"M"+points[0][0]+" "+points[0][1]+" "+points[1][0]+" "+points[1][1]}if($$.isTimeSeries()){sWithRegion=function(d0,d1,j,diff){var x0=d0.x.getTime(),x_diff=d1.x-d0.x,xv0=new Date(x0+x_diff*j),xv1=new Date(x0+x_diff*(j+diff)),points;if(config.chart_inverted){points=[[y(yp(j)),x(xv0)],[y(yp(j+diff)),x(xv1)]]}else{points=[[x(xv0),y(yp(j))],[x(xv1),y(yp(j+diff))]]}return generateM(points)}}else{sWithRegion=function(d0,d1,j,diff){var points;if(config.chart_inverted){points=[[y(yp(j),true),x(xp(j))],[y(yp(j+diff),true),x(xp(j+diff))]]}else{points=[[x(xp(j),true),y(yp(j))],[x(xp(j+diff),true),y(yp(j+diff))]]}return generateM(points)}}for(i=0;i<d.length;i++){if(isUndefined(regions)||!isWithinRegions(d[i].x,regions)){s+=" "+xValue(d[i])+" "+yValue(d[i])}else{xp=$$.getScale(d[i-1].x+xOffset,d[i].x+xOffset,$$.isTimeSeries());yp=$$.getScale(d[i-1].value,d[i].value);dx=x(d[i].x)-x(d[i-1].x);dy=y(d[i].value)-y(d[i-1].value);dd=Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2));diff=2/dd;diffx2=diff*2;for(j=diff;j<=1;j+=diffx2){s+=sWithRegion(d[i-1],d[i],j,diff)}}prev=d[i].x}return s};top_chart_internal_fn.updateArea=function(durationForExit){var $$=this,d3=$$.d3,color=function(d){return $$.color(d.id)[0]};$$.mainArea=$$.main.selectAll("."+CLASS.areas).selectAll("."+CLASS.area).data($$.lineData.bind($$));$$.mainArea.enter().append("path").attr("class",$$.classArea.bind($$)).style("fill",color).style("opacity",function(d){return d.opacity||null});$$.mainArea.exit().transition().duration(durationForExit).style("opacity",0).remove()};top_chart_internal_fn.redrawArea=function(drawArea,withTransition){return[(withTransition?this.mainArea.transition():this.mainArea).attr("d",drawArea)]};top_chart_internal_fn.generateDrawArea=function(areaIndices,isSub){var $$=this,config=$$.config,area=$$.d3.svg.area(),getPoints=$$.generateGetAreaPoints(areaIndices,isSub),yScaleGetter=$$.getYScale,xValue=function(d){return $$.xx.call($$,d)},value0=function(d,i){return Object.keys(config.data_groups).length>0?getPoints(d,i)[0][1]:yScaleGetter.call($$,d.id)($$.getAreaBaseValue(d.id))},value1=function(d,i){return Object.keys(config.data_groups).length>0?getPoints(d,i)[1][1]:yScaleGetter.call($$,d.id)(d.value)};area=config.chart_inverted?area.x0(value0).x1(value1).y(xValue):area.x(xValue).y0(value0).y1(value1);if(!config.line_connectNull){area=area.defined(function(d){return d.value!==null})}return function(d){var values=config.line_connectNull?$$.filterRemoveNull(d.values):d.values,x0=0,y0=0,path;if($$.isAreaType(d)){if($$.isStepType(d)){values=$$.convertValuesToStep(values)}path=area.interpolate($$.getInterpolate(d))(values)}else{if(values[0]){x0=$$.x(values[0].x);y0=$$.getYScale(d.id)(values[0].value)}path=config.chart_inverted?"M "+y0+" "+x0:"M "+x0+" "+y0}return path?path:"M 0 0"}};top_chart_internal_fn.getAreaBaseValue=function(){return 0};top_chart_internal_fn.generateGetAreaPoints=function(areaIndices,isSub){var $$=this,config=$$.config,areaTargetsNum=areaIndices.__max__+1,x=$$.getShapeX(0,areaTargetsNum,areaIndices,!!isSub),y=$$.getShapeY(!!isSub),areaOffset=$$.getShapeOffset($$.isAreaType,areaIndices,!!isSub),yScale=$$.getYScale;return function(d,i){var y0=yScale.call($$,d.id)(0),offset=areaOffset(d,i)||y0,posX=x(d),posY=y(d);if(config.chart_inverted){if(0<d.value&&posY<y0||d.value<0&&y0<posY){posY=y0}}return[[posX,offset],[posX,posY-(y0-offset)],[posX,posY-(y0-offset)],[posX,offset]]}};top_chart_internal_fn.initEqualizer=function(){var $$=this,row,column;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartEqualizers)};top_chart_internal_fn.updateTargetsForEqualizer=function(targets){var $$=this,config=$$.config,mainEqualizerUpdate,mainEqualizerEnter,classChartEqualizer=$$.classChartEqualizer.bind($$);mainEqualizerUpdate=$$.main.select("."+CLASS.chartEqualizers).selectAll("."+CLASS.chartEqualizer).data(targets).text(function(d){return});mainEqualizerUpdate.exit().remove();mainEqualizerEnter=mainEqualizerUpdate.enter().append("g").attr("class",classChartEqualizer)};top_chart_internal_fn.updateEqualizer=function(durationForExit){var $$=this,classEqualizer=$$.classEqualizer.bind($$),equalizerData=$$.equalizerData.bind($$),eqIndices=$$.getShapeIndices($$.isEqualizerType);var eq_padding=2,w=$$.getEqBlockWidth(),h=$$.getEqBlockHeight(),xOffset=$$.xAxis.tickOffset(),yOffset=h;if(!$$.data.targets[0].values)return;var backgroundData=function(){var data=[],xIndex=0,yValue=0,rowLength=$$.data.targets[0].values.length,columnLength=$$.y.domain(),yAxisTickValues=$$.getPureYAxisTickValues(),yAxisBlockValues=[],tickDivision=$$.getYTickDivision();for(var i=0;i<yAxisTickValues.length-1;i++){var m=tickDivision,d=(yAxisTickValues[i+1]-yAxisTickValues[i])/m,betweenTick=yAxisTickValues[i]+d;while(betweenTick<yAxisTickValues[i+1]){yAxisBlockValues.push(betweenTick);betweenTick+=d}}yAxisBlockValues=yAxisBlockValues.concat(yAxisTickValues);yAxisBlockValues=yAxisBlockValues.slice().sort(function(a,b){return a-b}).reduce(function(a,b){if(a.slice(-1)[0]!==b)a.push(b);return a},[]);for(var row=0;row<$$.data.targets[0].values.length;row++){data.push([]);for(var column=0;column<yAxisBlockValues.length;column++){data[row].push({x:row,y:$$.data.targets[0].values[row].value,block:yAxisBlockValues[column]})}}return data}();$$.mainEqualizer=$$.main.selectAll("."+CLASS.chartEqualizer).selectAll("."+CLASS.equalizer).data(backgroundData);
$$.mainEqualizer.exit().transition().duration(durationForExit).remove();var columns=$$.mainEqualizer.enter().append("g").attr("class",classEqualizer).data(backgroundData).style("stroke-width",$$.getEqPadding()).style("stroke","white").style("fill","#f1f1f1");var rows=columns.selectAll("."+CLASS.equalizer).data(function(d){return d}).enter().append("rect");$$.main.selectAll("."+CLASS.chartEqualizer).selectAll("."+CLASS.equalizer).selectAll("rect").attr("width",$$.getEqBlockWidth()).attr("height",$$.getEqBlockHeight()).attr("x",function(d){return $$.x(d.x)-xOffset}).attr("y",function(d){return $$.y(d.block)})};top_chart_internal_fn.redrawEqualizer=function(withTransition){var $$=this,thresholds=$$.getEqThresholds(),eqColor=$$.generateEqColor();var generateBlockColor=function(value){for(var i=0;i<thresholds.length-1;i++){if(value>thresholds[i]&&value<=thresholds[i+1]){return eqColor[i]}}};return[(withTransition?this.mainEqualizer.selectAll("rect").transition():this.mainEqualizer.selectAll("rect")).style("fill",function(d){return d.y>=d.block?generateBlockColor(d.block):"#f1f1f1"})]};top_chart_internal_fn.generateEqColor=function(){var thresholds=this.getEqThresholds();var eqColor;if(notEmpty(this.config.colors)){while(this.config.colors.length<thresholds.length){this.config.colors=this.config.colors.concat(this.config.colors)}return this.config.colors}else{eqColor=[];for(var i=0;i<thresholds.length;i++){eqColor.push(this.color(thresholds[i])[0])}return eqColor}};top_chart_internal_fn.getEqPadding=function(){return this.config.eq_padding||4};top_chart_internal_fn.getYTickDivision=function(){return this.config.yAxis_tick_division||4};top_chart_internal_fn.getEqBlockWidth=function(axis){var $$=this,divideCnt;divideCnt=$$.xAxis.tickCount();return $$.xAxis.pixelLength()/divideCnt};top_chart_internal_fn.getEqBlockHeight=function(axis){var $$=this;return $$.yAxis.pixelLength()/($$.yAxis.tickCount()-1)/$$.getYTickDivision()};top_chart_internal_fn.getEqThresholds=function(){return this.config.yAxis_tick_thresholds||this.getPureYAxisTickValues()};top_chart_internal_fn.getPureYAxisTickValues=function(){return this.yAxis.tickValues().slice().sort(function(a,b){return a-b}).reduce(function(a,b){if(a.slice(-1)[0]!==b)a.push(b);return a},[])};top_chart_internal_fn.updateBubble=function(durationForExit){var $$=this,color=function(d){return $$.color(d.id)[0]};$$.mainBubble=$$.main.selectAll("."+CLASS.bubbles).selectAll("circle").data($$.bubbleData.bind($$));$$.mainBubble.style("fill",color).style("stroke",color).style("opacity",.6).attr("r",function(d){return d.z}).style("display",function(d){if(d.value!==null){return}else{return"none"}}).attr("class",$$.classBubble.bind($$));$$.mainBubble.exit().remove();$$.mainBubble.enter().append("circle").style("fill",color).style("stroke",color).style("opacity",.6).attr("r",function(d){return d.z}).style("display",function(d){if(d.z!==null){return}else{return"none"}}).attr("class",$$.classBubble.bind($$))};top_chart_internal_fn.redrawBubble=function(cx,cy,withTransition,forShift){var $$=this;var transition=forShift?$$.mainBubble.transition().duration(10):$$.mainBubble.transition();return[(withTransition?transition:this.mainBubble).attr("transform",function(d){return"translate("+cx(d)+","+cy(d)+")"})]};top_chart_internal_fn.updateTargetsForBoxplot=function(targets){var $$=this,config=$$.config,mainBoxplotUpdate,mainBoxplotEnter,classChartBoxplot=$$.classChartBoxplot.bind($$),classBoxplots=$$.classBoxplots.bind($$),classFocus=$$.classFocus.bind($$);mainBoxplotUpdate=$$.main.select("."+CLASS.chartBoxplots).selectAll("."+CLASS.chartBoxplot).data(targets).attr("class",function(d){return classChartBoxplot(d)+classFocus(d)});mainBoxplotEnter=mainBoxplotUpdate.enter().append("g").attr("class",classChartBoxplot).style("opacity",0).style("pointer-events","none");mainBoxplotUpdate.exit().remove();mainBoxplotEnter.append("g").attr("class",classBoxplots);$$.main.selectAll("."+CLASS.Boxplots).data(targets)};top_chart_internal_fn.updateBoxplot=function(durationForExit){var $$=this,config=$$.config,color=function(d){return $$.color(d.id)[0]};var boxplotIndices=$$.getShapeIndices($$.isBoxplotType);$$.mainBoxplot=$$.main.selectAll("."+CLASS.boxplots).selectAll("g").data($$.boxplotData.bind($$));$$.mainBoxplot.attr("class",$$.classBoxplot.bind($$));$$.mainBoxplot.exit().remove();$$.mainBoxplot.enter().append("g").attr("class",$$.classBoxplot.bind($$));$$.mainBoxplot.selectAll("line").remove();$$.mainBoxplot.selectAll("path").remove();$$.mainBoxplot.append("path").attr("class","TOP-boxplot-whisker").style("fill",color).style("stroke",color);$$.mainBoxplot.append("path").attr("class","TOP-boxplot-stem").style("fill",color).style("stroke",color);$$.mainBoxplot.append("path").attr("class","TOP-boxplot-box").style("stroke",color).style("stroke-width","2px");$$.mainBoxplot.append("path").attr("class","TOP-boxplot-box-background").style("fill",color).style("stroke-width",0).style("opacity",.6);$$.mainBoxplot.append("path").attr("class","TOP-boxplot-median").style("fill",color).style("stroke",color)};top_chart_internal_fn.redrawBoxplot=function(withTransition){var $$=this;var boxplotIndices=$$.getShapeIndices($$.isBoxplotType);var mainBoxplot=withTransition?$$.mainBoxplot.transition():$$.mainBoxplot;return[$$.mainBoxplot.selectAll(".TOP-boxplot-box").attr("d",$$.generateDrawBoxplotBox(boxplotIndices)),$$.mainBoxplot.selectAll(".TOP-boxplot-box-background").attr("d",$$.generateDrawBoxplotBox(boxplotIndices)),$$.mainBoxplot.selectAll(".TOP-boxplot-median").attr("d",$$.generateDrawBoxplotMedian(boxplotIndices)),$$.mainBoxplot.selectAll(".TOP-boxplot-whisker").attr("d",$$.generateDrawBoxplotWhisker(boxplotIndices)),$$.mainBoxplot.selectAll(".TOP-boxplot-stem").attr("d",$$.generateDrawBoxplotStem(boxplotIndices))]};top_chart_internal_fn.getBoxplotW=function(axis,barTargetsNum){var $$=this,config=$$.config,length=$$.main.select(".TOP-axis-x").select("path.domain").node().getTotalLength(),tickInterval=$$.isCategorized()?axis.tickInterval():$$.stacking?axis.tickInterval():length/($$.tickValues.length?$$.tickValues.length:1),w=typeof config.chart_bar_width==="number"?config.chart_bar_width:barTargetsNum?tickInterval*config.bar_width_ratio/barTargetsNum:0;return config.bar_width_max&&w>config.bar_width_max?config.bar_width_max:w};top_chart_internal_fn.updateScatter=function(durationForExit){var $$=this,color=function(d){return $$.color(d.id)[0]};$$.mainScatter=$$.main.selectAll("."+CLASS.scatters).selectAll("path").data($$.scatterData.bind($$));$$.mainScatter.attr("d",$$.generateScatter.bind($$)).style("fill",color).style("stroke",color).style("opacity",.8).style("display",function(d){if(d.value!==null){return}else{return"none"}}).attr("class",$$.classScatter.bind($$));$$.mainScatter.exit().remove();$$.mainScatter.enter().append("path").attr("d",$$.generateScatter.bind($$)).style("fill",color).style("stroke",color).style("opacity",.8).style("display",function(d){if(d.value!==null){return}else{return"none"}}).attr("class",$$.classScatter.bind($$))};top_chart_internal_fn.redrawScatter=function(cx,cy,withTransition,forShift){var $$=this,selectedScatters=this.main.selectAll("."+CLASS.selectedScatter);var transition=forShift?$$.mainScatter.transition().duration(10):$$.mainScatter.transition();return[(withTransition?transition:this.mainScatter).attr("transform",function(d){return"translate("+(cx(d)-3.5)+","+(cy(d)-3.5)+")"})]};top_chart_internal_fn.generateScatter=function(){return"M0 4 L0 3 L7 3 L7 4 M3 0 L4 0 L4 7 L3 7 M2 5 L2 2 L5 2 L5 5 Z"};top_chart_internal_fn.generateSelectedScatter=function(){return"M0 4 L0 3 L7 3 L7 4 M3 0 L4 0 L4 7 L3 7 M2 5 L2 2 L5 2 L5 5 Z"};top_chart_internal_fn.updateCircle=function(durationForExit){var $$=this,marker,circleGroup,expandedCircle,mainCircleGroupEnter,markerOption,color=function(d){return $$.color(d.id)[0]};$$.mainCircleGroup=$$.main.selectAll("."+CLASS.circles);$$.mainCircleGroup.selectAll("circle").remove();$$.mainCircle=$$.mainCircleGroup.append("circle").attr("class",$$.classCircle.bind($$)).attr("r",function(d){markerOption=d3.select(this.parentNode.parentNode).datum().marker;return 0}).style("fill",color).style("stroke",function(d){markerOption=d3.select(this.parentNode.parentNode).datum().marker;return undefined}).style("stroke-width",function(d){markerOption=d3.select(this.parentNode.parentNode).datum().marker;return 0}).style("opacity",$$.initialOpacityForCircle.bind($$));$$.expandedCircle=$$.mainCircleGroup.append("circle").attr("class",$$.classCircleExpanded.bind($$)).attr("r",11.5).style("fill",color).style("opacity",0);$$.main.selectAll("."+CLASS.selectedCircles).selectAll("circle").remove();$$.selectedCircles=$$.main.selectAll("."+CLASS.selectedCircles).selectAll("circle").data($$.linePointData.bind($$));$$.selectedCircle=$$.selectedCircles.enter().append("circle");$$.selectedCircle.attr("class",$$.classSelectedCircle.bind($$))};top_chart_internal_fn.redrawCircle=function(cx,cy,withTransition){var $$=this;var selectedCircles=this.main.selectAll("."+CLASS.selectedCircle);return[(withTransition?selectedCircles.transition():selectedCircles).attr("cx",cx).attr("cy",cy)]};top_chart_internal_fn.circleX=function(d){return d.x||d.x===0?this.x(d.x):null};top_chart_internal_fn.updateCircleY=function(){var $$=this,lineIndices,getPoints;$$.positionMap={};if(Object.keys($$.config.data_groups).length>0){lineIndices=$$.getShapeIndices($$.isLineType),getPoints=$$.generateGetLinePoints(lineIndices,false);$$.circleY=function(d,i){return getPoints(d,i)[0][1]}}else{$$.circleY=function(d){return $$.getYScale(d.id)(d.value)}}};top_chart_internal_fn.getMarkers=function(i,id){var $$=this;return(id?$$.main.selectAll("."+CLASS.target+$$.getTargetSelectorSuffix(id)):$$.main).selectAll(".TOP-markers").selectAll("."+CLASS.marker+(isValue(i)?"-"+i:""))};top_chart_internal_fn.getCircles=function(i,id){var $$=this;return(id?$$.main.selectAll("."+CLASS.circles+$$.getTargetSelectorSuffix(id)):$$.main).selectAll("."+CLASS.circle+(isValue(i)?"-"+i:""))};top_chart_internal_fn.getCircleGroup=function(id){var $$=this;return id?$$.main.select("."+CLASS.circles+$$.getTargetSelectorSuffix(id)):$$.main};top_chart_internal_fn.getCircleGroups=function(i,id){var $$=this;return(id?$$.main.selectAll("."+CLASS.circles+$$.getTargetSelectorSuffix(id)):$$.main).selectAll("."+CLASS.circleGroup+(isValue(i)?"-"+i:""))};top_chart_internal_fn.expandCircles=function(i,id,reset){var $$=this,r=$$.pointExpandedR.bind($$),cx,cy,outerColor,color=function(d){return $$.color(d.id)[0]};if(reset){$$.unexpandCircles()}if(!id||!$$.isLineType(id))return;var cx=$$.positionMap[id][i].x;var cy=$$.positionMap[id][i].y;$$.getCircleGroup(id).select(".TOP-circle").classed(CLASS.EXPANDED,true).attr("r",r).attr("cx",cx).attr("cy",cy).style("stroke-width",4).style("opacity",1).style("stroke",color).style("fill","#fff");$$.getCircleGroup(id).select(".TOP-circle-expanded").attr("cx",cx).attr("cy",cy).style("opacity",.2);if($$.hasMarker()){if($$.getMarkers(i,id)[0]&&$$.getMarkers(i,id)[0].length){$$.getMarkers(i,id).classed(CLASS.EXPANDED,true).style("opacity",0)}}};top_chart_internal_fn.unexpandCircles=function(i){var $$=this,r=$$.pointR.bind($$),marker,markerOption,color=function(d){return $$.color(d.id)[0]};$$.main.selectAll(".TOP-circle").classed(CLASS.EXPANDED,false).attr("r",0).style("fill",color).style("stroke",function(d){return undefined}).style("stroke-width",function(d){return 0});$$.main.selectAll(".TOP-circle-expanded").style("opacity",0);if($$.hasMarker()){if($$.getMarkers(i)[0]&&$$.getMarkers(i)[0].length){$$.getMarkers(i).classed(CLASS.EXPANDED,false).style("opacity",1)}}};top_chart_internal_fn.updateMarker=function(durationForExit){var $$=this,config=$$.config;var color=function(d){return $$.color(d.id)[0]};$$.mainMarker=$$.main.selectAll(".TOP-markers").selectAll("path").data($$.linePointData.bind($$));$$.mainMarker.enter().append("path").attr("d",d3.svg.symbol().type(function(d,i){return $$.findMarkerInfo(d.id,"shape")}).size(function(d,i){return $$.findMarkerInfo(d.id,"size")})).style("fill",function(d,i){if($$.findMarkerInfo(d.id,"fill")){if($$.findMarkerInfo(d.id,"color")){return $$.findMarkerInfo(d.id,"color")}else{return color(d)}}else{return"#fff"}}).style("display",function(d,i){if($$.findMarkerInfo(d.id,"size"))return"block";else return"none"}).style("stroke-width",2).style("stroke",function(d,i){if($$.findMarkerInfo(d.id,"color"))return $$.findMarkerInfo(d.id,"color");else return color(d)}).style("opacity",1);$$.mainMarker.attr("class",$$.classMarker.bind($$));$$.mainMarker.exit().transition().duration(durationForExit).remove()};top_chart_internal_fn.redrawMarker=function(cx,cy,withTransition,forShift){var $$=this;var transition=forShift?$$.mainMarker.transition().duration(10):$$.mainMarker.transition();return[(withTransition?transition:$$.mainMarker).attr("transform",function(d){return"translate("+cx(d)+","+cy(d)+")"})]};top_chart_internal_fn.findMarkerInfo=function(id,key){var $$=this,config=$$.config;var info;if(key==="shape"){for(var i=0;i<config.series.length;i++){if(!info&&config.series[i].marker)info="dot";if(config.series[i].name===id&&config.series[i].marker){info=config.series[i].marker.shape}}}else if(key==="size"){for(var i=0;i<config.series.length;i++){if(config.series[i].name===id&&config.series[i].marker){info=config.series[i].marker.size;if(!config.series[i].marker.size&&config.series[i].marker.size!==0&&(config.series[i].marker.shape==="dot"||!config.series[i].marker.shape)){info=10}if(info===undefined)info=100}if(config.series[i].name===id&&!config.series[i].marker){info=0}}}else if(key==="color"){for(var i=0;i<config.series.length;i++){if(config.series[i].name===id&&config.series[i].marker){info=config.series[i].marker.color}}}else if(key==="fill"){for(var i=0;i<config.series.length;i++){if(config.series[i].name===id&&config.series[i].marker){info=config.series[i].marker.fill}}}return info};top_chart_internal_fn.pointR=function(d){var $$=this,config=$$.config;return $$.isStepType(d)?0:config.point_r};top_chart_internal_fn.pointExpandedR=function(d){var $$=this,config=$$.config;return config.point_focus_expand_enabled?config.point_focus_expand_r?config.point_focus_expand_r:$$.pointR(d)*1.75:$$.pointR(d)};top_chart_internal_fn.pointSelectR=function(d){var $$=this,config=$$.config;return config.point_select_r?config.point_select_r:$$.pointR(d)*4};top_chart_internal_fn.isWithinCircle=function(that,r){var d3=this.d3,mouse=d3.mouse(that),d3_this=d3.select(that),cx=+d3_this.attr("cx"),cy=+d3_this.attr("cy");return Math.sqrt(Math.pow(cx-mouse[0],2)+Math.pow(cy-mouse[1],2))<r};top_chart_internal_fn.isWithinStep=function(that,y){return Math.abs(y-this.d3.mouse(that)[1])<30};top_chart_internal_fn.initBar=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartBars)};top_chart_internal_fn.updateTargetsForBar=function(targets){var $$=this,config=$$.config,mainBarUpdate,mainBarEnter,classChartBar=$$.classChartBar.bind($$),classBars=$$.classBars.bind($$),classFocus=$$.classFocus.bind($$);mainBarUpdate=$$.main.select("."+CLASS.chartBars).selectAll("."+CLASS.chartBar).data(targets).attr("class",function(d){return classChartBar(d)+classFocus(d)});mainBarEnter=mainBarUpdate.enter().append("g").attr("class",classChartBar).style("opacity",0).style("pointer-events","none");mainBarUpdate.exit().remove();mainBarEnter.append("g").attr("class",classBars).style("cursor",function(d){return config.data_selection_isselectable(d)?"pointer":null});$$.main.selectAll("."+CLASS.bars).data(targets)};top_chart_internal_fn.updateBar=function(durationForExit){var $$=this,barData=$$.barData.bind($$),classBar=$$.classBar.bind($$),initialOpacity=$$.initialOpacity.bind($$),color=function(d){return $$.color(d.id)[1]};$$.mainBar=$$.main.selectAll("."+CLASS.bars).selectAll("."+CLASS.bar).data(barData);$$.mainBar.attr("class",classBar).style("stroke",color).style("fill",color);$$.mainBar.enter().append("path").attr("class",classBar).style("stroke",color).style("fill",color);$$.mainBar.style("opacity",initialOpacity);$$.mainBar.exit().transition().duration(durationForExit).style("opacity",0).remove()};top_chart_internal_fn.redrawBar=function(drawBar,withTransition){var $$=this,color=function(d){return $$.color(d.id)[1]};return[(withTransition?this.mainBar.transition():this.mainBar).attr("d",drawBar).style("fill",color).style("opacity",1)]};top_chart_internal_fn.getBarW=function(axis,barTargetsNum){var $$=this,config=$$.config,length=$$.main.select(".TOP-axis-x").select("path.domain").node().getTotalLength(),tickInterval=$$.isCategorized()?axis.tickInterval():$$.stacking?axis.tickInterval():length/($$.tickValues.length?$$.tickValues.length:1),w=typeof config.chart_bar_width==="number"?config.chart_bar_width:barTargetsNum?tickInterval*config.bar_width_ratio/barTargetsNum:0;return config.bar_width_max&&w>config.bar_width_max?config.bar_width_max:w};top_chart_internal_fn.getBars=function(i,id){var $$=this;return(id?$$.main.selectAll("."+CLASS.bars+$$.getTargetSelectorSuffix(id)):$$.main).selectAll("."+CLASS.bar+(isValue(i)?"-"+i:""))};top_chart_internal_fn.expandBars=function(i,id,reset){var $$=this;if(reset){$$.unexpandBars()}$$.getBars(i,id).classed(CLASS.EXPANDED,true)};top_chart_internal_fn.unexpandBars=function(i){var $$=this;$$.getBars(i).classed(CLASS.EXPANDED,false)};top_chart_internal_fn.generateDrawBar=function(barIndices,isSub){var $$=this,config=$$.config,getPoints=$$.generateGetBarPoints(barIndices,isSub);return function(d,i){var points=getPoints(d,i);var indexX=config.chart_inverted?1:0;var indexY=config.chart_inverted?0:1;if(d.value===0||$$.stacking==="percent"&&d.value<1){var zeroPoint=config.bar_showZero?2:0;if(!config.chart_inverted){points[1][indexY]=points[1][indexY]-zeroPoint;points[2][indexY]=points[2][indexY]-zeroPoint}else{points[1][indexX]=points[1][indexX]+zeroPoint;points[2][indexX]=points[2][indexX]+zeroPoint}}var path="M "+points[0][indexX]+","+points[0][indexY]+" "+"L"+points[1][indexX]+","+points[1][indexY]+" "+"L"+points[2][indexX]+","+points[2][indexY]+" "+"L"+points[3][indexX]+","+points[3][indexY]+" "+"z";return path}};top_chart_internal_fn.generateGetBarPoints=function(barIndices,isSub){var $$=this,config=$$.config,axis=$$.xAxis,barTargetsNum=barIndices.__max__+1,barW=$$.getBarW(axis,barTargetsNum),barX=$$.getShapeX(barW,barTargetsNum,barIndices,!!isSub),barY=$$.getShapeY(!!isSub),barOffset=$$.getShapeOffset($$.isBarType,barIndices,!!isSub),yScale=$$.getYScale;return function(d,i){var y0=yScale.call($$,d.id)(0),offset=barOffset(d,i)||y0,posX=barX(d),posY=barY(d);if($$.config.chart_inverted){if(0<d.value&&posY<y0||d.value<0&&y0<posY){posY=y0}}var barInterval=config.bar_zeroInterval?0:barW/6;return[[posX+barInterval,offset],[posX+barInterval,posY-(y0-offset)],[posX+barW-barInterval,posY-(y0-offset)],[posX+barW-barInterval,offset]]}};top_chart_internal_fn.isWithinBar=function(that){var mouse=this.d3.mouse(that),box=this.getPathBox(that),offset=0,sx=box.x-offset,ex=box.x+box.width+offset,sy=box.y+box.height+offset,ey=box.y-offset;return sx<mouse[0]&&mouse[0]<ex&&ey<mouse[1]&&mouse[1]<sy};top_chart_internal_fn.generateDrawBoxplotBox=function(boxplotIndices,isSub){var $$=this,config=$$.config,getPoints=$$.generateGetBoxplotPoints("box",boxplotIndices,isSub);return function(d,i){var points=getPoints(d,i);var indexX=config.chart_inverted?1:0;var indexY=config.chart_inverted?0:1;var path="M "+points[0][indexX]+","+points[0][indexY]+" "+"L"+points[1][indexX]+","+points[1][indexY]+" "+"L"+points[2][indexX]+","+points[2][indexY]+" "+"L"+points[3][indexX]+","+points[3][indexY]+" "+"z";return path}};top_chart_internal_fn.generateDrawBoxplotMedian=function(boxplotIndices,isSub){var $$=this,config=$$.config,getPoints=$$.generateGetBoxplotPoints("median",boxplotIndices,isSub);return function(d,i){var points=getPoints(d,i);var indexX=config.chart_inverted?1:0;var indexY=config.chart_inverted?0:1;var path="M "+points[0][indexX]+","+points[0][indexY]+" "+"L"+points[1][indexX]+","+points[1][indexY]+" "+"z";return path}};top_chart_internal_fn.generateDrawBoxplotWhisker=function(boxplotIndices,isSub){var $$=this,config=$$.config,getPoints=$$.generateGetBoxplotPoints("whisker",boxplotIndices,isSub);return function(d,i){var points=getPoints(d,i);var indexX=config.chart_inverted?1:0;var indexY=config.chart_inverted?0:1;var path="M "+points[0][indexX]+","+points[0][indexY]+" "+"L"+points[1][indexX]+","+points[1][indexY]+" "+"M "+points[2][indexX]+","+points[2][indexY]+" "+"L"+points[3][indexX]+","+points[3][indexY]+" "+"z";return path}};top_chart_internal_fn.generateDrawBoxplotStem=function(boxplotIndices,isSub){var $$=this,config=$$.config,getPoints=$$.generateGetBoxplotPoints("stem",boxplotIndices,isSub);return function(d,i){var points=getPoints(d,i);var indexX=config.chart_inverted?1:0;var indexY=config.chart_inverted?0:1;var path="M "+points[0][indexX]+","+points[0][indexY]+" "+"L"+points[1][indexX]+","+points[1][indexY]+" "+"M "+points[2][indexX]+","+points[2][indexY]+" "+"L"+points[3][indexX]+","+points[3][indexY]+" "+"z";return path}};top_chart_internal_fn.generateGetBoxplotPoints=function(nameOfShape,boxplotIndices,isSub){var $$=this,config=$$.config,axis=$$.xAxis,boxplotTargetsNum=boxplotIndices.__max__+1,boxplotW=$$.getBarW(axis,boxplotTargetsNum),boxplotX=$$.getShapeX(boxplotW,boxplotTargetsNum,boxplotIndices,!!isSub),boxplotY=$$.getShapeY(!!isSub),boxplotOffset=$$.getShapeOffset($$.isBoxplotType,boxplotIndices,!!isSub),yScale=$$.getYScale,boxplotInterval=config.boxplot_zeroInterval?0:boxplotW/6;if(nameOfShape==="box"){return function(d,i){var yLower=yScale.call($$,d.id)(d.lower),posX=boxplotX(d),posY=boxplotY(d);return[[posX+boxplotInterval,yLower],[posX+boxplotInterval,posY],[posX+boxplotW-boxplotInterval,posY],[posX+boxplotW-boxplotInterval,yLower]]}}else if(nameOfShape==="median"){return function(d,i){var yMedian=yScale.call($$,d.id)(d.median),posX=boxplotX(d);return[[posX+boxplotInterval,yMedian],[posX+boxplotW-boxplotInterval,yMedian]]}}else if(nameOfShape==="whisker"){return function(d,i){var yMax=yScale.call($$,d.id)(d.max),yMin=yScale.call($$,d.id)(d.min),posX=boxplotX(d),halfWidth=10;return[[posX+boxplotW/2-halfWidth,yMax],[posX+boxplotW/2+halfWidth,yMax],[posX+boxplotW/2-halfWidth,yMin],[posX+boxplotW/2+halfWidth,yMin]]}}else if(nameOfShape==="stem"){return function(d,i){var yMax=yScale.call($$,d.id)(d.max),yMin=yScale.call($$,d.id)(d.min),yUpper=yScale.call($$,d.id)(d.upper),yLower=yScale.call($$,d.id)(d.lower),posX=boxplotX(d);return[[posX+boxplotW/2,yMax],[posX+boxplotW/2,yUpper],[posX+boxplotW/2,yLower],[posX+boxplotW/2,yMin]]}}};top_chart_internal_fn.initText=function(){var $$=this;$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartTexts);$$.mainText=$$.d3.selectAll([]);$$.config.dataLabels_format=$$.config.dataLabels_format||function(text){return text}};top_chart_internal_fn.updateTargetsForText=function(targets){var $$=this,mainTextUpdate,mainTextEnter,classChartText=$$.classChartText.bind($$),classTexts=$$.classTexts.bind($$),classFocus=$$.classFocus.bind($$);mainTextUpdate=$$.main.select("."+CLASS.chartTexts).selectAll("."+CLASS.chartText).data(targets).attr("class",function(d){return classChartText(d)+classFocus(d)});mainTextEnter=mainTextUpdate.enter().append("g").attr("class",classChartText).style("opacity",0).style("pointer-events","none");mainTextEnter.append("g").attr("class",classTexts);$$.main.selectAll("."+CLASS.texts).data(targets)};top_chart_internal_fn.updateText=function(durationForExit){var $$=this,config=$$.config,barOrLineData=$$.barOrLineData.bind($$),classText=$$.classText.bind($$),parentData,transformList,dataLabelOption;$$.mainText=$$.main.selectAll("."+CLASS.texts).selectAll("."+CLASS.text).data(barOrLineData);if(TOP.chart.Browser.isIE())transformList="translate(0,0)";else if(TOP.chart.Browser.isChrome())transformList="translate(0,-10)";var mainTextEnter=$$.mainText.enter();mainTextEnter.append("text").attr("class",classText).attr("text-anchor",function(d){return config.chart_inverted?d.value<0?"end":"start":"middle"}).attr("alignment-baseline","hanging").attr("transform",transformList);$$.mainText.exit().transition().duration(durationForExit).style("fill-opacity",0).remove();$$.main.selectAll("."+CLASS.texts).selectAll("."+CLASS.text).text(function(d,i,j){var text;if($$.dataLabelFormat(d.id)(d.value,d.id,i,j)===0)return"";else if(!config.dataLabels_floatPoint)text=Math.round($$.dataLabelFormat(d.id)(d.value,d.id,i,j));else text=$$.dataLabelFormat(d.id)(d.value,d.id,i,j);return config.dataLabels_format(text)}).style("fill",function(d){parentData=d3.select(this.parentNode.parentNode).datum();dataLabelOption=parentData.dataLabels;return dataLabelOption?dataLabelOption.color:undefined})};top_chart_internal_fn.getStyleObject=function(style){var styleString="{";for(var key in style){styleString+='"'+this.camelToDash(key)+'": "'+style[key]+'", '}styleString=styleString.slice(0,styleString.length-2);styleString+="}";return JSON.parse(styleString)};top_chart_internal_fn.redrawText=function(xForText,yForText,forFlow,withTransition){var mainText=withTransition?this.mainText.transition():this.mainText;return[(withTransition?this.mainText.transition():this.mainText).attr("x",xForText).attr("y",yForText).style("fill-opacity",function(d){return this.opacityForText})]};top_chart_internal_fn.redrawTextRect=function(xForText,yForText,forFlow,withTransition){var $$=this;return[(withTransition?this.mainTextRect.transition():this.mainTextRect).attr("x",xForText).attr("y",yForText)]};top_chart_internal_fn.getTextRect=function(text,cls){var dummy=this.d3.select("body").append("div").classed("TOP",true),svg=dummy.append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0),rect;svg.selectAll(".dummy").data([text]).enter().append("text").classed(cls?cls:"",true).text(text).each(function(){rect=this.getBoundingClientRect()});dummy.remove();return rect};top_chart_internal_fn.generateXYForText=function(areaIndices,barIndices,lineIndices,forX){var $$=this,getAreaPoints=$$.generateGetAreaPoints(areaIndices,false),getBarPoints=$$.generateGetBarPoints(barIndices,false),getLinePoints=$$.generateGetLinePoints(lineIndices,false),getter=forX?$$.getXForText:$$.getYForText;return function(d,i){var getPoints=$$.isAreaType(d)?getAreaPoints:$$.isBarType(d)?getBarPoints:getLinePoints;return getter.call($$,getPoints(d,i),d,this)}};top_chart_internal_fn.getXForText=function(points,d,textElement){var $$=this,config=$$.config,box=textElement.getBoundingClientRect(),xPos,padding;if($$.config.chart_inverted){if($$.hasType("bar")||$$.hasType("column")||$$.hasType("area")){if(config.dataLabels_horizontalAlignment==="center"){xPos=(points[2][1]+points[0][1]-box.width)/2}else if(config.dataLabels_horizontalAlignment==="left"){xPos=points[0][1]}else if(config.dataLabels_horizontalAlignment==="right"){if($$.stacking==="percent")xPos=points[2][1]-box.width;else xPos=points[2][1]}else{xPos=(points[2][1]+points[0][1]-box.width)/2}}else if($$.hasType("line")){if(config.dataLabels_horizontalAlignment==="center"){xPos=(points[2][1]+points[0][1]-box.width)/2}else if(config.dataLabels_horizontalAlignment==="left"){xPos=points[0][1]-box.width}else if(config.dataLabels_horizontalAlignment==="right"){xPos=points[2][1]}else{xPos=(points[2][1]+points[0][1]-box.width)/2}}else{xPos=points[0][1]}}else{if($$.hasType("bar")||$$.hasType("column")){if(config.dataLabels_horizontalAlignment==="center"){xPos=(points[2][0]+points[0][0])/2}else if(config.dataLabels_horizontalAlignment==="left"){xPos=points[0][0]+box.width/2}else if(config.dataLabels_horizontalAlignment==="right"){xPos=points[2][0]-box.width/2}else{xPos=(points[2][0]+points[0][0])/2}}else if($$.hasType("line")||$$.hasType("area")){if(config.dataLabels_horizontalAlignment==="center"){xPos=(points[2][0]+points[0][0])/2}else if(config.dataLabels_horizontalAlignment==="left"){xPos=points[0][0]-box.width/2}else if(config.dataLabels_horizontalAlignment==="right"){xPos=points[2][0]+box.width/2}else{xPos=(points[2][0]+points[0][0])/2}}else{xPos=points[0][0]}}if(d.value===null){if(xPos>$$.width){xPos=$$.width-box.width}else if(xPos<0){xPos=4}}return xPos+config.dataLabels_x};top_chart_internal_fn.getYForText=function(points,d,textElement){var $$=this,config=$$.config,box=textElement.getBoundingClientRect(),yPos;if($$.config.chart_inverted){if($$.hasType("bar")||$$.hasType("column")){if(config.dataLabels_verticalAlignment==="center"){yPos=(points[0][0]+points[2][0]+box.height*.6)/2}else if(config.dataLabels_verticalAlignment==="top"){yPos=points[0][0]+box.height*.6}else if(config.dataLabels_verticalAlignment==="bottom"){yPos=points[2][0]}else{yPos=(points[0][0]+points[2][0]+box.height*.6)/2}}else if($$.hasType("line")||$$.hasType("area")){if(config.dataLabels_verticalAlignment==="center"){yPos=(points[0][0]+points[2][0]+box.height*.6)/2}else if(config.dataLabels_verticalAlignment==="top"){yPos=points[2][0]}else if(config.dataLabels_verticalAlignment==="bottom"){yPos=points[0][0]+box.height*.6}else{yPos=(points[0][0]+points[2][0]+box.height*.6)/2}}else{yPos=(points[0][0]+points[2][0]+box.height*.6)/2}}else{if($$.hasType("bar")||$$.hasType("column")||$$.hasType("area")){if(config.dataLabels_verticalAlignment==="center"){yPos=(points[0][1]+points[2][1]+box.height)/2}else if(config.dataLabels_verticalAlignment==="top"){if($$.stacking==="percent")yPos=points[2][1]+box.height*.6;else yPos=points[2][1]}else if(config.dataLabels_verticalAlignment==="bottom"){yPos=points[0][1]}else{yPos=(points[0][1]+points[2][1]+box.height)/2}}else if($$.hasType("line")){if(config.dataLabels_verticalAlignment==="center"){yPos=(points[0][1]+points[2][1]+box.height)/2}else if(config.dataLabels_verticalAlignment==="top"){yPos=points[2][1]}else if(config.dataLabels_verticalAlignment==="bottom"){yPos=points[0][1]+box.height}else{yPos=(points[0][1]+points[2][1]+box.height)/2}}else{yPos=points[2][1]}if(d.value<0){yPos+=box.height;if($$.isBarType(d)&&$$.isSafari()){yPos-=3}else if(!$$.isBarType(d)&&$$.isChrome()){yPos+=3}}else{}}if(d.value===null&&!$$.config.chart_inverted){if(yPos<box.height){yPos=box.height}else if(yPos>this.height){yPos=this.height-4}}return yPos+config.dataLabels_y};top_chart_internal_fn.setTargetType=function(targetIds,type){var $$=this,config=$$.config;$$.mapToTargetIds(targetIds).forEach(function(id){$$.withoutFadeIn[id]=type===config.data_types[id];config.data_types[id]=type});if(!targetIds){config.data_type=type}};top_chart_internal_fn.hasMarker=function(){var $$=this,config=$$.config;var targets=$$.data.targets;if(targets&&targets.length){for(var i=0;i<targets.length;i++){if(targets[i].marker.enabled){return true}}}return false};top_chart_internal_fn.hasType=function(type,targets){var $$=this,types=$$.config.data_types,has=false;targets=targets||$$.data.targets;if(targets&&targets.length){targets.forEach(function(target){var t=types[target.id];if(t&&t.indexOf(type)>=0||!t&&type==="line"){has=true}})}else if(Object.keys(types).length){Object.keys(types).forEach(function(id){if(types[id]===type){has=true}})}else{has=$$.config.chart_type===type}return has};top_chart_internal_fn.hasArcType=function(targets){return this.hasType("pie",targets)||this.hasType("donut",targets)||this.hasType("angulargauge",targets)||this.hasType("circulargauge",targets)};top_chart_internal_fn.hasLineType=function(targets){return this.hasType("line",targets)||this.hasType("spline",targets)||this.hasType("area",targets)||this.hasType("area-spline",targets)||this.hasType("step",targets)||this.hasType("area-step",targets)};top_chart_internal_fn.hasLinearGaugeType=function(targets){return this.hasType("bargauge",targets)||this.hasType("columngauge",targets)};top_chart_internal_fn.isLineType=function(d){var config=this.config,id=isString(d)?d:d.id;return!config.data_types[id]||["line","spline","area","area-spline","step","area-step"].indexOf(config.data_types[id])>=0;
};top_chart_internal_fn.isStepType=function(d){var id=isString(d)?d:d.id;return["step","area-step"].indexOf(this.config.data_types[id])>=0};top_chart_internal_fn.isSplineType=function(d){var id=isString(d)?d:d.id;return["spline","area-spline"].indexOf(this.config.data_types[id])>=0};top_chart_internal_fn.isAreaType=function(d){var id=isString(d)?d:d.id;return["area","area-spline","area-step"].indexOf(this.config.data_types[id])>=0};top_chart_internal_fn.isBarType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]===("bar"||"column")};top_chart_internal_fn.isColumnType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="column"};top_chart_internal_fn.isScatterType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="scatter"};top_chart_internal_fn.isBubbleType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="bubble"};top_chart_internal_fn.isBoxplotType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="boxplot"};top_chart_internal_fn.isEqualizerType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="equalizer"};top_chart_internal_fn.isPieType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="pie"};top_chart_internal_fn.isAngularGaugeType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="angulargauge"};top_chart_internal_fn.isCircularGaugeType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="circulargauge"};top_chart_internal_fn.isLinearGaugeType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="bargauge"||this.config.data_types[id]==="columngauge"};top_chart_internal_fn.isDonutType=function(d){var id=isString(d)?d:d.id;return this.config.data_types[id]==="donut"};top_chart_internal_fn.isArcType=function(d){return this.isPieType(d)||this.isDonutType(d)||this.isAngularGaugeType(d)||this.isCircularGaugeType(d)};top_chart_internal_fn.lineData=function(d){return this.isLineType(d)?[d]:[]};top_chart_internal_fn.linePointData=function(d){return this.isLineType(d)||this.isAreaType(d)?d.values:[]};top_chart_internal_fn.arcData=function(d){return this.isArcType(d.data)?[d]:[]};top_chart_internal_fn.linearGaugeData=function(d){return this.isLinearGaugeType(d)?[d]:[]};top_chart_internal_fn.scatterData=function(d){return this.isScatterType(d)?d.values:[]};top_chart_internal_fn.bubbleData=function(d){return this.isBubbleType(d)?d.values:[]};top_chart_internal_fn.boxplotData=function(d){return this.isBoxplotType(d)?d.values:[]};top_chart_internal_fn.barData=function(d){return this.isBarType(d)?d.values:[]};top_chart_internal_fn.equalizerData=function(d){return this.isEqualizerType(d)?d.values:[]};top_chart_internal_fn.barOrLineData=function(d){return this.isBarType(d)||this.isLineType(d)?d.values:[]};top_chart_internal_fn.initGrid=function(){var $$=this,config=$$.config,d3=$$.d3;$$.grid=$$.main.append("g").attr("clip-path",$$.clipPathForGrid).attr("class",CLASS.grid);if(config.grid_x_show){$$.grid.append("g").attr("class",CLASS.xgrids)}if(config.grid_y_show){$$.grid.append("g").attr("class",CLASS.ygrids)}if(config.grid_focus_show){$$.grid.append("g").attr("class",CLASS.xgridFocus).append("line").attr("class",CLASS.xgridFocus).style("stroke-width",1).style("stroke",config.tooltip_grouped?"#ffba00":null)}$$.xgrid=d3.selectAll([])};top_chart_internal_fn.updateXGrid=function(withoutUpdate){var $$=this,config=$$.config,d3=$$.d3,xgridData=config.xAxis_tick_fit?$$.tickValues:$$.generateGridData(config.grid_x_type,$$.x),tickOffset=$$.isCategorized()?$$.xAxis.tickOffset():0;$$.xgridAttr=config.chart_inverted?{x1:0,x2:$$.width,y1:function(d){return $$.x(d)-tickOffset},y2:function(d){return $$.x(d)-tickOffset}}:{x1:function(d){return $$.x(d)+tickOffset},x2:function(d){return $$.x(d)+tickOffset},y1:0,y2:$$.height};if(xgridData){$$.xgrid=$$.main.select("."+CLASS.xgrids).selectAll("."+CLASS.xgrid).data(xgridData);$$.xgrid.enter().append("line").attr("class",CLASS.xgrid);if(!withoutUpdate){$$.xgrid.attr($$.xgridAttr).style("opacity",function(){return+d3.select(this).attr(config.chart_inverted?"y1":"x1")===(config.chart_inverted?$$.height:0)?0:1})}$$.xgrid.exit().remove()}};top_chart_internal_fn.updateYGrid=function(){var $$=this,config=$$.config,gridValues=$$.yAxis.tickValues()||$$.y.ticks(config.grid_y_ticks);$$.ygrid=$$.main.select("."+CLASS.ygrids).selectAll("."+CLASS.ygrid).data(gridValues);$$.ygrid.enter().append("line").attr("class",CLASS.ygrid);$$.ygrid.attr("x1",config.chart_inverted?$$.y:0).attr("x2",config.chart_inverted?$$.y:$$.width).attr("y1",config.chart_inverted?0:$$.y).attr("y2",config.chart_inverted?$$.height:$$.y);$$.ygrid.exit().remove();$$.smoothLines($$.ygrid,"grid")};top_chart_internal_fn.gridTextAnchor=function(d){return d.position?d.position:"end"};top_chart_internal_fn.gridTextDx=function(d){return d.position==="start"?4:d.position==="middle"?0:-4};top_chart_internal_fn.xGridTextX=function(d){return d.position==="start"?-this.height:d.position==="middle"?-this.height/2:0};top_chart_internal_fn.yGridTextX=function(d){return d.position==="start"?0:d.position==="middle"?this.width/2:this.width};top_chart_internal_fn.updateGrid=function(duration){var $$=this,main=$$.main,config=$$.config,xgridLine,ygridLine,yv;if($$.hasArcType()){$$.grid.style("visibility","hidden");return}else{$$.grid.style("visibility","visible")}main.select("line."+CLASS.xgridFocus).style("visibility","hidden");main.select("."+CLASS.grid).select("."+CLASS.xgrids).style("visibility",config.grid_x_show?"visible":"hidden");main.select("."+CLASS.grid).select("."+CLASS.ygrids).style("visibility",config.grid_y_show?"visible":"hidden");if(config.grid_x_show){$$.updateXGrid()}if(config.grid_y_show){$$.updateYGrid()}};top_chart_internal_fn.showXGridFocus=function(selectedData){var $$=this,config=$$.config,dataToShow=selectedData.filter(function(d){return d&&isValue(d.value)}),focusEl=$$.main.selectAll("line."+CLASS.xgridFocus),xx=$$.xx.bind($$);if(!config.tooltip_show){return}if($$.hasType("scatter")||$$.hasArcType()){return}focusEl.style("visibility","visible").data([dataToShow[0]]).attr(config.chart_inverted?"y1":"x1",xx).attr(config.chart_inverted?"y2":"x2",xx);$$.smoothLines(focusEl,"grid")};top_chart_internal_fn.hideXGridFocus=function(){this.main.select("line."+CLASS.xgridFocus).style("visibility","hidden")};top_chart_internal_fn.updateXgridFocus=function(){var $$=this,config=$$.config;$$.main.select("line."+CLASS.xgridFocus).attr("x1",config.chart_inverted?0:-10).attr("x2",config.chart_inverted?$$.width:-10).attr("y1",config.chart_inverted?-10:0).attr("y2",config.chart_inverted?-10:$$.height)};top_chart_internal_fn.generateGridData=function(type,scale){var $$=this,gridData=[],xDomain,firstYear,lastYear,i,tickNum=$$.main.select("."+CLASS.axisX).selectAll(".tick").size();if(type==="year"){xDomain=$$.getXDomain();firstYear=xDomain[0].getFullYear();lastYear=xDomain[1].getFullYear();for(i=firstYear;i<=lastYear;i++){gridData.push(new Date(i+"-01-01 00:00:00"))}}else{gridData=scale.ticks(10);if(gridData.length>tickNum){gridData=gridData.filter(function(d){return(""+d).indexOf(".")<0})}}return gridData};top_chart_internal_fn.getGridFilterToRemove=function(params){return params?function(line){var found=false;[].concat(params).forEach(function(param){if("value"in param&&line.value===param.value||"class"in param&&line["class"]===param["class"]){found=true}});return found}:function(){return true}};top_chart_internal_fn.removeGridLines=function(params,forX){var $$=this,config=$$.config,toRemove=$$.getGridFilterToRemove(params),toShow=function(line){return!toRemove(line)},classLines=forX?CLASS.xgridLines:CLASS.ygridLines,classLine=forX?CLASS.xgridLine:CLASS.ygridLine;$$.main.select("."+classLines).selectAll("."+classLine).filter(toRemove).transition().duration(config.transition_duration).style("opacity",0).remove();if(forX){config.grid_x_lines=config.grid_x_lines.filter(toShow)}else{config.grid_y_lines=config.grid_y_lines.filter(toShow)}};top_chart_internal_fn.initSlider=function(){var $$=this,config=$$.config;if(config.slider_position==="bottom")$$.sliderContainer=$$.selectChart.style("position","relative").append("div").attr("class",CLASS.sliderContainer).style("width",$$.width);else if(config.slider_position==="top"){var sliderTop=CLASS.sliderContainer+" "+"slider-top";$$.sliderContainer=$$.selectChart.style("position","relative").insert("div",":first-child").attr("class",sliderTop).style("width",$$.width)}$$.slider=$$.sliderContainer[0][0]};top_chart_internal_fn.generateSlider=function(){var $$=this,config=$$.config;var domain=$$.getXDomain($$.data.targets),min,max,margin;if(domain[0]===domain[1]){min=0;max=100}else{min=domain[0];max=domain[1]}if($$.isTimeSeries()&&!isEmpty($$.data.targets)){min=min.getTime();max=max.getTime();margin=config.slider_margin?config.slider_margin:(max-min)/5}Slider.create($$.slider,{start:[min,max],connect:config.slider_connect,range:{min:min,max:max},behaviour:"drag",margin:margin});$$.slider.Slider.on("update",function(values,handle){if($$.isTimeSeries()){values[0]=Math.round(values[0]);values[1]=Math.round(values[1])}$$.api.zoom([values[0],values[1]]);config.slider_onupdate.call($$.api,values,handle)})};top_chart_internal_fn.updateSlider=function(){var $$=this,config=$$.config;var orgDomain=$$.x.domain(),domain=$$.getXDomain($$.data.targets),min=domain[0],max=domain[1],margin;if($$.isTimeSeries()&&!isEmpty($$.data.targets)){min=min.getTime();max=max.getTime()}margin=config.slider_margin?config.slider_margin:(max-min)/5;if(min!==max){$$.slider.Slider.updateOptions({range:{min:min,max:max},margin:margin});if(config.slider_mode==="reset"){$$.slider.Slider.set([min,max])}}};top_chart_internal_fn.initTooltip=function(){var $$=this,config=$$.config,i,color=function(d){return $$.color(d.id)[0]};function mouseout(){$$.svg.select("."+CLASS.eventRect).style("cursor",null);$$.hideXGridFocus();if(!$$.flowing)$$.hideTooltip();$$.unexpandCircles();$$.unexpandBars();if(!$$.isFocusLock)$$.api.revert()}$$.tooltip=$$.selectChart.append("div").attr("class",CLASS.tooltipContainer).style("position","absolute").style("cursor","default").style("pointer-events",config.tooltip_onmouse_enabled?"auto":"none").style("display","none").style("top","0px").style("left","0px").on("mouseenter",function(){$$.isMouseOverTooltip=true}).on("mouseleave",function(){$$.isMouseOverTooltip=false;if(!$$.config){return}if($$.hasArcType()){return}mouseout()}).on("click",function(d){if(config.tooltip_onmouse_enabled&&config.tooltip_onmouse_onclick){var targetsToShow=$$.filterTargetsToShow($$.data.targets);var closest=$$.closest;var selectedData=$$.selectedData;var sameXData;$$.tooltipClick=true;config.tooltip_grouped=!config.tooltip_grouped;if(config.tooltip_grouped||$$.stacking){sameXData=$$.filterByX(targetsToShow,closest.x)}else{sameXData=[closest]}selectedData=sameXData.map(function(d){return $$.addName(d)});$$.tooltipTable.attr("class",config.tooltip_grouped?CLASS.tooltip:CLASS.tooltipSingle);$$.tooltipArrow.attr("class",config.tooltip_grouped?CLASS.tooltipGroupArrow:CLASS.tooltipArrow);$$.showTooltip(selectedData,$$.eventRect[0].parentNode.children[0],closest);$$.tooltipClick=false}});$$.tooltipTable=$$.tooltip.append("table").attr("class",config.tooltip_grouped?CLASS.tooltip:$$.hasType("boxplot")||$$.hasType("bubble")?CLASS.tooltipMultiple:CLASS.tooltipSingle);if(config.chart_type!=="pie"&&config.chart_type!=="donut"&&config.chart_type!=="angulargauge"&&config.chart_type!=="circulargauge"&&!$$.hasType("boxplot")&&!$$.hasType("bubble")){$$.tooltipArrow=$$.tooltip.append("div").attr("class",config.tooltip_grouped?CLASS.tooltipGroupArrow:CLASS.tooltipArrow)}if(config.tooltip_init_show){if($$.isTimeSeries()&&isString(config.tooltip_init_x)){config.tooltip_init_x=$$.parseDate(config.tooltip_init_x);for(i=0;i<$$.data.targets[0].values.length;i++){if($$.data.targets[0].values[i].x-config.tooltip_init_x===0){break}}config.tooltip_init_x=i}$$.tooltipTable.html(config.tooltip_contents.call($$,$$.data.targets.map(function(d){return $$.addName(d.values[config.tooltip_init_x])}),$$.axis.getXAxisTickFormat(),$$.getYFormat($$.hasArcType()),color));$$.tooltipTable.style("top",config.tooltip_init_position.top).style("left",config.tooltip_init_position.left).style("display","block")}};top_chart_internal_fn.getTooltipContent=function(d,defaultTitleFormat,defaultValueFormat,color){var $$=this,config=$$.config,titleFormat=config.tooltip_format_title||(config.xAxis_categories?defaultTitleFormat:""),nameFormat=config.tooltip_format_name||function(name){return name},valueFormat=config.tooltip_format_value||defaultValueFormat,text,i,title,value,name,bgcolor,tooltipWidth,tooltipHeight;if(config.chart_type==="pie"||config.chart_type==="donut"){var pieData=$$.pie($$.data.targets);if(config.tooltip_grouped){var d;for(var j=0;j<pieData.length;j++){d=$$.convertToArcData(pieData[j]);d.index=j;if(!text){title=titleFormat?titleFormat(d.x):" ";text=title||title===0?"<tr><th colspan='3'>"+title+"</th></tr>":""}value=valueFormat(d.value,d.ratio,d.id,d.index);if(value!==undefined){name=nameFormat(d.name,d.ratio,d.id,d.index);bgcolor=$$.levelColor?$$.levelColor(d.value):color(d.id);text+="<tr class='"+CLASS.tooltipName+"-"+d.id+"'>";text+="<td class='tooltipTile'><span style='background-color:"+bgcolor+"'></span></td>";text+="<td class='name'><span>"+name+"</span></td>";text+="<td class='value'>"+($$.stacking==="percent"?value.toFixed()+"%":value)+"</td>";text+="</tr>"}}}else{if(!text)title=titleFormat?titleFormat(d[0].id):d[0].id;value=valueFormat(d[0].value,d[0].ratio,d[0].id,d[0].index);if(value!==undefined){text="<td class = 'tooltipSpan'>"+title+"</td>";text+="<td class = 'tooltipSpan'>"+value+"</td>";return text}}}else if($$.isBoxplotType(d[0].id)){for(i=0;i<d.length;i++){if(!(d[i]&&(d[i].value||d[i].value===0))){continue}var upper=d[i].upper,max=d[i].max,min=d[i].min,lower=d[i].lower,median=d[i].median;if(!text){title=titleFormat?titleFormat(d[i].x):d[i].x;text=title||title===0?"<tr><th class='multiple_title' style>"+d[i].id+"</th></tr>":""}value=valueFormat(d[i].value,d[i].ratio,d[i].id,d[i].index);if(value!==undefined){name=nameFormat(d[i].name,d[i].ratio,d[i].id,d[i].index);bgcolor=$$.levelColor?$$.levelColor(d[i].value):color(d[i].id);text+="<tr class='max-"+d[i].id+"'>";text+="<td class='max'><span class='multiple_name'>Maximum : </span><span class='multiple_value'>"+max+"</span></td></tr>";text+="<tr class='upper-"+d[i].id+"'>";text+="<td class='upper'><span class='multiple_name'>Upper quartile : </span><span class='multiple_value'>"+upper+"</span></td></tr>";text+="<tr class='median-"+d[i].id+"'>";text+="<td class='median'><span class='multiple_name'>Median : </span><span class='multiple_value'>"+median+"</span></td></tr>";text+="<tr class='lower-"+d[i].id+"'>";text+="<td class='lower'><span class='multiple_name'>Lower quartile : </span><span class='multiple_value'>"+lower+"</span></td></tr>";text+="<tr class='min-"+d[i].id+"'>";text+="<td class='min'><span class='multiple_name'>Minimum : </span><span class='multiple_value'>"+min+"</span></td></tr>"}}}else if($$.hasType("boxplot")){for(i=0;i<d.length;i++){if(!(d[i]&&(d[i].value||d[i].value===0))){continue}if(!text){title=titleFormat?titleFormat(d[i].x):d[i].x;text=title||title===0?"<tr><th class='multiple_title' style>"+d[0].id+"</th></tr>":""}value=valueFormat(d[i].value,d[i].ratio,d[i].id,d[i].index);var valueString=config.tooltip_valueString?config.tooltip_valueString:"Value";if(value!==undefined){name=nameFormat(d[i].name,d[i].ratio,d[i].id,d[i].index);bgcolor=$$.levelColor?$$.levelColor(d[i].value):color(d[i].id);text+="<tr class='name-"+d[i].id+"'>";text+="<td class='name'><span class='multiple_name'>"+valueString+" : </span><span class='multiple_value'>"+value+"</span></td></tr>"}}}else if($$.isBubbleType(d[0].id)){for(i=0;i<d.length;i++){if(!(d[i]&&(d[i].value||d[i].value===0))){continue}if(!text){title=titleFormat?titleFormat(d[i].x):d[i].x;text=title||title===0?"<tr><th class='multiple_title' style>"+d[0].id+"</th></tr>":""}var xTextFormat=config.tooltip_format_xText||(config.xAxis_categories?defaultTitleFormat:"X");var xFormat=config.tooltip_format_xValue||(config.xAxis_categories?defaultTitleFormat:"");var yTextFormat=config.tooltip_format_yText||function(d){return"Y"};var yFormat=config.tooltip_format_yValue||function(y){return y};var zTextFormat=config.tooltip_format_zText||function(d){return"Z"};var zFormat=config.tooltip_format_zValue||function(z){return z};var xText=xTextFormat(d[i]);var yText=yTextFormat(d[i]);var zText=zTextFormat(d[i]);var x=xFormat(d[i].x);var y=yFormat(d[i].y);var z=zFormat(d[i].z);value=valueFormat(d[i].value,d[i].ratio,d[i].id,d[i].index);if(value!==undefined){name=nameFormat(d[i].name,d[i].ratio,d[i].id,d[i].index);bgcolor=$$.levelColor?$$.levelColor(d[i].value):color(d[i].id);text+="<tr class='x-"+d[i].id+"'>";text+="<td class='name'><span class='multiple_x'>"+xText+" : </span><span class='multiple_value'>"+x+"</span></td></tr>";text+="<tr class='y-"+d[i].id+"'>";text+="<td class='name'><span class='multiple_y'>"+yText+" : </span><span class='multiple_value'>"+y+"</span></td></tr>";text+="<tr class='z-"+d[i].id+"'>";text+="<td class='name'><span class='multiple_z'>"+zText+" : </span><span class='multiple_value'>"+z+"</span></td></tr>"}}}else for(i=0;i<d.length;i++){if(!(d[i]&&(d[i].value||d[i].value===0))){continue}else if(config.tooltip_grouped){if(!text){title=titleFormat?titleFormat(d[i].x):d[i].x;text=title||title===0?"<tr><th colspan='3'>"+title+"</th></tr>":""}if($$.stacking==="percent"){var val=d[i].value*1;d[i].value=Math.round(val);value=valueFormat(d[i].value,d[i].oriValue,d[i].id,d[i].index)}else value=valueFormat(d[i].value,d[i].ratio,d[i].id,d[i].index);if(value!==undefined){name=nameFormat(d[i].name,d[i].ratio,d[i].id,d[i].index);bgcolor=$$.levelColor?$$.levelColor(d[i].value):color(d[i].id);text+="<tr class='"+CLASS.tooltipName+"-"+d[i].id+"'>";text+="<td class='tooltipTile'><span style='background-color:"+bgcolor+"'></span></td>";text+="<td class='name'><span>"+name+"</span></td>";text+="<td class='value'>"+($$.stacking==="percent"&&valueFormat===defaultValueFormat?value+"%":value)+"</td>";text+="</tr>"}}else{if(!text){if(config.tooltip_format_single==="x"||config.tooltip_format_single==="X")title=titleFormat?titleFormat(d[i].x):d[i].x;else if(config.tooltip_format_single==="name"){var titleFormat=config.tooltip_format_title;title=titleFormat?titleFormat(d[i].id):d[i].id}}value=valueFormat(d[i].value,d[i].ratio,d[i].id,d[i].index);if(value!==undefined){text="<td class = 'tooltipSpan'>"+title+"</td>";text+="<td class = 'tooltipSpan'>"+value+"</td>";return text}}}return text};top_chart_internal_fn.tooltipPosition=function(dataToShow,tooltipWidth,tooltipHeight,element,closest){var $$=this,config=$$.config,d3=$$.d3,axis=$$.xAxis;var svgLeft,tooltipLeft,tooltipRight,tooltipTop,chartRight;var forArc=$$.hasArcType(),tooltipBottom,isY2Axis,direction="bottom",barIndices=$$.getShapeIndices($$.isBarType),barW=$$.getBarW(axis,barIndices.__max__+1),selectedIndex=barIndices[dataToShow[0].id],mouse=d3.mouse(element),firstIndex=barIndices.__max__/2;var groupedPosition=barIndices.__max__?(barIndices.__max__+1)/2:0;var subtitleHeight=$$.subtitleHeight||8;var tooltipDataValue=$$.y(dataToShow[0].value);var targetId=closest?closest.id:dataToShow[0].id;for(var i=0;i<config.series.length;i++){if(targetId===config.series[i].name&&config.series[i].yAxis==="y2"){tooltipDataValue=$$.y2(dataToShow[0].value);isY2Axis=true}}if(forArc){var translateX=0;if(typeof config.chart_spacing.left==="number")translateX=config.chart_spacing.left+$$.radius;else translateX=$$.arcWidth/2;tooltipLeft=translateX+mouse[0]-tooltipWidth/2;tooltipTop=$$.height/2+mouse[1]+20}else if(config.tooltip_positioningType==="mouse"){tooltipLeft=mouse[0]+$$.margin.left-tooltipWidth/2;tooltipTop=mouse[1]+$$.margin.top-tooltipHeight;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=mouse[1]+$$.margin.top;direction="top"}}else{svgLeft=$$.getSvgLeft(true);if(config.chart_inverted){if(config.tooltip_grouped){if($$.stacking&&closest){var titleHeight=$$.titleHeight?0:-12;var targetPosition=$$.findTargetIndicesFromGroups(config.data_groups,closest),stackingLength=targetPosition[2].length-1,i,j,generatedStackingData,stackingData=0;for(i=targetPosition[1];i>=0;i--){for(j=0;j<dataToShow.length;j++)if(dataToShow[j].id===targetPosition[2][stackingLength-i]){stackingData=stackingData+dataToShow[j].value;break}}generatedStackingData=$$.y(stackingData);tooltipLeft=generatedStackingData-tooltipWidth/2;tooltipTop=$$.x(dataToShow[0].x)+$$.margin.top+targetPosition[0]*barW-barW*firstIndex-barW/2-tooltipHeight;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=mouse[1]+$$.margin.top+15;direction="top"}}else{var titleHeight=$$.titleHeight?0:-12;tooltipTop=$$.x(dataToShow[0].x)-barW*firstIndex+barW*selectedIndex-tooltipHeight-barW/2+$$.margin.top;tooltipLeft=tooltipDataValue+$$.getCurrentPaddingLeft()-tooltipWidth/2;tooltipRight=tooltipLeft+tooltipWidth;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=mouse[1]+tooltipHeight/2+8;direction="top"}}var chartRight=$$.currentWidth-$$.getCurrentPaddingRight();if(tooltipLeft>chartRight)tooltipLeft=chartRight-tooltipWidth/2}else{if(config.chart_type==="bar"){var titleHeight=$$.titleHeight?$$.titleHeight:0;tooltipTop=$$.x(dataToShow[0].x)-barW*firstIndex+barW*selectedIndex-barW/2-tooltipHeight+$$.margin.top;tooltipLeft=tooltipDataValue-tooltipWidth/2+$$.margin.left-4;tooltipRight=tooltipLeft+tooltipWidth}else{tooltipLeft=svgLeft+mouse[0]-30;tooltipRight=tooltipLeft+tooltipWidth;chartRight=$$.currentWidth-$$.getCurrentPaddingRight();tooltipTop=$$.x(dataToShow[0].x)-tooltipHeight-5+$$.margin.top}if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=mouse[1]+tooltipHeight/2+8;direction="top"}var chartRight=$$.currentWidth-$$.getCurrentPaddingRight();if(tooltipLeft>chartRight)tooltipLeft=chartRight-tooltipWidth/2}}else{if(config.tooltip_grouped){if(closest){if($$.stacking){var targetPosition=$$.findTargetIndicesFromGroups(config.data_groups,closest);if(!targetPosition)return;var stackingLength=targetPosition[2].length-1,i,j,generatedStackingData,stackingData=0;for(i=targetPosition[1];i>=0;i--){for(j=0;j<dataToShow.length;j++)if(dataToShow[j].id===targetPosition[2][stackingLength-i]){stackingData=stackingData+dataToShow[j].value;break}}generatedStackingData=$$.y(stackingData);tooltipTop=generatedStackingData-tooltipHeight+$$.margin.top-5;tooltipLeft=$$.getCurrentPaddingLeft(true)+$$.x(dataToShow[0].x)-firstIndex*barW-tooltipWidth/2+targetPosition[0]*barW;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=tooltipDataValue+13+$$.margin.top;direction="top"}}else{var i;for(i=0;i<dataToShow.length;i++){if(dataToShow[i].id===closest.id)selectedIndex=i}tooltipTop=(isY2Axis?$$.y2(dataToShow[selectedIndex].value):$$.y(dataToShow[selectedIndex].value))-tooltipHeight-10+$$.margin.top;tooltipLeft=$$.getCurrentPaddingLeft(true)+$$.x(dataToShow[0].x)-tooltipWidth/2+1;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=tooltipDataValue+13+$$.margin.top;direction="top"}}}else{tooltipLeft=$$.getCurrentPaddingLeft(true)+$$.x(dataToShow[0].x)-firstIndex*barW-tooltipWidth/2+groupedPosition*barW;tooltipTop=tooltipDataValue-tooltipHeight-10+$$.margin.top}}else{if($$.stacking){var targetPosition=$$.findTargetIndicesFromGroups(config.data_groups,closest);if(!targetPosition)return;var stackingLength=targetPosition[2].length-1,i,j,generatedStackingData,stackingData=0;for(i=targetPosition[1];i>=0;i--){for(j=0;j<dataToShow.length;j++)if(dataToShow[j].id===targetPosition[2][stackingLength-i]){stackingData=stackingData+dataToShow[j].value;break}}generatedStackingData=$$.y(stackingData);tooltipTop=generatedStackingData-tooltipHeight+$$.margin.top-5;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=tooltipDataValue+13+$$.margin.top;direction="top"}}else{tooltipTop=tooltipDataValue-tooltipHeight-10+$$.margin.top;if(config.tooltip_reversed&&(mouse[1]+$$.margin.top<tooltipTop||tooltipTop<0)){tooltipTop=tooltipDataValue+13+$$.margin.top;direction="top"}}if(selectedIndex!==undefined)tooltipLeft=$$.getCurrentPaddingLeft(true)+$$.x(dataToShow[0].x)-firstIndex*barW-tooltipWidth/2+selectedIndex*barW;else tooltipLeft=$$.getCurrentPaddingLeft(true)+$$.x(dataToShow[0].x)-tooltipWidth/2;tooltipRight=tooltipLeft+tooltipWidth;chartRight=svgLeft+$$.currentWidth-$$.getCurrentPaddingRight();tooltipBottom=tooltipTop+tooltipHeight}}}if(config.tooltip_inside){chartRight=$$.currentWidth-$$.getCurrentPaddingRight();tooltipTop=tooltipTop<$$.getCurrentPaddingTop()?$$.getCurrentPaddingTop():tooltipTop;tooltipLeft=tooltipLeft+tooltipWidth>chartRight?chartRight-tooltipWidth:tooltipLeft;tooltipLeft=tooltipLeft<$$.getCurrentPaddingLeft()?$$.getCurrentPaddingLeft():tooltipLeft}if(typeof config.tooltip_limit.left==="number"&&config.tooltip_limit.left>tooltipLeft)tooltipLeft=config.tooltip_limit.left;if(typeof config.tooltip_limit.top==="number"&&config.tooltip_limit.top>tooltipTop)tooltipTop=config.tooltip_limit.top;return{top:tooltipTop,left:tooltipLeft,direction:direction,chartRight:chartRight}};top_chart_internal_fn.showTooltip=function(selectedData,element,closest){var $$=this,config=$$.config;var tooltipWidth,tooltipHeight,position,valueTop;var forArc=$$.hasArcType(),closest=closest,dataToShow=selectedData.filter(function(d){return d&&isValue(d.value)}),color=function(d){return $$.color(d)[0]},positionFunction=config.tooltip_position||$$.tooltipPosition,barIndices=$$.getShapeIndices($$.isBarType),axis=$$.xAxis,firstIndex=barIndices.__max__/2,barW=$$.getBarW(axis,barIndices.__max__+1),subtitleHeight=$$.subtitleHeight||8;var mouse=d3.mouse(element);if(dataToShow.length===0||!config.tooltip_show||config.chart_type==="angulargauge"||config.chart_type==="circulargauge"){return}if($$.orgClosest===closest&&!$$.tooltipClick){$$.tooltip.style("display","block")}else{$$.tooltip.style("display","block");if($$.stacking&&!config.tooltip_grouped){$$.tooltipTable.html(config.tooltip_contents.call($$,[closest],$$.axis.getXAxisTickFormat(),$$.getYFormat(forArc),color))}else{$$.tooltipTable.html(config.tooltip_contents.call($$,selectedData,$$.axis.getXAxisTickFormat(),$$.getYFormat(forArc),color))}}tooltipWidth=$$.tooltip.property("offsetWidth");tooltipHeight=$$.tooltip.property("offsetHeight");position=positionFunction.call(this,dataToShow,tooltipWidth,tooltipHeight,element,closest);if(!position)return;if(config.chart_type!=="pie"&&config.chart_type!=="donut"&&config.chart_type!=="angulargauge"&&config.chart_type!=="circulargauge"){if(position.direction==="bottom"){if(config.tooltip_grouped){if(config.tooltip_inside&&(position.left+tooltipWidth>=position.chartRight||position.left<=$$.getCurrentPaddingLeft())){d3.selectAll("."+CLASS.tooltipGroupArrow).classed("bottom",true).classed("top",false).style("top",tooltipHeight-4+"px").style("left",mouse[0]+$$.margin.left-position.left-3+"px")}else{d3.selectAll("."+CLASS.tooltipGroupArrow).classed("bottom",true).classed("top",false).style("top",tooltipHeight-4+"px").style("left",tooltipWidth/2-4+"px")}}else if(config.tooltip_inside&&(position.left+tooltipWidth>=position.chartRight||position.left<=$$.getCurrentPaddingLeft())){d3.selectAll("."+CLASS.tooltipArrow).style("top",tooltipHeight-5+"px").style("left",mouse[0]+$$.margin.left-position.left-3+"px")}else{d3.selectAll("."+CLASS.tooltipArrow).style("top",tooltipHeight-5+"px").style("left",tooltipWidth/2-4+"px")}}if(position.direction==="top"){if(config.tooltip_grouped){if(config.tooltip_inside&&(position.left+tooltipWidth>=position.chartRight||position.left<=$$.getCurrentPaddingLeft())){d3.selectAll("."+CLASS.tooltipGroupArrow).classed("top",true).classed("bottom",false).style("top",-3+"px").style("left",mouse[0]+$$.margin.left-position.left-3+"px")}else{d3.selectAll("."+CLASS.tooltipGroupArrow).classed("top",true).classed("bottom",false).style("top",-3+"px").style("left",tooltipWidth/2-4+"px")}}else if(config.tooltip_inside&&(position.left+tooltipWidth>=position.chartRight||position.left<=$$.getCurrentPaddingLeft())){d3.selectAll("."+CLASS.tooltipArrow).style("top",-3+"px").style("left",mouse[0]+$$.margin.left-position.left-3+"px")}else{d3.selectAll("."+CLASS.tooltipArrow).style("top",-3+"px").style("left",tooltipWidth/2-4+"px")}}}$$.tooltip.style("top",position.top+"px").style("left",position.left+"px");if($$.hasType("boxplot")||$$.hasType("bubble")){var bgcolor=$$.levelColor?$$.levelColor(selectedData[0].value):color(selectedData[0].id);$$.tooltipTable.style("border-color",bgcolor);$$.tooltipTable.select(".multiple_title").style("color",bgcolor)}};top_chart_internal_fn.hideTooltip=function(){this.tooltip.style("display","none")};top_chart_internal_fn.initLegend=function(){var $$=this,config=$$.config;$$.legendItemTextBox={};$$.legendHasRendered=false;$$.legendGroup=$$.svg.append("g").attr("class",CLASS.legends);$$.legend=$$.legendGroup.append("g").attr("transform",$$.getTranslate("legend"));if(!$$.config.legend_enabled){$$.legend.style("visibility","hidden");$$.hiddenLegendIds=$$.mapToIds($$.data.targets);return}if(config.legend_pagination){$$.initLegendButtons()}$$.initLegendBackground();$$.updateLegendWithDefaults();$$.updateLegendWithDefaults()};top_chart_internal_fn.initLegendButtons=function(){var $$=this,config=$$.config;var path=$$.findCurrentPath();$$.legendLeftButton=$$.legendGroup.append("svg:image").attr("class","TOP-legend-button-left").attr("width",config.legend_ButtonWidth).attr("height",config.legend_ButtonHeight).attr("xlink:href",function(){var img=path+"/js_btn_chart_arrow_left.png";return img}).style("visibility","hidden").on("click",function(){$$.prevLegend()});$$.legendRightButton=$$.legendGroup.append("svg:image").attr("class","TOP-legend-button-right").attr("width",5).attr("height",15).attr("xlink:href",function(){var img=path+"/js_btn_chart_arrow_right.png";return img}).style("visibility","hidden").on("click",function(){$$.nextLegend()})};top_chart_internal_fn.updateLegendButtons=function(){var $$=this,config=$$.config;$$.legendLeftButton.attr("x",function(){return $$.margin.left}).attr("y",function(){return $$.margin3.top-5}).style("visibility",function(){var visible=$$.prevLegendList.length>0?"visible":"hidden";return visible});$$.legendRightButton.attr("x",function(){if($$.hasArcType())return $$.currentWidth-$$.margin3.left;else return $$.currentWidth-$$.margin.left+9}).attr("y",function(){return $$.margin3.top-5}).style("visibility",function(){var visible=$$.nextLegendList.length>0?"visible":"hidden";return visible})};top_chart_internal_fn.calculateLegendHorizontalPosition=function(){var $$=this,config=$$.config;$$.titleHorizontalPosition=0;if(!config.legend_floating){if(config.legend_align==="left"){}}};top_chart_internal_fn.calculateLegendVerticalPosition=function(){};top_chart_internal_fn.updateLegendWithDefaults=function(){var $$=this;$$.updateLegend($$.mapToIds($$.data.targets),{withTransform:false,withTransitionForTransform:false,withTransition:false})};top_chart_internal_fn.updateSizeForLegend=function(legendHeight,legendWidth){var $$=this,config=$$.config,floatingLegendPosition={},floatingLegendPositionX,floatingLegendPositionY,currentMarginTop=$$.margin.top,currentMarginRight=$$.margin.right,currentMarginBottom=$$.margin.bottom,currentMarginLeft=$$.margin.left;floatingLegendPosition={top:$$.isLegendTop?$$.getCurrentPaddingTop()+config.legend_y+config.legend_margin+$$.titleSpace+$$.subtitleSpace+(config.chart_inverted?$$.getHorizontalAxisHeight("y2"):0):$$.currentHeight-legendHeight-$$.getCurrentPaddingBottom()-config.legend_y,left:$$.isLegendLeft?$$.getCurrentPaddingLeft()+config.legend_x+.5:$$.currentWidth-legendWidth-$$.getCurrentPaddingRight()-config.legend_x+.5
};if(config.legend_pagination){if(config.legend_verticalAlign==="top"){$$.margin.top=currentMarginTop+legendHeight;$$.margin.bottom=currentMarginBottom;if($$.hasArcType())$$.margin3.top=config.title_text?$$.margin.top-25:config.chart_spacing.top?config.chart_spacing.top:10;else $$.margin3.top=config.title_text?$$.margin.top-25:config.chart_spacing.top?config.chart_spacing.top:0;$$.margin3.left=$$.margin.left-legendWidth/2+($$.width?$$.width/2:$$.getCurrentWidth()/2)-20}else if(config.legend_verticalAlign==="bottom"){$$.margin.bottom=currentMarginBottom+legendHeight;$$.margin.top=currentMarginTop;$$.margin3.left=$$.margin.left-legendWidth/2+($$.width?$$.width/2:$$.getCurrentWidth()/2)-20;if($$.hasArcType())$$.margin3.top=$$.currentHeight-legendHeight-$$.getCurrentPaddingBottom();else $$.margin3.top=$$.currentHeight-legendHeight-$$.getCurrentPaddingBottom()+15}}else if(config.legend_floating===false){if(config.legend_layout==="horizontal"){if(config.legend_verticalAlign==="middle"){config.legend_floating=true}else if(config.legend_verticalAlign==="top"){$$.margin.top=currentMarginTop+legendHeight;$$.margin.bottom=currentMarginBottom;$$.margin3.top=config.title_text?$$.margin.top-25:config.chart_spacing.top;if(config.legend_align==="right"){$$.margin3.left=$$.getCurrentWidth()-legendWidth-$$.getCurrentPaddingRight()-7}else if(config.legend_align==="left"){$$.margin3.left=$$.margin.left-15}else{$$.margin3.left=$$.margin.left-legendWidth/2+($$.width?$$.width/2:$$.getCurrentWidth()/2)}}else{$$.margin.bottom=currentMarginBottom+legendHeight;$$.margin.top=currentMarginTop;$$.margin3.top=$$.currentHeight-legendHeight-$$.getCurrentPaddingBottom()+15;if(config.legend_align==="right"){$$.margin3.left=$$.getCurrentWidth()-legendWidth-$$.getCurrentPaddingRight()-7}else if(config.legend_align==="left"){$$.margin3.left=$$.margin.left-15}else{$$.margin3.left=$$.margin.left-legendWidth/2+($$.width?$$.width/2:$$.getCurrentWidth()/2)}}}else if(config.legend_layout==="vertical"){if(config.legend_align==="center"){config.legend_align="right"}else if(config.legend_align==="left"){$$.margin.left=currentMarginLeft+legendWidth+config.legend_padding;$$.margin3.left=currentMarginLeft+config.legend_margin;if(config.legend_verticalAlign==="top"){$$.margin3.top=$$.margin.top}else if(config.legend_verticalAlign==="bottom"){$$.margin3.top=$$.margin.top+$$.height-legendHeight}else{$$.margin3.top=$$.margin.top+$$.height/2-legendHeight/2}}else{$$.margin.right=currentMarginRight+legendWidth+config.legend_padding;$$.margin3.left=$$.margin.left+$$.width+config.legend_margin+config.legend_padding;if(config.legend_verticalAlign==="top"){$$.margin3.top=$$.margin.top}else if(config.legend_verticalAlign==="bottom"){$$.margin3.top=$$.margin.top+$$.height-legendHeight}else{$$.margin3.top=$$.margin.top+$$.height/2-legendHeight/2}}}}else{if(config.legend_layout==="vertical"){$$.margin3.left=$$.margin.left+10;$$.margin3.top=$$.margin.top-4;if(config.legend_align==="right"){$$.margin3.left+=$$.width-legendWidth}else if(config.legend_align==="center"){$$.margin3.left+=$$.width/2-legendWidth/2}if(config.legend_verticalAlign==="bottom"){$$.margin3.top+=$$.height-legendHeight}else if(config.legend_verticalAlign==="middle"){$$.margin3.top+=$$.height/2-legendHeight/2}}else{$$.margin3.top=$$.margin.top+10;$$.margin3.left=$$.margin.left-4;if(config.legend_align==="right"){$$.margin3.left+=$$.width-legendWidth-4}else if(config.legend_align==="center"){$$.margin3.left+=$$.width/2-legendWidth/2}if(config.legend_verticalAlign==="bottom"){$$.margin3.top+=$$.height-legendHeight}else if(config.legend_verticalAlign==="middle"){$$.margin3.top+=$$.height/2-legendHeight/2}}}if(config.legend_x){$$.margin3.left+=config.legend_x}if(config.legend_y){$$.margin3.top+=config.legend_y}};top_chart_internal_fn.transformLegend=function(withTransition){var $$=this;(withTransition?$$.legend.transition():$$.legend).attr("transform",$$.getTranslate("legend"))};top_chart_internal_fn.updateLegendStep=function(step){this.legendStep=step};top_chart_internal_fn.updateLegendItemWidth=function(w){this.legendItemWidth=w};top_chart_internal_fn.updateLegendItemHeight=function(h){this.legendItemHeight=h};top_chart_internal_fn.getLegendWidth=function(){var $$=this,config=$$.config,horizontalLegendWidth=0,key;if($$.config.legend_enabled){if(config.legend_width){return config.legend_width}if(config.legend_layout==="vertical"){return $$.legendItemWidth*($$.legendStep+1)}else{for(key in $$.itemIdsOnFirstRow){horizontalLegendWidth+=$$.widths[$$.itemIdsOnFirstRow[key]]}horizontalLegendWidth+=config.legend_padding*2;return horizontalLegendWidth}return 0}else{return 0}};top_chart_internal_fn.getLegendHeight=function(){var $$=this,h=0,config=$$.config;if($$.config.legend_enabled){if(config.legend_layout==="vertical"){h=$$.currentHeight;h=(config.legend_itemMarginTop+$$.legendItemHeight+config.legend_itemMarginBottom)*$$.numberOfLegendItemsOnFirstRow+2*config.legend_padding}else{h=Math.max(20,config.legend_itemMarginTop+$$.legendItemHeight+config.legend_itemMarginBottom)*($$.legendStep+1)+2*config.legend_padding}}return h};top_chart_internal_fn.opacityForLegend=function(legendItem){return legendItem.classed(CLASS.legendItemHidden)?null:1};top_chart_internal_fn.opacityForUnfocusedLegend=function(legendItem){return legendItem.classed(CLASS.legendItemHidden)?null:.3};top_chart_internal_fn.toggleFocusLegend=function(targetIds,focus){var $$=this;targetIds=$$.mapToTargetIds(targetIds);$$.legend.selectAll("."+CLASS.legendItem).filter(function(id){return targetIds.indexOf(id)>=0}).classed(CLASS.legendItemFocused,focus).transition().duration(10).style("opacity",function(){var opacity=focus?$$.opacityForLegend:$$.opacityForUnfocusedLegend;return opacity.call($$,$$.d3.select(this))})};top_chart_internal_fn.revertLegend=function(){var $$=this,d3=$$.d3;$$.legend.selectAll("."+CLASS.legendItem).classed(CLASS.legendItemFocused,false).transition().duration(10).style("opacity",function(){return $$.opacityForLegend(d3.select(this))})};top_chart_internal_fn.showLegend=function(targetIds){var $$=this,config=$$.config;if(!config.legend_enabled){config.legend_enabled=true;$$.legend.style("visibility","visible");if(!$$.legendHasRendered){$$.updateLegendWithDefaults()}}$$.removeHiddenLegendIds(targetIds);$$.legend.selectAll($$.selectorLegends(targetIds)).style("visibility","visible").transition().style("opacity",function(){return $$.opacityForLegend($$.d3.select(this))})};top_chart_internal_fn.hideLegend=function(targetIds){var $$=this,config=$$.config;if(config.legend_enabled&&isEmpty(targetIds)){config.legend_enabled=false;$$.legend.style("visibility","hidden")}$$.addHiddenLegendIds(targetIds);$$.legend.selectAll($$.selectorLegends(targetIds)).style("opacity",0).style("visibility","hidden")};top_chart_internal_fn.clearLegendItemTextBoxCache=function(){this.legendItemTextBox={}};top_chart_internal_fn.nextLegend=function(){var $$=this,config=this.config;var targetIds=$$.mapToIds($$.data.targets);if($$.nextLegendList.length>0){$$.currentLegendIndex++}$$.prevLegendList=targetIds.splice(0,$$.currentLegendIndex);$$.updateLegend(targetIds,{withTransform:false,withTransitionForTransform:false,withTransition:false})};top_chart_internal_fn.prevLegend=function(){var $$=this,config=this.config;var targetIds=$$.mapToIds($$.data.targets);if($$.currentLegendIndex>0)$$.currentLegendIndex--;$$.prevLegendList=targetIds.splice(0,$$.currentLegendIndex);$$.updateLegend(targetIds,{withTransform:false,withTransitionForTransform:false,withTransition:false})};top_chart_internal_fn.updateLegend=function(targetIds,options,transitions){var $$=this,config=$$.config;var xForLegend,xForLegendText,xForLegendRect,yForLegend,yForLegendText,yForLegendRect;var paddingTop=4,paddingRight=10,maxWidth=0,maxHeight=0,posMin=10,tileWidth=config.legend_symbolWidth,symbolPadding=5;var l,legendGroup,totalLength=0,offsets={},heights={},margins=[0],steps={},step=0;var withTransition,withTransitionForTransform;var texts,rects,tiles,background;if(config.legend_reversed){targetIds.reverse()}options=options||{};withTransition=getOption(options,"withTransition",true);withTransitionForTransform=getOption(options,"withTransitionForTransform",true);if($$.legendBackground)$$.cleanLegendBackground();$$.numberOfLegendItemsOnFirstRow=0;$$.itemIdsOnFirstRow={};$$.widths={};var color=function(d){return $$.color(d)[0]};function getTextBoxByTargetIds(targetIds){for(var i=0;i<targetIds.length;i++){$$.legendItemTextBox[targetIds[i]]=$$.getTextRect(targetIds[i],CLASS.legendItem)}return $$.legendItemTextBox}function getTextBox(textElement,id){if(!$$.legendItemTextBox[id]){$$.legendItemTextBox[id]=$$.getTextRect(textElement.textContent,CLASS.legendItem)}return $$.legendItemTextBox[id]}function generateLegendWidth(targetIds){$$.nextLegendList=[];$$.currentLegendList=[];var boxes=getTextBoxByTargetIds(targetIds);for(var i=0;i<targetIds.length;i++){var itemWidth=config.legend_itemWidth||boxes[targetIds[i]].width+(config.legend_layout==="horizontal"?config.legend_itemDistance:0)+symbolPadding+config.legend_symbolWidth+config.legend_itemStyle_x;$$.widths[targetIds[i]]=itemWidth;if((config.legend_layout==="horizontal"?$$.width:$$.height)-totalLength<itemWidth+posMin){$$.nextLegendList.push(targetIds[i])}else{$$.currentLegendList.push(targetIds[i])}totalLength+=itemWidth}}function updatePositions(textElement,id,index){var reset=index===0,isLast=index===targetIds.length-1,box=getTextBox(textElement,id),itemWidth=config.legend_itemWidth||box.width+(config.legend_layout==="horizontal"&&!isLast?config.legend_itemDistance:0)+symbolPadding+config.legend_symbolWidth+config.legend_itemStyle_x,itemHeight=$$.getMax(box.height,config.legend_symbolHeight?config.legend_symbolHeight:0),itemLength=config.legend_layout==="vertical"?itemHeight:itemWidth,areaLength=0,margin,maxLength;function updateValues(id,withoutStep){if(config.legend_layout==="vertical")totalLength+=config.legend_itemMarginTop;if(!withoutStep){margin=15;if((config.legend_layout==="horizontal"?$$.width:$$.height)-totalLength<itemLength+posMin){margin=15;totalLength=0;step++;if(config.legend_layout==="vertical")totalLength+=config.legend_itemMarginTop}}steps[id]=step;if(step==0){if($$.itemIdsOnFirstRow[index]!==id){$$.numberOfLegendItemsOnFirstRow++;$$.itemIdsOnFirstRow[index]=id}}else{if($$.itemIdsOnFirstRow[index]===id)delete $$.itemIdsOnFirstRow[index]}margins[step]=margin;offsets[id]=totalLength;totalLength+=itemLength;if(config.legend_layout==="vertical")totalLength+=config.legend_itemMarginBottom}if(reset){totalLength=0;step=0;maxWidth=0;maxHeight=0}if(config.legend_enabled&&!$$.isLegendToShow(id)){$$.widths[id]=heights[id]=steps[id]=offsets[id]=0;return}$$.widths[id]=itemWidth;heights[id]=itemHeight;if(config.legend_layout==="vertical"){Object.keys(heights).forEach(function(id){areaLength+=heights[id]})}else{Object.keys($$.widths).forEach(function(id){areaLength+=$$.widths[id]});$$.legendItemWidth=areaLength}if(!maxWidth||itemWidth>=maxWidth){maxWidth=itemWidth}if(!maxHeight||itemHeight>=maxHeight){maxHeight=itemHeight}maxLength=config.legend_layout==="vertical"?maxHeight:maxWidth;updateValues(id)}if(config.legend_floating===true){step=targetIds.length;$$.updateLegendStep(step)}if(config.legend_layout==="vertical"){xForLegend=function(id){return maxWidth*steps[id]};yForLegend=function(id){return margins[steps[id]]+offsets[id]}}else{xForLegend=function(id){return margins[0]+offsets[id]};yForLegend=function(id){var toReturn=config.legend_itemMarginTop+(maxHeight+config.legend_itemMarginTop+config.legend_itemMarginBottom)*steps[id];return toReturn}}xForLegendText=function(id,i){return xForLegend(id,i)+symbolPadding+config.legend_itemStyle_x+config.legend_symbolWidth};yForLegendText=function(id,i){return yForLegend(id,i)+heights[id]/2+2};xForLegendRect=function(id,i){return xForLegend(id,i)};yForLegendRect=function(id,i){return yForLegend(id,i)};if(config.legend_pagination){if(!$$.legendLeftButton)$$.initLegendButtons();var allTargetIds=$$.mapToIds($$.data.targets);var newTargetIds=allTargetIds.splice($$.currentLegendIndex,allTargetIds.length);generateLegendWidth(newTargetIds);$$.prevLegendList=allTargetIds.splice(0,$$.currentLegendIndex);targetIds=$$.currentLegendList;$$.updateLegendButtons()}legendGroup=$$.legend.selectAll("."+CLASS.legendItem).data(targetIds);l=legendGroup.enter().append("g").attr("class",function(id){return $$.generateClass(CLASS.legendItem,id)}).style("visibility",function(id){return $$.isLegendToShow(id)?"inherit":"hidden"}).style("cursor","pointer").on("click",function(id){if(config.legend_onclick){config.legend_onclick.call($$,id)}else{if($$.d3.event.altKey){$$.api.hide();$$.api.show()}else{$$.api.toggle(id);$$.isTargetToShow(id)?$$.api.focus(id):$$.api.revert()}}}).on("mouseover",function(id){$$.d3.select(this).classed(CLASS.legendItemFocused,true);if(!$$.transiting&&$$.isTargetToShow(id)){$$.api.focus(id)}if(config.legend_item_onmouseover){config.legend_item_onmouseover.call($$,id)}}).on("mouseout",function(id){$$.d3.select(this).classed(CLASS.legendItemFocused,false);$$.api.revert();if(config.legend_item_onmouseout){config.legend_item_onmouseout.call($$,id)}});legendGroup.exit().remove();l.append("text").text(function(id){return isDefined(config.data_names[id])?config.data_names[id]:id}).attr("class",function(d,i){return"dummyTextForGenerate"}).each(function(id,i){updatePositions(this,id,i)});l.selectAll(".dummyTextForGenerate").remove();l.append("text").text(function(id){return isDefined(config.data_names[id])?config.data_names[id]:id}).each(function(id,i){updatePositions(this,id,i)}).style("pointer-events","none").attr("x",$$.isLegendRight||config.legend_floating===true?xForLegendText:-200).attr("y",$$.isLegendRight||config.legend_floating===true?-200:yForLegendText);l.append("rect").attr("class",CLASS.legendItemEvent).style("fill-opacity",0).attr("x",$$.isLegendRight||config.legend_floating===true?xForLegendRect:-200).attr("y",$$.isLegendRight||config.legend_floating===true?-200:yForLegendRect);l.append("rect").attr("class",CLASS.legendItemTile).style("pointer-events","none").style("fill",color).attr("x",$$.isLegendRight||config.legend_floating===true?xForLegendText:-200).attr("y",$$.isLegendRight||config.legend_floating===true?-200:yForLegend);if(config.legend_rtl===false){texts=$$.legend.selectAll("text").data(targetIds).text(function(id){return isDefined(config.data_names[id])?config.data_names[id]:id}).each(function(id,i){updatePositions(this,id,i)});(withTransition?texts.transition():texts).attr("x",function(id,i){return xForLegendText(id,i)}).attr("y",function(id,i){return yForLegendText(id,i)+config.legend_itemStyle_y}).style("fill",config.legend_itemStyle_color).style("cursor",config.legend_itemStyle_cursor).style("font-size",config.legend_itemStyle_fontSize+"px").style("font-weight",config.legend_itemStyle_fontWeight);rects=$$.legend.selectAll("rect."+CLASS.legendItemEvent).data(targetIds);(withTransition?rects.transition():rects).attr("width",function(id){return $$.widths[id]}).attr("height",function(id){return heights[id]}).attr("x",xForLegendRect).attr("y",yForLegendRect);tiles=$$.legend.selectAll("rect."+CLASS.legendItemTile).data(targetIds);(withTransition?tiles.transition():tiles).style("fill",color).attr("x",xForLegend).attr("y",function(id){return yForLegend(id)}).attr("width",config.legend_symbolWidth).attr("height",config.legend_symbolHeight||function(id){return heights[id]})}else if(config.legend_rtl===true){}$$.legend.selectAll("."+CLASS.legendItem).classed(CLASS.legendItemHidden,function(id){return!$$.isTargetToShow(id)});$$.updateLegendItemWidth(maxWidth);$$.updateLegendItemHeight(maxHeight);$$.updateLegendStep(step);$$.updateSizes();$$.updateScales();$$.updateSvgSize();$$.transformAll(withTransitionForTransform,transitions);$$.legendHasRendered=true};top_chart_internal_fn.getLegendVerticalPosition=function(){var $$=this;if(TOP.chart.Browser.isIE())return $$.legend.node().getBoundingClientRect().y;return $$.legend.node().getBBox().y};top_chart_internal_fn.getLegendHorizontalPosition=function(){var $$=this;if(TOP.chart.Browser.isIE())return $$.legend.node().getBoundingClientRect().x;return $$.legend.node().getBBox().x};top_chart_internal_fn.initLegendBackground=function(){var $$=this,config=$$.config;if(TOP.chart.Browser.isIE())var legendG=$$.legend.node().getBoundingClientRect();else var legendG=$$.legend.node().getBBox();$$.legendBackground=$$.legend.append("rect").attr("class",CLASS.legendBackground)};top_chart_internal_fn.updateLegendBackground=function(){var $$=this,config=$$.config;if(TOP.chart.Browser.isIE())var legendG=$$.legend.node().getBoundingClientRect();else var legendG=$$.legend.node().getBBox();$$.legendBackground.attr("x",legendG.x-config.legend_padding).attr("y",legendG.y-config.legend_padding-config.legend_itemMarginTop).attr("width",legendG.width+config.legend_padding*2).attr("height",legendG.height+config.legend_padding*2+config.legend_itemMarginTop).style("fill",config.legend_backgroundColor||"none");if(config.legend_borderWidth>0){$$.legendBackground.style("stroke-width",config.legend_borderWidth).style("stroke",config.legend_borderColor).attr("rx",config.legend_borderRadius).attr("ry",config.legend_borderRadius)}};top_chart_internal_fn.cleanLegendBackground=function(){var $$=this,config=$$.config;$$.legendBackground.attr("width",0).attr("height",0)};top_chart_internal_fn.generateTickTimeInterval=function(standardPosition,tickCount){var $$=this,config=$$.config,domain=$$.getXDomain($$.data.targets),interval=config.xAxis_tickTimeInterval,timeTicks=[],count=1,tick=0;if(!domain[0].getTime)return domain;if(standardPosition==="normal"){$$.firstestTick=domain[0].getTime();var firstTick=$$.firstestTick,lastTick=domain[1].getTime(),interval=Math.floor((lastTick-firstTick)/(tickCount-1)),tick=firstTick;while(tick<=lastTick){timeTicks.push(new Date(tick));tick=tick+interval;count++;if(tickCount&&tickCount<count){break}}return timeTicks}else if(standardPosition==="start"){if(!$$.firstestTick||config.xAxis_tick_reset){if(config.xAxis_tick_floor)$$.firstestTick=Math.floor(domain[0].getTime()/1e3)*1e3;else $$.firstestTick=domain[0].getTime()}while($$.firstestTick<domain[0].getTime()){$$.firstestTick=$$.firstestTick+interval}var firstTick=$$.firstestTick,lastTick=domain[1].getTime(),tick=firstTick;while(tick<lastTick){timeTicks.push(new Date(tick));tick=tick+interval;count++;if(tickCount&&tickCount<count)break}return timeTicks}else{if(!$$.firstestTick||config.xAxis_tick_reset)if(config.xAxis_tick_floor)$$.firstestTick=Math.floor(domain[1].getTime()/1e3)*1e3;else $$.firstestTick=domain[1].getTime();if($$.firstestTick+interval<domain[1].getTime()){var newCount=(domain[1].getTime()-$$.firstestTick)/interval;newCount=Math.floor(newCount);var newFirstestTick=$$.firstestTick+newCount*interval;$$.firstestTick=newFirstestTick}var firstTick=domain[0].getTime(),lastTick=$$.firstestTick,tick=lastTick;while(firstTick<tick){timeTicks.push(new Date(tick));tick=tick-interval;count++;if(tickCount&&tickCount<count)break}timeTicks.sort();return timeTicks}};function Axis(owner){API.call(this,owner)}Axis.prototype.init=function init(){var $$=this.owner,config=$$.config,main=$$.main;$$.axes.x=main.append("g").attr("class",CLASS.axis+" "+CLASS.axisX).attr("clip-path",$$.clipPathForXAxis).attr("transform",$$.getTranslate("x")).style("display",config.xAxis_show?"block":"none");$$.axes.x.append("text").attr("class",CLASS.axisXLabel).attr("transform",config.chart_inverted?"rotate(-90)":"").style("text-anchor",this.textAnchorForXAxisLabel.bind(this));$$.axes.y=main.append("g").attr("class",CLASS.axis+" "+CLASS.axisY).attr("clip-path",config.axis_y_inner?"":$$.clipPathForYAxis).attr("transform",$$.getTranslate("y")).style("display",config.yAxis_show?"block":"none");$$.axes.y.append("text").attr("class",CLASS.axisYLabel).attr("transform",config.chart_inverted?"":"rotate(-90)").style("text-anchor",this.textAnchorForYAxisLabel.bind(this));$$.axes.y2=main.append("g").attr("class",CLASS.axis+" "+CLASS.axisY2).attr("clip-path",$$.clipPathForY2Axis).attr("transform",$$.getTranslate("y2")).style("display",config.axis_y2_show?"block":"none");$$.axes.y2.append("text").attr("class",CLASS.axisY2Label).attr("transform",config.chart_inverted?"":"rotate(-90)").style("text-anchor",this.textAnchorForY2AxisLabel.bind(this))};Axis.prototype.getXAxis=function getXAxis(scale,orient,tickFormat,tickValues,withOuterTick,withoutTransition,withoutRotateTickText,show){var $$=this.owner,config=$$.config,axisParams={isCategory:$$.isCategorized(),withOuterTick:withOuterTick,tickMultiline:config.xAxis_tick_multiline,tickLimit:config.xAxis_tick_limit_enabled,tickLimitCount:config.xAxis_tick_limit_count,tickLimitType:config.xAxis_tick_limit_type,tickWidth:config.axis_x_tick_width,tickTextRotate:withoutRotateTickText?0:config.xAxis_tick_rotate,withoutTransition:withoutTransition,maxWidth:config.xAxis_tick_width,isDateTime:$$.isTimeSeries()},axis=TOP_axis($$.d3,axisParams,show).scale(scale).orient(orient);if($$.isTimeSeries()&&tickValues){tickValues=tickValues.map(function(v){return $$.parseDate(v)})}axis.tickFormat(tickFormat).tickValues(tickValues);if($$.isCategorized()){axis.tickCentered(config.axis_x_tick_centered);if(isEmpty(config.axis_x_tick_culling)){config.axis_x_tick_culling=false}}return axis};Axis.prototype.updateXAxisTickValues=function updateXAxisTickValues(targets,axis){var $$=this.owner,config=$$.config,tickValues,tickCount;tickCount=config.xAxis_tickAmount||config.xAxis_tickAmount===0?config.xAxis_tickAmount:config.xAxis_tick_count?config.xAxis_tick_count:d3.round((config.chart_inverted?$$.height:$$.width+($$.getCurrentPaddingLeft()+10))/config.xAxis_tickPixelInterval);$$.tickValues=this.generateTickValues($$.mapTargetsToUniqueXs(targets),tickCount,$$.isTimeSeries(),undefined,$$.afterFlowTickValues);if(config.xAxis_tick_fit||config.xAxis_tickAmount||config.xAxis_tick_count||config.xAxis_tickPixelInterval){tickValues=$$.tickValues}if(axis){axis.tickValues(tickValues)}else{$$.xAxis.tickValues(tickValues)}if(config.xAxis_type==="datetime"&&!config.xAxis_tickTimeInterval&&(config.xAxis_tick_count||config.xAxis_tickAmount)){tickValues=$$.generateTickTimeInterval("normal",config.xAxis_tick_count);$$.xAxis.tickValues(tickValues)}else if(config.xAxis_type==="datetime"&&config.xAxis_tickTimeInterval){tickValues=$$.generateTickTimeInterval(config.xAxis_tick_from,config.xAxis_tick_count);$$.xAxis.tickValues(tickValues)}return tickValues};Axis.prototype.getYAxis=function getYAxis(scale,orient,tickFormat,tickValues,withOuterTick,withoutTransition,show){var axisParams={withOuterTick:withOuterTick,withoutTransition:withoutTransition},$$=this.owner,d3=$$.d3,config=$$.config,axis,base=config.yAxis_tick_base;if($$.isTimeSeriesY()){axis=TOP_axis(d3,axisParams,show).scale(scale).orient(orient).tickFormat(tickFormat);axis.ticks(d3.time[config.axis_y_tick_time_value],config.axis_y_tick_time_interval)}else if($$.isLogY()){scale.base(base);axis=TOP_axis(d3,axisParams,show).scale(scale.nice()).orient(orient).tickFormat(function(d){if(Math.log(d)/Math.log(base)>=0&&(Math.log(d)/Math.log(base)).toFixed(10)%1===0){return d3.format("f")(d)}else if(Math.log(d)/Math.log(base)<0&&(Math.log(d)/Math.log(base)).toFixed(10)%1===0){return d}else{return}})}else{axis=TOP_axis(d3,axisParams,show).scale(scale).orient(orient).tickFormat(tickFormat);axis.tickValues(tickValues)}return axis};Axis.prototype.getId=function getId(id){var config=this.owner.config;return id in config.data_axes?config.data_axes[id]:"y"};Axis.prototype.getXAxisTickFormat=function getXAxisTickFormat(){var $$=this.owner,config=$$.config,format=$$.isTimeSeries()?$$.defaultAxisTimeFormat:$$.isCategorized()?$$.categoryName:function(v){return v<0?v.toFixed(0):v};if(config.xAxis_timeFormat){if(isFunction(config.xAxis_timeFormat)){format=config.xAxis_timeFormat}else if($$.isTimeSeries()){format=function(date){var date=new Date(date);return date?$$.axisTimeFormat(config.xAxis_timeFormat)(date):""}}}return isFunction(format)?function(v){return format.call($$,v)}:format};Axis.prototype.getTickValues=function getTickValues(tickValues,axis){return tickValues?tickValues:axis?axis.tickValues():undefined};Axis.prototype.getXAxisTickValues=function getXAxisTickValues(){return this.getTickValues(this.owner.config.axis_x_tick_values,this.owner.xAxis)};Axis.prototype.getYAxisTickValues=function getYAxisTickValues(){return this.getTickValues(this.owner.config.yAxis_tick_values,this.owner.yAxis)};Axis.prototype.getY2AxisTickValues=function getY2AxisTickValues(){return this.getTickValues(this.owner.config.axis_y2_tick_values,this.owner.y2Axis)};Axis.prototype.getLabelOptionByAxisId=function getLabelOptionByAxisId(axisId){var $$=this.owner,config=$$.config,option;if(axisId==="y"){option=config.axis_y_label}else if(axisId==="y2"){option=config.axis_y2_label}else if(axisId==="x"){option=config.axis_x_label}return option};Axis.prototype.getLabelText=function getLabelText(axisId){var option=this.getLabelOptionByAxisId(axisId);return isString(option)?option:option?option.text:null};Axis.prototype.setLabelText=function setLabelText(axisId,text){var $$=this.owner,config=$$.config,option=this.getLabelOptionByAxisId(axisId);if(isString(option)){if(axisId==="y"){config.axis_y_label=text}else if(axisId==="y2"){config.axis_y2_label=text}else if(axisId==="x"){config.axis_x_label=text}}else if(option){option.text=text}};Axis.prototype.getLabelPosition=function getLabelPosition(axisId,defaultPosition){var option=this.getLabelOptionByAxisId(axisId),position=option&&typeof option==="object"&&option.position?option.position:defaultPosition;return{isInner:position.indexOf("inner")>=0,isOuter:position.indexOf("outer")>=0,isLeft:position.indexOf("left")>=0,isCenter:position.indexOf("center")>=0,isRight:position.indexOf("right")>=0,isTop:position.indexOf("top")>=0,isMiddle:position.indexOf("middle")>=0,isBottom:position.indexOf("bottom")>=0}};Axis.prototype.getXAxisLabelPosition=function getXAxisLabelPosition(){return this.getLabelPosition("x",this.owner.config.chart_inverted?"inner-top":"inner-right")};Axis.prototype.getYAxisLabelPosition=function getYAxisLabelPosition(){return this.getLabelPosition("y",this.owner.config.chart_inverted?"inner-right":"inner-top")};Axis.prototype.getY2AxisLabelPosition=function getY2AxisLabelPosition(){return this.getLabelPosition("y2",this.owner.config.chart_inverted?"inner-right":"inner-top")};Axis.prototype.getLabelPositionById=function getLabelPositionById(id){return id==="y2"?this.getY2AxisLabelPosition():id==="y"?this.getYAxisLabelPosition():this.getXAxisLabelPosition()};Axis.prototype.textForXAxisLabel=function textForXAxisLabel(){return this.getLabelText("x")};Axis.prototype.textForYAxisLabel=function textForYAxisLabel(){return this.getLabelText("y")};Axis.prototype.textForY2AxisLabel=function textForY2AxisLabel(){return this.getLabelText("y2")};Axis.prototype.xForAxisLabel=function xForAxisLabel(forHorizontal,position){var $$=this.owner;if(forHorizontal){return position.isLeft?0:position.isCenter?$$.width/2:$$.width}else{return position.isBottom?-$$.height:position.isMiddle?-$$.height/2:0}};Axis.prototype.dxForAxisLabel=function dxForAxisLabel(forHorizontal,position){if(forHorizontal){return position.isLeft?"0.5em":position.isRight?"-0.5em":"0"}else{return position.isTop?"-0.5em":position.isBottom?"0.5em":"0"}};Axis.prototype.textAnchorForAxisLabel=function textAnchorForAxisLabel(forHorizontal,position){if(forHorizontal){return position.isLeft?"start":position.isCenter?"middle":"end"}else{return position.isBottom?"start":position.isMiddle?"middle":"end"}};Axis.prototype.xForXAxisLabel=function xForXAxisLabel(){return this.xForAxisLabel(!this.owner.config.chart_inverted,this.getXAxisLabelPosition())};Axis.prototype.xForYAxisLabel=function xForYAxisLabel(){return this.xForAxisLabel(this.owner.config.chart_inverted,this.getYAxisLabelPosition())};Axis.prototype.xForY2AxisLabel=function xForY2AxisLabel(){return this.xForAxisLabel(this.owner.config.chart_inverted,this.getY2AxisLabelPosition())};Axis.prototype.dxForXAxisLabel=function dxForXAxisLabel(){return this.dxForAxisLabel(!this.owner.config.chart_inverted,this.getXAxisLabelPosition())};Axis.prototype.dxForYAxisLabel=function dxForYAxisLabel(){return this.dxForAxisLabel(this.owner.config.chart_inverted,this.getYAxisLabelPosition())};Axis.prototype.dxForY2AxisLabel=function dxForY2AxisLabel(){return this.dxForAxisLabel(this.owner.config.chart_inverted,this.getY2AxisLabelPosition())};Axis.prototype.dyForXAxisLabel=function dyForXAxisLabel(){var $$=this.owner,config=$$.config,position=this.getXAxisLabelPosition();if(config.chart_inverted){return position.isInner?"1.2em":-25-this.getMaxTickWidth("x")}else{return position.isInner?"-0.5em":config.axis_x_height?config.axis_x_height-10:"3em"}};Axis.prototype.dyForYAxisLabel=function dyForYAxisLabel(){var $$=this.owner,position=this.getYAxisLabelPosition();if($$.config.chart_inverted){return position.isInner?"-0.5em":"3em"}else{return position.isInner?"1.2em":-10-($$.config.axis_y_inner?0:this.getMaxTickWidth("y")+10)}};Axis.prototype.dyForY2AxisLabel=function dyForY2AxisLabel(){var $$=this.owner,position=this.getY2AxisLabelPosition();if($$.config.chart_inverted){return position.isInner?"1.2em":"-2.2em"}else{return position.isInner?"-0.5em":15+($$.config.axis_y2_inner?0:this.getMaxTickWidth("y2")+15)}};Axis.prototype.textAnchorForXAxisLabel=function textAnchorForXAxisLabel(){var $$=this.owner;return this.textAnchorForAxisLabel(!$$.config.chart_inverted,this.getXAxisLabelPosition())};Axis.prototype.textAnchorForYAxisLabel=function textAnchorForYAxisLabel(){var $$=this.owner;return this.textAnchorForAxisLabel($$.config.chart_inverted,this.getYAxisLabelPosition())};Axis.prototype.textAnchorForY2AxisLabel=function textAnchorForY2AxisLabel(){var $$=this.owner;return this.textAnchorForAxisLabel($$.config.chart_inverted,this.getY2AxisLabelPosition())};Axis.prototype.getMaxTickWidth=function getMaxTickWidth(id,withoutRecompute){var $$=this.owner,config=$$.config,maxWidth=0,targetsToShow,scale,axis,dummy,svg;if(withoutRecompute&&$$.currentMaxTickWidths[id]){return $$.currentMaxTickWidths[id]}if($$.svg){targetsToShow=$$.filterTargetsToShow($$.data.targets);if(id==="y"){scale=$$.y.copy().domain($$.getYDomain(targetsToShow,"y"));axis=this.getYAxis(scale,$$.yOrient,config.yAxis_tick_format,$$.yAxisTickValues,false,true,config.yAxis_show)}else if(id==="y2"){scale=$$.y2.copy().domain($$.getYDomain(targetsToShow,"y2"));axis=this.getYAxis(scale,$$.y2Orient,config.axis_y2_tick_format,$$.y2AxisTickValues,false,true,config.axis_y2_show)}else{scale=$$.x.copy().domain($$.getXDomain(targetsToShow));axis=this.getXAxis(scale,$$.xOrient,$$.xAxisTickFormat,$$.xAxisTickValues,false,true,true,config.xAxis_show);this.updateXAxisTickValues(targetsToShow,axis)}dummy=$$.d3.select("body").append("div").classed("TOP",true);svg=dummy.append("svg").style("visibility","hidden").style("position","fixed").style("top",0).style("left",0),svg.append("g").call(axis).each(function(){$$.d3.select(this).selectAll("text").each(function(){var box=this.getBoundingClientRect();if(maxWidth<box.width){maxWidth=box.width}});dummy.remove()})}$$.currentMaxTickWidths[id]=maxWidth<=0?$$.currentMaxTickWidths[id]:maxWidth;return $$.currentMaxTickWidths[id]};Axis.prototype.updateLabels=function updateLabels(withTransition){var $$=this.owner;var axisXLabel=$$.main.select("."+CLASS.axisX+" ."+CLASS.axisXLabel),axisYLabel=$$.main.select("."+CLASS.axisY+" ."+CLASS.axisYLabel),axisY2Label=$$.main.select("."+CLASS.axisY2+" ."+CLASS.axisY2Label);(withTransition?axisXLabel.transition():axisXLabel).attr("x",this.xForXAxisLabel.bind(this)).attr("dx",this.dxForXAxisLabel.bind(this)).attr("dy",this.dyForXAxisLabel.bind(this)).text(this.textForXAxisLabel.bind(this));(withTransition?axisYLabel.transition():axisYLabel).attr("x",this.xForYAxisLabel.bind(this)).attr("dx",this.dxForYAxisLabel.bind(this)).attr("dy",this.dyForYAxisLabel.bind(this)).text(this.textForYAxisLabel.bind(this));
(withTransition?axisY2Label.transition():axisY2Label).attr("x",this.xForY2AxisLabel.bind(this)).attr("dx",this.dxForY2AxisLabel.bind(this)).attr("dy",this.dyForY2AxisLabel.bind(this)).text(this.textForY2AxisLabel.bind(this))};Axis.prototype.getPadding=function getPadding(padding,key,defaultValue,domainLength){if(!isValue(padding[key])){return defaultValue}if(padding.unit==="ratio"){return padding[key]*domainLength}return this.convertPixelsToAxisPadding(padding[key],domainLength)};Axis.prototype.convertPixelsToAxisPadding=function convertPixelsToAxisPadding(pixels,domainLength){var $$=this.owner,length=$$.config.chart_inverted?$$.width:$$.height;return domainLength*(pixels/length)};Axis.prototype.generateTickValues=function generateTickValues(values,tickCount,forTimeSeries,integer,afterFlowTickValues){var tickValues=values,targetCount,start,end,count,interval,i,tickValue,t,$$=this.owner,config=$$.config,length=config.chart_inverted?$$.height:$$.width,decimalPoints=config.yAxis_tick_toFixed;if(config.yAxis_max&&(config.yAxis_min||config.yAxis_min===0)&&config.yAxis_tick_interval&&$$.hasType("equalizer")&&values===$$.y.domain()){interval=config.yAxis_tick_interval;for(t=config.yAxis_min;t<config.yAxis_max;t+=interval){tickValues.push(t)}tickValues.push(config.yAxis_max);return tickValues}if(!forTimeSeries){tickValues=tickValues.sort(function(a,b){return a-b})}if(tickCount===0){return[]}if(tickCount&&!$$.isCategorized()||tickCount&&afterFlowTickValues===undefined){targetCount=isFunction(tickCount)?tickCount():tickCount;if(targetCount===1){tickValues=[values[0]]}else if(targetCount===2){tickValues=[values[0],values[values.length-1]]}else if(targetCount>2){count=targetCount-2;start=values[0];end=values[values.length-1];interval=(end-start)/(count+1);if(afterFlowTickValues!==undefined&&afterFlowTickValues!==null&&afterFlowTickValues!==false&&afterFlowTickValues.length!==0){if(config.xAxis_type==="datetime"){tickValues=afterFlowTickValues;if(values[0]>tickValues[0]){tickValues.shift()}if(values[values.length-1]>tickValues[tickValues.length-1]){tickValues.push(new Date(tickValues[tickValues.length-1].getTime()+interval))}return tickValues}else{tickValues=afterFlowTickValues;if(values[0]>tickValues[0]){tickValues.shift()}if(values[values.length-1]>tickValues[tickValues.length-1]){tickValues.push(tickValues[tickValues.length-1]+interval)}return tickValues}}if(!integer){interval=Math.ceil(interval);start=Math.floor(start);end=Math.ceil(end)}else interval=interval.toFixed(decimalPoints);tickValues=[start.constructor===Number?start.toFixed()/1:start];for(i=0;i<count+1;i++){tickValue=+start+interval*(i+1);tickValues.push(forTimeSeries?new Date(tickValue):tickValue)}if(tickValues[0]===0&&tickValues[tickValues.length-1]===0){tickValues[tickValues.length-1]=1}}}return tickValues};Axis.prototype.generateTransitions=function generateTransitions(duration){var $$=this.owner,axes=$$.axes;return{axisX:duration?axes.x.transition().duration(duration):axes.x,axisY:duration?axes.y.transition().duration(duration):axes.y,axisY2:duration?axes.y2.transition().duration(duration):axes.y2}};Axis.prototype.redraw=function redraw(transitions,isHidden){var $$=this.owner,config=$$.config;$$.axes.x.style("opacity",isHidden?0:1);$$.axes.y.style("opacity",isHidden?0:1);$$.axes.y2.style("opacity",isHidden?0:1);$$.axes.x.selectAll("."+"tick").style("display",$$.config.xAxis_show?"block":"none");$$.axes.y.selectAll("."+"tick").style("display",$$.config.yAxis_show?"block":"none");$$.axes.y2.selectAll("."+"tick").style("display",$$.config.axis_y2_show?"block":"none");$$.main.select("."+CLASS.axisY2).attr("transform",$$.getTranslate("y2")).style("display",config.axis_y2_show?"block":"none");$$.main.select("."+CLASS.axisX).selectAll("."+"tick").selectAll("text").attr("class","tick-x-text");$$.main.select("."+CLASS.axisY).selectAll("."+"tick").selectAll("text").attr("class","tick-y-text");$$.main.select("."+CLASS.axisY2).selectAll("."+"tick").selectAll("text").attr("class","tick-y2-text");transitions.axisX.call($$.xAxis);transitions.axisY.call($$.yAxis);transitions.axisY2.call($$.y2Axis)};top_chart_internal_fn.getClipPath=function(id){var isIE9=window.navigator.appVersion.toLowerCase().indexOf("msie 9.")>=0;return"url("+(isIE9?"":document.URL.split("#")[0])+"#"+id+")"};top_chart_internal_fn.appendClip=function(parent,id){return parent.append("clipPath").attr("id",id).append("rect")};top_chart_internal_fn.getAxisClipX=function(forHorizontal){var left=Math.max(30,this.margin.left);return forHorizontal?-(1+left):-(left-1)};top_chart_internal_fn.getAxisClipY=function(forHorizontal){return forHorizontal?-20:-this.margin.top};top_chart_internal_fn.getXAxisClipX=function(){var $$=this;return $$.getAxisClipX(!$$.config.chart_inverted)};top_chart_internal_fn.getXAxisClipY=function(){var $$=this;return $$.getAxisClipY(!$$.config.chart_inverted)};top_chart_internal_fn.getYAxisClipX=function(){var $$=this;return $$.config.axis_y_inner?-1:$$.getAxisClipX($$.config.chart_inverted)};top_chart_internal_fn.getYAxisClipY=function(){var $$=this;return $$.getAxisClipY($$.config.chart_inverted)};top_chart_internal_fn.getAxisClipWidth=function(forHorizontal){var $$=this,left=Math.max(30,$$.margin.left),right=Math.max(30,$$.margin.right);return forHorizontal?$$.width+2+left+right:$$.margin.left+20};top_chart_internal_fn.getAxisClipHeight=function(forHorizontal){return(forHorizontal?this.margin.bottom:this.margin.top+this.height)+20};top_chart_internal_fn.getXAxisClipWidth=function(){var $$=this;return $$.getAxisClipWidth(!$$.config.chart_inverted)};top_chart_internal_fn.getXAxisClipHeight=function(){var $$=this;return $$.getAxisClipHeight(!$$.config.chart_inverted)};top_chart_internal_fn.getYAxisClipWidth=function(){var $$=this;return $$.getAxisClipWidth($$.config.chart_inverted)+($$.config.axis_y_inner?20:0)};top_chart_internal_fn.getYAxisClipHeight=function(){var $$=this;return $$.getAxisClipHeight($$.config.chart_inverted)};top_chart_internal_fn.initPie=function(){var $$=this,d3=$$.d3,config=$$.config;$$.pie=d3.layout.pie().sort(null).value(function(d){return d.values[0].value});if(!config.data_order){$$.pie.sort(null)}};top_chart_internal_fn.updateRadius=function(){var $$=this,config=$$.config,w=config.chart_shape_width;$$.radiusExpanded=Math.min($$.arcWidth,$$.arcHeight)/2;if(!$$.hasType("donut")&&!$$.hasType("pie"))$$.radius=$$.radiusExpanded*.95;else if(config.chart_spacing.top!==undefined){$$.radius=$$.radiusExpanded*.95-config.chart_spacing.top;$$.radiusExpanded=$$.radius*1.1}else if($$.radiusExpanded>=135){$$.radius=$$.radiusExpanded*.95-40;$$.radiusExpanded=$$.radius*1.1}else{$$.radius=$$.radiusExpanded*(135/185);$$.radiusExpanded=$$.radius*1.1}$$.innerRadiusRatio=w?($$.radius-w)/$$.radius:.33;$$.innerRadius=$$.hasType("circulargauge")?$$.radius*72/96:$$.hasType("donut")||$$.hasType("angulargauge")||$$.hasType("circulargauge")?$$.radius*$$.innerRadiusRatio:0};top_chart_internal_fn.updateArc=function(){var $$=this;$$.svgArc=$$.getSvgArc();$$.svgArcExpanded=$$.getSvgArcExpanded();$$.svgArcExpandedSub=$$.getSvgArcExpanded(.98);$$.svgArcTranslate=$$.getSvgArcTranslated()};top_chart_internal_fn.updateAngle=function(d){var $$=this,config=$$.config,found=false,index=0,gMin=config.yAxis_min||config.angular_gauge_min,gMax=config.yAxis_max||config.angular_gauge_max,gTic,gValue;$$.pie($$.filterTargetsToShow($$.data.targets)).forEach(function(t){if(!found&&t.data.id===d.data.id){found=true;d=t;d.index=index}index++});if(isNaN(d.startAngle)){d.startAngle=0}if(isNaN(d.endAngle)){d.endAngle=d.startAngle}if($$.isAngularGaugeType(d.data)){gTic=Math.PI/(gMax-gMin);gValue=d.value<gMin?0:d.value<gMax?d.value-gMin:gMax-gMin;d.startAngle=-1*(Math.PI/2);d.endAngle=d.startAngle+gTic*gValue}if($$.isDonutType(d.data)&&config.donut_semiCircle){d.startAngle=d.startAngle/2-Math.PI/2;d.endAngle=d.endAngle/2-Math.PI/2}if($$.isCircularGaugeType(d.data)){gTic=Math.PI*2/(gMax-gMin);gValue=d.value<gMin?0:d.value<gMax?d.value-gMin:gMax-gMin;d.startAngle=0;d.endAngle=d.startAngle+gTic*gValue}return found?d:null};top_chart_internal_fn.getSvgArc=function(){var $$=this,arc=$$.d3.svg.arc().outerRadius($$.radius).innerRadius($$.innerRadius),twoPI=Math.PI*2,newArc=function(d,withoutUpdate){var updated;if(withoutUpdate){return arc(d)}updated=$$.updateAngle(d);return updated?arc(updated):"M 0 0"};newArc.centroid=arc.centroid;return newArc};top_chart_internal_fn.getSvgArcExpanded=function(rate){var $$=this,arc=$$.d3.svg.arc().outerRadius($$.radiusExpanded*(rate?rate:1)).innerRadius($$.innerRadius);return function(d){var updated=$$.updateAngle(d);return updated?arc(updated):"M 0 0"}};top_chart_internal_fn.getSvgArcTranslated=function(){var $$=this;return function(d){var updated=$$.updateAngle(d),startAngle=updated.startAngle,endAngle=updated.endAngle,halfAngle=startAngle+.5*(endAngle-startAngle),magnitude=Math.abs(-1/Math.sin((endAngle-startAngle)/2)*7);if(magnitude>12)magnitude=12;var dX=magnitude*Math.sin(halfAngle),dY=-magnitude*Math.cos(halfAngle);return"translate("+dX+","+dY+")"}};top_chart_internal_fn.getArc=function(d,withoutUpdate,force){return force||this.isArcType(d.data)?this.svgArc(d,withoutUpdate):"M 0 0"};top_chart_internal_fn.transformForArcLabel=function(d){var $$=this,updated=$$.updateAngle(d),c,x,y,h,ratio,translate="";if(updated&&!$$.hasType("angulargauge")&&!$$.hasType("circulargauge")){c=this.svgArc.centroid(updated);x=isNaN(c[0])?0:c[0];y=isNaN(c[1])?0:c[1];h=Math.sqrt(x*x+y*y);ratio=$$.radius&&h?(36/$$.radius>.375?1.175-36/$$.radius:.8)*$$.radius/h:0;translate="translate("+x*ratio+","+y*ratio+")"}return translate};top_chart_internal_fn.getArcRatio=function(d){var $$=this,whole=$$.hasType("angulargauge")||$$.hasType("donut")&&$$.config.donut_semiCircle?Math.PI:Math.PI*2;return d?(d.endAngle-d.startAngle)/whole:null};top_chart_internal_fn.convertToArcData=function(d){return this.addName({id:d.data.id,value:d.value,ratio:this.getArcRatio(d),index:d.index})};top_chart_internal_fn.textForArcLabel=function(d){var $$=this,updated,value,ratio,id,format,max=$$.config.yAxis_max||$$.config.angular_gauge_max;if(!$$.shouldShowArcLabel()){return""}updated=$$.updateAngle(d);value=updated?updated.value:null;ratio=$$.getArcRatio(updated);id=d.data.id;if(!$$.hasType("angulargauge")&&!$$.meetsArcLabelThreshold(ratio)){return""}format=$$.getArcLabelFormat();if($$.hasType("circulargauge")){ratio=value*100/max;return ratio%1===0?ratio:ratio.toFixed(1)}return format?format(value,ratio,id):$$.defaultValueFormat(value)};top_chart_internal_fn.expandArc=function(targetIds){var $$=this,config=$$.config,interval;if($$.transiting){interval=window.setInterval(function(){if(!$$.transiting){window.clearInterval(interval);if($$.legend.selectAll(".TOP-legend-item-focused").size()>0){$$.expandArc(targetIds)}}},10);return}targetIds=$$.mapToTargetIds(targetIds);if(config.chart_type==="pie"){$$.svg.selectAll($$.selectorTargets(targetIds,"."+CLASS.chartArc)).each(function(d){if(!$$.shouldExpand(d.data.id)){return}$$.d3.select(this).selectAll("path").transition().duration(50).attr("transform",$$.svgArcTranslate).transition().duration(100).each(function(d){if($$.isDonutType(d.data)){}})})}else{$$.svg.selectAll($$.selectorTargets(targetIds,"."+CLASS.chartArc)).each(function(d){if(!$$.shouldExpand(d.data.id)){return}$$.d3.select(this).selectAll("path").transition().duration(50).attr("d",$$.svgArcExpanded).transition().duration(100).attr("d",$$.svgArcExpandedSub).each(function(d){if($$.isDonutType(d.data)){}})})}};top_chart_internal_fn.unexpandArc=function(targetIds){var $$=this;if($$.transiting){return}targetIds=$$.mapToTargetIds(targetIds);$$.svg.selectAll($$.selectorTargets(targetIds,"."+CLASS.chartArc)).selectAll("path").transition().duration(50).attr("transform","").attr("d",$$.svgArc);$$.svg.selectAll("."+CLASS.arc).style("opacity",1)};top_chart_internal_fn.shouldExpand=function(id){var $$=this,config=$$.config;return $$.isDonutType(id)&&config.donut_expand||$$.isAngularGaugeType(id)&&config.angular_gauge_expand||$$.isCircularGaugeType(id)&&config.angular_gauge_expand||$$.isPieType(id)&&config.pie_expand};top_chart_internal_fn.shouldShowArcLabel=function(){var $$=this,config=$$.config,shouldShow=true;if($$.hasType("donut")){shouldShow=config.donut_label_show}else if($$.hasType("pie")){shouldShow=config.pie_label_show}return shouldShow};top_chart_internal_fn.meetsArcLabelThreshold=function(ratio){var $$=this,config=$$.config,threshold=$$.hasType("donut")?config.donut_label_threshold:config.pie_label_threshold;return ratio>=threshold};top_chart_internal_fn.getArcLabelFormat=function(){var $$=this,config=$$.config,format=config.pie_label_format;if(config.dataLabels_format("a")!=="a")return format=config.dataLabels_format;if($$.hasType("angulargauge")){format=config.angular_gauge_label_format}else if($$.hasType("donut")){format=config.donut_label_format}return format};top_chart_internal_fn.getArcTitle=function(){var $$=this;return $$.hasType("donut")?$$.config.donut_title:""};top_chart_internal_fn.updateTargetsForArc=function(targets){var $$=this,main=$$.main,mainPieUpdate,mainPieEnter,classChartArc=$$.classChartArc.bind($$),classArcs=$$.classArcs.bind($$),classFocus=$$.classFocus.bind($$);mainPieUpdate=main.select("."+CLASS.chartArcs).selectAll("."+CLASS.chartArc).data($$.pie(targets)).attr("class",function(d){return classChartArc(d)+classFocus(d.data)});mainPieEnter=mainPieUpdate.enter().append("g").attr("class",classChartArc);mainPieEnter.append("g").attr("class",classArcs);if($$.hasDataLabel()||$$.hasType("circulargauge")||$$.hasType("angulargauge")){mainPieEnter.append("text").attr("dy",$$.hasType("angulargauge")?"-.1em":".35em").style("opacity",0).style("text-anchor","middle").style("pointer-events","none")}};top_chart_internal_fn.initArc=function(){var $$=this;$$.arcs=$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartArcs).attr("transform",$$.getTranslate("arc"));$$.arcs.append("text").attr("class",CLASS.chartArcsTitle).style("text-anchor","middle").text($$.getArcTitle());$$.arcs.append("path").attr("class",CLASS.chartArcsBackground)};top_chart_internal_fn.redrawArc=function(duration,durationForExit,withTransform){var $$=this,d3=$$.d3,config=$$.config,main=$$.main,mainArc,max=config.yAxis_max||config.angular_gauge_max;mainArc=main.selectAll("."+CLASS.arcs).selectAll("."+CLASS.arc).data($$.arcData.bind($$));mainArc.enter().append("path").attr("class",$$.classArc.bind($$)).style("fill",function(d){if(!$$.isCircularGaugeType(d.data)){return $$.color(d.data)[0]}else{return $$.getGaugeColor(d.data/max*100,$$.config.gauge_breaks)[0]}}).style("cursor",function(d){return config.interaction_enabled&&config.data_selection_isselectable(d)?"pointer":null}).style("opacity",0).each(function(d){if($$.isAngularGaugeType(d.data)){d.startAngle=d.endAngle=-1*(Math.PI/2)}else if($$.isAngularGaugeType(d.data)){d.startAngle=d.endAngle=0}this._current=d});mainArc.attr("transform",function(d){return!($$.isAngularGaugeType(d.data)||$$.isCircularGaugeType(d.data))&&withTransform?"scale(0)":""}).style("opacity",function(d){return d===this._current?0:1}).on("mouseover",config.interaction_enabled?function(d){var updated,arcData;if($$.transiting){return}updated=$$.updateAngle(d);arcData=$$.convertToArcData(updated);$$.expandArc(updated.data.id);$$.api.focus(updated.data.id);$$.toggleFocusLegend(updated.data.id,true);$$.config.data_onmouseover(arcData,this)}:null).on("mousemove",config.interaction_enabled?function(d){var updated=$$.updateAngle(d),arcData=$$.convertToArcData(updated),selectedData=[arcData];$$.showTooltip(selectedData,this)}:null).on("mouseout",config.interaction_enabled?function(d){var updated,arcData;if($$.transiting){return}updated=$$.updateAngle(d);arcData=$$.convertToArcData(updated);$$.unexpandArc(updated.data.id);$$.api.revert();$$.revertLegend();$$.hideTooltip();$$.config.data_onmouseout(arcData,this)}:null).on("click",config.interaction_enabled?function(d,i){var updated=$$.updateAngle(d),arcData=$$.convertToArcData(updated);if($$.toggleShape&&config.chart_selectable){$$.toggleShape(this,arcData,i)}$$.config.data_onclick.call($$.api,arcData,this)}:null).each(function(){$$.transiting=true}).transition().duration(duration).attrTween("d",function(d){var updated=$$.updateAngle(d),interpolate;if(!updated){return function(){return"M 0 0"}}if(isNaN(this._current.startAngle)){this._current.startAngle=0}if(isNaN(this._current.endAngle)){this._current.endAngle=this._current.startAngle}interpolate=d3.interpolate(this._current,updated);this._current=interpolate(0);return function(t){var interpolated=interpolate(t);interpolated.data=d.data;return $$.getArc(interpolated,true)}}).attr("transform",withTransform?"scale(1)":"").style("fill",function(d){return $$.isCircularGaugeType(d.data)?$$.getGaugeColor(d.data.values[0].value/max*100)[0]:$$.levelColor?$$.levelColor(d.data.values[0].value):$$.color(d.data.id)[0]}).style("opacity",1).call($$.endall,function(){$$.transiting=false});mainArc.exit().transition().duration(durationForExit).style("opacity",0).remove();main.selectAll("."+CLASS.chartArc).select("text").style("opacity",0).attr("class",function(d){return $$.isAngularGaugeType(d.data)?CLASS.angularGaugeValue:$$.isCircularGaugeType(d.data)?CLASS.circularGaugeValue:""}).text($$.textForArcLabel.bind($$)).attr("transform",$$.transformForArcLabel.bind($$)).style("font-size",function(d){if(config.gauge_fontSize){return config.gauge_fontSize}else if($$.isAngularGaugeType(d.data)||$$.isCircularGaugeType(d.data)){return Math.round($$.radius/5)}else if(config.dataLabels_fontSize){return config.dataLabels_fontSize}else return 12}).transition().duration(duration).style("opacity",function(d){return $$.isTargetToShow(d.data.id)&&$$.isArcType(d.data)&&d.data?1:0}).style("visibility",function(d){return d.data.values[0].value===0&&($$.hasType("donut")||$$.hasType("pie"))?"hidden":"visible"});main.select("."+CLASS.chartArcsTitle).style("opacity",$$.hasType("donut")||$$.hasType("angulargauge")?1:0);if($$.hasType("angulargauge")){$$.arcs.select("."+CLASS.chartArcsBackground).attr("d",function(){var d={data:[{value:max}],startAngle:-1*(Math.PI/2),endAngle:Math.PI/2};return $$.getArc(d,true,true)});$$.arcs.select("."+CLASS.chartArcsGaugeUnit).attr("dy",".75em").text(config.angular_gauge_label_show?config.angular_gauge_units:"");$$.arcs.select("."+CLASS.chartArcsGaugeMin).attr("dx",-1*($$.innerRadius+($$.radius-$$.innerRadius)/2)+"px").attr("dy","1.2em").text(config.angular_gauge_label_show?config.yAxis_min:"");$$.arcs.select("."+CLASS.chartArcsGaugeMax).attr("dx",$$.innerRadius+($$.radius-$$.innerRadius)/2+"px").attr("dy","1.2em").text(config.angular_gauge_label_show?max:"")}if($$.hasType("circulargauge")){$$.arcs.select("."+CLASS.chartArcsBackground).attr("d",function(){var d={data:[{value:max}],startAngle:0,endAngle:Math.PI*2};return $$.getArc(d,true,true)});$$.arcs.select("."+CLASS.circularGaugeValue).style("font-family","Arial, Helvetica, sans-serif, ").style("font-size",function(){if(config.gauge_fontSize){return config.gauge_fontSize+"px"}else return"30px"}).style("font-weight",600).attr("fill",function(d){return $$.getGaugeColor(d.value/max*100)[1]});if(TOP.chart.Browser.isIE())$$.arcs.select("."+CLASS.chartArcsGaugeUnit).attr("dy",".75em").text("%").attr("transform","translate(0,"+$$.arcs.select("."+CLASS.circularGaugeValue).node().getBoundingClientRect().height/2+")");else $$.arcs.select("."+CLASS.chartArcsGaugeUnit).attr("dy",".75em").text("%").attr("transform","translate(0,"+$$.arcs.select("."+CLASS.circularGaugeValue).node().getBBox().height/2+")")}if($$.hasType("pie")||$$.hasType("donut")){$$.arcs.select("."+CLASS.chartArcsBackground).attr("d",function(){var d={data:[{value:max}],startAngle:!config.donut_semiCircle?0:-1*(Math.PI/2),endAngle:!config.donut_semiCircle?Math.PI*2:Math.PI/2};return $$.getArc(d,true,true)})}};top_chart_internal_fn.initAngularGauge=function(){var arcs=this.arcs;if(this.hasType("angulargauge")){arcs.append("text").attr("class",CLASS.chartArcsGaugeUnit).style("text-anchor","middle").style("pointer-events","none");arcs.append("text").attr("class",CLASS.chartArcsGaugeMin).style("text-anchor","middle").style("pointer-events","none").style("font","10px verdana");arcs.append("text").attr("class",CLASS.chartArcsGaugeMax).style("text-anchor","middle").style("pointer-events","none").style("font","10px verdana")}};top_chart_internal_fn.initCircularGauge=function(){var arcs=this.arcs;if(this.hasType("circulargauge")){arcs.append("text").attr("class",CLASS.chartArcsGaugeUnit).style("text-anchor","middle").style("pointer-events","none").style("font-family","Arial, Helvetica, sans-serif, ").style("font-size","12px").style("fill","#b3b4b4")}};top_chart_internal_fn.getAngularGaugeLabelHeight=function(){return this.config.angular_gauge_label_show?20:0};top_chart_internal_fn.initLinearGauge=function(){var $$=this,labelBox,max=$$.config.yAxis_max||$$.config.gauge_max,linearGauges=$$.main.select("."+CLASS.chart).append("g").attr("class",CLASS.chartLinearGauges);if($$.hasType("bargauge")||$$.hasType("columngauge")){linearGauges.append("rect").attr("class",CLASS.chartLinearGaugeBackground).attr("fill","#e9e9e9");$$.config.yAxis_tick_values=[0,max]}};top_chart_internal_fn.updateTargetsForColumnGauge=function(targets){var $$=this,main=$$.main,config=$$.config,labelBox,percentLabelBox,mainGaugeUpdate,mainGaugeEnter,mainLinerGauge,mainLinearGauges,classChartLinearGauge=$$.classChartLinearGauge.bind($$),classLinearGauges=$$.classLinearGauges.bind($$),classLinearGauge=$$.classLinearGauge.bind($$),classLinearGauge2=$$.classLinearGauge2.bind($$),classLinearGauge3=$$.classLinearGauge3.bind($$);mainGaugeUpdate=main.select("."+CLASS.chartLinearGauges).selectAll("."+CLASS.chartLinearGauge).data(targets).attr("class",function(d){return classChartLinearGauge(d)});mainGaugeEnter=mainGaugeUpdate.enter().append("g").attr("class",classChartLinearGauge);mainLinearGauges=mainGaugeEnter.append("g").attr("class",classLinearGauges);mainLinearGauges.append("rect").attr("class",classLinearGauge);mainLinearGauges.append("rect").attr("class",classLinearGauge2);mainLinearGauges.append("rect").attr("class",classLinearGauge3);mainLinearGauges.append("g").attr("class",CLASS.linearGaugeGrid);percentLabelBox=mainLinearGauges.append("g").attr("class",CLASS.linearGaugePercentLabel);percentLabelBox.append("rect").attr("class",CLASS.linearGaugePercentLabelBackground).style("opacity",0).attr("width",0).attr("height",0).attr("fill","#000000").attr("rx",5).attr("ry",5).style("stroke-weight",0);percentLabelBox.append("text").style("text-anchor","middle").style("alignment-baseline","central").style("font-family","Arial,Helvetica,sans-serif, ").style("pointer-events","none").attr("class",CLASS.linearGaugePercent);percentLabelBox.append("text").style("opacity",0).style("text-anchor","start").style("alignment-baseline","central").style("pointer-events","none").attr("class",CLASS.linearGaugePercentUnit);labelBox=mainGaugeEnter.append("g").attr("class",CLASS.linearGaugeLabelBox);labelBox.append("rect").attr("class",CLASS.linearGaugeLabelBackground).attr("width",0).attr("height",0).attr("fill","#FFFFFF").style("stroke-weight",2).style("stroke","rgb(237, 242, 248)").style("opacity",1);labelBox.append("text").attr("class",CLASS.linearGaugeName).style("text-anchor","start").style("alignment-baseline","text-before-edge");labelBox.append("text").attr("class",CLASS.linearGaugeValueUnit).style("text-anchor","start").style("font-size","11px").style("font-weight",400).style("opacity",0).style("pointer-events","none");if(config.gauge_text){var gaugeText=config.gauge_text;if(typeof gaugeText==="string")gaugeText=gaugeText.split("\n");config.gauge_text=gaugeText;if(gaugeText.length>=2){labelBox.select("text").append("tspan").attr("class","gaugeText1");labelBox.select("text").append("tspan").attr("class","gaugeText2")}}};top_chart_internal_fn.updateTargetsForBarGauge=function(targets){var $$=this,main=$$.main,config=$$.config,labelBox,percentLabelBox,mainGaugeUpdate,mainGaugeEnter,mainLinerGauge,mainLinearGauges,classChartLinearGauge=$$.classChartLinearGauge.bind($$),classLinearGauges=$$.classLinearGauges.bind($$),classLinearGauge=$$.classLinearGauge.bind($$);mainGaugeUpdate=main.select("."+CLASS.chartLinearGauges).selectAll("."+CLASS.chartLinearGauge).data(targets).attr("class",function(d){return classChartLinearGauge(d)});mainGaugeEnter=mainGaugeUpdate.enter().append("g").attr("class",classChartLinearGauge);mainLinearGauges=mainGaugeEnter.append("g").attr("class",classLinearGauges);labelBox=mainGaugeEnter.append("g").attr("class",CLASS.linearGaugeLabelBox);labelBox.append("text").attr("class",CLASS.linearGaugeName).style("text-anchor","start").style("alignment-baseline","text-before-edge");percentLabelBox=labelBox.append("g").attr("class",CLASS.linearGaugePercentLabel);percentLabelBox.append("text").style("text-anchor","start").style("alignment-baseline","text-before-edge").style("font-family","Arial,Helvetica,sans-serif,").style("pointer-events","none").attr("class",CLASS.linearGaugePercent);percentLabelBox.append("text").style("opacity",0).style("text-anchor","start").style("alignment-baseline","text-before-edge").style("pointer-events","none").attr("class",CLASS.linearGaugePercentUnit);labelBox.append("text").attr("class",CLASS.linearGaugeValueUnit).style("text-anchor","end").style("opacity",0).style("pointer-events","none").style("font-size","11px").style("font-weight",400).style("alignment-baseline","text-before-edge");mainLinearGauges.append("rect").attr("class",classLinearGauge)};top_chart_internal_fn.transformForLinearGauge=function(element){var $$=this,config=$$.config,width=$$.getSvgRectWidth(),inverted=config.chart_inverted,main=$$.main;if(element==="gauge"||element==="background"){return function(){if(TOP.chart.Browser.isIE())var x=inverted?0:-$$.width/2-width/2,y=inverted?$$.main.select("."+CLASS.linearGaugePercentLabel).node().getBoundingClientRect().height+1:-main.select("."+CLASS.chartLinearGaugeBackground).attr("height"),rotation=inverted?0:180;else var x=inverted?0:-$$.width/2-width/2,y=inverted?$$.main.select("."+CLASS.linearGaugePercentLabel).node().getBBox().height+1:-main.select("."+CLASS.chartLinearGaugeBackground).attr("height"),rotation=inverted?0:180;return"rotate("+rotation+") translate("+x+","+y+")"}}else if(element==="gauge2"){return function(){var x=inverted?0:-$$.width/2-width/2,y=inverted?0:-main.select("."+CLASS.chartLinearGaugeBackground).attr("height"),rotation=inverted?0:180;x=x-20;return"rotate("+rotation+") translate("+x+","+y+")"}}else if(element==="gauge3"){return function(){var x=inverted?0:-$$.width/2-width/2-40,y=inverted?0:-main.select("."+CLASS.chartLinearGaugeBackground).attr("height"),rotation=inverted?0:180;return"rotate("+rotation+") translate("+x+","+y+")"}}else if(element==="label"){return function(){if(TOP.chart.Browser.isIE())var x=inverted?0:+$$.width/2-width/2,y=inverted?13:+main.select("."+CLASS.chartLinearGaugeBackground).attr("height")+5,rotation=inverted?0:0;else var x=inverted?0:+$$.width/2-width/2,y=inverted?0:+main.select("."+CLASS.chartLinearGaugeBackground).attr("height")+5,rotation=inverted?0:0;return"rotate("+rotation+") translate("+x+","+y+") "}}else if(element==="value"){return function(){var x=inverted?main.select("."+CLASS.chartLinearGaugeBackground).attr("width"):5,y=inverted?0:+main.select("."+CLASS.linearGaugeLabelBackground).attr("height")-5,rotation=inverted?0:0;return"rotate("+rotation+") translate("+x+","+y+") "}}else if(element==="percentLabel"){return function(){if(TOP.chart.Browser.isIE())var x=inverted?main.select("."+CLASS.linearGaugeName).node().getBoundingClientRect().width+15:main.select("."+CLASS.chartLinearGaugeBackground).attr("width")*-.8,y=inverted?-1:main.select("."+CLASS.chartLinearGaugeBackground).attr("height")*-.66,rotation=inverted?0:180;else var x=inverted?main.select("."+CLASS.linearGaugeName).node().getBBox().width+15:main.select("."+CLASS.chartLinearGaugeBackground).attr("width")*-.8,y=inverted?-1:main.select("."+CLASS.chartLinearGaugeBackground).attr("height")*-.66,rotation=inverted?0:180;return"rotate("+rotation+") translate("+x+","+y+") "}}else if(element==="name"){return function(){if(TOP.chart.Browser.isIE())var x=inverted?0:5,y=inverted?-2:15,rotation=inverted?0:0;else var x=inverted?0:5,y=inverted?0:5,rotation=inverted?0:0;return"rotate("+rotation+") translate("+x+","+y+") "}}else if(element==="percentValue"){return function(){if(TOP.chart.Browser.isIE())var x=inverted?0:main.select("."+CLASS.linearGaugePercentLabelBackground).attr("width")/2,y=inverted?0:main.select("."+CLASS.linearGaugePercentLabelBackground).attr("height")/2+5,rotation=inverted?0:0;else var x=inverted?0:main.select("."+CLASS.linearGaugePercentLabelBackground).attr("width")/2,y=inverted?0:main.select("."+CLASS.linearGaugePercentLabelBackground).attr("height")/2,rotation=inverted?0:0;return"rotate("+rotation+") translate("+x+","+y+") "}}else if(element==="unit"){return function(){if(TOP.chart.Browser.isIE())var x=inverted?main.select("."+CLASS.linearGaugePercent).node().getBoundingClientRect().width+2:main.select("."+CLASS.linearGaugePercent).node().getBoundingClientRect().width/2+5+main.select("."+CLASS.linearGaugePercentLabelBackground).attr("width")/2,y=inverted?0:main.select("."+CLASS.linearGaugePercentLabelBackground).attr("height")/2+5,rotation=inverted?0:0;else var x=inverted?main.select("."+CLASS.linearGaugePercent).node().getBBox().width+2:main.select("."+CLASS.linearGaugePercent).node().getBBox().width/2+5+main.select("."+CLASS.linearGaugePercentLabelBackground).attr("width")/2,y=inverted?0:main.select("."+CLASS.linearGaugePercentLabelBackground).attr("height")/2,rotation=inverted?0:0;return"rotate("+rotation+") translate("+x+","+y+") "}}};top_chart_internal_fn.getGaugeColor=function(percentValue,breakpoints){if(!breakpoints||breakpoints.length<3)breakpoints=[.25,.5,.75];breakpoints.sort();percentValue=percentValue/100;var statusColor=this.theme.statusColor,fatal=statusColor.fatal,critical=statusColor.critical,warning=statusColor.warning,normal=statusColor.normal,informative=statusColor.informative,terminate=statusColor.terminate;if(percentValue<breakpoints[0]){return[normal[0],normal[1],normal[2],normal[3]]}else if(percentValue<breakpoints[1]){return[warning[0],warning[1],warning[2],warning[3]]}else if(percentValue<breakpoints[2]){return[critical[0],critical[1],critical[2],critical[3]]}else{return[fatal[0],fatal[1],fatal[2],fatal[3]]}};top_chart_internal_fn.redrawLinearGauge=function(duration,durationForExit,withTransform){var $$=this,d3=$$.d3,config=$$.config,main=$$.main,mainLinearGauge,unit=config.chart_unit,width=$$.getSvgRectWidth(),height=$$.getSvgRectLength(),colorSet,inverted=config.chart_inverted,max=config.yAxis_max||config.gauge_max,gaugeGrid,gaugeGridData,gaugeGridDistance=2,i;main.select("."+CLASS.chartLinearGaugeBackground).attr(inverted?"width":"height",function(){var d={values:[{value:max}]};return $$.getRect(d,true,true)}).attr(inverted?"height":"width",width).attr("transform",$$.transformForLinearGauge("background"));mainLinearGauge=main.selectAll("."+CLASS.linearGauges).selectAll("."+CLASS.linearGauge).data($$.linearGaugeData.bind($$));main.select("."+CLASS.linearGauge).style("fill",function(d){colorSet=$$.getGaugeColor($$.getLinearGaugePercentFormat(d.values[0].value),$$.config.gauge_breaks);return inverted?colorSet[0]:colorSet[2]}).attr(inverted?"height":"width",width).transition().duration(duration).attr(inverted?"width":"height",function(d){return $$.getRect(d,true,true)});if($$.hasType("columngauge")){main.select("."+CLASS.linearGauge2).style("fill",function(d){return colorSet[1]}).attr(inverted?"height":"width",$$.getSvgRectWidth("gauge2")).transition().duration(duration).attr(inverted?"width":"height",function(d){return $$.getRect(d,true,true)});main.select("."+CLASS.linearGauge3).style("fill",function(d){return colorSet[0]}).attr(inverted?"height":"width",$$.getSvgRectWidth("gauge3")).transition().duration(duration).attr(inverted?"width":"height",function(d){
return $$.getRect(d,true,true)})}main.select("."+CLASS.linearGauges).attr("transform",$$.transformForLinearGauge("gauge"));mainLinearGauge.exit().transition().duration(durationForExit).style("opacity",0).remove();if($$.hasType("columngauge")){gaugeGridData=[];for(i=0;i<height;i=i+gaugeGridDistance){gaugeGridData.push(i)}gaugeGrid=main.select("."+CLASS.linearGaugeGrid).selectAll("line").data(gaugeGridData);gaugeGrid.exit().remove();gaugeGrid.enter().append("line").attr("x1",2).attr("y1",function(d){return d}).attr("x2",function(d){return d%10===0?12:8}).attr("y2",function(d){return d}).style("stroke","#f1f1f1").style("stroke-width","0.5")}main.selectAll("."+CLASS.chartLinearGauge).selectAll("."+CLASS.linearGaugePercentLabel).attr("transform",$$.transformForLinearGauge("percentLabel")).select("."+CLASS.linearGaugePercentLabelBackground).attr("width",width*.6).attr("height",height*.33).style("opacity",1);main.select("."+CLASS.linearGaugePercentLabel).select("."+CLASS.linearGaugePercent).style("opacity",0).attr("transform",$$.transformForLinearGauge("percentValue")).style("font-size",$$.hasType("bargauge")?"14px":"18px").attr("fill",colorSet[1]).text(function(d){return $$.getLinearGaugePercentFormat(d.values[0].value)}).transition().duration(duration).style("opacity",1);main.select("."+CLASS.linearGaugePercentLabel).select("."+CLASS.linearGaugePercentUnit).style("opacity",0).attr("transform",$$.transformForLinearGauge("unit")).style("font-size","14px").style("font-weight",400).attr("fill","#b3b4b4").text("%").transition().duration(duration).style("opacity",1);main.select("."+CLASS.linearGaugeLabelBox).attr("transform",$$.transformForLinearGauge("label")).select("."+CLASS.linearGaugeLabelBackground).attr(inverted?"width":"height",function(){var d={values:[{value:max*2/4}]};if(!inverted)return 42;else return $$.getRect(d,true,true)}).attr(inverted?"height":"width",width);if(config.gauge_text){if(config.gauge_text.length>=2){main.select("."+CLASS.linearGaugeLabelBox).select("."+CLASS.linearGaugeName).attr("transform",$$.transformForLinearGauge("name")).style("font-family","Arial,Helvetica,sans-serif,").style("font-size","12px").attr("fill","rgb(21, 32, 62)").style("font-weight",600);main.select("."+CLASS.linearGaugeLabelBox).select("."+CLASS.linearGaugeName).select(".gaugeText1").text(function(d){return config.gauge_text[0]}).attr("dy","0.5em");main.select("."+CLASS.linearGaugeLabelBox).select("."+CLASS.linearGaugeName).select(".gaugeText2").text(function(d){return config.gauge_text[1]}).attr("dy","1.1em").attr("x","0")}else{main.select("."+CLASS.linearGaugeLabelBox).select("."+CLASS.linearGaugeName).attr("transform",$$.transformForLinearGauge("name")).text(function(d){return config.gauge_text||d.id||d.name}).style("font-family","Arial,Helvetica,sans-serif,").style("font-size","12px").attr("fill","rgb(21, 32, 62)").style("font-weight",600)}}else{main.select("."+CLASS.linearGaugeLabelBox).select("."+CLASS.linearGaugeName).attr("transform",$$.transformForLinearGauge("name")).text(function(d){return config.gauge_text||d.id||d.name}).style("font-family","Arial,Helvetica,sans-serif,").style("font-size","12px").attr("fill","rgb(21, 32, 62)").style("font-weight",600)}main.select("."+CLASS.linearGaugeLabelBox).select("."+CLASS.linearGaugeValueUnit).attr("transform",$$.transformForLinearGauge("value")).style("opacity",0).style("font-family","Arial,Helvetica,sans-serif,").style("font-size","11px").style("font-weight",600).attr("fill","#b1b1b1").text(function(d){return $$.getLinearGaugeValueFormat(d.values[0].value,unit)}).transition().duration(duration).style("opacity",1)};top_chart_internal_fn.getLinearGaugeValueFormat=function(v){var value,total,t=this.config.yAxis_max?this.config.yAxis_max:this.config.gauge_max;if(!isValue(v)){return""}else{if(this.config.gauge_format_value){value=this.config.gauge_format_value(v)}else{value=v}if(this.config.gauge_format_total){total=this.config.gauge_format_total(t)}else{total=t}return value+" / "+total}};top_chart_internal_fn.getLinearGaugePercentFormat=function(v){var value=isValue(v)?v*100/(this.config.yAxis_max?this.config.yAxis_max:this.config.gauge_max):"";return!isValue(v)?"":value%1===0?value:value.toFixed(1)};top_chart_internal_fn.getRect=function(d,withoutUpdate,force){return force||this.isLinearGaugeType(d)?this.getSvgRectLength(d,withoutUpdate):"0"};top_chart_internal_fn.getSvgRectLength=function(d){var $$=this,d3=$$.d3,config=$$.config,inverted=config.chart_inverted,domainMax=config.yAxis_max||config.gauge_max,rangeMax=inverted?$$.width:$$.height<42?42:$$.height-45,scale=d3.scale.linear().domain([0,domainMax]).range([0,rangeMax]);return d?scale(d.values[0].value):scale(domainMax)};top_chart_internal_fn.getSvgRectWidth=function(smaller){var $$=this,d3=$$.d3,config=$$.config,restrict,min,max,scale,width,inverted=config.chart_inverted;restrict=inverted?$$.height:$$.width;min=inverted?4:80;max=inverted?8:160;if(restrict>max)width=max;else if(restrict<min)width=min;else width=restrict;if(smaller){if(smaller==="gauge2"){width=width*2/3}if(smaller==="gauge3"){width=width*1/3}}return width.toFixed(2)};top_chart_internal_fn.updateRectLength=function(d){var $$=this,config=$$.config,found=false,index=0,gMin=config.yAxis_min||config.gauge_min,gMax=config.yAxis_max||config.gauge_max};top_chart_internal_fn.initRegion=function(){var $$=this;$$.region=$$.main.append("g").attr("clip-path",$$.clipPath).attr("class",CLASS.regions)};top_chart_internal_fn.updateRegion=function(duration){var $$=this,config=$$.config;if($$.hasArcType()){$$.region.style("visibility","hidden");return}else{$$.region.style("visibility","visible")}$$.mainRegion=$$.main.select("."+CLASS.regions).selectAll("."+CLASS.region).data(config.regions);$$.mainRegion.enter().append("g").attr("class",$$.classRegion.bind($$)).append("rect").style("fill-opacity",0);$$.mainRegion.exit().transition().duration(duration).style("opacity",0).remove()};top_chart_internal_fn.redrawRegion=function(withTransition){var $$=this,regions=$$.mainRegion.selectAll("rect"),x=$$.regionX.bind($$),y=$$.regionY.bind($$),w=$$.regionWidth.bind($$),h=$$.regionHeight.bind($$);return[(withTransition?regions.transition():regions).attr("x",x).attr("y",y).attr("width",w).attr("height",h).style("fill-opacity",function(d){return isValue(d.opacity)?d.opacity:.1})]};top_chart_internal_fn.regionX=function(d){var $$=this,config=$$.config,xPos,yScale=d.axis==="y"?$$.y:$$.y2;if(d.axis==="y"||d.axis==="y2"){xPos=config.chart_inverted?"start"in d?yScale(d.start):0:0}else{xPos=config.chart_inverted?0:"start"in d?$$.x($$.isTimeSeries()?$$.parseDate(d.start):d.start):0}return xPos};top_chart_internal_fn.regionY=function(d){var $$=this,config=$$.config,yPos,yScale=d.axis==="y"?$$.y:$$.y2;if(d.axis==="y"||d.axis==="y2"){yPos=config.chart_inverted?0:"end"in d?yScale(d.end):0}else{yPos=config.chart_inverted?"start"in d?$$.x($$.isTimeSeries()?$$.parseDate(d.start):d.start):0:0}return yPos};top_chart_internal_fn.regionWidth=function(d){var $$=this,config=$$.config,start=$$.regionX(d),end,yScale=d.axis==="y"?$$.y:$$.y2;if(d.axis==="y"||d.axis==="y2"){end=config.chart_inverted?"end"in d?yScale(d.end):$$.width:$$.width}else{end=config.chart_inverted?$$.width:"end"in d?$$.x($$.isTimeSeries()?$$.parseDate(d.end):d.end):$$.width}return end<start?0:end-start};top_chart_internal_fn.regionHeight=function(d){var $$=this,config=$$.config,start=this.regionY(d),end,yScale=d.axis==="y"?$$.y:$$.y2;if(d.axis==="y"||d.axis==="y2"){end=config.chart_inverted?$$.height:"start"in d?yScale(d.start):$$.height}else{end=config.chart_inverted?"end"in d?$$.x($$.isTimeSeries()?$$.parseDate(d.end):d.end):$$.height:$$.height}return end<start?0:end-start};top_chart_internal_fn.isRegionOnX=function(d){return!d.axis||d.axis==="x"};top_chart_internal_fn.drag=function(mouse){var $$=this,config=$$.config,main=$$.main,d3=$$.d3;$$.dragging=true;var sx,sy,mx,my,minX,maxX,minY,maxY;if($$.hasArcType()){return}if(!config.data_selection_enabled){return}if(!config.data_selection_multiple){return}sx=$$.dragStart[0];sy=$$.dragStart[1];mx=mouse[0];my=mouse[1];minX=Math.min(sx,mx);maxX=Math.max(sx,mx);minY=Math.min(sy,my);maxY=Math.max(sy,my);if($$.positionMap){$$.selectedPoints=[];Object.keys($$.positionMap).forEach(function(key){Object.keys($$.positionMap[key]).forEach(function(key2){var positionInfo=$$.positionMap[key][key2];if(minX<positionInfo.x&&positionInfo.x<maxX&&minY<positionInfo.y&&positionInfo.y<maxY){positionInfo.id=key;positionInfo._x=key2;$$.selectedPoints.push(positionInfo)}})})}main.select("."+CLASS.dragarea).attr("x",minX).attr("y",minY).attr("width",maxX-minX).attr("height",maxY-minY);main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).filter(function(d){return config.data_selection_isselectable(d)}).each(function(d,i){var shape=d3.select(this),isSelected=shape.classed(CLASS.SELECTED),isIncluded=shape.classed(CLASS.INCLUDED),_x,_y,_w,_h,toggle,isWithin=false,box;if(shape.classed(CLASS.selectedCircle)){_x=shape.attr("cx")*1;_y=shape.attr("cy")*1;toggle=$$.togglePoint;isWithin=minX<_x&&_x<maxX&&minY<_y&&_y<maxY}else if(shape.classed(CLASS.bar)){box=$$.getPathBox(this);_x=box.x;_y=box.y;_w=box.width;_h=box.height;toggle=$$.togglePath;isWithin=!(maxX<_x||_x+_w<minX)&&!(maxY<_y||_y+_h<minY)}else if(shape.classed(CLASS.scatter)){box=$$.getPathBox(this);_x=box.x;_y=box.y;_w=box.width;_h=box.height;toggle=$$.togglePath;isWithin=!(maxX<_x||_x+_w<minX)&&!(maxY<_y||_y+_h<minY)}else{return}if(isWithin^isIncluded){shape.classed(CLASS.INCLUDED,!isIncluded);shape.classed(CLASS.SELECTED,!isSelected);toggle.call($$,!isSelected,shape,d,i)}})};top_chart_internal_fn.dragstart=function(mouse){var $$=this,config=$$.config;if($$.hasArcType()){return}if(!config.data_selection_enabled){return}$$.dragStart=mouse;$$.selectedPoints=[];$$.main.select("."+CLASS.chart).append("rect").attr("class",CLASS.dragarea).style("opacity",.1)};top_chart_internal_fn.dragend=function(){var $$=this,config=$$.config;$$.selectedDataPoints=[];if(!$$.dragging)return;var dataset=[],thisset=[],color=function(d){return $$.color(d.id)[0]};if($$.hasArcType()){return}if(!config.data_selection_enabled){return}$$.main.select("."+CLASS.dragarea).transition().duration(100).style("opacity",0).remove();$$.main.selectAll("."+CLASS.SELECTED+":not(."+CLASS.selectedCircle+")").style("fill",color).style("stroke",color).each(function(d){dataset.push(d)});$$.main.selectAll("."+CLASS.SELECTED+"."+CLASS.selectedCircle).each(function(d){dataset.push(d)});$$.main.selectAll("."+CLASS.scatter+":not(."+CLASS.SELECTED+")").style("fill",color).style("stroke",color);$$.main.selectAll("."+CLASS.shape).classed(CLASS.INCLUDED,false);$$.dragging=false;if(dataset.length!==0){$$.selectedDataPoints=$$.generateSelectedDataPoints(dataset);config.data_onselected.call($$.api,$$.selectedDataPoints)}};top_chart_internal_fn.selectPoint=function(target,d,i){var $$=this,config=$$.config,cx=(config.chart_inverted?$$.circleY:$$.circleX).bind($$),cy=(config.chart_inverted?$$.circleX:$$.circleY).bind($$),r=$$.pointSelectR.bind($$),color=function(d){return $$.color(d.id)[0]};$$.main.select("."+CLASS.selectedCircles+$$.getTargetSelectorSuffix(d.id)).selectAll("."+CLASS.selectedCircle+"-"+i).attr("stroke",color).attr("r",function(d){return $$.pointSelectR(d)*1.4}).transition().duration(100)};top_chart_internal_fn.unselectPoint=function(target,d,i){var $$=this;$$.config.data_onunselected(d,target.node());$$.main.select("."+CLASS.selectedCircles+$$.getTargetSelectorSuffix(d.id)).selectAll("."+CLASS.selectedCircle+"-"+i).attr("r",0)};top_chart_internal_fn.togglePoint=function(selected,target,d,i){selected?this.selectPoint(target,d,i):this.unselectPoint(target,d,i)};top_chart_internal_fn.selectPath=function(target,d){var $$=this;var color=function(d){return $$.color(d.id)[0]};target.transition().duration(100).style("fill",function(){return color}).style("stroke",function(){return color})};top_chart_internal_fn.unselectPath=function(target,d){var $$=this;var color=function(d){return $$.color(d.id)[1]};$$.config.data_onunselected.call($$,d,target.node());target.transition().duration(100).style("fill",function(){return color}).style("stroke",function(){return color})};top_chart_internal_fn.togglePath=function(selected,target,d,i){selected?this.selectPath(target,d,i):this.unselectPath(target,d,i)};top_chart_internal_fn.getToggle=function(that,d){var $$=this,toggle;if(that.nodeName==="circle"){if($$.isStepType(d)){toggle=function(){}}else{toggle=$$.togglePoint}}else if(that.nodeName==="path"){toggle=$$.togglePath}return toggle};top_chart_internal_fn.toggleShape=function(that,d,i){var $$=this,d3=$$.d3,config=$$.config,shape=d3.select(that),isSelected=shape.classed(CLASS.SELECTED),toggle=$$.getToggle(that,d).bind($$);if(config.data_selection_enabled&&config.data_selection_isselectable(d)){if(!config.data_selection_multiple){$$.main.selectAll("."+CLASS.shapes+(config.data_selection_grouped?$$.getTargetSelectorSuffix(d.id):"")).selectAll("."+CLASS.shape).each(function(d,i){var shape=d3.select(this);if(shape.classed(CLASS.SELECTED)){toggle(false,shape.classed(CLASS.SELECTED,false),d,i)}})}shape.classed(CLASS.SELECTED,!isSelected);toggle(!isSelected,shape,d,i)}};top_chart_internal_fn.initBrush=function(){var $$=this,d3=$$.d3;$$.brush=d3.svg.brush().on("brush",function(){$$.redrawForBrush()});$$.brush.update=function(){if($$.context){$$.context.select("."+CLASS.brush).call(this)}return this};$$.brush.scale=function(scale){return $$.config.chart_inverted?this.y(scale):this.x(scale)}};top_chart_internal_fn.redrawForBrush=function(){var $$=this,x=$$.x;$$.redraw({withTransition:false,withY:$$.config.zoom_rescale,withSubchart:false,withUpdateXDomain:true,withDimension:false});$$.config.subchart_onbrush.call($$.api,x.orgDomain())};top_chart_internal_fn.transformContext=function(withTransition,transitions){var $$=this,subXAxis;if(transitions&&transitions.axisSubX){subXAxis=transitions.axisSubX}else{subXAxis=$$.context.select("."+CLASS.axisX);if(withTransition){subXAxis=subXAxis.transition()}}$$.context.attr("transform",$$.getTranslate("context"));subXAxis.attr("transform",$$.getTranslate("subx"))};top_chart_internal_fn.getDefaultExtent=function(){var $$=this,config=$$.config,extent=isFunction(config.axis_x_extent)?config.axis_x_extent($$.getXDomain($$.data.targets)):config.axis_x_extent;if($$.isTimeSeries()){extent=[$$.parseDate(extent[0]),$$.parseDate(extent[1])]}return extent};top_chart_internal_fn.initZoom=function(){var $$=this,d3=$$.d3,config=$$.config,startEvent;$$.zoom=d3.behavior.zoom();$$.zoom.scale=function(scale){return config.chart_inverted?this.y(scale):this.x(scale)};$$.zoom.orgScaleExtent=function(){var extent=config.zoom_extent?config.zoom_extent:[1,10];return[extent[0],Math.max($$.getMaxDataCount()/extent[1],extent[1])]};$$.zoom.updateScaleExtent=function(){var ratio=diffDomain($$.x.orgDomain())/diffDomain($$.orgXDomain),extent=this.orgScaleExtent();this.scaleExtent([extent[0]*ratio,extent[1]*ratio]);return this}};top_chart_internal_fn.updateZoom=function(){var $$=this,z=$$.config.zoom_enabled?$$.zoom:function(){};$$.main.select("."+CLASS.zoomRect).call(z).on("dblclick.zoom",null);$$.main.selectAll("."+CLASS.eventRect).call(z).on("dblclick.zoom",null)};top_chart_internal_fn.redrawForZoom=function(domain){var $$=this,d3=$$.d3,config=$$.config,zoom=$$.zoom,x=$$.x;if(!config.zoom_enabled){return}if($$.filterTargetsToShow($$.data.targets).length===0){return}if($$.isCategorized()&&x.orgDomain()[0]===$$.orgXDomain[0]){x.domain([$$.orgXDomain[0]-1e-10,x.orgDomain()[1]])}$$.redraw({withTransition:false,withY:config.zoom_rescale,withSubchart:false,withEventRect:false,withDimension:false,withForZoom:true});config.zoom_onzoom.call($$.api,x.orgDomain())};top_chart_internal_fn.generateClickDataPoint=function(data){var pointData={};pointData.id=data.id;pointData.index=data.index;pointData.name=data.name;pointData.value=data.value;pointData.x=data.x;pointData.__proto__=data.__proto__;pointData.innerData=data.innerData;return pointData};top_chart_internal_fn.generateSelectedDataPoints=function(data){var pointData=[],dataobj={};var i;for(i=0;i<data.length;i++){dataobj={};dataobj.id=data[i].id;dataobj.index=data[i].index;dataobj.value=data[i].value;dataobj.x=data[i].x;dataobj.innerData=data[i].innerData;pointData.push(dataobj)}return pointData};top_chart_internal_fn.opacityCalc=function(color,opacity){var r,g,b,finalColor,newR,newG,newB;if(color.length===7){r=color.slice(1,3);g=color.slice(3,5);b=color.slice(5,7)}else if(color.length===4){r=color.slice(1,2);g=color.slice(2,3);b=color.slice(3,4);r=r+r;g=g+g;b=b+b}else{var colorSet,length=color.length;colorSet=color.slice(4,length-1);colorSet=colorSet.split(",");r=colorSet[0];g=colorSet[1];b=colorSet[2]}r=parseInt("0x"+r);g=parseInt("0x"+g);b=parseInt("0x"+b);if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;newR=opacity*r+(1-opacity)*255;newG=opacity*g+(1-opacity)*255;newB=opacity*b+(1-opacity)*255;newR=Math.round(newR);newG=Math.round(newG);newB=Math.round(newB);newR=newR.toString(16);newG=newG.toString(16);newB=newB.toString(16);finalColor="#"+newR+newG+newB;return finalColor};top_chart_internal_fn.generateColorSet=function(color){var $$=this,config=this.config,colorSet=[];colorSet[0]=$$.opacityCalcForFirst(color);colorSet[1]=color;colorSet[2]=$$.opacityCalc(color,.8125);colorSet[3]=$$.opacityCalc(color,.5625);colorSet[4]=$$.opacityCalc(color,.3125);return colorSet};top_chart_internal_fn.opacityCalcForFirst=function(color){var r,g,b,finalColor,newR,newG,newB;if(color.length===7){r=color.slice(1,3);g=color.slice(3,5);b=color.slice(5,7)}else if(color.length===4){r=color.slice(1,2);g=color.slice(2,3);b=color.slice(3,4);r=r+r;g=g+g;b=b+b}else{var colorSet,length=color.length;colorSet=color.slice(4,length-1);colorSet=colorSet.split(",");r=colorSet[0];g=colorSet[1];b=colorSet[2]}r=parseInt("0x"+r);g=parseInt("0x"+g);b=parseInt("0x"+b);if(r>255)r=255;if(g>255)g=255;if(b>255)b=255;newR=(r-.2*255)/.8;newG=(g-.2*255)/.8;newB=(b-.2*255)/.8;if(newR<0)newR=0;if(newG<0)newG=0;if(newB<0)newB=0;newR=Math.round(newR);newG=Math.round(newG);newB=Math.round(newB);newR=newR.toString(16);newG=newG.toString(16);newB=newB.toString(16);if(newR.length===1){newR="0"+newR}if(newG.length===1){newG="0"+newG}if(newB.length===1){newB="0"+newB}finalColor="#"+newR+newG+newB;return finalColor};top_chart_internal_fn.generateColor=function(){var $$=this,config=$$.config,d3=$$.d3,theme=$$.theme,colorSet1=theme.colorSet1,colorSet2=theme.colorSet2,statusColor=theme.statusColor,colors=config.data_colors,colorSet=[],fatal=statusColor.fatal,critical=statusColor.critical,warning=statusColor.warning,normal=statusColor.normal,informative=statusColor.informative,terminate=statusColor.terminate,statusColor=[fatal[0],critical[0],warning[0],normal[0],informative[0],terminate[0]],pattern=notEmpty(config.colors)?config.colors:config.theme==="colorSet2"?colorSet2:config.theme==="statusColor"?statusColor:colorSet1,callback=config.data_color,ids=[];return function(d){var id=d.id||d.data&&d.data.id||d,color;if(colors[id]instanceof Function){color=colors[id](d)}else if(colors[id]){color=colors[id]}else{if(ids.indexOf(id)<0){ids.push(id)}color=pattern[ids.indexOf(id)%pattern.length]}colorSet=$$.generateColorSet(color);return callback instanceof Function?callback(colorSet,d):colorSet}};top_chart_internal_fn.generateLevelColor=function(){var $$=this,config=$$.config,colors=config.colors,threshold=config.color_threshold,asValue=threshold.unit==="value",values=threshold.values&&threshold.values.length?threshold.values:[],max=threshold.max||100;return notEmpty(config.color_threshold)?function(value){var i,v,color=colors[colors.length-1];for(i=0;i<values.length;i++){v=asValue?value:value*100/max;if(v<values[i]){color=colors[i];break}}return color}:null};top_chart_internal_fn.getYFormat=function(forArc){var $$=this,formatForY=forArc&&!$$.hasType("angulargauge")?$$.defaultArcValueFormat:$$.yFormat,formatForY2=forArc&&!$$.hasType("angulargauge")?$$.defaultArcValueFormat:$$.y2Format;return function(v,ratio,id){var format=$$.axis.getId(id)==="y2"?formatForY2:formatForY;return format.call($$,v,ratio)}};top_chart_internal_fn.yFormat=function(v){var $$=this,config=$$.config,format=config.yAxis_tick_format?config.yAxis_tick_format:$$.defaultValueFormat;return format(v)};top_chart_internal_fn.y2Format=function(v){var $$=this,config=$$.config,format=config.axis_y2_tick_format?config.axis_y2_tick_format:$$.defaultValueFormat;return format(v)};top_chart_internal_fn.defaultValueFormat=function(v){return isValue(v)?+v:""};top_chart_internal_fn.defaultArcValueFormat=function(v,ratio){return(ratio*100).toFixed(1)+"%"};top_chart_internal_fn.dataLabelFormat=function(targetId){var $$=this,data_labels=$$.config.data_labels,format,defaultFormat=function(v){v=v*1;return isValue(v)?+v.toFixed(2):""};if(typeof data_labels.format==="function"){format=data_labels.format}else if(typeof data_labels.format==="object"){if(data_labels.format[targetId]){format=data_labels.format[targetId]===true?defaultFormat:data_labels.format[targetId]}else{format=function(){return""}}}else{format=defaultFormat}return format};var CLASS=top_chart_internal_fn.CLASS={target:"TOP-target",chart:"TOP-chart",chartLine:"TOP-chart-line",chartLines:"TOP-chart-lines",chartEqualizer:"TOP-chart-equalizer",chartEqualizers:"TOP-chart-equalizers",chartBubble:"TOP-chart-bubble",chartBubbles:"TOP-chart-bubbles",equalizers:"TOP-equalizers",equalizer:"TOP-equalizer",chartScatter:"TOP-chart-scatter",chartScatters:"TOP-chart-scatters",chartBar:"TOP-chart-bar",chartBars:"TOP-chart-bars",chartBoxplot:"TOP-chart-boxplot",chartBoxplots:"TOP-chart-boxplots",chartText:"TOP-chart-text",chartTexts:"TOP-chart-texts",chartArc:"TOP-chart-arc",chartArcs:"TOP-chart-arcs",chartArcsTitle:"TOP-chart-arcs-title",chartArcsBackground:"TOP-chart-arcs-background",chartArcsGaugeUnit:"TOP-chart-arcs-gauge-unit",chartArcsGaugeMax:"TOP-chart-arcs-gauge-max",chartArcsGaugeMin:"TOP-chart-arcs-gauge-min",chartLinearGauges:"TOP-chart-linear-gauges",chartLinearGauge:"TOP-chart-linear-gauge",chartLinearGaugeBackground:"TOP-chart-linear-gauge-background",chartLinearGaugeUnit:"TOP-chart-linear-gauge-unit",chartLinearGaugeMax:"TOP-chart-linear-gauge-max",chartLinearGaugeMin:"TOP-chart-linear-gauge-min",selectedCircle:"TOP-selected-circle",selectedCircles:"TOP-selected-circles",eventRect:"TOP-event-rect",eventRects:"TOP-event-rects",eventRectsSingle:"TOP-event-rects-single",eventRectsMultiple:"TOP-event-rects-multiple",zoomRect:"TOP-zoom-rect",brush:"TOP-brush",focused:"TOP-focused",defocused:"TOP-defocused",region:"TOP-region",regions:"TOP-regions",threshold:"TOP-threshold",thresholdLine:"TOP-threshold-line",tooltipContainer:"TOP-tooltip-container",tooltip:"TOP-tooltip",tooltipSingle:"TOP-tooltip-single",tooltipMultiple:"TOP-tooltip-multiple",tooltipArrow:"TOP-tooltip-arrow",tooltipGroupArrow:"TOP-tooltip-group-arrow",tooltipName:"TOP-tooltip-name",shape:"TOP-shape",shapes:"TOP-shapes",line:"TOP-line",lines:"TOP-lines",scatter:"TOP-scatter",scatters:"TOP-scatters",bubble:"TOP-bubble",bubbles:"TOP-bubbles",bar:"TOP-bar",bars:"TOP-bars",boxplot:"TOP-boxplot",boxplots:"TOP-boxplots",circle:"TOP-circle",circles:"TOP-circles",circleGroup:"TOP-circle-group",circleExpanded:"TOP-circle-expanded",outerCircle:"TOP-circle-outer",marker:"TOP-marker",arc:"TOP-arc",arcs:"TOP-arcs",area:"TOP-area",areas:"TOP-areas",empty:"TOP-empty",linearGauges:"TOP-linear-gauges",linearGauge:"TOP-linear-gauge",linearGauge2:"TOP-linear-gauge2",linearGauge3:"TOP-linear-gauge3",text:"TOP-text",texts:"TOP-texts",angularGaugeValue:"TOP-angular-gauge-value",circularGaugeValue:"TOP-circular-gauge-value",linearGaugePercent:"TOP-linear-gauge-percent",linearGaugePercentUnit:"TOP-linear-gauge-percent-unit",linearGaugeName:"TOP-linear-gauge-name",linearGaugePercentLabel:"TOP-linear-gauge-percent-label",linearGaugePercentLabelBackground:"TOP-linear-gauge-percent-label-background",linearGaugeLabelBox:"TOP-linear-gauge-label-box",linearGaugeLabelBackground:"TOP-linear-gauge-label-background",linearGaugeValueUnit:"TOP-linear-gauge-value-unit",linearGaugeValue:"TOP-linear-gauge-value",linearGaugeUnit:"TOP-linear-gauge-unit",linearGaugeGrid:"TOP-linear-gauge-grid",grid:"TOP-grid",gridLines:"TOP-grid-lines",xgrid:"TOP-xgrid",xgrids:"TOP-xgrids",xgridLine:"TOP-xgrid-line",xgridLines:"TOP-xgrid-lines",xgridFocus:"TOP-xgrid-focus",ygrid:"TOP-ygrid",ygrids:"TOP-ygrids",ygridLine:"TOP-ygrid-line",ygridLines:"TOP-ygrid-lines",axis:"TOP-axis",axisX:"TOP-axis-x",axisXLabel:"TOP-axis-x-label",axisY:"TOP-axis-y",axisYLabel:"TOP-axis-y-label",axisY2:"TOP-axis-y2",axisY2Label:"TOP-axis-y2-label",legend:"TOP-legend",legends:"TOP-legends",legendBackground:"TOP-legend-background",legendItem:"TOP-legend-item",legendItemEvent:"TOP-legend-item-event",legendItemTile:"TOP-legend-item-tile",legendItemHidden:"TOP-legend-item-hidden",legendItemFocused:"TOP-legend-item-focused",dragarea:"TOP-dragarea",EXPANDED:"_expanded_",SELECTED:"_selected_",INCLUDED:"_included_",titleContainer:"TOP-title-container",title:"TOP-title",subtitleContainer:"TOP-subtitle-container",subtitle:"TOP-subtitle",border:"TOP-border",plotBorder:"TOP-plotborder",credits:"TOP-credits",labels:"TOP-labels",label:"TOP-label",sliderContainer:"TOP-slider-container"};top_chart_internal_fn.findTargetIndicesFromGroups=function(groups,target){var group=groups,target=target,keyGroup=Object.keys(groups);var total=0;var i,k,j;var result=[];for(i=0;i<keyGroup.length;i++){for(k=0;k<group[keyGroup[i]].length;k++){if(group[keyGroup[i]][k]===target.id)return result=[i,group[keyGroup[i]].length-1-k,group[keyGroup[i]]]}}};top_chart_internal_fn.generateClass=function(prefix,targetId){return" "+prefix+" "+prefix+this.getTargetSelectorSuffix(targetId)};top_chart_internal_fn.classText=function(d){return this.generateClass(CLASS.text,d.index)};top_chart_internal_fn.classTexts=function(d){return this.generateClass(CLASS.texts,d.id)};top_chart_internal_fn.classShape=function(d){return this.generateClass(CLASS.shape,d.index)};top_chart_internal_fn.classShapes=function(d){return this.generateClass(CLASS.shapes,d.id)};top_chart_internal_fn.classLine=function(d){return this.classShape(d)+this.generateClass(CLASS.line,d.id)};top_chart_internal_fn.classLines=function(d){return this.classShapes(d)+this.generateClass(CLASS.lines,d.id)};top_chart_internal_fn.classScatter=function(d){return this.classShape(d)+this.generateClass(CLASS.scatter,d.id)};top_chart_internal_fn.classScatters=function(d){return this.classShapes(d)+this.generateClass(CLASS.scatters,d.id)};top_chart_internal_fn.classBubble=function(d){return this.classShape(d)+this.generateClass(CLASS.bubble,d.id)};top_chart_internal_fn.classBubbles=function(d){return this.classShapes(d)+this.generateClass(CLASS.bubbles,d.id)};top_chart_internal_fn.classBoxplot=function(d){return this.classShape(d)+this.generateClass(CLASS.boxplot,d.id)};top_chart_internal_fn.classBoxplots=function(d){return this.classShapes(d)+this.generateClass(CLASS.boxplots,d.id)};top_chart_internal_fn.classEqualizer=function(d,i){return this.generateClass(CLASS.equalizer,d[i].x)};top_chart_internal_fn.classEqualizers=function(d){return this.classShapes(d)+this.generateClass(CLASS.equalizers,d.id)};top_chart_internal_fn.classCircle=function(d){return this.classShape(d)+this.generateClass(CLASS.circle,d.index)};top_chart_internal_fn.classCircleGroup=function(d){return this.generateClass(CLASS.circleGroup,d.index)};top_chart_internal_fn.classCircleExpanded=function(d){return this.generateClass(CLASS.circleExpanded,d.index)};top_chart_internal_fn.classCircles=function(d){return this.classShapes(d)+this.generateClass(CLASS.circles,d.id)};top_chart_internal_fn.classSelectedCircles=function(d){return this.classShapes(d)+this.generateClass(CLASS.selectedCircles,d.id)};top_chart_internal_fn.classSelectedCircle=function(d){return this.classShape(d)+this.generateClass(CLASS.selectedCircle,d.index)};top_chart_internal_fn.classMarker=function(d){return this.classShape(d)+this.generateClass(CLASS.marker,d.index)};top_chart_internal_fn.classBar=function(d){return this.classShape(d)+this.generateClass(CLASS.bar,d.index)};top_chart_internal_fn.classBars=function(d){return this.classShapes(d)+this.generateClass(CLASS.bars,d.id)};top_chart_internal_fn.classArc=function(d){return this.classShape(d.data)+this.generateClass(CLASS.arc,d.data.id)};top_chart_internal_fn.classArcs=function(d){return this.classShapes(d.data)+this.generateClass(CLASS.arcs,d.data.id)};top_chart_internal_fn.classLinearGauges=function(d){return this.classShapes(d)+this.generateClass(CLASS.linearGauges,d.id)};top_chart_internal_fn.classLinearGauge=function(d){return this.classShapes(d)+this.generateClass(CLASS.linearGauge,d.id)};top_chart_internal_fn.classLinearGauge2=function(d){return this.classShapes(d)+this.generateClass(CLASS.linearGauge2,d.id)};top_chart_internal_fn.classLinearGauge3=function(d){return this.classShapes(d)+this.generateClass(CLASS.linearGauge3,d.id)};top_chart_internal_fn.classArea=function(d){return this.classShape(d)+this.generateClass(CLASS.area,d.id)};top_chart_internal_fn.classAreas=function(d){return this.classShapes(d)+this.generateClass(CLASS.areas,d.id)};top_chart_internal_fn.classRegion=function(d,i){return this.generateClass(CLASS.region,i)+" "+("class"in d?d["class"]:"")};top_chart_internal_fn.classEvent=function(d){return this.generateClass(CLASS.eventRect,d.index)};top_chart_internal_fn.classTarget=function(id){var $$=this;var additionalClassSuffix=$$.config.data_classes[id],additionalClass="";if(additionalClassSuffix){additionalClass=" "+CLASS.target+"-"+additionalClassSuffix}return $$.generateClass(CLASS.target,id)+additionalClass};top_chart_internal_fn.classFocus=function(d){return this.classFocused(d)+this.classDefocused(d)};top_chart_internal_fn.classFocused=function(d){return" "+(this.focusedTargetIds.indexOf(d.id)>=0?CLASS.focused:"")};top_chart_internal_fn.classDefocused=function(d){return" "+(this.defocusedTargetIds.indexOf(d.id)>=0?CLASS.defocused:"")};top_chart_internal_fn.classChartText=function(d){return CLASS.chartText+this.classTarget(d.id)};top_chart_internal_fn.classChartLine=function(d){return CLASS.chartLine+this.classTarget(d.id)};top_chart_internal_fn.classChartScatter=function(d){return CLASS.chartScatter+this.classTarget(d.id)};top_chart_internal_fn.classChartBubble=function(d){return CLASS.chartBubble+this.classTarget(d.id)};top_chart_internal_fn.classChartBoxplot=function(d){return CLASS.chartBoxplot+this.classTarget(d.id)};top_chart_internal_fn.classChartEqualizer=function(d){return CLASS.chartEqualizer+this.classTarget(d.id)};top_chart_internal_fn.classChartBar=function(d){return CLASS.chartBar+this.classTarget(d.id)};top_chart_internal_fn.classChartArc=function(d){return CLASS.chartArc+this.classTarget(d.data.id)};top_chart_internal_fn.classChartLinearGauge=function(d){return CLASS.chartLinearGauge+this.classTarget(d.id)};top_chart_internal_fn.getTargetSelectorSuffix=function(targetId){return targetId||targetId===0?("-"+targetId).replace(/[\s?!@#$%^&*()_=+,.<>'":;\[\]\/|~`{}\\]/g,"-"):""};top_chart_internal_fn.selectorTarget=function(id,prefix){return(prefix||"")+"."+CLASS.target+this.getTargetSelectorSuffix(id)};top_chart_internal_fn.selectorTargets=function(ids,prefix){var $$=this;ids=ids||[];return ids.length?ids.map(function(id){return $$.selectorTarget(id,prefix)}):null};top_chart_internal_fn.selectorLegend=function(id){return"."+CLASS.legendItem+this.getTargetSelectorSuffix(id)};top_chart_internal_fn.selectorLegends=function(ids){var $$=this;return ids&&ids.length?ids.map(function(id){return $$.selectorLegend(id)}):null};var isValue=top_chart_internal_fn.isValue=function(v){return v||v===0},isFunction=top_chart_internal_fn.isFunction=function(o){return typeof o==="function"},isString=top_chart_internal_fn.isString=function(o){return typeof o==="string"},isUndefined=top_chart_internal_fn.isUndefined=function(v){
return typeof v==="undefined"},isDefined=top_chart_internal_fn.isDefined=function(v){return typeof v!=="undefined"},ceil10=top_chart_internal_fn.ceil10=function(v){return Math.ceil(v/10)*10},asHalfPixel=top_chart_internal_fn.asHalfPixel=function(n){return Math.ceil(n)+.5},diffDomain=top_chart_internal_fn.diffDomain=function(d){return d[1]-d[0]},isEmpty=top_chart_internal_fn.isEmpty=function(o){return!o||isString(o)&&o.length===0||typeof o==="object"&&Object.keys(o).length===0},notEmpty=top_chart_internal_fn.notEmpty=function(o){return Object.keys(o).length>0},getOption=top_chart_internal_fn.getOption=function(options,key,defaultValue){return isDefined(options[key])?options[key]:defaultValue},hasValue=top_chart_internal_fn.hasValue=function(dict,value){var found=false;Object.keys(dict).forEach(function(key){if(dict[key]===value){found=true}});return found};top_chart_internal_fn.getPathBox=function(path){var $$=this,mainBox=$$.main.select("."+CLASS.chart)[0][0].getBoundingClientRect(),box=path.getBoundingClientRect();return{x:box.left-mainBox.left,y:box.top-mainBox.top,width:box.width,height:box.height}};top_chart_fn.focus=function(targetIds,lock){var $$=this.internal,candidates;if(!$$.isFocusLock)$$.isFocusLock=lock;targetIds=$$.mapToTargetIds(targetIds);candidates=$$.svg.selectAll($$.selectorTargets(targetIds.filter($$.isTargetToShow,$$)));this.defocus();if($$.isFocusLock){var targetsToShow=$$.filterTargetsToShow($$.data.targets),unTargetIds,allTargetIds=[];for(var i=0;i<targetsToShow.length;i++)allTargetIds=allTargetIds.concat(targetsToShow[i].id);for(var j=0;j<targetIds.length;j++){for(var i=0;i<allTargetIds.length;i++){if(targetIds[j]===allTargetIds[i]){allTargetIds.splice(i,1);break}}}unTargetIds=allTargetIds;$$.addHiddenTargetIds(unTargetIds)}candidates.classed(CLASS.focused,true).classed(CLASS.defocused,false);if($$.config.data_types[targetIds]!=="circulargauge"){var color=function(d){if($$.hasType("area")){return $$.color(d)[1]}else return $$.color(d)[0]};candidates.select("."+CLASS.shapes).selectAll("."+CLASS.shape).style("fill",color);candidates.select("."+CLASS.shapes).selectAll("."+CLASS.line).style("fill","none")}if($$.hasArcType()){$$.expandArc(targetIds)}$$.toggleFocusLegend(targetIds,true);$$.focusedTargetIds=targetIds;$$.defocusedTargetIds=$$.defocusedTargetIds.filter(function(id){return targetIds.indexOf(id)<0})};top_chart_fn.defocus=function(targetIds){var $$=this.internal,candidates;targetIds=$$.mapToTargetIds(targetIds);candidates=$$.svg.selectAll($$.selectorTargets(targetIds.filter($$.isTargetToShow,$$)));candidates.classed(CLASS.focused,false).classed(CLASS.defocused,true);if($$.config.data_types[targetIds]!=="circulargauge"){var color=function(d){return $$.color(d)[2]};candidates.select("."+CLASS.shapes).selectAll("."+CLASS.shape).style("fill",color);var color0=function(d){return $$.color(d)[0]};candidates.select("."+CLASS.shapes).selectAll("._selected_").style("fill",color0);candidates.select("."+CLASS.shapes).selectAll("."+CLASS.line).style("fill","none")}if($$.hasArcType()){$$.unexpandArc(targetIds)}$$.toggleFocusLegend(targetIds,false);$$.focusedTargetIds=$$.focusedTargetIds.filter(function(id){return targetIds.indexOf(id)<0});$$.defocusedTargetIds=targetIds};top_chart_fn.focused=function(){var $$=this.internal;return $$.focusedPoint};top_chart_fn.revert=function(targetIds){var $$=this.internal,candidates;if($$.isFocusLock)$$.hiddenTargetIds=[];$$.isFocusLock=false;targetIds=$$.mapToTargetIds(targetIds);candidates=$$.svg.selectAll($$.selectorTargets(targetIds));candidates.classed(CLASS.focused,false).classed(CLASS.defocused,false);if($$.config.data_types[targetIds]!=="circulargauge"){var color1=function(d){return $$.color(d)[1]};candidates.select("."+CLASS.shapes).selectAll("."+CLASS.shape).style("fill",color1);var color0=function(d){return $$.color(d)[0]};candidates.select("."+CLASS.shapes).selectAll("._selected_").style("fill",color0);candidates.select("."+CLASS.shapes).selectAll("."+CLASS.line).style("fill","none")}if($$.hasArcType()){$$.unexpandArc(targetIds)}if($$.config.legend_enabled){$$.showLegend(targetIds.filter($$.isLegendToShow.bind($$)));$$.legend.selectAll($$.selectorLegends(targetIds)).filter(function(){return $$.d3.select(this).classed(CLASS.legendItemFocused)}).classed(CLASS.legendItemFocused,false)}$$.focusedTargetIds=[];$$.defocusedTargetIds=[]};top_chart_fn.show=function(targetIds,options){var $$=this.internal,targets;targetIds=$$.mapToTargetIds(targetIds);options=options||{};$$.removeHiddenTargetIds(targetIds);targets=$$.svg.selectAll($$.selectorTargets(targetIds));targets.transition().style("opacity",1,"important").style("display","block").call($$.endall,function(){targets.style("opacity",null).style("opacity",1)});if(options.withLegend){$$.showLegend(targetIds)}$$.redraw({withUpdateOrgXDomain:false,withUpdateXDomain:true,withLegend:true})};top_chart_fn.hide=function(targetIds,options){var $$=this.internal,targets;targetIds=$$.mapToTargetIds(targetIds);options=options||{};$$.addHiddenTargetIds(targetIds);targets=$$.svg.selectAll($$.selectorTargets(targetIds));targets.transition().style("opacity",0,"important").style("display","none").call($$.endall,function(){targets.style("opacity",null).style("opacity",0)});if(options.withLegend){$$.hideLegend(targetIds)}$$.redraw({withUpdateOrgXDomain:false,withUpdateXDomain:true,withLegend:true})};top_chart_fn.toggle=function(targetIds,options){var that=this,$$=this.internal;$$.mapToTargetIds(targetIds).forEach(function(targetId){$$.isTargetToShow(targetId)?that.hide(targetId,options):that.show(targetId,options)})};top_chart_fn.zoom=function(domain){var $$=this.internal;if(domain){if($$.isTimeSeries()){domain=domain.map(function(x){return $$.parseDate(x)})}$$.x.domain(domain);$$.redrawForZoom(domain);$$.redrawEventRect();$$.updateZoom();$$.brush.extent(domain);$$.config.zoom_onzoom.call(this,$$.x.orgDomain())}return $$.brush.extent()};top_chart_fn.zoom.enable=function(enabled){var $$=this.internal;$$.config.zoom_enabled=enabled;$$.updateAndRedraw()};top_chart_fn.unzoom=function(){var $$=this.internal;$$.brush.clear().update();$$.redraw({withUpdateXDomain:true})};top_chart_fn.load=function(args){var $$=this.internal,config=$$.config;if(args.xs){$$.addXs(args.xs)}if("classes"in args){Object.keys(args.classes).forEach(function(id){config.data_classes[id]=args.classes[id]})}if("categories"in args&&$$.isCategorized()){config.xAxis_categories=args.categories}if("axes"in args){Object.keys(args.axes).forEach(function(id){config.data_axes[id]=args.axes[id]})}if("colors"in args){Object.keys(args.colors).forEach(function(id){config.data_colors[id]=args.colors[id]})}if("unload"in args){$$.unload($$.mapToTargetIds(typeof args.unload==="boolean"&&args.unload?null:args.unload),function(){$$.loadFromArgs(args)})}else{$$.loadFromArgs(args)}};top_chart_fn.addSeries=function(seriesOptions,redraw,animation){var $$=this.internal,config=$$.config,initialSeries=config.series,series;if(redraw===undefined)redraw=true;if($$.frameUpdateList.length>0){if($$.frameUpdateList[$$.frameUpdateList.length-1].toDo==="addPoint"){$$.frameUpdateList[$$.frameUpdateList.length-1].params[4]=true}}if(redraw&&$$.frameList.length===0){$$.pushFuncToQueue($$.frameUpdateList,"addSeries",[seriesOptions,redraw,animation]);for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}else if(redraw&&$$.frameList.length){$$.pushFuncToQueue($$.frameList,"addSeries",[seriesOptions,redraw,animation]);var frameList=$$.frameList.slice();$$.frameList=[];$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}else $$.pushFuncToQueue($$.frameList,"addSeries",[seriesOptions,redraw,animation])};top_chart_internal_fn.addSeries=function(seriesOptions,redraw,animation){var $$=this,config=$$.config,initialSeries=config.series,series;if(!$$.isTabVisible())return;if(typeof seriesOptions!=="undefined"&&seriesOptions&&seriesOptions.constructor===Array){seriesOptions.forEach(function(currentValue,index,array){series=$$.convertHighchartsSeriesOptionsToTopChartsSeriesOptions(currentValue);config.series.push(series)})}else if(seriesOptions.constructor===Object){seriesOptions=$$.convertHighchartsSeriesOptionsToTopChartsSeriesOptions(seriesOptions);config.series.push(seriesOptions)}$$.buildStacks(config.series);$$.buildSeries(config.series);$$.updateWithData($$.convertSeriesToData(config.series));$$.loadFromArgs({series:config.series},redraw);return this.series};top_chart_internal_fn.updateSeries=function(seriesIndexOrName,seriesOptions,redraw){var $$=this,config=$$.config,series=$$.getSeries(seriesIndexOrName);if(!series)return;for(var key in seriesOptions){series[key]=seriesOptions[key]}if(seriesOptions.data){series.data=seriesOptions.data}if(seriesOptions.name){series.name=seriesOptions.name}if(redraw){$$.updateWithData($$.convertSeriesToData(config.series),true);$$.loadFromArgs({series:config.series},redraw)}};top_chart_fn.updateSeries=function(seriesIndexOrName,seriesOptions,redraw){var $$=this.internal,config=$$.config;if(redraw===undefined)redraw=true;if($$.frameList.length>0){if($$.frameList[$$.frameList.length-1].toDo==="removeSeries"||$$.frameList[$$.frameList.length-1].toDo==="addSeries"){var frameList=$$.frameList.slice();$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);$$.frameList=[]}}$$.pushFuncToQueue($$.frameUpdateList,"updateSeries",[seriesIndexOrName,seriesOptions,redraw]);if(redraw){for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}};top_chart_fn.setSeriesData=function(seriesIndexOrName,data,redraw){var $$=this.internal,config=$$.config;if(redraw===undefined)redraw=true;if($$.frameList.length>0){if($$.frameList[$$.frameList.length-1].toDo==="removeSeries"||$$.frameList[$$.frameList.length-1].toDo==="addSeries"){var frameList=$$.frameList.slice();$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);$$.frameList=[]}}$$.pushFuncToQueue($$.frameUpdateList,"setSeriesData",[seriesIndexOrName,data,redraw]);if(redraw){for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}};top_chart_internal_fn.setSeriesData=function(seriesIndexOrName,data,redraw){var $$=this,config=$$.config,series=$$.getSeries(seriesIndexOrName);if(data&&series)series.data=data;$$.updateWithData($$.convertSeriesToData(config.series),true);if(redraw)$$.loadFromArgs(config,redraw)};top_chart_fn.getSeriesData=function(seriesIndexOrName){var $$=this.internal,series=$$.getSeries(seriesIndexOrName);if(series)return series.data;else return};top_chart_internal_fn.executeFrameList=function(frameList){var $$=this,config=$$.config,series,frame,funcName,params,id,ids=[],frameListLength=frameList.length;for(var k=0;k<frameListLength;k++){frame=frameList.shift();funcName=frame.toDo;params=frame.params;if(funcName==="addSeries"){var seriesOptions=params[0];if(typeof seriesOptions!=="undefined"&&seriesOptions&&seriesOptions.constructor===Array){seriesOptions.forEach(function(currentValue,index,array){series=$$.convertHighchartsSeriesOptionsToTopChartsSeriesOptions(currentValue);config.series.push(series)})}else if(seriesOptions.constructor===Object){seriesOptions=$$.convertHighchartsSeriesOptionsToTopChartsSeriesOptions(seriesOptions);config.series.push(seriesOptions)}$$.buildStacks(config.series);$$.buildSeries(config.series);$$.updateWithData($$.convertSeriesToData(config.series))}else if(funcName==="removeSeries"){var index=params[0],count=params[1];if(!count)count=1;if(index>-1){var removedSeries=config.series.splice(index,count);$$.buildStacks(config.series);$$.buildSeries(config.series);if(config.legend_pagination){if($$.prevLegendList&&$$.prevLegendList.length>index){$$.currentLegendIndex=$$.currentLegendIndex-count>0?$$.currentLegendIndex-count:0}}$$.updateWithData($$.convertSeriesToData(config.series));for(var i=0;i<count;i++){id=removedSeries[i].name;ids.push(id);delete config.data_types[id]}if($$.legend){ids.forEach(function(currentValue){$$.legend.selectAll("."+CLASS.legendItem+$$.getTargetSelectorSuffix(currentValue)).remove()})}if(ids.length){$$.svg.selectAll($$.selectorTargets(ids)).remove()}}}}$$.loadFromArgs({series:config.series});return config.series};top_chart_fn.unload=function(args){var $$=this.internal;args=args||{};if(args instanceof Array){args={ids:args}}else if(typeof args==="string"){args={ids:[args]}}$$.unload($$.mapToTargetIds(args.ids),function(){$$.redraw({withUpdateOrgXDomain:true,withUpdateXDomain:true,withLegend:true});if(args.done){args.done()}})};top_chart_fn.flow=function(args){var $$=this.internal,targets,data,notfoundIds=[],orgDataCount=$$.getMaxDataCount(),dataCount,domain,baseTarget,baseValue,length=0,tail=0,diff,to,series=$$.getSeries(args.series[0].name);if(args.json){data=$$.convertJsonToData(args.json,args.keys)}else if(args.rows){data=$$.convertRowsToData(args.rows)}else if(args.columns){data=$$.convertColumnsToData(args.columns)}else if(args.series){data=$$.convertSeriesToData(args.series);if(series){if(!series.data){series.data=[]}if($$.isTimeSeries()){series.data.push(args.series[0].data[0])}else{if(Array.isArray(series.data[0]))series.data.push(args.series[0].data[0]);else series.data.push(args.series[0].data[0][1])}$$.buildStacks($$.config.series);$$.buildSeries($$.config.series)}}else{return}targets=$$.convertDataToTargets(data,true);$$.data.targets.forEach(function(t){var found=false,i,j;for(i=0;i<targets.length;i++){if(t.id===targets[i].id){found=true;if(t.values[t.values.length-1]){tail=t.values[t.values.length-1].index+1}length=targets[i].values.length;for(j=0;j<length;j++){targets[i].values[j].index=tail+j;if(!$$.isTimeSeries()){var newX=args.series[0].data[0][0]?args.series[0].data[0][0]:args.series[0].data[0].x;targets[i].values[j].x=newX}}t.values=t.values.concat(targets[i].values);targets.splice(i,1);break}}});if($$.stacking==="percent"){$$.data.targets=$$.convertDataToTargets($$.convertDataToPercentData($$.convertSeriesToData($$.config.series),true));$$.data.targetsForTooltip=$$.convertDataToTargets($$.convertSeriesToData($$.config.series))}var i;if(args.redraw){for(i=0;i<$$.data.targets.length;i++){if(args.series[0].name===$$.data.targets[i].id)baseTarget=$$.data.targets[i]}if(!baseTarget)baseTarget=$$.data.targets[0];var dataLength=baseTarget.values.length;$$.data.targets.forEach(function(t){var i,j,xTail;length=0;if(dataLength>t.values.length){length++;if(t.values[t.values.length-1].x){xTail=$$.flowX}else{tail=t.values[t.values.length-1].index+1;xTail=tail}for(j=0;j<length;j++){t.values.push({x:$$.isTimeSeries()?xTail:xTail+j,value:null,id:t.id,innerData:undefined,index:tail+j})}}})}if($$.data.targets.length){targets.forEach(function(t){var i,missing=[];for(i=$$.data.targets[0].values[0].index;i<tail;i++){missing.push({id:t.id,index:i,x:$$.isTimeSeries()?$$.getOtherTargetX(i):i,value:null})}t.values.forEach(function(v){v.index+=tail;if(!$$.isTimeSeries()){v.x+=tail}});t.values=missing.concat(t.values)})}$$.data.targets=$$.data.targets.concat(targets);dataCount=$$.getMaxDataCount();baseTarget=$$.data.targets[0];baseValue=baseTarget.values[0];if(isDefined(args.to)){length=0;to=$$.isTimeSeries()?$$.parseDate(args.to):args.to;baseTarget.values.forEach(function(v){if(v.x<to){length++}})}else if(isDefined(args.length)){length=args.length}if(!orgDataCount){if($$.isTimeSeries()){if(baseTarget.values.length>1){diff=baseTarget.values[baseTarget.values.length-1].x-baseValue.x}else{diff=baseValue.x-$$.getXDomain($$.data.targets)[0]}}else{diff=1}domain=[baseValue.x-diff,baseValue.x];$$.updateXDomain(null,true,true,false,domain)}else if(orgDataCount===1){if($$.isTimeSeries()){diff=(baseTarget.values[baseTarget.values.length-1].x-baseValue.x)/2;domain=[new Date(+baseValue.x-diff),new Date(+baseValue.x+diff)];$$.updateXDomain(null,true,true,false,domain)}}$$.updateTargets($$.data.targets);if(args.redraw){$$.redraw({flow:{index:baseValue.index,length:length,duration:isValue(args.duration)?args.duration:$$.config.transition_duration,done:args.done,orgDataCount:orgDataCount},withLegend:true,withTransition:orgDataCount>1,withTrimXDomain:false,withUpdateXAxis:true})}};top_chart_internal_fn.generateFlow=function(args){var $$=this,config=$$.config,d3=$$.d3;return function(){var targets=args.targets,flow=args.flow,drawBar=args.drawBar,drawLine=args.drawLine,drawArea=args.drawArea,cx=args.cx,cy=args.cy,xv=args.xv,xForText=args.xForText,yForText=args.yForText,duration=args.duration;var translateX,scaleX=1,transform,transformWithoutScale,flowIndex=flow.index,flowLength=flow.length,flowStart=$$.getValueOnIndex($$.data.targets[0].values,flowIndex),flowEnd=$$.getValueOnIndex($$.data.targets[0].values,flowIndex+flowLength),orgDomain=$$.x.domain(),domain,durationForFlow=flow.duration||duration,done=flow.done||function(){},wait=$$.generateWait();var xgrid=$$.xgrid||d3.selectAll([]),xgridLines=$$.xgridLines||d3.selectAll([]),mainRegion=$$.mainRegion||d3.selectAll([]),mainText=$$.mainText||d3.selectAll([]),mainBar=$$.mainBar||d3.selectAll([]),mainLine=$$.mainLine||d3.selectAll([]),mainArea=$$.mainArea||d3.selectAll([]),mainCircle=$$.mainCircle||d3.selectAll([]),expandedCircle=$$.expandedCircle||d3.selectAll([]),mainMarker=$$.mainMarker||d3.selectAll([]),mainScatter=$$.mainScatter||d3.selectAll([]);var flowErrorFlag=false;var transformYForText="-10";$$.flowing=true;if(!flowStart||!flowEnd)flowErrorFlag=true;var minX=$$.data.targets[0].values[0].x;for(var i=0;i<$$.data.targets.length;i++){if($$.data.targets[i].values[0])if($$.data.targets[i].values[0].x<minX){minX=$$.data.targets[i].values[0].x}}$$.data.targets.forEach(function(d){if(d.values[0])if(d.values[0].x<=minX){d.values.splice(0,flowLength)}});var series,seriesData,dataArray;for(var i=0;i<$$.data.targets.length;i++){series=$$.config.series[i];seriesData=[];for(var j=0;j<$$.data.targets[i].values.length;j++){if($$.data.targets[i].values[j].x){dataArray=[];dataArray.push($$.data.targets[i].values[j].x);if($$.stacking==="percent")if(Array.isArray($$.config.series[i].data[j+flowLength]))dataArray.push($$.config.series[i].data[j+flowLength][1]);else dataArray.push($$.config.series[i].data[j+flowLength]);else dataArray.push($$.data.targets[i].values[j].value);seriesData.push(dataArray)}else if($$.stacking==="percent")if(Array.isArray($$.config.series[i].data[j+flowLength]))seriesData.push($$.config.series[i].data[j+flowLength][1]);else seriesData.push($$.config.series[i].data[j+flowLength]);else seriesData.push($$.data.targets[i].values[j].value)}$$.config.series[i].data=seriesData}$$.buildSeries($$.config.series);$$.buildStacks($$.config.series);domain=$$.updateXDomain(targets,true,true);if(!config.xAxis_tickTimeInterval&&config.xAxis_tick_count&&config.xAxis_type==="datetime"){$$.xAxis.tickValues($$.generateTickTimeInterval("normal",config.xAxis_tick_count))}else if(config.xAxis_type==="datetime"&&config.xAxis_tickTimeInterval){$$.xAxis.tickValues($$.generateTickTimeInterval(config.xAxis_tick_from,config.xAxis_tick_count))}if(config.slider_enabled){$$.updateSlider();if(config.slider_mode==="flow")return}if(!flow.orgDataCount){if($$.data.targets[0].values.length!==1){translateX=$$.x(orgDomain[0])-$$.x(domain[0])}else{if($$.isTimeSeries()){flowStart=$$.getValueOnIndex($$.data.targets[0].values,0);flowEnd=$$.getValueOnIndex($$.data.targets[0].values,$$.data.targets[0].values.length-1);translateX=$$.x(flowStart.x)-$$.x(flowEnd.x)}else{translateX=diffDomain(domain)/2}}}else if(flowErrorFlag){return}else if(flow.orgDataCount===1||flowStart.x===flowEnd.x){translateX=$$.x(orgDomain[0])-$$.x(domain[0])}else{if($$.isTimeSeries()){translateX=$$.x(orgDomain[0])-$$.x(domain[0])}else{translateX=$$.x(flowStart.x)-$$.x(flowEnd.x)}}if(TOP.chart.Browser.isIE())transformYForText="0";else transformYForText="-10";scaleX=diffDomain(orgDomain)/diffDomain(domain);transform="translate("+translateX+",0) scale("+scaleX+",1)";transformWithoutScale="translate("+translateX+",0)";$$.hideXGridFocus();d3.transition().ease("linear").duration(durationForFlow).each(function(){wait.add($$.axes.x.transition().call($$.xAxis));wait.add(mainBar.transition().attr("transform",transform));wait.add(mainLine.transition().attr("transform",transform));wait.add(mainArea.transition().attr("transform",transform));wait.add(mainScatter.transition().attr("transform",function(d){return"translate("+(cx(d)-3.5)+","+(cy(d)-3.5)+")"}));wait.add(mainMarker.transition().attr("transform",function(d){return"translate("+cx(d)+","+cy(d)+")"}));wait.add(mainText.transition().attr("transform",function(){return"translate("+translateX+","+transformYForText+")"}));wait.add(mainRegion.filter($$.isRegionOnX).transition().attr("transform",transform));wait.add(xgrid.transition().attr("transform",transform));wait.add(xgridLines.transition().attr("transform",transform))}).call(wait,function(){var i,shapes=[],texts=[],eventRects=[];if(flowLength){for(i=0;i<flowLength;i++){shapes.push("."+CLASS.shape+"-"+(flowIndex+i));texts.push("."+CLASS.text+"-"+(flowIndex+i));eventRects.push("."+CLASS.eventRect+"-"+(flowIndex+i))}if($$.hasType("bar"))$$.svg.selectAll("."+CLASS.shapes).selectAll(shapes).remove();$$.svg.selectAll("."+CLASS.texts).selectAll(texts).remove();$$.svg.selectAll("."+CLASS.eventRects).selectAll(eventRects).remove()}xgrid.attr("transform",null).attr($$.xgridAttr);xgridLines.attr("transform",null);xgridLines.select("line").attr("x1",config.chart_inverted?0:xv).attr("x2",config.chart_inverted?$$.width:xv);xgridLines.select("text").attr("x",config.chart_inverted?$$.width:0).attr("y",xv);mainBar.attr("transform",null).attr("d",drawBar);mainLine.attr("transform",null).attr("d",drawLine);mainArea.attr("transform",null).attr("d",drawArea);mainScatter.attr("cx",cx).attr("cy",cy);mainText.attr("transform","translate(0,"+transformYForText+")").attr("x",xForText).attr("y",yForText).style("fill-opacity",$$.opacityForText.bind($$));mainRegion.attr("transform",null);mainRegion.select("rect").filter($$.isRegionOnX).attr("x",$$.regionX.bind($$)).attr("width",$$.regionWidth.bind($$));$$.updateXGrid();if(config.interaction_enabled){$$.redrawEventRect()}done();$$.flowing=false})}};top_chart_fn.selected=function(targetId){var $$=this.internal,d3=$$.d3;return d3.merge($$.main.selectAll("."+CLASS.shapes+$$.getTargetSelectorSuffix(targetId)).selectAll("."+CLASS.shape).filter(function(){return d3.select(this).classed(CLASS.SELECTED)}).map(function(d){return d.map(function(d){var data=d.__data__;return data.data?data.data:data})}))};top_chart_fn.select=function(ids,indices,resetOther){var $$=this.internal,d3=$$.d3,config=$$.config;if(!config.data_selection_enabled){return}$$.main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).each(function(d,i){var shape=d3.select(this),id=d.data?d.data.id:d.id,toggle=$$.getToggle(this,d).bind($$),isTargetId=config.data_selection_grouped||!ids||ids.indexOf(id)>=0,isTargetIndex=!indices||indices.indexOf(i)>=0,isSelected=shape.classed(CLASS.SELECTED);if(shape.classed(CLASS.line)||shape.classed(CLASS.area)){return}if(isTargetId&&isTargetIndex){if(config.data_selection_isselectable(d)&&!isSelected){toggle(true,shape.classed(CLASS.SELECTED,true),d,i)}}else if(isDefined(resetOther)&&resetOther){if(isSelected){toggle(false,shape.classed(CLASS.SELECTED,false),d,i)}}})};top_chart_fn.unselect=function(ids,indices){var $$=this.internal,d3=$$.d3,config=$$.config;if(!config.data_selection_enabled){return}$$.main.selectAll("."+CLASS.shapes).selectAll("."+CLASS.shape).each(function(d,i){var shape=d3.select(this),id=d.data?d.data.id:d.id,toggle=$$.getToggle(this,d).bind($$),isTargetId=config.data_selection_grouped||!ids||ids.indexOf(id)>=0,isTargetIndex=!indices||indices.indexOf(i)>=0,isSelected=shape.classed(CLASS.SELECTED);if(shape.classed(CLASS.line)||shape.classed(CLASS.area)){return}if(isTargetId&&isTargetIndex){if(config.data_selection_isselectable(d)){if(isSelected){toggle(false,shape.classed(CLASS.SELECTED,false),d,i)}}}})};top_chart_fn.transform=function(type,targetIds){var $$=this.internal,options=["pie","donut"].indexOf(type)>=0?{withTransform:true}:null;$$.transformTo(targetIds,type,options)};top_chart_internal_fn.transformTo=function(targetIds,type,optionsForRedraw){var $$=this,withTransitionForAxis=!$$.hasArcType(),options=optionsForRedraw||{withTransitionForAxis:withTransitionForAxis};options.withTransitionForTransform=false;$$.transiting=false;$$.setTargetType(targetIds,type);$$.updateTargets($$.data.targets);$$.updateAndRedraw(options)};top_chart_fn.groups=function(groups){var $$=this.internal,config=$$.config;if(isUndefined(groups)){return config.data_groups}config.data_groups=groups;$$.redraw();return config.data_groups};top_chart_fn.xgrids=function(grids){var $$=this.internal,config=$$.config;if(!grids){return config.grid_x_lines}config.grid_x_lines=grids;$$.redrawWithoutRescale();return config.grid_x_lines};top_chart_fn.xgrids.add=function(grids){var $$=this.internal;return this.xgrids($$.config.grid_x_lines.concat(grids?grids:[]))};top_chart_fn.xgrids.remove=function(params){var $$=this.internal;$$.removeGridLines(params,true)};top_chart_fn.ygrids=function(grids){var $$=this.internal,config=$$.config;if(!grids){return config.grid_y_lines}config.grid_y_lines=grids;$$.redrawWithoutRescale();return config.grid_y_lines};top_chart_fn.ygrids.add=function(grids){var $$=this.internal;return this.ygrids($$.config.grid_y_lines.concat(grids?grids:[]))};top_chart_fn.ygrids.remove=function(params){var $$=this.internal;$$.removeGridLines(params,false)};top_chart_fn.regions=function(regions){var $$=this.internal,config=$$.config;if(!regions){return config.regions}config.regions=regions;$$.redrawWithoutRescale();return config.regions};top_chart_fn.regions.add=function(regions){var $$=this.internal,config=$$.config;if(!regions){return config.regions}config.regions=config.regions.concat(regions);$$.redrawWithoutRescale();return config.regions};top_chart_fn.regions.remove=function(options){var $$=this.internal,config=$$.config,duration,classes,regions;options=options||{};duration=$$.getOption(options,"duration",config.transition_duration);classes=$$.getOption(options,"classes",[CLASS.region]);regions=$$.main.select("."+CLASS.regions).selectAll(classes.map(function(c){return"."+c}));(duration?regions.transition().duration(duration):regions).style("opacity",0).remove();config.regions=config.regions.filter(function(region){var found=false;if(!region["class"]){return true}region["class"].split(" ").forEach(function(c){if(classes.indexOf(c)>=0){found=true}});return!found});return config.regions};top_chart_fn.data=function(targetIds){var targets=this.internal.data.targets;return typeof targetIds==="undefined"?targets:targets.filter(function(t){return[].concat(targetIds).indexOf(t.id)>=0})};top_chart_fn.data.shown=function(targetIds){return this.internal.filterTargetsToShow(this.data(targetIds))};top_chart_fn.data.values=function(targetId){var targets,values=null;if(targetId){targets=this.data(targetId);values=targets[0]?targets[0].values.map(function(d){return d.value}):null}return values};top_chart_fn.data.names=function(names){this.internal.clearLegendItemTextBoxCache();return this.internal.updateDataAttributes("names",names)};top_chart_fn.data.colors=function(colors){return this.internal.updateDataAttributes("colors",colors)};top_chart_fn.data.axes=function(axes){return this.internal.updateDataAttributes("axes",axes)};top_chart_fn.category=function(i,category){var $$=this.internal,config=$$.config;if(arguments.length>1){config.xAxis_categories[i]=category;$$.redraw()}return config.xAxis_categories[i]};top_chart_fn.categories=function(categories){var $$=this.internal,config=$$.config;if(!arguments.length){return config.xAxis_categories}config.xAxis_categories=categories;$$.redraw();return config.xAxis_categories};top_chart_fn.color=function(id){var $$=this.internal;return $$.color(id)};top_chart_fn.x=function(x){var $$=this.internal;if(arguments.length){$$.updateTargetX($$.data.targets,x);$$.redraw({withUpdateOrgXDomain:true,withUpdateXDomain:true})}return $$.data.xs};top_chart_fn.xs=function(xs){var $$=this.internal;if(arguments.length){$$.updateTargetXs($$.data.targets,xs);$$.redraw({withUpdateOrgXDomain:true,withUpdateXDomain:true})}return $$.data.xs};top_chart_fn.axis=function(){};top_chart_fn.axis.labels=function(labels){var $$=this.internal;if(arguments.length){Object.keys(labels).forEach(function(axisId){$$.axis.setLabelText(axisId,labels[axisId])});$$.axis.updateLabels()}};top_chart_fn.axis.max=function(max){var $$=this.internal,config=$$.config;if(arguments.length){if(typeof max==="object"){if(isValue(max.x)){config.axis_x_max=max.x}if(isValue(max.y)){config.yAxis_max=max.y}if(isValue(max.y2)){config.axis_y2_max=max.y2}}else{config.yAxis_max=config.axis_y2_max=max}$$.redraw({withUpdateOrgXDomain:true,withUpdateXDomain:true})}else{return{x:config.axis_x_max,y:config.yAxis_max,y2:config.axis_y2_max}}};top_chart_fn.axis.min=function(min){var $$=this.internal,config=$$.config;if(arguments.length){if(typeof min==="object"){if(isValue(min.x)){config.axis_x_min=min.x}if(isValue(min.y)){config.yAxis_min=min.y}if(isValue(min.y2)){config.axis_y2_min=min.y2}}else{config.yAxis_min=config.axis_y2_min=min}$$.redraw({withUpdateOrgXDomain:true,withUpdateXDomain:true})}else{return{x:config.axis_x_min,y:config.yAxis_min,y2:config.axis_y2_min}}};top_chart_fn.axis.range=function(range){if(arguments.length){if(isDefined(range.max)){this.axis.max(range.max)}if(isDefined(range.min)){this.axis.min(range.min)}}else{return{max:this.axis.max(),min:this.axis.min()}}};top_chart_fn.emptyFrameQueue=function(){var $$=this.internal,config=$$.config;$$.stopAnimationLoop();if($$.frameQueue){$$.frameQueue=[];$$.frameUpdateList=[]}};top_chart_fn.domainX=function(domain){var $$=this.internal,config=$$.config;if(domain){$$.x.domain([domain[0],domain[1]])}else{var domain=$$.getXDomain($$.data.targets);return domain}};top_chart_fn.update=function(config){var $$=this.internal,oldConfig=$$.config,target,keys,read,type_changed,oldType,chartType,color_changed;function find(){var key=keys.shift();if(key&&target&&typeof target==="object"&&key in target&&key!=="series"){target=target[key];if(key==="chart")chartType=true;if(key==="type"&&chartType){type_changed=true;oldType=oldConfig["chart_type"]}if(key==="colors")color_changed=true;return find()}else if(!key){return target}else{return undefined}}Object.keys(oldConfig).forEach(function(key){target=config;keys=key.split("_");read=find();if(isDefined(read)){oldConfig[key]=read}});if(type_changed)$$.updateChartElement(oldType);$$.updateParams()};top_chart_fn.setOption=function(option){var $$=this.internal,config=$$.config;if($$.frameList.length>0){if($$.frameList[$$.frameList.length-1].toDo==="removeSeries"||$$.frameList[$$.frameList.length-1].toDo==="addSeries"){var frameList=$$.frameList.slice();$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);$$.frameList=[]}}$$.pushFuncToQueue($$.frameUpdateList,"setOption",[option]);for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()};top_chart_internal_fn.setOption=function(config){var $$=this,oldConfig=$$.config,target,keys,read,type_changed,oldType,chartType,color_changed;function find(){var key=keys.shift();if(key&&target&&typeof target==="object"&&key in target){target=target[key];if(key==="chart")chartType=true;if(key==="type"&&chartType){type_changed=true;oldType=oldConfig["chart_type"]}if(key==="colors")color_changed=true;return find()}else if(!key){return target}else{return undefined}}Object.keys(oldConfig).forEach(function(key){target=config;keys=key.split("_");read=find();if(isDefined(read)){oldConfig[key]=read}});if(type_changed)$$.updateChartElement(oldType);
$$.updateParams();$$.redraw()};top_chart_fn.legend=function(){};top_chart_fn.legend.show=function(targetIds){var $$=this.internal;$$.showLegend($$.mapToTargetIds(targetIds));$$.updateAndRedraw({withLegend:true})};top_chart_fn.legend.hide=function(targetIds){var $$=this.internal;$$.hideLegend($$.mapToTargetIds(targetIds));$$.updateAndRedraw({withLegend:true})};top_chart_fn.resize=function(size){var $$=this.internal,config=$$.config;config.chart_width=size?size.width:null;config.chart_height=size?size.height:null;this.flush()};top_chart_fn.setSize=function(width,height,animation){var $$=this.internal,config=$$.config;config.chart_width=width||null;config.chart_height=height||null;this.flush()};top_chart_fn.flush=function(){var $$=this.internal;$$.updateAndRedraw({withLegend:true,withTransition:false,withTransitionForTransform:false})};top_chart_fn.redraw=function(){var $$=this.internal;if($$.frameList.length>0){if($$.frameList[$$.frameList.length-1].toDo==="removeSeries"||$$.frameList[$$.frameList.length-1].toDo==="addSeries"){var frameList=$$.frameList.slice();$$.pushFuncToQueue($$.frameUpdateList,"executeFrameList",[frameList]);$$.frameList=[]}}if($$.frameUpdateList){for(var i=0;i<$$.frameUpdateList.length;i++)$$.frameQueue.push($$.frameUpdateList[i]);$$.frameUpdateList=[];$$.executeFrameQueue()}$$.updateAndRedraw({withLegend:true,withTransition:true,withTransitionForTransform:false})};top_chart_fn.destroy=function(){var $$=this.internal;window.clearInterval($$.intervalForObserveInserted);window.onresize=null;$$.selectChart.classed("TOP",false).html("");Object.keys($$).forEach(function(key){$$[key]=null});return null};top_chart_fn.tooltip=function(){};top_chart_fn.tooltip.show=function(args){var $$=this.internal,index,mouse;if(args.mouse){mouse=args.mouse}if(args.data){if($$.isMultipleX()){mouse=[$$.x(args.data.x),$$.getYScale(args.data.id)(args.data.value)];index=null}else{index=isValue(args.data.index)?args.data.index:$$.getIndexByX(args.data.x)}}else if(typeof args.x!=="undefined"){index=$$.getIndexByX(args.x)}else if(typeof args.index!=="undefined"){index=args.index}$$.dispatchEvent("mouseover",index,mouse);$$.dispatchEvent("mousemove",index,mouse)};top_chart_fn.tooltip.hide=function(){this.internal.dispatchEvent("mouseout",0)};var tickTextCharSize;function TOP_axis(d3,params,show){var scale=d3.scale.linear(),orient="bottom",innerTickSize=3,outerTickSize,tickPadding=5,tickValues=null,tickFormat,tickArguments;var tickOffset=0,tickCulling=true,tickCentered;params=params||{};outerTickSize=0;function axisX(selection,x){selection.attr("transform",function(d){return"translate("+Math.ceil(x(d)+tickOffset)+", 0)"})}function axisY(selection,y){selection.attr("transform",function(d){return"translate(0,"+Math.ceil(y(d))+")"})}function scaleExtent(domain){var start=domain[0],stop=domain[domain.length-1];return start<stop?[start,stop]:[stop,start]}function generateTicks(scale){var i,domain,ticks=[];if(scale.ticks){return scale.ticks.apply(scale,tickArguments)}domain=scale.domain();for(i=Math.ceil(domain[0]);i<domain[1];i++){ticks.push(i)}if(ticks.length>0&&ticks[0]>0){ticks.unshift(ticks[0]-(ticks[1]-ticks[0]))}return ticks}function copyScale(){var newScale=scale.copy(),domain;if(params.isCategory){domain=scale.domain();newScale.domain([domain[0],domain[1]-1])}return newScale}function textFormatted(v){var formatted=tickFormat?tickFormat(v):v;return typeof formatted!=="undefined"?formatted:""}function getSizeFor1Char(tick){if(tickTextCharSize){return tickTextCharSize}var size={h:11.5,w:5.5};tick.select("text").text(textFormatted).each(function(d){var box=this.getBoundingClientRect(),text=textFormatted(d),h=box.height,w=text?box.width/text.length:undefined;if(h&&w){size.h=h;size.w=w}}).text("");tickTextCharSize=size;return size}function transitionise(selection){return params.withoutTransition?selection:d3.transition(selection)}function axis(g){g.each(function(){var g=axis.g=d3.select(this);var scale0=this.__chart__||scale,scale1=this.__chart__=copyScale();var ticks=tickValues?tickValues:generateTicks(scale1);var xAxisDom="TOP-axis TOP-axis-x";if(this.className.baseVal!==xAxisDom){var maxTick=findMaxValue(ticks),isDecimal=hasDecimal(ticks);if(maxTick>=1){ticks=isDecimal?arrayToFixed(ticks,1):arrayToFixed(ticks,0)}else{var maxTickDecimal=decimalPlaces(maxTick),decimalNum,isMaxDecimal=true;ticks.forEach(function(d){decimalNum=decimalPlaces(d);if(maxTickDecimal<decimalNum)isMaxDecimal=false});ticks=isMaxDecimal?arrayToFixed(ticks,maxTickDecimal):arrayToFixed(ticks,maxTickDecimal+1)}}var tick=g.selectAll(".tick").data(ticks,scale1),tickEnter=tick.enter().insert("g",".domain").attr("class","tick").style("opacity",1e-6),tickExit=tick.exit().remove(),tickUpdate=transitionise(tick).style("opacity",1),tickTransform,tickX,tickY;var range=scale.rangeExtent?scale.rangeExtent():scaleExtent(scale.range()),path=g.selectAll(".domain").data([0]),pathUpdate=(path.enter().append("path").attr("class","domain"),transitionise(path));tickEnter.append("line");tickEnter.append("text");var lineEnter=tickEnter.select("line"),lineUpdate=tickUpdate.select("line"),textEnter=tickEnter.select("text"),textUpdate=tickUpdate.select("text");if(params.isCategory){tickOffset=Math.ceil((scale1(1)-scale1(0))/2);tickX=tickCentered?0:tickOffset;tickY=tickCentered?tickOffset:0}else{tickOffset=tickX=0}var text,tspan,sizeFor1Char=getSizeFor1Char(g.select(".tick")),counts=[];var tickLength=Math.max(innerTickSize,0)+tickPadding,isVertical=orient==="left"||orient==="right";function arrayToFixed(array,number){var fixedArray=[];for(var i=0;i<array.length;i++){fixedArray.push(array[i].toFixed(number))}return fixedArray}function findMaxValue(array){var maxNum=array[0];for(var i=0;i<array.length;i++){if(array[i]>maxNum)maxNum=array[i]}return maxNum}function hasDecimal(array){var isDecimal=false;array.forEach(function(d){if(d%1!==0)isDecimal=true});return isDecimal}function decimalPlaces(num){var match=(""+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!match){return 0}return Math.max(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0))}function splitTickText(d,maxWidth){var tickText=textFormatted(d),subtext,spaceIndex,textWidth,splitted=[];if(Object.prototype.toString.call(tickText)==="[object Array]"){return tickText}if(!maxWidth||maxWidth<=0){maxWidth=isVertical?55:params.isCategory?Math.ceil(scale1(ticks[1])-scale1(ticks[0]))-12:110;maxWidth=maxWidth*2}maxWidth=params.maxWidth?params.maxWidth:maxWidth;function split(splitted,text){spaceIndex=undefined;for(var i=1;i<text.length;i++){if(text.charAt(i)===" "){spaceIndex=i}subtext=text.substr(0,i+1);textWidth=sizeFor1Char.w*subtext.length;if(maxWidth<textWidth){return split(splitted.concat(text.substr(0,spaceIndex?spaceIndex:i)),text.slice(spaceIndex?spaceIndex+1:i))}}return splitted.concat(text)}return split(splitted,tickText+"")}function optimalTickText(d){var tickText=textFormatted(d);if(params.tickLimitType==="collapse"&&tickText.length>7||params.tickLimitType==="strict"&&tickText.length>params.tickLimitCount){tickText=tickText.slice(0,params.tickLimitCount);tickText=tickText+"..."}return[].concat(tickText)}function tspanDy(d,i){var dy=sizeFor1Char.h;if(i===0){if(orient==="left"||orient==="right"){dy=-((counts[d.index]-1)*(sizeFor1Char.h/2)-3)}else{dy=".71em"}}return dy}function tickSize(d){var $$=TOP.chart.internal.fn;var tickPosition=scale(d)+(tickCentered?0:tickOffset);return range[0]<tickPosition&&tickPosition<range[1]?innerTickSize:0}function tickTooltipContent(d){}function tickMouseOver(d,mouse){}function tickMouseOut(d){}text=tick.select("text");tspan=text.selectAll("tspan").data(function(d,i){var ticktext=textFormatted(d);var splitted=params.tickMultiline?splitTickText(d,params.tickWidth):params.tickLimit?optimalTickText(d):[].concat(textFormatted(d));counts[i]=splitted.length;return splitted.map(function(s){return{index:i,splitted:s,text:ticktext}})});text.on("mouseover",function(d){var mouse=d3.mouse(this);return tickMouseOver(d,mouse)}).on("mouseout",tickMouseOut);tspan.enter().append("tspan");tspan.exit().remove();tspan.text(function(d){return d.splitted});var rotate=params.tickTextRotate;function textAnchorForText(rotate){if(!rotate){return"middle"}return rotate>0?"start":"end"}function textTransform(rotate){if(!rotate){return""}if(params.isDateTime)return"translate(10,0) rotate("+rotate+")";else return"rotate("+rotate+")"}function dxForText(rotate){return 0}function yForText(rotate){if(!rotate){return tickLength}return 11.5-2.5*(rotate/15)*(rotate>0?1:-1)}switch(orient){case"bottom":{tickTransform=axisX;lineEnter.attr("y2",innerTickSize);textEnter.attr("y",tickLength);lineUpdate.attr("x1",tickX).attr("x2",tickX).attr("y2",tickSize);textUpdate.attr("x",0).attr("y",yForText(rotate)).style("text-anchor",textAnchorForText(rotate)).attr("transform",textTransform(rotate));tspan.attr("x",0).attr("dy",tspanDy).attr("dx",dxForText(rotate));pathUpdate.attr("d","M"+range[0]+","+outerTickSize+"V0H"+range[1]+"V"+outerTickSize);break}case"top":{tickTransform=axisX;lineEnter.attr("y2",-innerTickSize);textEnter.attr("y",-tickLength);lineUpdate.attr("x2",0).attr("y2",-innerTickSize);textUpdate.attr("x",0).attr("y",-tickLength);text.style("text-anchor","middle");tspan.attr("x",0).attr("dy","0em");pathUpdate.attr("d","M"+range[0]+","+-outerTickSize+"V0H"+range[1]+"V"+-outerTickSize);break}case"left":{tickTransform=axisY;lineEnter.attr("x2",-innerTickSize);textEnter.attr("x",-tickLength);lineUpdate.attr("x2",-innerTickSize).attr("y1",tickY).attr("y2",tickY);textUpdate.attr("x",-tickLength).attr("y",tickOffset);text.style("text-anchor","end");tspan.attr("x",-tickLength/2).attr("dy",tspanDy);pathUpdate.attr("d","M"+-outerTickSize+","+range[0]+"H0V"+range[1]+"H"+-outerTickSize);break}case"right":{tickTransform=axisY;lineEnter.attr("x2",innerTickSize);textEnter.attr("x",tickLength);lineUpdate.attr("x2",innerTickSize).attr("y2",0);textUpdate.attr("x",tickLength).attr("y",0);text.style("text-anchor","start");tspan.attr("x",tickLength).attr("dy",tspanDy);pathUpdate.attr("d","M"+outerTickSize+","+range[0]+"H0V"+range[1]+"H"+outerTickSize);break}}if(scale1.rangeBand){var x=scale1,dx=x.rangeBand()/2;scale0=scale1=function(d){return x(d)+dx}}else if(scale0.rangeBand){scale0=scale1}else{tickExit.call(tickTransform,scale1)}tickEnter.call(tickTransform,scale0);tickUpdate.call(tickTransform,scale1)})}axis.scale=function(x){if(!arguments.length){return scale}scale=x;return axis};axis.orient=function(x){if(!arguments.length){return orient}orient=x==="top"||x==="right"||x==="bottom"||x==="left"?x+"":"bottom";return axis};axis.tickFormat=function(format){if(!arguments.length){return tickFormat}tickFormat=format;return axis};axis.tickCentered=function(isCentered){if(!arguments.length){return tickCentered}tickCentered=isCentered;return axis};axis.tickOffset=function(){return tickOffset};axis.tickInterval=function(){var interval,length;if(params.isCategory){interval=tickOffset*2}else{length=axis.g.select("path.domain").node().getTotalLength()-outerTickSize*2;interval=length/axis.g.selectAll("line").size()}return interval===Infinity?0:interval};axis.ticks=function(){if(!arguments.length){return tickArguments}tickArguments=arguments;return axis};axis.tickCount=function(){var tickValues=this.tickValues();return tickValues.slice().sort(function(a,b){return a-b}).reduce(function(a,b){if(a.slice(-1)[0]!==b)a.push(b);return a},[]).length};axis.tickCulling=function(culling){if(!arguments.length){return tickCulling}tickCulling=culling;return axis};axis.tickValues=function(x){if(typeof x==="function"){tickValues=function(){return x(scale.domain())}}else{if(!arguments.length){return tickValues}tickValues=x}return axis};axis.pixelLength=function(){var l=axis.g.select("path.domain").node().getTotalLength();return l};return axis}top_chart_internal_fn.isSafari=function(){var ua=window.navigator.userAgent;return ua.indexOf("Safari")>=0&&ua.indexOf("Chrome")<0};top_chart_internal_fn.isChrome=function(){var ua=window.navigator.userAgent;return ua.indexOf("Chrome")>=0};if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP;return fBound}}if(typeof define==="function"&&define.amd){define("TOP",["d3"],TOP)}else if("undefined"!==typeof exports&&"undefined"!==typeof module){module.exports=TOP}else{window.TOP=TOP}top_chart_fn.title=function(){};top_chart_fn.setTitle=function(titleConfig,subtitleConfig,redraw){var $$=this.internal,config=$$.config;if(titleConfig){if(!(titleConfig.show===false)){config.title_show=true}else{config.title_show=false}config.title_align=titleConfig.align||"left";config.title_floating=titleConfig.floating||false;config.title_margin=titleConfig.margin||{top:15,right:15,bottom:15,left:16};config.title_text=titleConfig.text;config.title_verticalAlign=titleConfig.verticalAlign||undefined;config.title_x=titleConfig.x||0;config.title_y=titleConfig.y||undefined}if(subtitleConfig){if(!(subtitleConfig.show===false)){config.subtitle_show=true}else{config.subtitle_show=false}config.subtitle_align=subtitleConfig.align||"center";config.subtitle_floating=subtitleConfig.floating||false;config.subtitle_text=subtitleConfig.text||"Chart title";config.subtitle_verticalAlign=subtitleConfig.verticalAlign||undefined;config.subtitle_x=subtitleConfig.x||0;config.subtitle_y=subtitleConfig.y||undefined}if(!(redraw==="false")){$$.updateTitle();$$.redraw();$$.updateSubtitle();$$.redraw()}};top_chart_internal_fn.initTitle=function(){var $$=this,config=$$.config;if(!config.title_text||config.title_show===false){return}else{$$.titleContainer=$$.svg.append("g").attr("class",CLASS.titleContainer)}};top_chart_internal_fn.calculateTitleVerticalPosition=function(){var $$=this,config=$$.config;$$.titleVerticalPosition=0;if(config.title_verticalAlign){config.title_floating=true;if(config.title_verticalAlign==="top"){$$.titleVerticalPosition=$$.titleY+$$.getCurrentPaddingTop()}else if(config.title_verticalAlign==="middle"){$$.titleVerticalPosition=$$.height/2+$$.margin.top+$$.titleY}else if(config.title_verticalAlign==="bottom"){$$.titleVerticalPosition=$$.height-$$.margin.bottom+$$.titleY-$$.getCurrentPaddingBottom()}else{config.title_floating=false;config.title_verticalAlign=undefined}}else if(config.title_floating){$$.titleVerticalPosition=$$.titleY+$$.margin.top}else{if(TOP.chart.Browser.isIE())$$.titleHeight=$$.title.node().getBoundingClientRect().height;else $$.titleHeight=$$.title.node().getBBox().height;$$.titleVerticalPosition=$$.titleHeight+$$.getCurrentPaddingTop()+$$.titleMargin.top}};top_chart_internal_fn.calculateTitleHorizontalPosition=function(){var $$=this,config=$$.config;$$.titleHorizontalPosition=0;if(!config.title_floating){if(config.title_align==="left"){$$.titleHorizontalPosition=$$.titleMargin.left+$$.titleX}else if(config.title_align==="right"){if(TOP.chart.Browser.isIE())$$.titleHorizontalPosition=$$.margin.left+$$.width-$$.title.node().getBoundingClientRect().width-$$.titleMargin.right+$$.titleX-$$.getCurrentPaddingRight();else $$.titleHorizontalPosition=$$.margin.left+$$.width-$$.title.node().getBBox().width-$$.titleMargin.right+$$.titleX-$$.getCurrentPaddingRight()}else{if(TOP.chart.Browser.isIE())$$.titleHorizontalPosition=$$.margin.left+$$.width/2+$$.titleX-$$.title.node().getBoundingClientRect().width/2;else $$.titleHorizontalPosition=$$.margin.left+$$.width/2+$$.titleX-$$.title.node().getBBox().width/2}if(TOP.chart.Browser.isIE())$$.titleWidth=$$.titleMargin.left+$$.title.node().getBoundingClientRect().width+$$.titleMargin.right;else $$.titleWidth=$$.titleMargin.left+$$.title.node().getBBox().width+$$.titleMargin.right}else{if(config.title_align==="left"){$$.titleHorizontalPosition=$$.margin.left+$$.titleX}else if(config.title_align==="right"){if(TOP.chart.Browser.isIE())$$.titleHorizontalPosition=$$.margin.left+$$.width-$$.title.node().getBoundingClientRect().width+$$.titleX-$$.getCurrentPaddingRight();else $$.titleHorizontalPosition=$$.margin.left+$$.width-$$.title.node().getBBox().width+$$.titleX-$$.getCurrentPaddingRight()}else{if(TOP.chart.Browser.isIE())$$.titleHorizontalPosition=$$.margin.left+$$.width/2+$$.titleX-$$.title.node().getBoundingClientRect().width/2;else $$.titleHorizontalPosition=$$.margin.left+$$.width/2+$$.titleX-$$.title.node().getBBox().width/2}}};top_chart_internal_fn.updateTitle=function(){var $$=this,config=$$.config;if(!config.title_text||config.title_show===false){return}else{if(!$$.titleContainer){$$.titleContainer=$$.svg.append("g").attr("class",CLASS.titleContainer)}if(!$$.title){if(config.title_text){if($$.isHTML(config.title_text)){$$.title=$$.titleContainer.html(config.title_text)}else{$$.title=$$.titleContainer.append("text").attr("class",CLASS.title).style("text-anchor","start").text(config.title_text).attr("color","black")}}}else{if(config.title_text){if($$.isHTML(config.title_text)){$$.titleContainer.selectAll().remove();$$.title=null;$$.title=$$.titleContainer.html(config.title_text);$$.title.selectAll("text").attr("class",CLASS.title).style("text-anchor","start")}else{$$.titleContainer.selectAll("text").remove();$$.title=null;$$.title=$$.titleContainer.append("text").attr("class",CLASS.title).style("text-anchor","start").text(config.title_text).attr("color","black")}}}$$.titleMargin={top:0,right:0,bottom:15,left:0};if(config.title_margin){if(config.title_margin.constructor===Number){$$.titleMargin={top:config.title_margin,right:config.title_margin,bottom:config.title_margin,left:config.title_margin}}else if(config.title_margin instanceof Object){for(var key in config.title_margin){$$.titleMargin[key]=config.title_margin[key]}}}$$.titleX=config.title_x||0;$$.titleY=config.title_y?config.title_y:0;$$.calculateTitleVerticalPosition();$$.calculateTitleHorizontalPosition();$$.titleContainer.attr("transform",$$.getTranslate("title"));if(config.title_show===false){$$.titleMargin={top:0,right:0,bottom:15,left:0};$$.titleHeight=undefined;$$.titleWidth=undefined;$$.title.text("")}}};top_chart_internal_fn.isHTML=function(str){var a=document.createElement("div");a.innerHTML=str;for(var c=a.childNodes,i=c.length;i--;){if(c[i].nodeType==1){a=null;return true}}return false};top_chart_internal_fn.clone=function(obj){var $$=this,copy;if(null==obj||"object"!=typeof obj)return obj;if(obj instanceof Date){copy=new Date;copy.setTime(obj.getTime());return copy}if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;i<len;i++){copy[i]=$$.clone(obj[i])}return copy}if(obj instanceof Object){copy={};for(var attr in obj){if(obj.hasOwnProperty(attr))copy[attr]=$$.clone(obj[attr])}return copy}throw new Error("Unable to copy obj! Its type isn't supported.")};top_chart_fn.showTitle=function(){var $$=this.internal,config=$$.config;config.title_show=true;$$.updateTitle();$$.redraw();$$.updateSubtitle();$$.redraw()};top_chart_fn.hideTitle=function(){var $$=this.internal,config=$$.config;config.title_show=false;$$.updateTitle();$$.redraw();$$.updateSubtitle();$$.redraw()};top_chart_internal_fn.initSubtitle=function(){var $$=this,config=$$.config;$$.subtitleContainer=$$.svg.append("g").attr("class",CLASS.subtitleContainer);$$.subtitle=$$.subtitleContainer.append("text").attr("class",CLASS.subtitle).style("text-anchor","start").text(config.subtitle_text||"Subtitle").attr("color","black")};top_chart_internal_fn.calculateSubtitleVerticalPosition=function(){var $$=this,config=$$.config;$$.subtitleVerticalPosition=0;if(config.subtitle_verticalAlign){config.subtitle_floating=true;if(config.subtitle_verticalAlign==="top"){$$.subtitleVerticalPosition=$$.subtitleY+$$.getCurrentPaddingTop()}else if(config.subtitle_verticalAlign==="middle"){$$.subtitleVerticalPosition=$$.height/2+$$.margin.top+$$.subtitleY}else if(config.subtitle_verticalAlign==="bottom"){$$.subtitleVerticalPosition=$$.margin.top+$$.height-$$.margin.bottom+$$.subtitleY-$$.getCurrentPaddingBottom()}else{config.subtitle_floating=false;config.subtitle_verticalAlign=undefined}}else if(config.subtitle_floating){$$.subtitleVerticalPosition=$$.subtitleY+$$.margin.top}else{if(TOP.chart.Browser.isIE()){$$.subtitleHeight=$$.subtitle.node().getBoundingClientRect().height;$$.subtitleVerticalPosition=$$.subtitle.node().getBoundingClientRect().height+$$.subtitleY+$$.getCurrentPaddingTop()}else{$$.subtitleHeight=$$.subtitle.node().getBBox().height;$$.subtitleVerticalPosition=$$.subtitle.node().getBBox().height+$$.subtitleY+$$.getCurrentPaddingTop()}if($$.titleHeight){$$.subtitleVerticalPosition+=$$.titleHeight}else{$$.subtitleHeight+=30}}};top_chart_internal_fn.calculateSubtitleHorizontalPosition=function(){var $$=this,config=$$.config;$$.subtitleHorizontalPosition=0;if(!config.subtitle_floating){if(config.subtitle_align==="left"){$$.subtitleHorizontalPosition=$$.margin.left+$$.subtitleX+$$.titleMargin.left}else if(config.subtitle_align==="right"){if(TOP.chart.Browser.isIE())$$.subtitleHorizontalPosition=$$.margin.left+$$.width-$$.subtitle.node().getBoundingClientRect().width+$$.subtitleX-$$.titleMargin.right-$$.getCurrentPaddingRight();else $$.subtitleHorizontalPosition=$$.margin.left+$$.width-$$.subtitle.node().getBBox().width+$$.subtitleX-$$.titleMargin.right-$$.getCurrentPaddingRight()}else{if(TOP.chart.Browser.isIE())$$.subtitleHorizontalPosition=$$.margin.left+$$.width/2+$$.subtitleX-$$.subtitle.node().getBoundingClientRect().width/2;else $$.subtitleHorizontalPosition=$$.margin.left+$$.width/2+$$.subtitleX-$$.subtitle.node().getBBox().width/2}if($$.titleMargin){if(TOP.chart.Browser.isIE())$$.subtitleWidth=($$.titleMargin.left||0)+$$.subtitle.node().getBoundingClientRect().width+($$.titleMargin.right||0);else $$.subtitleWidth=($$.titleMargin.left||0)+$$.subtitle.node().getBBox().width+($$.titleMargin.right||0)}else{if(TOP.chart.Browser.isIE())$$.subtitleWidth=$$.subtitle.node().getBoundingClientRect().width;else $$.subtitleWidth=$$.subtitle.node().getBBox().width}}else{if(config.subtitle_align==="left"){$$.subtitleHorizontalPosition=$$.margin.left+$$.subtitleX}else if(config.subtitle_align==="right"){if(TOP.chart.Browser.isIE())$$.subtitleHorizontalPosition=$$.margin.left+$$.width-$$.subtitle.node().getBoundingClientRect().width+$$.subtitleX-$$.getCurrentPaddingRight();else $$.subtitleHorizontalPosition=$$.margin.left+$$.width-$$.subtitle.node().getBBox().width+$$.subtitleX-$$.getCurrentPaddingRight()}else{if(TOP.chart.Browser.isIE())$$.subtitleHorizontalPosition=$$.margin.left+$$.width/2+$$.subtitleX-$$.subtitle.node().getBoundingClientRect().width/2;else $$.subtitleHorizontalPosition=$$.margin.left+$$.width/2+$$.subtitleX-$$.subtitle.node().getBBox().width/2}}};top_chart_internal_fn.updateSubtitle=function(){var $$=this,config=$$.config;$$.subtitleX=config.subtitle_x||0;if(TOP.chart.Browser.isIE())$$.subtitleY=config.subtitle_y?config.subtitle_y+$$.subtitle.node().getBoundingClientRect().height:$$.subtitle.node().getBoundingClientRect().height;else $$.subtitleY=config.subtitle_y?config.subtitle_y+$$.subtitle.node().getBBox().height:$$.subtitle.node().getBBox().height;$$.calculateSubtitleVerticalPosition();$$.calculateSubtitleHorizontalPosition();if(!$$.subtitleContainer){$$.subtitleContainer=$$.svg.append("g").attr("class",CLASS.subtitleContainer)}if(!$$.subtitle){$$.subtitle=$$.subtitleContainer.append("text").attr("class",CLASS.subtitle).style("text-anchor","start").text(config.subtitle_text).attr("color","black")}else{$$.subtitle.text(config.subtitle_text)}$$.subtitleContainer.attr("transform",$$.getTranslate("subtitle"));if(!(config.subtitle_show===false)){}else{$$.subtitleHeight=undefined;$$.subtitleWidth=undefined;$$.subtitle.text("")}};top_chart_fn.showSubtitle=function(){var $$=this.internal,config=$$.config;config.subtitle_show=true;$$.updateTitle();$$.updateSizes();$$.updateSubtitle();$$.redraw()};top_chart_fn.hideSubtitle=function(){var $$=this.internal,config=$$.config;config.subtitle_show=false;$$.updateTitle();$$.updateSizes();$$.updateSubtitle();$$.redraw()};top_chart_internal_fn.initBorder=function(){var $$=this,config=$$.config;$$.border=$$.svg.append("rect").attr("class",CLASS.border)};top_chart_internal_fn.updateBorder=function(){var $$=this,config=$$.config;var rectWidth=$$.svg.attr("width"),rectHeight=$$.svg.attr("height");$$.border.attr("width",rectWidth).attr("height",rectHeight).style("stroke-width",config.chart_borderWidth).style("stroke",config.chart_borderColor).attr("rx",config.chart_borderRadius).attr("ry",config.chart_borderRadius).style("fill",config.chart_backgroundColor).style("opacity",1)};top_chart_internal_fn.initPlotBorder=function(){var $$=this,config=$$.config;$$.plotBackgroundImage=$$.main.select("."+CLASS.chart).append("image");$$.plotBorder=$$.main.select("."+CLASS.chart).append("rect").attr("class",CLASS.plotBorder)};top_chart_internal_fn.updatePlotBorder=function(){var $$=this,config=$$.config;var rectWidth=$$.width,rectHeight=$$.height;$$.plotBorder.attr("width",rectWidth).attr("height",rectHeight).style("stroke-width",config.chart_plotBorderWidth).style("fill",config.chart_plotBackgroundColor).style("stroke",config.chart_plotBorderColor).style("opacity",1);$$.plotBackgroundImage.attr("width",rectWidth).attr("height",rectHeight);if(config.chart_plotBackgroundImage){$$.plotBackgroundImage.attr("xlink:href",config.chart_plotBackgroundImage).attr("x",0).attr("y",0).attr("preserveAspectRatio","none");$$.plotBorder.style("opacity",0)}};top_chart_internal_fn.updateSpacing=function(){var $$=this,config=$$.config,numberValue,inputObject;if(!$$.hasArcType()){if(config.chart_spacing.constructor===Number){numberValue=config.chart_spacing;config.chart_spacing={};config.chart_spacing.top=config.chart_spacing.right=config.chart_spacing.bottom=config.chart_spacing.left=numberValue}else if(config.chart_spacing instanceof Object){if(config.chart_spacing.top===undefined&&config.slider_position==="top")config.chart_spacing.top=10;else if(config.chart_spacing.top===undefined)config.chart_spacing.top=15;if(config.chart_spacing.right===undefined)config.chart_spacing.right=25;if(config.chart_spacing.bottom===undefined)config.chart_spacing.bottom=15;if(config.chart_spacing.left===undefined)config.chart_spacing.left=40}else{config.chart_spacing={};config.chart_spacing.top=config.chart_spacing.right=config.chart_spacing.bottom=config.chart_spacing.left=0}}};top_chart_internal_fn.updateMargin=function(){var $$=this,config=$$.config;if(config.chart_margin instanceof Array){config.chart_margin[0]=config.chart_marginTop?config.chart_marginTop:config.chart_margin[0]||undefined;config.chart_margin[1]=config.chart_marginRight?config.chart_marginRight:config.chart_margin[1]||undefined;config.chart_margin[2]=config.chart_marginBottom?config.chart_marginBottom:config.chart_margin[2]||undefined;config.chart_margin[3]=config.chart_marginLeft?config.chart_marginLeft:config.chart_margin[3]||undefined}else if(config.chart_margin.constructor===Number){config.chart_marginTop=config.chart_marginTop?config.chart_marginTop:config.chart_margin;config.chart_marginRight=config.chart_marginRight?config.chart_marginRight:config.chart_margin;config.chart_marginBottom=config.chart_marginBottom?config.chart_marginBottom:config.chart_margin;config.chart_marginLeft=config.chart_marginLeft?config.chart_marginLeft:config.chart_margin;config.chart_margin=[config.chart_marginTop,config.chart_marginRight,config.chart_marginBottom,config.chart_marginLeft]}else{config.chart_marginTop=config.chart_marginTop?config.chart_marginTop:undefined;config.chart_marginRight=config.chart_marginRight?config.chart_marginRight:undefined;config.chart_marginBottom=config.chart_marginBottom?config.chart_marginBottom:undefined;config.chart_marginLeft=config.chart_marginLeft?config.chart_marginLeft:undefined;config.chart_margin=[]}};top_chart_internal_fn.initLabels=function(){var $$=this,config=$$.config;$$.svg.append("g").attr("class",CLASS.labels)};top_chart_internal_fn.updateLabels=function(){var $$=this,config=$$.config,labelOptionArray=config.labels,labels=$$.svg.select("."+CLASS.labels).selectAll("."+CLASS.label).data(labelOptionArray);var i=0;labels.exit().remove();labels.enter().append("text");labels.attr("class",function(d){var labelIndex=CLASS.label+"-"+i;i++;return CLASS.label+" "+labelIndex}).text(function(d){return d.text}).attr("style",function(d){return d.style}).attr("transform",function(d){var x=d.x?d.x:0,y=d.y?d.y:0;return"translate("+x+","+y+")"})};top_chart_fn.addLabels=function(labelOptions){var $$=this.internal,config=$$.config,labelConfig=config.labels,i;if(labelOptions.constructor!==Array)return;for(i=0;i<labelOptions.length;i++){labelConfig.push(labelOptions[i])}$$.updateLabels()};top_chart_fn.updateLabels=function(labelOptions){this.internal.config=labelOptions;this.internal.updateLabels()};top_chart_fn.updateLabel=function(labelIndex,labelOption){var $$=this.internal,config=$$.config,key,labelConfig=config.labels;if(labelConfig[labelIndex]){for(key in labelOption){labelConfig[labelIndex][key]=labelOption[key]}}$$.updateLabels()};top_chart_internal_fn.initCredits=function(){var $$=this,config=$$.config;$$.credits=$$.svg.append("text");$$.credits.classed(CLASS.credits)};top_chart_internal_fn.updateCredits=function(){var $$=this,config=$$.config;var creditsStyle={cursor:"pointer",color:"#909090",fontSize:"10px"};var creditsPosition={align:"right",x:-20,verticalAlign:"bottom",y:-5};if(config.credits_position){for(var key in config.credits_position){creditsPosition[key]=config.credits_position[key]}}if(config.credits_style){for(var key in config.credits_style){creditsStyle[key]=config.credits_style[key]}}if($$.credits&&config.credits_enabled){$$.credits.text(config.credits_text).attr("href",config.credits_href);for(var key in creditsStyle){$$.credits.style($$.camelToDash(key),creditsStyle[key])}}if(creditsPosition.align){if(creditsPosition.align==="right"){if(TOP.chart.Browser.isIE())$$.creditsHorizontalPosition=$$.svg.attr("width")-$$.credits.node().getBoundingClientRect().width;else $$.creditsHorizontalPosition=$$.svg.attr("width")-$$.credits.node().getBBox().width}else if(creditsPosition.align==="center"){if(TOP.chart.Browser.isIE())$$.creditsHorizontalPosition=$$.svg.attr("width")/2-$$.credits.node().getBoundingClientRect().width/2;else $$.creditsHorizontalPosition=$$.svg.attr("width")/2-$$.credits.node().getBBox().width/2}else{$$.creditsHorizontalPosition=0}}if(creditsPosition.x&&creditsPosition.x.constructor===Number){$$.creditsHorizontalPosition+=creditsPosition.x}if(creditsPosition.verticalAlign){if(creditsPosition.verticalAlign==="bottom"){if(TOP.chart.Browser.isIE())$$.creditsVerticalPosition=$$.svg.attr("height")-$$.credits.node().getBoundingClientRect().height;else $$.creditsVerticalPosition=$$.svg.attr("height")-$$.credits.node().getBBox().height}else if(creditsPosition.verticalAlign==="middle"){if(TOP.chart.Browser.isIE())$$.creditsVerticalPosition=$$.svg.attr("height")/2-$$.credits.node().getBoundingClientRect().height/2;else $$.creditsVerticalPosition=$$.svg.attr("height")/2-$$.credits.node().getBBox().height/2}else{$$.creditsVerticalPosition=0}}if(creditsPosition.y&&creditsPosition.y.constructor===Number)$$.creditsVerticalPosition+=creditsPosition.y;if($$.credits&&config.credits_enabled){$$.credits.attr("transform",$$.getTranslate("credits"))}};top_chart_internal_fn.camelToDash=function(camel){var $$=this,config=$$.config;var hyphenate=function(a,b){return"-"+b.toLowerCase()};return camel.replace(/([A-Z])/g,hyphenate)};top_chart_internal_fn.getMax=function(a,b){if(a.constructor===Number&&b.constructor===Number){if(a>=b){return a}else{return b}}else{return}}})(window);(function(factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){
module.exports=factory()}else{window.Slider=factory()}})(function(){"use strict";var VERSION="9.2.0";function addNodeTo(target,className){var div=document.createElement("div");addClass(div,className);target.appendChild(div);return div}function unique(array){return array.filter(function(a){return!this[a]?this[a]=true:false},{})}function closest(value,to){return Math.round(value/to)*to}function offset(elem,orientation){var rect=elem.getBoundingClientRect(),doc=elem.ownerDocument,docElem=doc.documentElement,pageOffset=getPageOffset();if(/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)){pageOffset.x=0}return orientation?rect.top+pageOffset.y-docElem.clientTop:rect.left+pageOffset.x-docElem.clientLeft}function isNumeric(a){return typeof a==="number"&&!isNaN(a)&&isFinite(a)}function addClassFor(element,className,duration){if(duration>0){addClass(element,className);setTimeout(function(){removeClass(element,className)},duration)}}function limit(a){return Math.max(Math.min(a,100),0)}function asArray(a){return Array.isArray(a)?a:[a]}function countDecimals(numStr){numStr=String(numStr);var pieces=numStr.split(".");return pieces.length>1?pieces[1].length:0}function addClass(el,className){if(el.classList){el.classList.add(className)}else{el.className+=" "+className}}function removeClass(el,className){if(el.classList){el.classList.remove(className)}else{el.className=el.className.replace(new RegExp("(^|\\b)"+className.split(" ").join("|")+"(\\b|$)","gi")," ")}}function hasClass(el,className){return el.classList?el.classList.includes(className):new RegExp("\\b"+className+"\\b").test(el.className)}function getPageOffset(){var supportPageOffset=window.pageXOffset!==undefined,isCSS1Compat=(document.compatMode||"")==="CSS1Compat",x=supportPageOffset?window.pageXOffset:isCSS1Compat?document.documentElement.scrollLeft:document.body.scrollLeft,y=supportPageOffset?window.pageYOffset:isCSS1Compat?document.documentElement.scrollTop:document.body.scrollTop;return{x:x,y:y}}function getActions(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function subRangeRatio(pa,pb){return 100/(pb-pa)}function fromPercentage(range,value){return value*100/(range[1]-range[0])}function toPercentage(range,value){return fromPercentage(range,range[0]<0?value+Math.abs(range[0]):value-range[0])}function isPercentage(range,value){return value*(range[1]-range[0])/100+range[0]}function getJ(value,arr){var j=1;while(value>=arr[j]){j+=1}return j}function toStepping(xVal,xPct,value){if(value>=xVal.slice(-1)[0]){return 100}var j=getJ(value,xVal),va,vb,pa,pb;va=xVal[j-1];vb=xVal[j];pa=xPct[j-1];pb=xPct[j];return pa+toPercentage([va,vb],value)/subRangeRatio(pa,pb)}function fromStepping(xVal,xPct,value){if(value>=100){return xVal.slice(-1)[0]}var j=getJ(value,xPct),va,vb,pa,pb;va=xVal[j-1];vb=xVal[j];pa=xPct[j-1];pb=xPct[j];return isPercentage([va,vb],(value-pa)*subRangeRatio(pa,pb))}function getStep(xPct,xSteps,snap,value){if(value===100){return value}var j=getJ(value,xPct),a,b;if(snap){a=xPct[j-1];b=xPct[j];if(value-a>(b-a)/2){return b}return a}if(!xSteps[j-1]){return value}return xPct[j-1]+closest(value-xPct[j-1],xSteps[j-1])}function handleEntryPoint(index,value,that){var percentage;if(typeof value==="number"){value=[value]}if(Object.prototype.toString.call(value)!=="[object Array]"){throw new Error("Slider ("+VERSION+"): 'range' contains invalid value.")}if(index==="min"){percentage=0}else if(index==="max"){percentage=100}else{percentage=parseFloat(index)}if(!isNumeric(percentage)||!isNumeric(value[0])){throw new Error("Slider ("+VERSION+"): 'range' value isn't numeric.")}that.xPct.push(percentage);that.xVal.push(value[0]);if(!percentage){if(!isNaN(value[1])){that.xSteps[0]=value[1]}}else{that.xSteps.push(isNaN(value[1])?false:value[1])}that.xHighestCompleteStep.push(0)}function handleStepPoint(i,n,that){if(!n){return true}that.xSteps[i]=fromPercentage([that.xVal[i],that.xVal[i+1]],n)/subRangeRatio(that.xPct[i],that.xPct[i+1]);var totalSteps=(that.xVal[i+1]-that.xVal[i])/that.xNumSteps[i];var highestStep=Math.ceil(Number(totalSteps.toFixed(3))-1);var step=that.xVal[i]+that.xNumSteps[i]*highestStep;that.xHighestCompleteStep[i]=step}function Spectrum(entry,snap,direction,singleStep){this.xPct=[];this.xVal=[];this.xSteps=[singleStep||false];this.xNumSteps=[false];this.xHighestCompleteStep=[];this.snap=snap;this.direction=direction;var index,ordered=[];for(index in entry){if(entry.hasOwnProperty(index)){ordered.push([entry[index],index])}}if(ordered.length&&typeof ordered[0][0]==="object"){ordered.sort(function(a,b){return a[0][0]-b[0][0]})}else{ordered.sort(function(a,b){return a[0]-b[0]})}for(index=0;index<ordered.length;index++){handleEntryPoint(ordered[index][1],ordered[index][0],this)}this.xNumSteps=this.xSteps.slice(0);for(index=0;index<this.xNumSteps.length;index++){handleStepPoint(index,this.xNumSteps[index],this)}}Spectrum.prototype.getMargin=function(value){var step=this.xNumSteps[0];if(step&&value/step%1!==0){throw new Error("Slider ("+VERSION+"): 'limit', 'margin' and 'padding' must be divisible by step.")}return this.xPct.length===2?fromPercentage(this.xVal,value):false};Spectrum.prototype.toStepping=function(value){value=toStepping(this.xVal,this.xPct,value);return value};Spectrum.prototype.fromStepping=function(value){return fromStepping(this.xVal,this.xPct,value)};Spectrum.prototype.getStep=function(value){value=getStep(this.xPct,this.xSteps,this.snap,value);return value};Spectrum.prototype.getNearbySteps=function(value){var j=getJ(value,this.xPct);return{stepBefore:{startValue:this.xVal[j-2],step:this.xNumSteps[j-2],highestStep:this.xHighestCompleteStep[j-2]},thisStep:{startValue:this.xVal[j-1],step:this.xNumSteps[j-1],highestStep:this.xHighestCompleteStep[j-1]},stepAfter:{startValue:this.xVal[j-0],step:this.xNumSteps[j-0],highestStep:this.xHighestCompleteStep[j-0]}}};Spectrum.prototype.countStepDecimals=function(){var stepDecimals=this.xNumSteps.map(countDecimals);return Math.max.apply(null,stepDecimals)};Spectrum.prototype.convert=function(value){return this.getStep(this.toStepping(value))};var defaultFormatter={to:function(value){return value!==undefined&&value.toFixed(2)},from:Number};function testStep(parsed,entry){if(!isNumeric(entry)){throw new Error("Slider ("+VERSION+"): 'step' is not numeric.")}parsed.singleStep=entry}function testRange(parsed,entry){if(typeof entry!=="object"||Array.isArray(entry)){throw new Error("Slider ("+VERSION+"): 'range' is not an object.")}if(entry.min===undefined||entry.max===undefined){throw new Error("Slider ("+VERSION+"): Missing 'min' or 'max' in 'range'.")}if(entry.min===entry.max){throw new Error("Slider ("+VERSION+"): 'range' 'min' and 'max' cannot be equal.")}parsed.spectrum=new Spectrum(entry,parsed.snap,parsed.dir,parsed.singleStep)}function testStart(parsed,entry){entry=asArray(entry);if(!Array.isArray(entry)||!entry.length){throw new Error("Slider ("+VERSION+"): 'start' option is incorrect.")}parsed.handles=entry.length;parsed.start=entry}function testSnap(parsed,entry){parsed.snap=entry;if(typeof entry!=="boolean"){throw new Error("Slider ("+VERSION+"): 'snap' option must be a boolean.")}}function testAnimate(parsed,entry){parsed.animate=entry;if(typeof entry!=="boolean"){throw new Error("Slider ("+VERSION+"): 'animate' option must be a boolean.")}}function testAnimationDuration(parsed,entry){parsed.animationDuration=entry;if(typeof entry!=="number"){throw new Error("Slider ("+VERSION+"): 'animationDuration' option must be a number.")}}function testConnect(parsed,entry){var connect=[false];var i;if(entry==="lower"){entry=[true,false]}else if(entry==="upper"){entry=[false,true]}if(entry===true||entry===false){for(i=1;i<parsed.handles;i++){connect.push(entry)}connect.push(false)}else if(!Array.isArray(entry)||!entry.length||entry.length!==parsed.handles+1){throw new Error("Slider ("+VERSION+"): 'connect' option doesn't match handle count.")}else{connect=entry}parsed.connect=connect}function testOrientation(parsed,entry){switch(entry){case"horizontal":parsed.ort=0;break;case"vertical":parsed.ort=1;break;default:throw new Error("Slider ("+VERSION+"): 'orientation' option is invalid.")}}function testMargin(parsed,entry){if(!isNumeric(entry)){throw new Error("Slider ("+VERSION+"): 'margin' option must be numeric.")}if(entry===0){return}parsed.margin=parsed.spectrum.getMargin(entry);if(!parsed.margin){throw new Error("Slider ("+VERSION+"): 'margin' option is only supported on linear sliders.")}}function testLimit(parsed,entry){if(!isNumeric(entry)){throw new Error("Slider ("+VERSION+"): 'limit' option must be numeric.")}parsed.limit=parsed.spectrum.getMargin(entry);if(!parsed.limit||parsed.handles<2){throw new Error("Slider ("+VERSION+"): 'limit' option is only supported on linear sliders with 2 or more handles.")}}function testPadding(parsed,entry){if(!isNumeric(entry)){throw new Error("Slider ("+VERSION+"): 'padding' option must be numeric.")}if(entry===0){return}parsed.padding=parsed.spectrum.getMargin(entry);if(!parsed.padding){throw new Error("Slider ("+VERSION+"): 'padding' option is only supported on linear sliders.")}if(parsed.padding<0){throw new Error("Slider ("+VERSION+"): 'padding' option must be a positive number.")}if(parsed.padding>=50){throw new Error("Slider ("+VERSION+"): 'padding' option must be less than half the range.")}}function testDirection(parsed,entry){switch(entry){case"ltr":parsed.dir=0;break;case"rtl":parsed.dir=1;break;default:throw new Error("Slider ("+VERSION+"): 'direction' option was not recognized.")}}function testBehaviour(parsed,entry){if(typeof entry!=="string"){throw new Error("Slider ("+VERSION+"): 'behaviour' must be a string containing options.")}var tap=entry.indexOf("tap")>=0;var drag=entry.indexOf("drag")>=0;var fixed=entry.indexOf("fixed")>=0;var snap=entry.indexOf("snap")>=0;var hover=entry.indexOf("hover")>=0;if(fixed){if(parsed.handles!==2){throw new Error("Slider ("+VERSION+"): 'fixed' behaviour must be used with 2 handles")}testMargin(parsed,parsed.start[1]-parsed.start[0])}parsed.events={tap:tap||snap,drag:drag,fixed:fixed,snap:snap,hover:hover}}function testTooltips(parsed,entry){if(entry===false){return}else if(entry===true){parsed.tooltips=[];for(var i=0;i<parsed.handles;i++){parsed.tooltips.push(true)}}else{parsed.tooltips=asArray(entry);if(parsed.tooltips.length!==parsed.handles){throw new Error("Slider ("+VERSION+"): must pass a formatter for all handles.")}parsed.tooltips.forEach(function(formatter){if(typeof formatter!=="boolean"&&(typeof formatter!=="object"||typeof formatter.to!=="function")){throw new Error("Slider ("+VERSION+"): 'tooltips' must be passed a formatter or 'false'.")}})}}function testFormat(parsed,entry){parsed.format=entry;if(typeof entry.to==="function"&&typeof entry.from==="function"){return true}throw new Error("Slider ("+VERSION+"): 'format' requires 'to' and 'from' methods.")}function testCssPrefix(parsed,entry){if(entry!==undefined&&typeof entry!=="string"&&entry!==false){throw new Error("Slider ("+VERSION+"): 'cssPrefix' must be a string or `false`.")}parsed.cssPrefix=entry}function testCssClasses(parsed,entry){if(entry!==undefined&&typeof entry!=="object"){throw new Error("Slider ("+VERSION+"): 'cssClasses' must be an object.")}if(typeof parsed.cssPrefix==="string"){parsed.cssClasses={};for(var key in entry){if(!entry.hasOwnProperty(key)){continue}parsed.cssClasses[key]=parsed.cssPrefix+entry[key]}}else{parsed.cssClasses=entry}}function testUseRaf(parsed,entry){if(entry===true||entry===false){parsed.useRequestAnimationFrame=entry}else{throw new Error("Slider ("+VERSION+"): 'useRequestAnimationFrame' option should be true (default) or false.")}}function testOptions(options){var parsed={margin:0,limit:0,padding:0,animate:true,animationDuration:300,format:defaultFormatter};var tests={step:{r:false,t:testStep},start:{r:true,t:testStart},connect:{r:true,t:testConnect},direction:{r:true,t:testDirection},snap:{r:false,t:testSnap},animate:{r:false,t:testAnimate},animationDuration:{r:false,t:testAnimationDuration},range:{r:true,t:testRange},orientation:{r:false,t:testOrientation},margin:{r:false,t:testMargin},limit:{r:false,t:testLimit},padding:{r:false,t:testPadding},behaviour:{r:true,t:testBehaviour},format:{r:false,t:testFormat},tooltips:{r:false,t:testTooltips},cssPrefix:{r:false,t:testCssPrefix},cssClasses:{r:false,t:testCssClasses},useRequestAnimationFrame:{r:false,t:testUseRaf}};var defaults={connect:false,direction:"ltr",behaviour:"tap",orientation:"horizontal",cssPrefix:"chartSlider-",cssClasses:{target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",ltr:"ltr",rtl:"rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},useRequestAnimationFrame:true};Object.keys(tests).forEach(function(name){if(options[name]===undefined&&defaults[name]===undefined){if(tests[name].r){throw new Error("Slider ("+VERSION+"): '"+name+"' is required.")}return true}tests[name].t(parsed,options[name]===undefined?defaults[name]:options[name])});parsed.pips=options.pips;var styles=[["left","top"],["right","bottom"]];parsed.style=styles[parsed.dir][parsed.ort];parsed.styleOposite=styles[parsed.dir?0:1][parsed.ort];return parsed}function closure(target,options,originalOptions){var actions=getActions();var scope_Target=target;var scope_Locations=[];var scope_Base;var scope_Handles;var scope_HandleNumbers=[];var scope_ActiveHandle=false;var scope_Connects;var scope_Spectrum=options.spectrum;var scope_Values=[];var scope_Events={};var scope_Self;function addOrigin(base,handleNumber){var origin=addNodeTo(base,options.cssClasses.origin);var handle=addNodeTo(origin,options.cssClasses.handle);handle.setAttribute("data-handle",handleNumber);if(handleNumber===0){addClass(handle,options.cssClasses.handleLower)}else if(handleNumber===options.handles-1){addClass(handle,options.cssClasses.handleUpper)}return origin}function addConnect(base,add){if(!add){return false}return addNodeTo(base,options.cssClasses.connect)}function addElements(connectOptions,base){scope_Handles=[];scope_Connects=[];scope_Connects.push(addConnect(base,connectOptions[0]));for(var i=0;i<options.handles;i++){scope_Handles.push(addOrigin(base,i));scope_HandleNumbers[i]=i;scope_Connects.push(addConnect(base,connectOptions[i+1]))}}function addSlider(target){addClass(target,options.cssClasses.target);if(options.dir===0){addClass(target,options.cssClasses.ltr)}else{addClass(target,options.cssClasses.rtl)}if(options.ort===0){addClass(target,options.cssClasses.horizontal)}else{addClass(target,options.cssClasses.vertical)}scope_Base=addNodeTo(target,options.cssClasses.base)}function addTooltip(handle,handleNumber){if(!options.tooltips[handleNumber]){return false}return addNodeTo(handle.firstChild,options.cssClasses.tooltip)}function tooltips(){var tips=scope_Handles.map(addTooltip);bindEvent("update",function(values,handleNumber,unencoded){if(!tips[handleNumber]){return}var formattedValue=values[handleNumber];if(options.tooltips[handleNumber]!==true){formattedValue=options.tooltips[handleNumber].to(unencoded[handleNumber])}tips[handleNumber].innerHTML=formattedValue})}function getGroup(mode,values,stepped){if(mode==="range"||mode==="steps"){return scope_Spectrum.xVal}if(mode==="count"){if(!values){throw new Error("Slider ("+VERSION+"): 'values' required for mode 'count'.")}var spread=100/(values-1);var v;var i=0;values=[];while((v=i++*spread)<=100){values.push(v)}mode="positions"}if(mode==="positions"){return values.map(function(value){return scope_Spectrum.fromStepping(stepped?scope_Spectrum.getStep(value):value)})}if(mode==="values"){if(stepped){return values.map(function(value){return scope_Spectrum.fromStepping(scope_Spectrum.getStep(scope_Spectrum.toStepping(value)))})}return values}}function generateSpread(density,mode,group){function safeIncrement(value,increment){return(value+increment).toFixed(7)/1}var indexes={};var firstInRange=scope_Spectrum.xVal[0];var lastInRange=scope_Spectrum.xVal[scope_Spectrum.xVal.length-1];var ignoreFirst=false;var ignoreLast=false;var prevPct=0;group=unique(group.slice().sort(function(a,b){return a-b}));if(group[0]!==firstInRange){group.unshift(firstInRange);ignoreFirst=true}if(group[group.length-1]!==lastInRange){group.push(lastInRange);ignoreLast=true}group.forEach(function(current,index){var step;var i;var q;var low=current;var high=group[index+1];var newPct;var pctDifference;var pctPos;var type;var steps;var realSteps;var stepsize;if(mode==="steps"){step=scope_Spectrum.xNumSteps[index]}if(!step){step=high-low}if(low===false||high===undefined){return}step=Math.max(step,1e-7);for(i=low;i<=high;i=safeIncrement(i,step)){newPct=scope_Spectrum.toStepping(i);pctDifference=newPct-prevPct;steps=pctDifference/density;realSteps=Math.round(steps);stepsize=pctDifference/realSteps;for(q=1;q<=realSteps;q+=1){pctPos=prevPct+q*stepsize;indexes[pctPos.toFixed(5)]=["x",0]}type=group.indexOf(i)>-1?1:mode==="steps"?2:0;if(!index&&ignoreFirst){type=0}if(!(i===high&&ignoreLast)){indexes[newPct.toFixed(5)]=[i,type]}prevPct=newPct}});return indexes}function addMarking(spread,filterFunc,formatter){var element=document.createElement("div");var out="";var valueSizeClasses=[options.cssClasses.valueNormal,options.cssClasses.valueLarge,options.cssClasses.valueSub];var markerSizeClasses=[options.cssClasses.markerNormal,options.cssClasses.markerLarge,options.cssClasses.markerSub];var valueOrientationClasses=[options.cssClasses.valueHorizontal,options.cssClasses.valueVertical];var markerOrientationClasses=[options.cssClasses.markerHorizontal,options.cssClasses.markerVertical];addClass(element,options.cssClasses.pips);addClass(element,options.ort===0?options.cssClasses.pipsHorizontal:options.cssClasses.pipsVertical);function getClasses(type,source){var a=source===options.cssClasses.value;var orientationClasses=a?valueOrientationClasses:markerOrientationClasses;var sizeClasses=a?valueSizeClasses:markerSizeClasses;return source+" "+orientationClasses[options.ort]+" "+sizeClasses[type]}function getTags(offset,source,values){return'class="'+getClasses(values[1],source)+'" style="'+options.style+": "+offset+'%"'}function addSpread(offset,values){values[1]=values[1]&&filterFunc?filterFunc(values[0],values[1]):values[1];out+="<div "+getTags(offset,options.cssClasses.marker,values)+"></div>";if(values[1]){out+="<div "+getTags(offset,options.cssClasses.value,values)+">"+formatter.to(values[0])+"</div>"}}Object.keys(spread).forEach(function(a){addSpread(a,spread[a])});element.innerHTML=out;return element}function pips(grid){var mode=grid.mode;var density=grid.density||1;var filter=grid.filter||false;var values=grid.values||false;var stepped=grid.stepped||false;var group=getGroup(mode,values,stepped);var spread=generateSpread(density,mode,group);var format=grid.format||{to:Math.round};return scope_Target.appendChild(addMarking(spread,filter,format))}function baseSize(){var rect=scope_Base.getBoundingClientRect(),alt="offset"+["Width","Height"][options.ort];return options.ort===0?rect.width||scope_Base[alt]:rect.height||scope_Base[alt]}function attachEvent(events,element,callback,data){var method=function(e){if(scope_Target.hasAttribute("disabled")){return false}if(hasClass(scope_Target,options.cssClasses.tap)){return false}e=fixEvent(e,data.pageOffset);if(!e){return false}if(events===actions.start&&e.buttons!==undefined&&e.buttons>1){return false}if(data.hover&&e.buttons){return false}e.calcPoint=e.points[options.ort];callback(e,data)};var methods=[];events.split(" ").forEach(function(eventName){element.addEventListener(eventName,method,false);methods.push([eventName,method])});return methods}function fixEvent(e,pageOffset){e.preventDefault();var touch=e.type.indexOf("touch")===0;var mouse=e.type.indexOf("mouse")===0;var pointer=e.type.indexOf("pointer")===0;var x;var y;if(e.type.indexOf("MSPointer")===0){pointer=true}if(touch){if(e.touches.length>1){return false}x=e.changedTouches[0].pageX;y=e.changedTouches[0].pageY}pageOffset=pageOffset||getPageOffset();if(mouse||pointer){x=e.clientX+pageOffset.x;y=e.clientY+pageOffset.y}e.pageOffset=pageOffset;e.points=[x,y];e.cursor=mouse||pointer;return e}function calcPointToPercentage(calcPoint){var location=calcPoint-offset(scope_Base,options.ort);var proposal=location*100/baseSize();return options.dir?100-proposal:proposal}function getClosestHandle(proposal){var closest=100;var handleNumber=false;scope_Handles.forEach(function(handle,index){if(handle.hasAttribute("disabled")){return}var pos=Math.abs(scope_Locations[index]-proposal);if(pos<closest){handleNumber=index;closest=pos}});return handleNumber}function moveHandles(upward,proposal,locations,handleNumbers){var proposals=locations.slice();var b=[!upward,upward];var f=[upward,!upward];handleNumbers=handleNumbers.slice();if(upward){handleNumbers.reverse()}if(handleNumbers.length>1){handleNumbers.forEach(function(handleNumber,o){var to=checkHandlePosition(proposals,handleNumber,proposals[handleNumber]+proposal,b[o],f[o]);if(to===false){proposal=0}else{proposal=to-proposals[handleNumber];proposals[handleNumber]=to}})}else{b=f=[true]}var state=false;handleNumbers.forEach(function(handleNumber,o){state=setHandle(handleNumber,locations[handleNumber]+proposal,b[o],f[o])||state});if(state){handleNumbers.forEach(function(handleNumber){fireEvent("update",handleNumber);fireEvent("slide",handleNumber)})}}function fireEvent(eventName,handleNumber,tap){Object.keys(scope_Events).forEach(function(targetEvent){var eventType=targetEvent.split(".")[0];if(eventName===eventType){scope_Events[targetEvent].forEach(function(callback){callback.call(scope_Self,scope_Values.map(options.format.to),handleNumber,scope_Values.slice(),tap||false,scope_Locations.slice())})}})}function documentLeave(event,data){if(event.type==="mouseout"&&event.target.nodeName==="HTML"&&event.relatedTarget===null){eventEnd(event,data)}}function eventMove(event,data){if(navigator.appVersion.indexOf("MSIE 9")===-1&&event.buttons===0&&data.buttonsProperty!==0){return eventEnd(event,data)}var movement=(options.dir?-1:1)*(event.calcPoint-data.startCalcPoint);var proposal=movement*100/data.baseSize;moveHandles(movement>0,proposal,data.locations,data.handleNumbers)}function eventEnd(event,data){if(scope_ActiveHandle){removeClass(scope_ActiveHandle,options.cssClasses.active);scope_ActiveHandle=false}if(event.cursor){document.body.style.cursor="";document.body.removeEventListener("selectstart",document.body.noUiListener)}document.documentElement.noUiListeners.forEach(function(c){document.documentElement.removeEventListener(c[0],c[1])});removeClass(scope_Target,options.cssClasses.drag);setZindex();data.handleNumbers.forEach(function(handleNumber){fireEvent("set",handleNumber);fireEvent("change",handleNumber);fireEvent("end",handleNumber)})}function eventStart(event,data){if(data.handleNumbers.length===1){var handle=scope_Handles[data.handleNumbers[0]];if(handle.hasAttribute("disabled")){return false}scope_ActiveHandle=handle.children[0];addClass(scope_ActiveHandle,options.cssClasses.active)}event.preventDefault();event.stopPropagation();var moveEvent=attachEvent(actions.move,document.documentElement,eventMove,{startCalcPoint:event.calcPoint,baseSize:baseSize(),pageOffset:event.pageOffset,handleNumbers:data.handleNumbers,buttonsProperty:event.buttons,locations:scope_Locations.slice()});var endEvent=attachEvent(actions.end,document.documentElement,eventEnd,{handleNumbers:data.handleNumbers});var outEvent=attachEvent("mouseout",document.documentElement,documentLeave,{handleNumbers:data.handleNumbers});document.documentElement.noUiListeners=moveEvent.concat(endEvent,outEvent);if(event.cursor){document.body.style.cursor=getComputedStyle(event.target).cursor;if(scope_Handles.length>1){addClass(scope_Target,options.cssClasses.drag)}var f=function(){return false};document.body.noUiListener=f;document.body.addEventListener("selectstart",f,false)}data.handleNumbers.forEach(function(handleNumber){fireEvent("start",handleNumber)})}function eventTap(event){event.stopPropagation();var proposal=calcPointToPercentage(event.calcPoint);var handleNumber=getClosestHandle(proposal);if(handleNumber===false){return false}if(!options.events.snap){addClassFor(scope_Target,options.cssClasses.tap,options.animationDuration)}setHandle(handleNumber,proposal,true,true);setZindex();fireEvent("slide",handleNumber,true);fireEvent("set",handleNumber,true);fireEvent("change",handleNumber,true);fireEvent("update",handleNumber,true);if(options.events.snap){eventStart(event,{handleNumbers:[handleNumber]})}}function eventHover(event){var proposal=calcPointToPercentage(event.calcPoint);var to=scope_Spectrum.getStep(proposal);var value=scope_Spectrum.fromStepping(to);Object.keys(scope_Events).forEach(function(targetEvent){if("hover"===targetEvent.split(".")[0]){scope_Events[targetEvent].forEach(function(callback){callback.call(scope_Self,value)})}})}function bindSliderEvents(behaviour){if(!behaviour.fixed){scope_Handles.forEach(function(handle,index){attachEvent(actions.start,handle.children[0],eventStart,{handleNumbers:[index]})})}if(behaviour.tap){attachEvent(actions.start,scope_Base,eventTap,{})}if(behaviour.hover){attachEvent(actions.move,scope_Base,eventHover,{hover:true})}if(behaviour.drag){scope_Connects.forEach(function(connect,index){if(connect===false||index===0||index===scope_Connects.length-1){return}var handleBefore=scope_Handles[index-1];var handleAfter=scope_Handles[index];var eventHolders=[connect];addClass(connect,options.cssClasses.draggable);if(behaviour.fixed){eventHolders.push(handleBefore.children[0]);eventHolders.push(handleAfter.children[0])}eventHolders.forEach(function(eventHolder){attachEvent(actions.start,eventHolder,eventStart,{handles:[handleBefore,handleAfter],handleNumbers:[index-1,index]})})})}}function checkHandlePosition(reference,handleNumber,to,lookBackward,lookForward){if(scope_Handles.length>1){if(lookBackward&&handleNumber>0){to=Math.max(to,reference[handleNumber-1]+options.margin)}if(lookForward&&handleNumber<scope_Handles.length-1){to=Math.min(to,reference[handleNumber+1]-options.margin)}}if(scope_Handles.length>1&&options.limit){if(lookBackward&&handleNumber>0){to=Math.min(to,reference[handleNumber-1]+options.limit)}if(lookForward&&handleNumber<scope_Handles.length-1){to=Math.max(to,reference[handleNumber+1]-options.limit)}}if(options.padding){if(handleNumber===0){to=Math.max(to,options.padding)}if(handleNumber===scope_Handles.length-1){to=Math.min(to,100-options.padding)}}to=scope_Spectrum.getStep(to);to=limit(to);if(to===reference[handleNumber]){return false}return to}function toPct(pct){return pct+"%"}function updateHandlePosition(handleNumber,to){scope_Locations[handleNumber]=to;scope_Values[handleNumber]=scope_Spectrum.fromStepping(to);var stateUpdate=function(){scope_Handles[handleNumber].style[options.style]=toPct(to);updateConnect(handleNumber);updateConnect(handleNumber+1)};if(window.requestAnimationFrame&&options.useRequestAnimationFrame){window.requestAnimationFrame(stateUpdate)}else{stateUpdate()}}function setZindex(){scope_HandleNumbers.forEach(function(handleNumber){var dir=scope_Locations[handleNumber]>50?-1:1;var zIndex=3+(scope_Handles.length+dir*handleNumber);scope_Handles[handleNumber].childNodes[0].style.zIndex=zIndex})}function setHandle(handleNumber,to,lookBackward,lookForward){to=checkHandlePosition(scope_Locations,handleNumber,to,lookBackward,lookForward);if(to===false){return false}updateHandlePosition(handleNumber,to);return true}function updateConnect(index){if(!scope_Connects[index]){return}var l=0;var h=100;if(index!==0){l=scope_Locations[index-1]}if(index!==scope_Connects.length-1){h=scope_Locations[index]}scope_Connects[index].style[options.style]=toPct(l);scope_Connects[index].style[options.styleOposite]=toPct(100-h)}function setValue(to,handleNumber){if(to===null||to===false){return}if(typeof to==="number"){to=String(to)}to=options.format.from(to);if(to!==false&&!isNaN(to)){setHandle(handleNumber,scope_Spectrum.toStepping(to),false,false)}}function valueSet(input,fireSetEvent){var values=asArray(input);var isInit=scope_Locations[0]===undefined;fireSetEvent=fireSetEvent===undefined?true:!!fireSetEvent;values.forEach(setValue);if(options.animate&&!isInit){addClassFor(scope_Target,options.cssClasses.tap,options.animationDuration)}scope_HandleNumbers.forEach(function(handleNumber){setHandle(handleNumber,scope_Locations[handleNumber],true,false)});setZindex();scope_HandleNumbers.forEach(function(handleNumber){fireEvent("update",handleNumber);if(values[handleNumber]!==null&&fireSetEvent){fireEvent("set",handleNumber)}})}function valueReset(fireSetEvent){valueSet(options.start,fireSetEvent)}function valueGet(){var values=scope_Values.map(options.format.to);if(values.length===1){return values[0]}return values}function destroy(){for(var key in options.cssClasses){if(!options.cssClasses.hasOwnProperty(key)){continue}removeClass(scope_Target,options.cssClasses[key])}while(scope_Target.firstChild){scope_Target.removeChild(scope_Target.firstChild)}delete scope_Target.Slider}function getCurrentStep(){return scope_Locations.map(function(location,index){var nearbySteps=scope_Spectrum.getNearbySteps(location);var value=scope_Values[index];var increment=nearbySteps.thisStep.step;var decrement=null;if(increment!==false){if(value+increment>nearbySteps.stepAfter.startValue){increment=nearbySteps.stepAfter.startValue-value}}if(value>nearbySteps.thisStep.startValue){decrement=nearbySteps.thisStep.step}else if(nearbySteps.stepBefore.step===false){decrement=false}else{decrement=value-nearbySteps.stepBefore.highestStep}if(location===100){increment=null}else if(location===0){decrement=null}var stepDecimals=scope_Spectrum.countStepDecimals();if(increment!==null&&increment!==false){increment=Number(increment.toFixed(stepDecimals))}if(decrement!==null&&decrement!==false){decrement=Number(decrement.toFixed(stepDecimals))}return[decrement,increment]})}function bindEvent(namespacedEvent,callback){scope_Events[namespacedEvent]=scope_Events[namespacedEvent]||[];scope_Events[namespacedEvent].push(callback);if(namespacedEvent.split(".")[0]==="update"){scope_Handles.forEach(function(a,index){fireEvent("update",index)})}}function removeEvent(namespacedEvent){var event=namespacedEvent&&namespacedEvent.split(".")[0];var namespace=event&&namespacedEvent.substring(event.length);Object.keys(scope_Events).forEach(function(bind){var tEvent=bind.split(".")[0],tNamespace=bind.substring(tEvent.length);if((!event||event===tEvent)&&(!namespace||namespace===tNamespace)){delete scope_Events[bind]}})}function updateOptions(optionsToUpdate,fireSetEvent){var v=valueGet();var updateAble=["margin","limit","padding","range","animate","snap","step","format"];updateAble.forEach(function(name){if(optionsToUpdate[name]!==undefined){originalOptions[name]=optionsToUpdate[name]}});var newOptions=testOptions(originalOptions);updateAble.forEach(function(name){if(optionsToUpdate[name]!==undefined){options[name]=newOptions[name]}});newOptions.spectrum.direction=scope_Spectrum.direction;scope_Spectrum=newOptions.spectrum;options.margin=newOptions.margin;options.limit=newOptions.limit;options.padding=newOptions.padding;scope_Locations=[];valueSet(optionsToUpdate.start||v,fireSetEvent);
}if(scope_Target.Slider){throw new Error("Slider ("+VERSION+"): Slider was already initialized.")}addSlider(scope_Target);addElements(options.connect,scope_Base);scope_Self={destroy:destroy,steps:getCurrentStep,on:bindEvent,off:removeEvent,get:valueGet,set:valueSet,reset:valueReset,__moveHandles:function(a,b,c){moveHandles(a,b,scope_Locations,c)},options:originalOptions,updateOptions:updateOptions,target:scope_Target,pips:pips};bindSliderEvents(options.events);valueSet(options.start);if(options.pips){pips(options.pips)}if(options.tooltips){tooltips()}return scope_Self}function initialize(target,originalOptions){if(!target.nodeName){throw new Error("Slider ("+VERSION+"): create requires a single element.")}var options=testOptions(originalOptions,target);var api=closure(target,options,originalOptions);target.Slider=api;return api}return{version:VERSION,create:initialize}});